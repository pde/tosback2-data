(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/ :/.*/;this.oa_class=function(){};oa_class.extend=function(prop){var _super,prototype,name;_super=this.prototype;initializing=true;prototype=new this();initializing=false;for(name in prop){if(prop.hasOwnProperty(name)){prototype[name]=typeof prop[name]==="function"&&typeof _super[name]==="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp,ret;tmp=this._super;this._super=_super[name];ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}}function oa_class(){if(!initializing&&this.init){this.init.apply(this,arguments)}}oa_class.prototype=prototype;oa_class.prototype.constructor=oa_class;oa_class.extend=arguments.callee;return oa_class}})();var oneall={};oneall.user_settings={library_version:'2.2',plugin_protocol:'http',plugin_language:'en',application_domain:'mapstone.api.oneall.com',application_domains:["oneall.com","*.oneall.com","mapstone.net","*.mapstone.net"],parent_uri:'',base_domain:'',is_valid_base_domain:null,included_files:[]};oneall.user_settings.get_application_uri=function(){return this.plugin_protocol+'://'+this.application_domain};oneall.user_settings.get_provider_connect_uri=function(){return this.get_application_uri()+'/socialize/connect.html'};oneall.user_settings.get_provider_login_data_frame_uri=function(){return this.get_application_uri()+'/socialize/login/data/frame/'};oneall.user_settings.get_provider_login_frame_uri=function(){return this.get_application_uri()+'/socialize/login/frame/'};oneall.user_settings.get_provider_login_modal_uri=function(){return this.get_application_uri()+'/socialize/login/modal/'};oneall.user_settings.get_provider_link_frame_uri=function(){return this.get_application_uri()+'/socialize/link/frame/'};oneall.user_settings.get_provider_redirect_uri=function(){return this.get_application_uri()+'/socialize/redirect.html'};oneall.user_settings.get_sharing_library_uri=function(){return this.get_application_uri()+'/socialize/sharing/library.js'};(function(){var domains,domain,document_domain,valid_domain,i,regexp;domains=oneall.user_settings.application_domains;document_domain=document.domain;domains.push(oneall.user_settings.application_domain);valid_domain=false;i=0;while(!valid_domain&&i<domains.length){domain=domains[i];domain=domain.split('?').join('');domain=domain.split('$').join('');domain=domain.split('.').join('\\.');domain=domain.split('*').join('(.*)');regexp=new RegExp('^'+domain,'i');if(document_domain.match(regexp)){oneall.user_settings.base_domain=document_domain;valid_domain=true}i=i+1}oneall.user_settings.is_valid_base_domain=valid_domain}());oneall.browser={};oneall.browser.user_agent=navigator.userAgent.toLowerCase();oneall.browser.is_mobile=false;oneall.browser.is_win=(navigator.appVersion&&navigator.appVersion.toLowerCase().indexOf("win")!==-1);oneall.browser.is_ie=(navigator.appVersion&&navigator.appVersion.indexOf("MSIE")!==-1);oneall.browser.is_ie6=(navigator.appVersion&&navigator.appVersion.indexOf("MSIE 6.")!==-1);oneall.browser.is_ie7=(navigator.appVersion&&navigator.appVersion.indexOf("MSIE 7.")!==-1);oneall.browser.is_ie8=(navigator.appVersion&&navigator.appVersion.indexOf("MSIE 8.")!==-1);oneall.browser.is_ie9=(navigator.appVersion&&navigator.appVersion.indexOf("MSIE 9.")!==-1);oneall.browser.is_chrome=(oneall.browser.user_agent.indexOf("chrome")!==-1);oneall.browser.is_firefox=(oneall.browser.user_agent.indexOf("firefox")!==-1);oneall.browser.is_opera=(oneall.browser.user_agent.indexOf("opera")!==-1);oneall.browser.is_safari=(navigator.appVersion&&navigator.appVersion.toLowerCase().indexOf("safari")!==-1&&navigator.appVersion.toLowerCase().indexOf("chrome")===-1);oneall.browser.is_mac=(navigator.appVersion&&navigator.appVersion.toLowerCase().indexOf("mac")!==-1?true:false);oneall.browser.quirks_mode=(document.compatMode==="BackCompat"&&oneall.browser.is_ie);oneall.browser.back_compat=(document.compatMode==="BackCompat");oneall.console={};oneall.console.log=function(){if(arguments.length>0){if(typeof console!=="undefined"){console.log("[ONEALL CONSOLE LOG] ",arguments)}}};oneall.xd={cache_bust:1,interval_id:null,last_hash:''};oneall.xd.postMessage=function(message,target_url,target){if(!target_url){return}target=target||parent;if(window['postMessage']){target['postMessage'](message,target_url.replace(/([^:]+:\/\/[^\/]+).*/,'$1'))}else if(target_url){target.location=target_url.replace(/#.*$/,'')+'#'+(+new Date)+(this.cache_bust++)+'&'+message}};oneall.xd.receiveMessage=function(callback,source_origin){if(window['postMessage']){var attached_callback;if(callback){attached_callback=function(e){if((typeof source_origin==='string'&&e.origin!==source_origin)||(Object.prototype.toString.call(source_origin)==="[object Function]"&&source_origin(e.origin)===false)){return false}callback(e)}}if(window['addEventListener']){window[callback?'addEventListener':'removeEventListener']('message',attached_callback,false)}else{window[callback?'attachEvent':'detachEvent']('onmessage',attached_callback)}}else{this.interval_id&&clearInterval(this.interval_id);this.interval_id=null;if(callback){this.interval_id=setInterval(function(){var hash=document.location.hash,re=/^#?\d+&/;if(hash!==this.last_hash&&re.test(hash)){this.last_hash=hash;callback({data:hash.replace(re,'')})}},100)}}};oneall.tools={};oneall.tools.oak={};oneall.tools.oak.encrypt=function(key,pt){var i,j,x,y,s,ct,res,b16_digits,b16_map;key='oak'+key;s=[];for(i=0;i<256;i=i+1){s[i]=i}j=0;for(i=0;i<256;i=i+1){j=(j+s[i]+key.charCodeAt(i%key.length))%256;x=s[i];s[i]=s[j];s[j]=x}i=0;j=0;ct='';for(y=0;y<pt.length;y=y+1){i=(i+1)%256;j=(j+s[i])%256;x=s[i];s[i]=s[j];s[j]=x;ct+=String.fromCharCode(pt.charCodeAt(y)^s[(s[i]+s[j])%256])}b16_digits='0123456789abcdef';b16_map=[];for(i=0;i<256;i=i+1){b16_map[i]=b16_digits.charAt(i>>4)+b16_digits.charAt(i&15)}res=[];for(i=0;i<ct.length;i=i+1){res[i]=b16_map[ct.charCodeAt(i)]}return res.join('')};var JSON=JSON||{};oneall.tools.json_parse=JSON.parse||function(str){return(new Function("return "+str))()};oneall.tools.json_escape_string=function(str){var chr,i,j;var _SPECIAL=/[\x00-\x07\x0b\x0e-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var _COMMON=[[/\\/g,'\\\\'],[/\t/g,'\\t'],[/\n/g,'\\n'],[/\f/g,'\\f'],[/\r/g,'\\r'],[/\"/g,'\\"'],[/\x08/g,'\\b'],[/\x09/g,'\\t'],[/\x0a/g,'\\n'],[/\x0c/g,'\\f'],[/\x0d/g,'\\r']];for(i=0;i<(j=_COMMON.length);i++){chr=_COMMON[i];str=str.replace(chr[0],chr[1])}str=str.replace(_SPECIAL,function(str){return'\\u'+('0000'+(+(str.charCodeAt(0))).toString(16)).slice(-4)});return str};oneall.tools.json_stringify=function(mixed){var n,v,json,arr;if(mixed===null||typeof mixed!=="object"){if(typeof mixed==="string"){mixed='"'+this.json_escape_string(mixed)+'"'}return String(mixed)}else{json=[];arr=(mixed&&mixed.constructor===Array);for(n in mixed){if(mixed.hasOwnProperty(n)){v=mixed[n];if(typeof v==="string"||(typeof v==="object"&&v!==null)){v=this.json_stringify(v)}json.push((arr?"":'"'+this.json_escape_string(n)+'":')+String(v))}}return(arr?"[":"{")+String(json)+(arr?"]":"}")}};oneall.tools.get_elements_by_class_name=function(class_name,node){var i,regexp,elements,node_elements,num_node_elements;if(typeof node==='undefined'){node=document.getElementsByTagName("body")[0]}elements=[];regexp=new RegExp('\\b'+class_name+'\\b');node_elements=node.getElementsByTagName("*");num_node_elements=node_elements.length;for(i=0;i<num_node_elements;i=i+1){if(regexp.test(node_elements[i].className)){elements.push(node_elements[i])}}return elements};oneall.tools.str_replace=function(string,search,replace){return string.split(search).join(replace)};oneall.tools.remove_element_by_id=function(id){var element=document.getElementById(id);if(element){element.parentNode.removeChild(element)}};oneall.tools.hide_element_by_id=function(id){var element=document.getElementById(id);if(element){element.style.display="none"}};oneall.tools.show_element_by_id=function(id){var element=document.getElementById(id);if(element){if(oneall.browser&&oneall.browser.is_ie6){if(element.tagName.toLowerCase()==="td"){element.style.display="table-cell"}else if(element.tagName.toLowerCase()==="tr"||element.tagName.toLowerCase()==="table"){element.style.display=""}else{element.style.display="block"}}else{element.style.display="block"}}};oneall.tools.remove_element_class=function(element,classname){var regexp;if(oneall.tools.has_element_class(element,classname)){regexp=new RegExp('(\\s|^)'+classname+'(\\s|$)');element.className=element.className.replace(regexp,' ')}};oneall.tools.add_element_class=function(element,new_classname){var old_classname;new_classname=new_classname.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(new_classname.length>0){if(!oneall.tools.has_element_class(element,new_classname)){old_classname=element.className;old_classname=old_classname.replace(/^\s\s*/,'').replace(/\s\s*$/,'');if(old_classname.length>0){new_classname=old_classname+" "+new_classname}element.className=new_classname}}};oneall.tools.has_element_class=function(element,classname){var regexp;regexp=new RegExp('(\\s|^)'+classname+'(\\s|$)');return element.className.match(regexp)};oneall.tools.get_object_pos_x=function(obj){var pos_x;pos_x=0;if(obj.offsetParent){while(1){pos_x=pos_x+obj.offsetLeft;if(!obj.offsetParent){break}obj=obj.offsetParent}}else if(obj.x){pos_x=pos_x+obj.x}return pos_x};oneall.tools.get_object_pos_y=function(obj){var pos_y;pos_y=0;if(obj.offsetParent){while(1){pos_y=pos_y+obj.offsetTop;if(!obj.offsetParent){break}obj=obj.offsetParent}}else if(obj.y){pos_y=pos_y+obj.y}return pos_y};oneall.tools.get_viewport_size=function(){var viewport_w,viewport_h;if(typeof window.innerWidth!=='undefined'){viewport_w=window.innerWidth;viewport_h=window.innerHeight}else if(typeof document.documentElement!=='undefined'&&typeof document.documentElement.clientWidth!=='undefined'&&document.documentElement.clientWidth!==0){viewport_w=document.documentElement.clientWidth;viewport_h=document.documentElement.clientHeight}else{viewport_w=document.getElementsByTagName('body')[0].clientWidth;viewport_h=document.getElementsByTagName('body')[0].clientHeight}return{width:viewport_w,height:viewport_h}};oneall.tools.include_file=function(file_name,file_type,include_once){var include_file,file_ref;include_file=false;include_once=((typeof include_once=='undefined')?true:false);if(file_type=='js'||file_type=='css'){if(include_once===true){if(oneall.user_settings.included_files.indexOf('['+file_name+']')==-1){include_file=true}}else{include_file=true}}if(include_file===true){if(file_type=='js'){file_ref=document.createElement('script');file_ref.setAttribute('type','text/javascript');file_ref.setAttribute('src',file_name)}else if(file_type=='css'){file_ref=document.createElement('link');file_ref.setAttribute('rel','stylesheet');file_ref.setAttribute('type','text/css');file_ref.setAttribute('href',file_name)}document.getElementsByTagName("head")[0].appendChild(file_ref);oneall.user_settings.included_files+='['+file_name+']'}};oneall.tools.create_iframe=function(container,options){var frame_cw,options_name,options_id,options_border,options_width,options_height,options_src,options_background_color,frame,frame_object;options_name=(typeof options.name!=='undefined'?options.name:("oa_frame_"+(Math.floor(Math.random()*1000+1))));options_id=(typeof options.id!=='undefined'?options.id:('oa_frame_'+(Math.floor(Math.random()*1000+1))));options_border=(typeof options.border!=='undefined'?options.border:"0px");options_background_color=(typeof options.background_color!=='undefined'?options.background_color:"transparent");options_width=(typeof options.width!=='undefined'?options.width:"100%");options_height=(typeof options.height!=='undefined'?options.height:"100px");options_src=(typeof options.src!=='undefined'?options.src:"about:blank");options_async=(typeof options.async!=='undefined'?options.async:false);options_src=options_src+'&lang='+oneall.user_settings.plugin_language;try{frame=document.createElement('iframe');frame.setAttribute('id',options_id);frame.setAttribute('frameBorder','0');frame.setAttribute('scrolling','no');frame.setAttribute('allowTransparency','true');frame.setAttribute('data-processed','false');frame=container.appendChild(frame);frame.name=options_name;frame.style.border=options_border;frame.style.width=options_width;frame.style.height=options_height;frame.style.backgroundColor=options_background_color;if(options_async===true){frame.src='about:blank';frame_cw=frame.contentWindow.document;frame_cw.open().write('<body onload="var f=function(a){window.location.replace(a);};f(\''+options_src+'\');">');frame_cw.close()}else{frame.src=options_src}}catch(exception){container.innerHTML+='<iframe frameBorder="0" scrolling="no" allowTransparency="true" id="'+options_id+'" style="background-color:'+options_background_color+';border:'+options_border+';width:'+options_width+';height:'+options_height+';</iframe>';frame_object={};frame_object.document={};frame_object.document.location={};frame_object.document.location.iframe=document.getElementById(options_id);frame_object.document.location.replace=function(location){this.iframe.src=location}}return frame};oneall.tools.get_window_center_position=function(width,height){var screen_pos_left,screen_width,screen_pos_y,screen_height,left,top;screen_pos_y=0;if(oneall.browser.is_ie){screen_pos_left=window.screenLeft;screen_width=(typeof screen.availWidth!=='undefined'?screen.availWidth:screen.width);screen_height=(typeof screen.availHeight!=='undefined'?screen.availHeight:screen.height)}else{screen_pos_left=(typeof window.screenX!=='undefined'?window.screenX:window.screenLeft);screen_width=(typeof window.outerWidth!=='undefined'?window.outerWidth:document.documentElement.clientWidth);screen_height=(typeof window.outerHeight!=='undefined'?window.outerHeight:(document.documentElement.clientHeight-22))}left=parseInt(((screen_pos_left+(screen_width/2))-(width/2)),10);top=parseInt(screen_pos_y+((screen_height-height)/2.5),10);return('left='+left+',top='+top)};oneall.tools.open_window=function(url,window_name,window_options){var width,height,options,new_window;if(typeof window_options==="undefined"){window_options="menubar=0,toolbar=0,resizable=1,width=960,height=680"}width=window_options.split("width=")[1].split(",")[0];height=window_options.split("height=")[1].split(",")[0];options=window_options+','+oneall.tools.get_window_center_position(width,height);new_window=window.open(url,window_name,options);if(new_window&&new_window.focus){new_window.focus();return new_window}};oneall.api={};oneall.api.providers={};oneall.api.providers.get_provider_by_key=function(provider_key,providers_list){var i;if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}for(i=0;i<providers_list.length;i=i+1){if(providers_list[i].key.toLowerCase()===provider_key.toLowerCase()){return providers_list[i]}}return false};oneall.api.providers.get_providers_by_keys=function(provider_keys,providers_list){var i,j,providers,provider;if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}providers=[];provider=null;j=0;for(i=0;i<provider_keys.length;i=i+1){provider=oneall.api.providers.get_provider_by_key(provider_keys[i]);if(provider){providers[j]=provider;j=j+1}}return providers};oneall.api.providers.get_sanitized_providerids=function(providerids,providers_list){var i,j,sanitized_providerids,providers;if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}sanitized_providerids=[];if(providerids.length>0){providers=oneall.api.providers.get_providers_by_ids(providerids);if(providers.length>0){j=0;for(i=0;i<providers.length;i=i+1){sanitized_providerids[j]=providers[i].id;j=j+1}}}return sanitized_providerids};oneall.api.providers.get_providerids_by_keys=function(provider_keys,providers_list){var i,j,providers,providerids;if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}providers=this.get_providers_by_keys(provider_keys,providers_list);providerids=[];if(providers.length>0){j=0;for(i=0;i<providers.length;i=i+1){providerids[j]=providers[i].id;j=j+1}}return providerids};oneall.api.providers.get_provider_by_id=function(provider_id,providers_list){var i;provider_id=parseInt(provider_id,10);if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}for(i=0;i<providers_list.length;i=i+1){if(providers_list[i].id===provider_id){return providers_list[i]}}return false};oneall.api.providers.get_providers_by_ids=function(provider_ids,providers_list){var i,j,providers,provider;if(typeof providers_list==='undefined'){providers_list=oneall.api.providers.list}providers=[];if(provider_ids.length>0){j=0;for(i=0;i<provider_ids.length;i=i+1){provider=oneall.api.providers.get_provider_by_id(provider_ids[i]);if(provider){providers[j]=provider;j=j+1}}}return providers};oneall.api.providers.get_all_providers=function(){return oneall.api.providers.list.concat()};oneall.api.providers.provider=function(providerid,name,name_short,key,is_login_data_required,popup_width,popup_height){this.id=providerid;this.key=key;this.name=name;this.name_short=name_short;this.is_login_data_required=(is_login_data_required=='1'?true:false);this.popup_width=popup_width;this.popup_height=popup_height;this.popup_options="menubar=0,toolbar=0,resizable=1,scrollbars=1,width="+popup_width+",height="+popup_height;this.toString=function(){return this.name}};oneall.api.providers.list=[new oneall.api.providers.provider(1,"Facebook","Facebook","facebook","0",650,400),new oneall.api.providers.provider(2,"Google","Google","google","0",540,470),new oneall.api.providers.provider(3,"Twitter","Twitter","twitter","0",674,792),new oneall.api.providers.provider(4,"PayPal","PayPal","paypal","0",640,580),new oneall.api.providers.provider(5,"Yahoo","Yahoo","yahoo","0",500,560),new oneall.api.providers.provider(6,"OpenID","OpenID","openid","1",730,590),new oneall.api.providers.provider(7,"Windows Live","Live","windowslive","0",800,550),new oneall.api.providers.provider(8,"MySpace","MySpace","myspace","0",610,510),new oneall.api.providers.provider(9,"AOL","AOL","aol","0",530,720),new oneall.api.providers.provider(10,"LinkedIn","LinkedIn","linkedin","0",480,600),new oneall.api.providers.provider(11,"VeriSign","VeriSign","verisign","0",980,500),new oneall.api.providers.provider(12,"WordPress.com","WordPress","wordpress","1",790,570),new oneall.api.providers.provider(13,"Flickr","Flickr","flickr","0",700,540),new oneall.api.providers.provider(14,"Steam","Steam","steam","0",985,820),new oneall.api.providers.provider(15,"Messenger","Messenger","messenger","0",520,450),new oneall.api.providers.provider(16,"Digg","Digg","digg","0",730,590),new oneall.api.providers.provider(17,"Orkut","Orkut","orkut","0",610,510),new oneall.api.providers.provider(18,"Blogger","Blogger","blogger","1",760,400),new oneall.api.providers.provider(19,"ClaimID","ClaimID","claimid","0",760,400),new oneall.api.providers.provider(20,"ClickPass","ClickPass","clickpass","0",760,400),new oneall.api.providers.provider(21,"Hyves","Hyves","hyves","0",700,540),new oneall.api.providers.provider(22,"LiveJournal","LiveJournal","livejournal","1",860,500),new oneall.api.providers.provider(23,"Typepad","Typepad","typepad","0",730,590),new oneall.api.providers.provider(24,"Netlog","Netlog","netlog","0",730,590),new oneall.api.providers.provider(25,"SignOn","SignOn","signon","0",870,900),new oneall.api.providers.provider(26,"Orange France","Orange France","orangefrance","0",730,590),new oneall.api.providers.provider(27,"Mixi","Mixi","mixi","0",730,590),new oneall.api.providers.provider(28,"Livedoor","Livedoor","livedoor","0",970,700),new oneall.api.providers.provider(29,"Fox News","Fox News","foxnews","0",730,590),new oneall.api.providers.provider(30,"Foursquare","Foursquare","foursquare","0",980,500),new oneall.api.providers.provider(31,"VKontakte","VKontakte","vkontakte","0",674,792),new oneall.api.providers.provider(32,"StackExchange","StackExchange","stackexchange","0",965,545),new oneall.api.providers.provider(34,"Mail.ru","Mail.ru","mailru","1",980,560),new oneall.api.providers.provider(36,"Skyrock.com","Skyrock","skyrock","0",996,470),new oneall.api.providers.provider(38,"Github.com","Github","github","0",980,580),new oneall.api.providers.provider(40,"Disqus","Disqus","disqus","0",648,300),new oneall.api.providers.provider(42,"YouTube","YouTube","youtube","0",674,792),new oneall.api.providers.provider(44,"Odnoklassniki","Odnoklassniki","odnoklassniki","0",674,792)];oneall.api.plugins={};var oa_social_abstract=oa_class.extend({init:function(pluginkey,args){args=((typeof args!=='undefined')?args:{});this.parent_uri=(typeof args.parent_uri!=='undefined'?args.parent_uri:document.location.href);this.callback_uri=(typeof args.callback_uri!=='undefined'?args.callback_uri:'');this.css_theme_uri=(typeof args.css_theme_uri!=='undefined'?args.css_theme_uri:'');this.demo=((typeof args.demo!=='undefined'&&args.demo===true)?true:false);this.force_reauth=((typeof args.force_reauth!=='undefined'&&args.force_reauth===true)?true:false);this.same_window=(typeof args.same_window!=='undefined'?args.same_window:null);this.modal=((typeof args.modal!=='undefined'&&args.modal===true)?true:false);this.grid_size_x=(((typeof args.grid_size_x!=='undefined')&&!isNaN(parseInt(args.grid_size_x,10)))?parseInt(args.grid_size_x,10):99);this.grid_size_y=(((typeof args.grid_size_y!=='undefined')&&!isNaN(parseInt(args.grid_size_y,10)))?parseInt(args.grid_size_y,10):99);this.id=(typeof args.id!=='undefined'?args.id:(10000+Math.floor(Math.random()*99999+1)));this.providers=(typeof args.providers==='object'&&args.providers.length?args.providers:oneall.api.providers.get_all_providers());this.linked_providers=(typeof args.provider_application_identities==='object'?args.provider_application_identities:[]);this.events=(typeof args.events==='object'?args.events:{});this.pluginkey=pluginkey;this.location='';this.args=((typeof this.args==='object')?this.args:{});this.args.id=this.id;this.args.parent_uri=this.parent_uri;this.args.callback_uri=this.callback_uri;this.args.css_theme_uri=this.css_theme_uri;this.args.modal=this.modal;this.args.force_reauth=this.force_reauth;this.args.same_window=this.same_window;this.args.demo=this.demo;this.args.pluginkey=this.pluginkey;this.args.linked_providers=this.linked_providers;this.args.grid_size_x=this.grid_size_x;this.args.grid_size_y=this.grid_size_y;this.args.providers=this.providers},build:function(target_url,container_class_or_id){var oakv,i,container,containers,args,tmp;args=this.args;args.parent_uri=encodeURIComponent(args.parent_uri);args.callback_uri=encodeURIComponent(args.callback_uri);args=oneall.tools.json_stringify(args);containers=document.getElementById(container_class_or_id);if(containers!==null&&typeof containers==='object'){containers=[containers]}else{containers=oneall.tools.get_elements_by_class_name(container_class_or_id)}if(containers!==null&&typeof containers==='object'){if(oneall.user_settings.is_valid_base_domain===false){for(i=0;i<containers.length;i=i+1){container=containers[i];container.style.cssText='visibility: visible;background-color:#efdfdf;color:#B80C14;padding:10px;line-height:16px;font-size:11px;border: 1px dashed #B80C14;display:block';container.innerHTML='<strong>[OneAll Social Login]</strong> To enforce the security of our services we require each domain to be whitelisted. Please <a style="color:#333;text-decoration: underline;" target="_blank" href="https://app.oneall.com/applications/application/settings/security/?applicationid=3173">click here to open your security settings</a> and whitelist the domain <strong>'+document.domain+'</strong>. Reload this page afterwards.'}throw new Error("[ONEALL SOCIAL API] The domain "+document.domain+" is not allowed to include this script. Please check your OneAll site security settings.")}else{for(i=0;i<containers.length;i=i+1){container=containers[i];if(this.modal!==true){oakv=oneall.tools.oak.encrypt(this.id,args);container.innerHTML='';oneall.tools.create_iframe(container,{'id':'oa_'+this.pluginkey+'_frame_'+this.id,'name':'OneAll Social Login','width':'100%','height':'0','async':false,'src':(target_url+'?oakk='+this.id+'&oakv='+oakv)})}else{container.style.cursor='pointer';container.onclick=function(me){return function(){me.open_login_modal_dialog();return false}}(this)}}var thiz=this;oneall.xd.receiveMessage(function(message){thiz.xd_listener(message)},oneall.user_settings.get_application_uri())}}else{throw new Error("[ONEALL SOCIAL API] No plugin container with the id/class ["+containers+"] has not been found")}},show_providers_in_container:function(provider_containerid){var i,cfunc,group_id,group,group_size_max,group_size,row,row_size_max,row_size,scrollbody,scroll,block,provider,provider_block,providers_group,providers_row,tick,link,text,provider_container,providers,providers_keys,document_height;providers=oneall.api.providers.get_providers_by_keys(this.providers);provider_container=document.getElementById(provider_containerid);if(provider_container){group_size_max=(this.grid_size_x*this.grid_size_y);group_size=0;group_id=0;row_size_max=this.grid_size_x;row_size=0;group_id=group_id+1;group=document.createElement('div');group.className='providers_group';group.setAttribute('id','providers_group_'+group_id);block=document.createElement('div');block.className='providers_block';row=document.createElement('div');row.className='providers_row';for(i=0;i<providers.length;i=i+1){provider=providers[i];cfunc=function(me,providerid){return function(){var date_old=this.parentNode.getAttribute('data-click');var date_new=new Date().getTime();var trigger=true;if(typeof date_old!=='undefined'){if(date_new>=date_old&&((date_new-date_old)<2000)){trigger=false}}if(trigger){this.parentNode.setAttribute('data-click',date_new);me.do_provider_login(providerid);return true}return false}}(this,provider.id);provider_block=document.createElement('div');provider_block.className=((typeof this.linked_providers[provider.key]==='object')?'provider provider_linked':'provider');provider_block.setAttribute('id','provider_'+provider.key);link=document.createElement('a');link.className='button';link.setAttribute('id','button_'+provider.key);link.setAttribute('href','#');link.setAttribute('rel','nofollow');link.onclick=cfunc;link.setAttribute('title',"Login with "+provider.name);link.setAttribute('alt',"Login with "+provider.name);tick=document.createElement('span');tick.className='tick';text=document.createElement('div');text.className='name';text.setAttribute('id','name_'+provider.key);text.onclick=cfunc;text.appendChild(document.createTextNode(provider.name_short));link.appendChild(tick);provider_block.appendChild(link);provider_block.appendChild(text);row.appendChild(provider_block);group_size=group_size+1;row_size=row_size+1;block.appendChild(row);if(row_size===row_size_max){row=document.createElement('div');row.className='providers_row';row_size=0}if(group_size===group_size_max){group.appendChild(block);block=document.createElement('div');block.className='providers_block';if((i+1)<providers.length){scroll=document.createElement('div');scroll.className='scroll scroll_right';scroll.onclick=function(me,page,direction){return function(){me.paginate_provider_group(page,direction)}}(this,group_id,'right');scrollbody=document.createElement('div');scroll.appendChild(scrollbody);group.appendChild(scroll);provider_container.appendChild(group);group_id=group_id+1;group=document.createElement('div');group.className='providers_group hidden';group.setAttribute('id','providers_group_'+group_id);scroll=document.createElement('div');scroll.className='scroll scroll_left';scroll.onclick=function(me,page,direction){return function(){me.paginate_provider_group(page,direction)}}(this,group_id,'left');scrollbody=document.createElement('div');scroll.appendChild(scrollbody);group.appendChild(scroll);group_size=0;row_size=0}}else{provider_container.appendChild(group)}}if(row_size>0||group_size>0){group.appendChild(block);provider_container.appendChild(group)}if(group_id===1){provider_container.className='providers_unpaginated'}}else{throw new Error("[ONEALL SOCIAL API] The provider container with the id ["+provider_container+"] has not been found")}},paginate_provider_group:function(page,direction){var element1,element2;element1=document.getElementById('providers_group_'+page);if(direction==='right'){element2=document.getElementById('providers_group_'+(page+1))}else{element2=document.getElementById('providers_group_'+(page-1))}if(element1&&element2){element1.style.display="none";element2.style.display="block"}},show_message:function(message,type,key){var element;element=document.getElementById('message');if(element){if(type==='error'){oneall.tools.remove_element_class(element,'notice');oneall.tools.add_element_class(element,'error')}else{oneall.tools.remove_element_class(element,'error');oneall.tools.add_element_class(element,'notice')}if(typeof key!=='undefined'){element.setAttribute('data-key',key)}else{element.removeAttribute('data-key')}element.innerHTML='';element.appendChild(document.createTextNode(message));oneall.tools.hide_element_by_id('branding');oneall.tools.show_element_by_id('message')}},hide_message:function(key){var element;element=document.getElementById('message');if(element){if(typeof key!=='undefined'){if(element.getAttribute('data-key')===key){oneall.tools.hide_element_by_id('message');oneall.tools.show_element_by_id('branding')}}else{oneall.tools.hide_element_by_id('message');oneall.tools.show_element_by_id('branding')}}},open_dialog:function(id,uri){var dialog,overlay;overlay=document.createElement('div');overlay.setAttribute('id','oa_'+this.pluginkey+'_'+id+'_overlay_'+this.id);overlay.style.position='fixed';overlay.style.left='0';overlay.style.top='0';overlay.style.width='100%';overlay.style.height='100%';overlay.style.textAlign='center';overlay.style.overflow='auto';overlay.style.zIndex='2147483640';overlay.style.backgroundImage="url('https://secure.oneallcdn.com/img/api/socialize/gui/overlay.png')";overlay.style.backgroundRepeat='repeat';overlay.style.backgroundPosition='0 0';overlay.style.backgroundColor='transparent';document.body.appendChild(overlay);dialog=document.createElement('div');dialog.setAttribute('id','oa_'+this.pluginkey+'_'+id+'_dialog_'+this.id);dialog.style.marginLeft='-240px';dialog.style.position='fixed';dialog.style.left='50%';dialog.style.top='15%';dialog.style.width='480px';dialog.style.textAlign='left';dialog.style.zIndex='2147483641';oneall.tools.create_iframe(dialog,{'id':'oa_'+this.pluginkey+'_'+id+'_dialog_'+this.id,'name':'SocialLogin','width':'480px','height':'480px','src':uri});document.body.appendChild(dialog)},close_dialog:function(id,uri){oneall.tools.remove_element_by_id('oa_'+this.pluginkey+'_'+id+'_dialog_'+this.id);oneall.tools.remove_element_by_id('oa_'+this.pluginkey+'_'+id+'_overlay_'+this.id)},hide_dialog:function(id){oneall.tools.hide_element_by_id('oa_'+this.pluginkey+'_'+id+'_dialog_'+this.id);oneall.tools.hide_element_by_id('oa_'+this.pluginkey+'_'+id+'_overlay_'+this.id)},show_dialog:function(id){oneall.tools.show_element_by_id('oa_'+this.pluginkey+'_'+id+'_dialog_'+this.id);oneall.tools.show_element_by_id('oa_'+this.pluginkey+'_'+id+'_overlay_'+this.id)},setup_login_frame:function(container){var db,dde,dh,dw;this.show_providers_in_container(container);db=document.body;dde=document.documentElement;dh=Math.max(db.scrollHeight,dde.scrollHeight,db.offsetHeight,dde.offsetHeight,dde.clientHeight);dw=Math.max(db.scrollWidth,dde.scrollWidth,db.offsetWidth,dde.offsetWidth,dde.clientWidth);this.xd_poster('resize_frame|'+dh+'-'+dw)},trigger_launch:function(which,data){if(typeof this.events==='object'&&typeof this.events[which]==='function'){if(typeof data!=='undefined'){this.events[which](data)}else{this.events[which]()}}},handle_callback:function(json_string){var json;try{json=oneall.tools.json_parse(json_string)}catch(e){oneall.console.log(json_string);throw e}if(typeof this.events==='object'&&typeof this.events['oncallback']==='function'){if(this.events['oncallback'](json)!==false){window.location.href=oneall.user_settings.get_provider_redirect_uri()+'?provider_connection_token='+json.connection.token}}else{window.location.href=oneall.user_settings.get_provider_redirect_uri()+'?provider_connection_token='+json.connection.token}},open_login_modal_dialog:function(){var args,oakv,uri;args=this.args;args.grid_size_x=2;args.grid_size_y=2;args=oneall.tools.json_stringify(args);oakv=oneall.tools.oak.encrypt(this.id,args);uri=(oneall.user_settings.get_provider_login_modal_uri()+'?oakk='+this.id+'&oakv='+oakv);this.open_dialog('login_modal',uri)},close_login_modal_dialog:function(){this.close_dialog('login_modal')},setup_login_modal_dialog:function(container){var element;element=document.getElementById('close_login_modal_dialog');if(element){element.onclick=function(me){return function(){me.xd_poster('close_login_modal_dialog')}}(this)}this.show_providers_in_container(container)},open_login_data_dialog:function(providerid){var args,oakv,provider;provider=oneall.api.providers.get_provider_by_id(providerid);if(provider!==false){args=this.args;args.providerid=provider.id;args.pluginkey=this.pluginkey;args=oneall.tools.json_stringify(args);oakv=oneall.tools.oak.encrypt(provider.id,args);if((typeof this.args.modal!=='undefined'&&this.args.modal===true)){this.hide_dialog('login_modal')}this.open_dialog('login_data',(oneall.user_settings.get_provider_login_data_frame_uri()+'?oakk='+provider.id+'&oakv='+oakv))}else{throw new Error("[ONEALL SOCIAL API] Non-existent provider ["+providerid+"] specified")}},close_login_data_dialog:function(){this.close_dialog('login_data');if((typeof this.args.modal!=='undefined'&&this.args.modal===true)){this.show_dialog('login_modal')}},setup_login_data_dialog:function(providerid){var element,field;element=document.getElementById('close_login_data_dialog');if(element){element.onclick=function(me){return function(){me.xd_poster('close_login_data_dialog')}}(this)}element=document.getElementById('login_data_dialog_form');if(element){element.onsubmit=function(me,providerid){return function(){field=document.getElementById('login_data_dialog_value');if(field&&field.value.length>0){me.do_provider_login(providerid,field.value)}return false}}(this,providerid)}},xd_poster:function(data){oneall.xd.postMessage(this.id+'::'+data,this.parent_uri,window.parent)},xd_parser:function(message){var message_data_parts,message_target_id,message_content,message_content_parts;if(typeof message.data!=='undefined'){message_data_parts=message.data.split('::');if(message_data_parts.length===2){message_target_id=parseInt(message_data_parts[0],10);if(message_target_id===this.id){message_content=message_data_parts[1];message_content_parts=message_content.split('|');return message_content_parts}}}return},xd_listener:function(message){var message_content_parts,message_action_parts,element,w_int,w_tag,h_int,h_tag;message_content_parts=this.xd_parser(message);if(typeof message_content_parts!=='undefined'){switch(message_content_parts[0]){case'open_login_data_dialog':if(message_content_parts.length===2){this.open_login_data_dialog(message_content_parts[1])}break;case'close_login_data_dialog':this.close_login_data_dialog();break;case'close_login_modal_dialog':this.close_login_modal_dialog();break;case'handle_callback':if(message_content_parts.length===2){this.handle_callback(message_content_parts[1])}break;case'redirect':if(message_content_parts.length===2){window.location.href=message_content_parts[1]}break;case'resize_frame':if(message_content_parts.length===2){message_action_parts=message_content_parts[1].split('-');if(message_action_parts.length===2){element=document.getElementById('oa_'+this.pluginkey+'_frame_'+this.id);if(element){w_int=parseInt(message_action_parts[1],10);h_int=parseInt(message_action_parts[0],10);if(w_int===0){w_tag='width:100%;'}else{w_tag='width:'+w_int+'px;'}if(h_int===0){h_tag=''}else{h_tag='height:'+h_int+'px !important;'}element.style.cssText='visibility: visible;background-color:transparent;border:0 none; '+h_tag+''+w_tag;element.setAttribute('data-processed','true')}}}this.trigger_launch('onload',element);break}}},do_provider_login:function(providerid,login_data,args){var provider,login_uri,login_window,timer,thiz,action;args=((typeof args!=='undefined')?args:{});args=oneall.tools.json_stringify(args);if(typeof this.demo!=='undefined'&&this.demo===true){alert("The login is disabled in the preview box");return false}login_data=((typeof login_data==='undefined')?'':login_data);provider=oneall.api.providers.get_provider_by_id(providerid);if(provider!==false){if(provider.is_login_data_required===true&&login_data.length===0){this.xd_poster('open_login_data_dialog|'+providerid)}else{this.show_message("Connecting...",'succes','connection_message');login_uri=oneall.user_settings.get_provider_connect_uri()+'?force_reauth='+this.force_reauth+'&xdframeid='+(this.id)+'&providerid='+providerid+'&plugin='+this.pluginkey+'&callback_uri='+encodeURIComponent(this.callback_uri)+'&args='+encodeURIComponent(args)+'&login_data='+encodeURIComponent(login_data);if(this.same_window===true||(this.same_window===null&&oneall.browser.is_mobile===true)){this.xd_poster('redirect|'+login_uri+'&same_window=1')}else{login_window=oneall.tools.open_window(login_uri,'Connect',provider.popup_options);if(typeof login_window==='object'){thiz=this;timer=setInterval(function(){if(login_window.closed){clearInterval(timer);thiz.hide_message('connection_message')}},500)}}}}else{throw new Error("[ONEALL SOCIAL API] Non-existent provider ["+providerid+"] specified")}}});var oa_social_login=oa_social_abstract.extend({init:function(args){this._super('social_login',args)},build:function(container_class_or_id){this._super(oneall.user_settings.get_provider_login_frame_uri(),container_class_or_id)},handle_callback_result:function(json){if(typeof json==='object'&&json.connection.status!=='undefined'){if(json.connection.status==='success'){this.xd_poster('handle_callback|'+oneall.tools.json_stringify(json))}else{switch(json.connection.flag){case'invalid_openid_endpoint':this.show_message("The specified url is not a valid OpenID endpoint",'error','error_message');break;case'user_has_cancelled':return true;break;default:this.show_message("An error occurred. Please try again later!",'error','error_message');break}}}}});var oa_social_link=oa_social_abstract.extend({init:function(args){this._super('social_link',args);args=((typeof args!=='undefined')?args:{});args.user_token=(typeof args.user_token!=='undefined'?args.user_token:'');this.args.user_token=args.user_token;this.user_token=args.user_token},build:function(container_class_or_id){this._super(oneall.user_settings.get_provider_link_frame_uri(),container_class_or_id)},handle_callback_result:function(json){if(typeof json==='object'&&json.connection.status!=='undefined'){switch(json.connection.status){case'error':switch(json.connection.operation){case'nothing_to_do':switch(json.connection.reason){case'invalid_openid_endpoint':this.show_message("The specified url is not a valid OpenID endpoint",'error');return true;case'identity_is_linked_to_another_user':this.show_message("The social profile is linked to another user",'error');return true;case'identity_is_last_one':this.show_message("At least one profile must remain linked to allow you to sign in",'error');return true;case'user_cancelled_operation':return true}break}break;case'success':switch(json.connection.operation){case'nothing_to_do':switch(json.connection.reason){case'identity_was_already_linked':this.show_message("The social profile is already linked",'notice');return true;case'identity_does_not_exist':return true}break}break}this.xd_poster('redirect|'+oneall.user_settings.get_provider_redirect_uri()+'?provider_connection_token='+json.connection.token)}},xd_listener:function(message){var message_content_parts,message_action_parts,element;message_content_parts=this.xd_parser(message);if(typeof message_content_parts!=='undefined'){switch(message_content_parts[0]){case'open_idm':if(message_content_parts.length===2){this.open_idm(message_content_parts[1])}break;case'close_idm':this.close_idm();break;default:this._super(message);break}}},setup_idm_dialog:function(providerid){var elements,i,identity;this.providerid=(typeof providerid!=='undefined'?providerid:null);elements=oneall.tools.get_elements_by_class_name('close_dialog');if(elements!==null&&typeof elements==='object'){for(i=0;i<elements.length;i=i+1){elements[i].onclick=function(me){return function(){me.xd_poster('close_idm')}}(this)}}elements=oneall.tools.get_elements_by_class_name('unlink_account');if(elements!==null&&typeof elements==='object'){for(i=0;i<elements.length;i=i+1){identity=elements[i].getAttribute('data-identity');elements[i].onclick=function(me,providerid,identity){return function(){me.do_provider_login(providerid,false,identity)}}(this,providerid,identity)}}elements=oneall.tools.get_elements_by_class_name('link_account');if(elements!==null&&typeof elements==='object'){for(i=0;i<elements.length;i=i+1){elements[i].onclick=function(me,providerid){return function(){me.do_provider_login(providerid,true)}}(this,providerid,identity)}}oneall.xd.receiveMessage(function(message){oneall.api.plugins.social_link.xd_listener(message)},document.location)},close_idm:function(){this.close_dialog('idm')},open_idm:function(providerid){var args,oakv,uri,provider;provider=oneall.api.providers.get_provider_by_id(providerid);if(provider!==false){args=this.args;args.providerid=providerid;args=oneall.tools.json_stringify(args);oakv=oneall.tools.oak.encrypt(this.id,args);uri=(oneall.user_settings.plugin_protocol+'://mapstone.api.oneall.com/socialize/link/idm/modal/?oakk='+this.id+'&oakv='+oakv);this.open_dialog('idm',uri)}else{throw new Error("[ONEALL SOCIAL API] Non-existent provider ["+providerid+"] specified")}},setup_login_data_dialog:function(providerid){var element,field;element=document.getElementById('close_login_data_dialog');if(element){element.onclick=function(me){return function(){me.xd_poster('close_login_data_dialog')}}(this)}element=document.getElementById('login_data_dialog_form');if(element){element.onsubmit=function(me,providerid){return function(){field=document.getElementById('login_data_dialog_value');if(field&&field.value.length>0){me.do_provider_login(providerid,true,field.value)}return false}}(this,providerid)}},open_login_data_dialog:function(providerid){this.hide_dialog('idm');this._super(providerid)},close_login_data_dialog:function(){this.show_dialog('idm');this._super()},do_provider_login:function(providerid,link_identity,login_data){var provider;link_identity=(typeof link_identity==='undefined'?true:link_identity);provider=oneall.api.providers.get_provider_by_id(providerid);if(provider!==false){if(typeof this.linked_providers[provider.key]==='object'){this.xd_poster('open_idm|'+provider.id)}else{this._super(providerid,login_data,{'user_token':this.user_token,'link_identity':link_identity})}}}});var oa_social_sharing=function(){this.include_library=function(){oneall.tools.include_file(oneall.user_settings.get_sharing_library_uri(),'js',true)};this.conditional_setup=function(){var elements=oneall.tools.get_elements_by_class_name('oas_box');if(typeof elements==='object'&&elements.length>0){this.include_library()}}};oneall.api.plugins.social_login={};oneall.api.plugins.social_login.build=function(container_class_or_id,args){var plugin;plugin=new oa_social_login(args);plugin.build(container_class_or_id)};oneall.api.plugins.social_login.modal={};oneall.api.plugins.social_login.modal.attach=function(container_class,args){args=((typeof args==='object')?args:{});args.modal=true;oneall.api.plugins.social_login.build(container_class,args)};oneall.api.plugins.social_link={};oneall.api.plugins.social_link.build=function(container_class_or_id,args){var plugin;plugin=new oa_social_link(args);plugin.build(container_class_or_id)};oneall.api.plugins.social_link.setup_frame=function(container_class_or_id,args){var plugin;plugin=new oa_social_link(args);plugin.setup_login_frame(container_class_or_id)};oneall.api.plugins.social_sharing={};oneall.api.plugins.social_sharing.build=function(){if(typeof oneall.api.plugins.social_sharing.build.plugin=='undefined'){oneall.api.plugins.social_sharing.build.plugin=new oa_social_sharing()}oneall.api.plugins.social_sharing.build.plugin.include_library()};oneall.loader={};oneall.loader.add_event=function(onload_new){var onload_current=window.onload;if(typeof onload_current!='function'){window.onload=function(){onload_new()}}else{window.onload=function(){onload_current();onload_new()}}};oneall.loader.add_event(function(){if(typeof oneall.loader.social_sharing=='undefined'){oneall.loader.social_sharing=new oa_social_sharing();oneall.loader.social_sharing.conditional_setup()}});