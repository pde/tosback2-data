jQuery.cookie=function(a,b,c){if(arguments.length>1&&String(b)!=="[object Object]"){c=jQuery.extend({},c);if(b===null||b===void 0)c.expires=-1;if(typeof c.expires==="number"){var d=c.expires,f=c.expires=new Date;f.setDate(f.getDate()+d)}b=String(b);return document.cookie=[encodeURIComponent(a),"=",c.raw?b:encodeURIComponent(b),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=b||{};f=c.raw?function(a){return a}:
decodeURIComponent;return(d=RegExp("(?:^|; )"+encodeURIComponent(a)+"=([^;]*)").exec(document.cookie))?f(d[1]):null};
(function(a,b){function c(a,b){for(var c=decodeURI(a),c=e[b?"strict":"loose"].exec(c),d={attr:{},param:{},seg:{}},f=14;f--;)d.attr[j[f]]=c[f]||"";d.param.query={};d.param.fragment={};d.attr.query.replace(l,function(a,b,c){b&&(d.param.query[b]=c)});d.attr.fragment.replace(p,function(a,b,c){b&&(d.param.fragment[b]=c)});d.seg.path=d.attr.path.replace(/^\/+|\/+$/g,"").split("/");d.seg.fragment=d.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");d.attr.base=d.attr.host?d.attr.protocol+"://"+d.attr.host+
(d.attr.port?":"+d.attr.port:""):"";return d}function d(a){a=a.tagName;if(a!==b)return f[a.toLowerCase()];return a}var f={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href"},j=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],h={anchor:"fragment"},e={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},l=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,p=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;a.fn.url=function(b){var c="";this.length&&(c=a(this).attr(d(this[0]))||"");return a.url(c,b)};a.url=function(a,e){arguments.length===1&&a===!0&&(e=!0,a=b);a=a||window.location.toString();return{data:c(a,e||!1),attr:function(a){a=h[a]||
a;return a!==b?this.data.attr[a]:this.data.attr},param:function(a){return a!==b?this.data.param.query[a]:this.data.param.query},fparam:function(a){return a!==b?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){return a===b?this.data.seg.path:(a=a<0?this.data.seg.path.length+a:a-1,this.data.seg.path[a])},fsegment:function(a){return a===b?this.data.seg.fragment:(a=a<0?this.data.seg.fragment.length+a:a-1,this.data.seg.fragment[a])}}}})(jQuery);
(function(){var a=this,b=a.Backbone,c=[],d=c.push,f=c.slice,j=c.splice,h;h=typeof exports!=="undefined"?exports:a.Backbone={};h.VERSION="1.0.0";var e=a._;!e&&typeof require!=="undefined"&&(e=require("underscore"));h.$=a.jQuery||a.Zepto||a.ender||a.$;h.noConflict=function(){a.Backbone=b;return this};h.emulateHTTP=!1;h.emulateJSON=!1;var l=h.Events={on:function(o,a,k){if(!n(this,"on",o,[a,k])||!a)return this;this._events||(this._events={});(this._events[o]||(this._events[o]=[])).push({callback:a,context:k,
ctx:k||this});return this},once:function(o,a,k){if(!n(this,"once",o,[a,k])||!a)return this;var b=this,c=e.once(function(){b.off(o,c);a.apply(this,arguments)});c._callback=a;return this.on(o,c,k)},off:function(a,g,k){var b,c,d,f,h,j,l,m;if(!this._events||!n(this,"off",a,[g,k]))return this;if(!a&&!g&&!k)return this._events={},this;f=a?[a]:e.keys(this._events);h=0;for(j=f.length;h<j;h++)if(a=f[h],d=this._events[a]){this._events[a]=b=[];if(g||k){l=0;for(m=d.length;l<m;l++)c=d[l],(g&&g!==c.callback&&g!==
c.callback._callback||k&&k!==c.context)&&b.push(c)}b.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var g=f.call(arguments,1);if(!n(this,"trigger",a,g))return this;var k=this._events[a],b=this._events.all;k&&t(k,g);b&&t(b,arguments);return this},stopListening:function(a,g,k){var b=this._listeners;if(!b)return this;var c=!g&&!k;typeof g==="object"&&(k=this);a&&((b={})[a._listenerId]=a);for(var e in b)b[e].off(g,k,this),c&&delete this._listeners[e];return this}},
p=/\s+/,n=function(a,g,k,b){if(!k)return!0;if(typeof k==="object"){for(var c in k)a[g].apply(a,[c,k[c]].concat(b));return!1}if(p.test(k)){k=k.split(p);c=0;for(var e=k.length;c<e;c++)a[g].apply(a,[k[c]].concat(b));return!1}return!0},t=function(a,g){var k,b=-1,c=a.length,e=g[0],d=g[1],f=g[2];switch(g.length){case 0:for(;++b<c;)(k=a[b]).callback.call(k.ctx);break;case 1:for(;++b<c;)(k=a[b]).callback.call(k.ctx,e);break;case 2:for(;++b<c;)(k=a[b]).callback.call(k.ctx,e,d);break;case 3:for(;++b<c;)(k=
a[b]).callback.call(k.ctx,e,d,f);break;default:for(;++b<c;)(k=a[b]).callback.apply(k.ctx,g)}};e.each({listenTo:"on",listenToOnce:"once"},function(a,g){l[g]=function(g,b,c){var d=this._listeners||(this._listeners={}),f=g._listenerId||(g._listenerId=e.uniqueId("l"));d[f]=g;typeof b==="object"&&(c=this);g[a](b,c,this);return this}});l.bind=l.on;l.unbind=l.off;e.extend(h,l);var m=h.Model=function(a,g){var b,c=a||{};g||(g={});this.cid=e.uniqueId("c");this.attributes={};e.extend(this,e.pick(g,u));g.parse&&
(c=this.parse(c,g)||{});if(b=e.result(this,"defaults"))c=e.defaults({},c,b);this.set(c,g);this.changed={};this.initialize.apply(this,arguments)},u=["url","urlRoot","collection"];e.extend(m.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return e.clone(this.attributes)},sync:function(){return h.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return e.escape(this.get(a))},has:function(a){return this.get(a)!=
null},set:function(a,g,b){var c,d,f,h,j,l,m;if(a==null)return this;typeof a==="object"?(d=a,b=g):(d={})[a]=g;b||(b={});if(!this._validate(d,b))return!1;f=b.unset;h=b.silent;a=[];j=this._changing;this._changing=!0;if(!j)this._previousAttributes=e.clone(this.attributes),this.changed={};m=this.attributes;l=this._previousAttributes;if(this.idAttribute in d)this.id=d[this.idAttribute];for(c in d)g=d[c],e.isEqual(m[c],g)||a.push(c),e.isEqual(l[c],g)?delete this.changed[c]:this.changed[c]=g,f?delete m[c]:
m[c]=g;if(!h){if(a.length)this._pending=!0;g=0;for(c=a.length;g<c;g++)this.trigger("change:"+a[g],this,m[a[g]],b)}if(j)return this;if(!h)for(;this._pending;)this._pending=!1,this.trigger("change",this,b);this._changing=this._pending=!1;return this},unset:function(a,g){return this.set(a,void 0,e.extend({},g,{unset:!0}))},clear:function(a){var g={},b;for(b in this.attributes)g[b]=void 0;return this.set(g,e.extend({},a,{unset:!0}))},hasChanged:function(a){if(a==null)return!e.isEmpty(this.changed);return e.has(this.changed,
a)},changedAttributes:function(a){if(!a)return this.hasChanged()?e.clone(this.changed):!1;var g,b=!1,c=this._changing?this._previousAttributes:this.attributes,d;for(d in a)if(!e.isEqual(c[d],g=a[d]))(b||(b={}))[d]=g;return b},previous:function(a){if(a==null||!this._previousAttributes)return null;return this._previousAttributes[a]},previousAttributes:function(){return e.clone(this._previousAttributes)},fetch:function(a){a=a?e.clone(a):{};if(a.parse===void 0)a.parse=!0;var g=this,b=a.success;a.success=
function(c){if(!g.set(g.parse(c,a),a))return!1;b&&b(g,c,a);g.trigger("sync",g,c,a)};x(this,a);return this.sync("read",this,a)},save:function(a,g,b){var c,d=this.attributes;a==null||typeof a==="object"?(c=a,b=g):(c={})[a]=g;if(c&&(!b||!b.wait)&&!this.set(c,b))return!1;b=e.extend({validate:!0},b);if(!this._validate(c,b))return!1;if(c&&b.wait)this.attributes=e.extend({},d,c);if(b.parse===void 0)b.parse=!0;var f=this,h=b.success;b.success=function(a){f.attributes=d;var o=f.parse(a,b);b.wait&&(o=e.extend(c||
{},o));if(e.isObject(o)&&!f.set(o,b))return!1;h&&h(f,a,b);f.trigger("sync",f,a,b)};x(this,b);a=this.isNew()?"create":b.patch?"patch":"update";if(a==="patch")b.attrs=c;a=this.sync(a,this,b);if(c&&b.wait)this.attributes=d;return a},destroy:function(a){var a=a?e.clone(a):{},g=this,b=a.success,c=function(){g.trigger("destroy",g,g.collection,a)};a.success=function(e){(a.wait||g.isNew())&&c();b&&b(g,e,a);g.isNew()||g.trigger("sync",g,e,a)};if(this.isNew())return a.success(),!1;x(this,a);var d=this.sync("delete",
this,a);a.wait||c();return d},url:function(){var a=e.result(this,"urlRoot")||e.result(this.collection,"url")||A();if(this.isNew())return a;return a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},e.extend(a||{},{validate:!0}))},_validate:function(a,g){if(!g.validate||!this.validate)return!0;var a=e.extend({},
this.attributes,a),b=this.validationError=this.validate(a,g)||null;if(!b)return!0;this.trigger("invalid",this,b,e.extend(g||{},{validationError:b}));return!1}});e.each(["keys","values","pairs","invert","pick","omit"],function(a){m.prototype[a]=function(){var g=f.call(arguments);g.unshift(this.attributes);return e[a].apply(e,g)}});var q=h.Collection=function(a,g){g||(g={});if(g.url)this.url=g.url;if(g.model)this.model=g.model;if(g.comparator!==void 0)this.comparator=g.comparator;this._reset();this.initialize.apply(this,
arguments);a&&this.reset(a,e.extend({silent:!0},g))},w={add:!0,remove:!0,merge:!0},z={add:!0,merge:!1,remove:!1};e.extend(q.prototype,l,{model:m,initialize:function(){},toJSON:function(a){return this.map(function(g){return g.toJSON(a)})},sync:function(){return h.sync.apply(this,arguments)},add:function(a,g){return this.set(a,e.defaults(g||{},z))},remove:function(a,g){a=e.isArray(a)?a.slice():[a];g||(g={});var b,c,d,f;b=0;for(c=a.length;b<c;b++)if(f=this.get(a[b])){delete this._byId[f.id];delete this._byId[f.cid];
d=this.indexOf(f);this.models.splice(d,1);this.length--;if(!g.silent)g.index=d,f.trigger("remove",f,this,g);this._removeReference(f)}return this},set:function(a,b){b=e.defaults(b||{},w);b.parse&&(a=this.parse(a,b));e.isArray(a)||(a=a?[a]:[]);var c,f,h,l,m,p=b.at,u=this.comparator&&p==null&&b.sort!==!1,q=e.isString(this.comparator)?this.comparator:null,n=[],v=[],y={};c=0;for(f=a.length;c<f;c++)if(h=this._prepareModel(a[c],b))(l=this.get(h))?(b.remove&&(y[l.cid]=!0),b.merge&&(l.set(h.attributes,b),
u&&!m&&l.hasChanged(q)&&(m=!0))):b.add&&(n.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,h.id!=null&&(this._byId[h.id]=h));if(b.remove){c=0;for(f=this.length;c<f;++c)y[(h=this.models[c]).cid]||v.push(h);v.length&&this.remove(v,b)}n.length&&(u&&(m=!0),this.length+=n.length,p!=null?j.apply(this.models,[p,0].concat(n)):d.apply(this.models,n));m&&this.sort({silent:!0});if(b.silent)return this;c=0;for(f=n.length;c<f;c++)(h=n[c]).trigger("add",h,this,b);m&&this.trigger("sort",this,b);
return this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);b.previousModels=this.models;this._reset();this.add(a,e.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:0},b));return a},
shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){if(a!=null)return this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){if(e.isEmpty(a))return b?void 0:[];return this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw Error("Cannot sort a set without a comparator");
a||(a={});e.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,this));a.silent||this.trigger("sort",this,a);return this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=e.isFunction(b)?b:function(a){return a.get(b)};return e.sortedIndex(this.models,a,d,c)},pluck:function(a){return e.invoke(this.models,"get",a)},fetch:function(a){a=a?e.clone(a):{};if(a.parse===void 0)a.parse=!0;var b=a.success,c=this;
a.success=function(d){c[a.reset?"reset":"set"](d,a);b&&b(c,d,a);c.trigger("sync",c,d,a)};x(this,a);return this.sync("read",this,a)},create:function(a,b){b=b?e.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;b.success=function(e){b.wait&&c.add(a,b);d&&d(a,e,b)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,
b){if(a instanceof m){if(!a.collection)a.collection=this;return a}b||(b={});b.collection=this;var c=new this.model(a,b);if(!c._validate(a,b))return this.trigger("invalid",this,a,b),!1;return c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){(a==="add"||a==="remove")&&c!==this||(a==="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],b.id!=null&&(this._byId[b.id]=
b)),this.trigger.apply(this,arguments))}});e.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(a){q.prototype[a]=function(){var b=f.call(arguments);b.unshift(this.models);return e[a].apply(e,b)}});e.each(["groupBy",
"countBy","sortBy"],function(a){q.prototype[a]=function(b,c){var d=e.isFunction(b)?b:function(a){return a.get(b)};return e[a](this.models,d,c)}});var c=h.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},D=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName","events"];e.extend(c.prototype,l,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},
render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof h.$?a:h.$(a);this.el=this.$el[0];b!==!1&&this.delegateEvents();return this},delegateEvents:function(a){if(!a&&!(a=e.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];e.isFunction(c)||(c=this[a[b]]);if(c){var d=b.match(D),f=d[1],d=d[2],c=e.bind(c,this);f+=".delegateEvents"+this.cid;if(d===
"")this.$el.on(f,c);else this.$el.on(f,d,c)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_configure:function(a){this.options&&(a=e.extend({},e.result(this,"options"),a));e.extend(this,e.pick(a,v));this.options=a},_ensureElement:function(){if(this.el)this.setElement(e.result(this,"el"),!1);else{var a=e.extend({},e.result(this,"attributes"));if(this.id)a.id=e.result(this,"id");this.className&&(a["class"]=e.result(this,"className"));this.setElement(h.$("<"+
e.result(this,"tagName")+">").attr(a),!1)}}});h.sync=function(a,b,c){var d=y[a];e.defaults(c||(c={}),{emulateHTTP:h.emulateHTTP,emulateJSON:h.emulateJSON});var f={type:d,dataType:"json"};if(!c.url)f.url=e.result(b,"url")||A();if(c.data==null&&b&&(a==="create"||a==="update"||a==="patch"))f.contentType="application/json",f.data=JSON.stringify(c.attrs||b.toJSON(c));if(c.emulateJSON)f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{};if(c.emulateHTTP&&(d==="PUT"||d==="DELETE"||
d==="PATCH")){f.type="POST";if(c.emulateJSON)f.data._method=d;var j=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(j)return j.apply(this,arguments)}}if(f.type!=="GET"&&!c.emulateJSON)f.processData=!1;if(f.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled))f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")};a=c.xhr=h.ajax(e.extend(f,c));b.trigger("request",b,a,c);return a};var y={create:"POST",update:"PUT",
patch:"PATCH","delete":"DELETE",read:"GET"};h.ajax=function(){return h.$.ajax.apply(h.$,arguments)};var B=h.Router=function(a){a||(a={});if(a.routes)this.routes=a.routes;this._bindRoutes();this.initialize.apply(this,arguments)},E=/\((.*?)\)/g,F=/(\(\?)?:\w+/g,G=/\*\w+/g,H=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend(B.prototype,l,{initialize:function(){},route:function(a,b,c){e.isRegExp(a)||(a=this._routeToRegExp(a));e.isFunction(b)&&(c=b,b="");c||(c=this[b]);var d=this;h.history.route(a,function(e){e=d._extractParameters(a,
e);c&&c.apply(d,e);d.trigger.apply(d,["route:"+b].concat(e));d.trigger("route",b,e);h.history.trigger("route",d,b,e)});return this},navigate:function(a,b){h.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){this.routes=e.result(this,"routes");for(var a,b=e.keys(this.routes);(a=b.pop())!=null;)this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(H,"\\$&").replace(E,"(?:$1)?").replace(F,function(a,b){return b?a:"([^/]+)"}).replace(G,"(.*?)");return RegExp("^"+
a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return e.map(c,function(a){return a?decodeURIComponent(a):null})}});var s=h.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");if(typeof window!=="undefined")this.location=window.location,this.history=window.history},C=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,J=/msie [\w.]+/,K=/\/$/;s.started=!1;e.extend(s.prototype,l,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,
b){if(a==null)if(this._hasPushState||!this._wantsHashChange||b){var a=this.location.pathname,c=this.root.replace(K,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(C,"")},start:function(a){if(s.started)throw Error("Backbone.history has already been started");s.started=!0;this.options=e.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==!1;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||
!this.history||!this.history.pushState);var a=this.getFragment(),b=document.documentMode,b=J.exec(navigator.userAgent.toLowerCase())&&(!b||b<=7);this.root=("/"+this.root+"/").replace(I,"/");if(b&&this._wantsHashChange)this.iframe=h.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a);if(this._hasPushState)h.$(window).on("popstate",this.checkUrl);else if(this._wantsHashChange&&"onhashchange"in window&&!b)h.$(window).on("hashchange",this.checkUrl);
else if(this._wantsHashChange)this._checkUrlInterval=setInterval(this.checkUrl,this.interval);this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;else if(this._wantsPushState&&this._hasPushState&&b&&a.hash)this.fragment=this.getHash().replace(C,""),this.history.replaceState({},
document.title,this.root+this.fragment+a.search);if(!this.options.silent)return this.loadUrl()},stop:function(){h.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);s.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment)return!1;this.iframe&&this.navigate(a);this.loadUrl()||
this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0})},navigate:function(a,b){if(!s.started)return!1;if(!b||b===!0)b={trigger:b};a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&
a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});h.history=new s;m.extend=q.extend=B.extend=c.extend=s.extend=function(a,b){var c=this,d;d=a&&e.has(a,"constructor")?a.constructor:function(){return c.apply(this,arguments)};e.extend(d,
c,b);var f=function(){this.constructor=d};f.prototype=c.prototype;d.prototype=new f;a&&e.extend(d.prototype,a);d.__super__=c.prototype;return d};var A=function(){throw Error('A "url" property or function must be specified');},x=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b);a.trigger("error",a,d,b)}}}).call(this);r.templating={};r.templating.TemplateSet=function(){this.index={}};
r.templating.TemplateSet.prototype={_templateSettings:{variable:"thing"},_key:function(a,b){return a+"."+b},_create:function(a){return _.template(a,null,this._templateSettings)},set:function(a){_.each(a,function(a){this.index[this._key(a.name,a.style)]=a.template},this)},_defaultStyle:function(a){_.isArray(a)||(a=[a,r.config.renderstyle]);return a},get:function(a){var a=this._defaultStyle(a),b=this._key(a[0],a[1]);if(!this.index[b])throw'"'+a[0]+"."+a[1]+'" template not found.';template=this.index[b];
_.isFunction(template)||(template=this.index[b]=this._create(template));return template},make:function(a,b,c){html=this.get(a)(b);c&&$(c).append(html);return html}};r.templates=new r.templating.TemplateSet;
r.utils={clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},staticURL:function(a){return r.config.static_root+"/"+a},querySelectorFromEl:function(a,b){return $(a).parents().andSelf().filter(b||"*").map(function(a,b){var f=[],j=$(b),h=j.data("fullname"),e=j.attr("id"),j=j.attr("class");f.push(b.nodeName.toLowerCase());h?f.push('[data-fullname="'+h+'"]'):e?f.push("#"+e):j&&f.push("."+_.compact(j.split(/\s+/)).join("."));return f.join("")}).toArray().join(" ")},serializeForm:function(a){var b={};
$.each(a.serializeArray(),function(a,d){b[d.name]=d.value});return b},_pyStrFormatRe:/%\((\w+)\)s/,pyStrFormat:function(a,b){return a.replace(this._pyStrFormatRe,function(a,d){if(!(d in b))throw"missing format parameter";return b[d]})},_mdLinkRe:/\[(.*?)\]\((.*?)\)/g,formatMarkdownLinks:function(a){return _.escape(a).replace(this._mdLinkRe,function(a,c,d){return'<a href="'+d+'">'+c+"</a>"})}};
r.ui.init=function(){$.cookie("reddit_first")?($.cookie("reddit_first",null,{domain:r.config.cur_domain}),store.set("ui.shown.welcome",!0)):store.get("ui.shown.welcome")!=!0&&($(".infobar.welcome").show(),store.set("ui.shown.welcome",!0));var a=window.matchMedia?matchMedia("(max-device-width: 700px)").matches:$(window).width()<700,b=$.url().attr("path")=="/";a&&b&&r.config.renderstyle!="compact"&&(a=$('<div class="infobar mellow">').html(r.utils.formatMarkdownLinks(r.strings("compact_suggest",{url:location+
".compact"}))),$("body > .content > :not(.infobar):first").before(a));$(".help-bubble").each(function(a,b){$(b).data("HelpBubble",new r.ui.Bubble({el:b}))});r.ui.PermissionEditor.init()};r.ui.Form=function(a){r.ui.Base.call(this,a);this.$el.submit($.proxy(function(a){a.preventDefault();this.submit(a)},this))};
r.ui.Form.prototype=$.extend(new r.ui.Base,{workingDelay:200,setWorking:function(a){if(a){if(!this.$el.hasClass("working")&&!this._workingTimer)this._workingTimer=setTimeout($.proxy(function(){this.$el.addClass("working")},this),this.workingDelay)}else this._workingTimer&&(clearTimeout(this._workingTimer),delete this._workingTimer),this.$el.removeClass("working")},showStatus:function(a,b){this.$el.find(".status").show().toggleClass("error",!!b).text(a)},showErrors:function(a){statusMsgs=[];$.each(a,
$.proxy(function(a,c){var d=c[1],f=c[2],f=this.$el.find(".error."+c[0]+(f?".field-"+f:""));f.length?f.show().text(d):statusMsgs.push(d)},this));statusMsgs.length&&this.showStatus(statusMsgs.join(", "),!0)},resetErrors:function(){this.$el.find(".error").hide()},checkCaptcha:function(a){this.$el.has('input[name="captcha"]').length&&$.grep(a,function(a){return a[0]=="badCaptcha"})&&$.request("new_captcha",{id:this.$el.attr("id")})},serialize:function(){return this.$el.serializeArray()},submit:function(){this.resetErrors();
this.setWorking(!0);this._submit()},_submit:function(){},handleResult:function(a,b,c){a?(this.checkCaptcha(a.json.errors),this._handleResult(a)):(this.setWorking(!1),this._handleNetError(a,b,c))},_handleResult:function(a){this.showErrors(a.json.errors);this.setWorking(!1)},_handleNetError:function(a,b,c){this.showStatus(r.strings("an_error_occurred",{status:c.status}),!0)}});
r.ui.Bubble=Backbone.View.extend({showDelay:150,hideDelay:750,animateDuration:150,initialize:function(){this.$el.hover($.proxy(this,"queueShow"),$.proxy(this,"queueHide"));this.$parent=this.options.parent||this.$el.parent();this.$parent.hover($.proxy(this,"queueShow"),$.proxy(this,"queueHide"));this.$parent.click($.proxy(this,"queueShow"))},position:function(){var a=this.$parent.offset(),b=$("body").offset(),c,d;this.$el.is(".anchor-top")?(c=this.$parent.outerWidth(!0)-this.$el.outerWidth(!0),d=this.$parent.outerHeight(!0)+
5,this.$el.css({left:a.left+c,top:a.top+d-b.top})):this.$el.is(".anchor-right")?(c=16,d=0,a.right=$(window).width()-a.left,this.$el.css({right:a.right+c,top:a.top+d-b.top})):this.$el.is(".anchor-right-fixed")&&(c=32,d=0,a.top-=$(document).scrollTop(),a.left-=$(document).scrollLeft(),this.$el.css({top:r.utils.clamp(a.top-d,0,$(window).height()-this.$el.outerHeight()),left:r.utils.clamp(a.left-c-this.$el.width(),0,$(window).width())}))},show:function(){this.cancelTimeout();if(!this.$el.is(":visible")&&
(this.trigger("show"),$("body").append(this.$el),this.$el.css("visibility","hidden").show(),this.render(),this.position(),this.$el.css({opacity:1,visibility:"visible"}),this.options.group&&this.options.group.current&&this.options.group.current!=this?this.options.group.current.hideNow():this._animate("show"),this.options.group))this.options.group.current=this},hideNow:function(){this.cancelTimeout();if(this.options.group)this.options.group.current=null;this.$el.hide();this.$parent.append(this.$el)},
hide:function(a){this.$el.is(":visible")?this._animate("hide",$.proxy(function(){this.hideNow();a&&a()},this)):a&&a()},_animate:function(a,b){if(this.animateDuration){var c,d;this.$el.is(".anchor-top")?(c="top",d="-=5"):this.$el.is(".anchor-right")?(c="right",d="-=5"):this.$el.is(".anchor-right-fixed")&&(c="right",d="-=5");var f=this.$el.css(c);hideProps={opacity:0};hideProps[c]=d;showProps={opacity:1};showProps[c]=f;var j,h;a=="show"?(j=hideProps,h=showProps):a=="hide"&&(j=showProps,h=hideProps);
this.$el.css(j).animate(h,this.animateDuration,b)}else b&&b()},cancelTimeout:function(){if(this.timeout)clearTimeout(this.timeout),this.timeout=null},queueShow:function(){this.cancelTimeout();this.timeout=setTimeout($.proxy(this,"show"),this.showDelay)},queueHide:function(){this.cancelTimeout();this.timeout=setTimeout($.proxy(this,"hide"),this.hideDelay)}});
r.ui.PermissionEditor=function(a){r.ui.Base.call(this,a);var b={};this.$el.find('input[type="hidden"]').each(function(a,d){b[d.name]=d.value});a=b.type;this.form_id=a+"-permissions-"+b.name;this.permission_info=r.strings.permissions.info[a];this.sorted_perm_keys=$.map(this.permission_info,function(a,b){return b});this.sorted_perm_keys.sort();this.original_perms=this._parsePerms(b.permissions);this.embedded=this.$el.find("form").length==0;this.$menu=null;this.embedded?(this.$permissions_field=this.$el.find('input[name="permissions"]'),
this.$menu_controller=this.$el.siblings(".permissions-edit")):this.$menu_controller=this.$el.closest("tr").find(".permissions-edit");this.$menu_controller.find("a").click($.proxy(this,"show"));this.updateSummary()};r.ui.PermissionEditor.init=function(){function a(a){$(a).find(".permissions").each(function(a,b){$(b).data("PermissionEditor",new r.ui.PermissionEditor(b))})}a("body");for(var b in r.strings.permissions.info)$("."+b+"-table").on("insert-row","tr",function(){a(this)})};
r.ui.PermissionEditor.prototype=$.extend(new r.ui.Base,{_parsePerms:function(a){var b={};a.split(",").forEach(function(a){b[a.substring(1)]=a[0]=="+"});return b.all?{all:!0}:b},_serializePerms:function(a){if(a.all)return"+all";else{var b=[],c;for(c in a)b.push((a[c]?"+":"-")+c);return b.join(",")}},_getNewPerms:function(){if(!this.$menu)return null;var a={};this.$menu.find('input[type="checkbox"]').each(function(b,c){a[$(c).attr("name")]=$(c).prop("checked")});return a},_makeMenuLabel:function(a){var b=
$.proxy(this,"updateSummary"),c=this.permission_info[a],d=$('<input type="checkbox">').attr("name",a).prop("checked",this.original_perms[a]),f=$("<label>").append(d).click(function(a){a.stopPropagation()});a=="all"?(d.change(function(){var a=d.is(":checked");f.siblings().toggleClass("disabled",a).find('input[type="checkbox"]').prop("disabled",a);b()}),f.append(document.createTextNode(r.strings.permissions.all_msg))):c&&(d.change(b),f.append(document.createTextNode(c.title)),f.attr("title",c.description));
return f},show:function(a){close_menus(a);this.$menu=$('<div class="permission-selector drop-choices">');this.$menu.append(this._makeMenuLabel("all"));for(var b in this.sorted_perm_keys)this.$menu.append(this._makeMenuLabel(this.sorted_perm_keys[b]));this.$menu.on("close_menu",$.proxy(this,"hide")).find("input").first().change().end();if(!this.embedded)a=this.$el.find("form").clone(),a.attr("id",this.form_id),a.click(function(a){a.stopPropagation()}),this.$menu.append("<hr>",a),this.$permissions_field=
this.$menu.find('input[name="permissions"]');this.$menu_controller.parent().append(this.$menu);open_menu(this.$menu_controller[0]);return!1},hide:function(){if(this.$menu){if(this.embedded)this.original_perms=this._getNewPerms(),this.$permissions_field.val(this._serializePerms(this.original_perms));this.$menu.remove();this.$menu=null;this.updateSummary()}},_renderBit:function(a){var b=this.permission_info[a],a=a=="all"?r.strings.permissions.all_msg:b?b.title:a,a=$('<span class="permission-bit"/>').text(a);
b&&a.attr("title",b.description);return a},updateSummary:function(){var a=this._getNewPerms(),b=[];if(a&&a.all)b.push(this._renderBit("all").toggleClass("added",this.original_perms.all!=!0));else{if(this.original_perms.all&&!a)b.push(this._renderBit("all"));else if(!this.original_perms.all)for(var c in this.original_perms)this.original_perms[c]&&(this.embedded&&(!a||a[c])&&b.push(this._renderBit(c)),this.embedded||b.push(this._renderBit(c).toggleClass("removed",a!=null&&!a[c])));if(a)for(c in a)this.permission_info[c]&&
a[c]&&!this.original_perms[c]&&b.push(this._renderBit(c).toggleClass("added",!this.embedded))}b.length||b.push($('<span class="permission-bit">').text(r.strings.permissions.none_msg).addClass("none"));c=$('<div class="permission-summary">');for(var d=0;d<b.length;d++)d>0&&c.append(", "),c.append(b[d]);c.toggleClass("edited",this.$menu!=null);this.$el.find(".permission-summary").replaceWith(c);a&&this.$permissions_field&&this.$permissions_field.val(this._serializePerms(a))},onCommit:function(a){this.$el.find('input[name="permissions"]').val(a);
this.original_perms=this._parsePerms(a);this.hide()}});
r.login={post:function(a,b,c){if(r.config.cnameframe&&!r.config.https_endpoint)a.$el.unbind(),a.$el.submit();else{var d=$('input[name="user"]',a.$el).val(),f=r.config.https_endpoint||"http://"+r.config.ajax_domain,d=f+"/api/"+b+"/"+d;if(r.config.currentOrigin==f||$.support.cors)b=a.serialize(),b.push({name:"api_type",value:"json"}),$.ajax({url:d,type:"POST",dataType:"json",data:b,success:c,error:function(a,b){c(!1,b,a)},xhrFields:{withCredentials:!0}});else{var j=$("<iframe>"),h=a.$el.clone(!0),a=
("resp"+Math.random()).replace(".","");j.css("display","none").attr("name",a).appendTo("body");j[0].contentWindow.name=a;h.unbind().css("display","none").attr("action",d).attr("target",a).appendTo("body");$("<input>").attr({type:"hidden",name:"api_type",value:"json"}).appendTo(h);$("<input>").attr({type:"hidden",name:"hoist",value:r.login.hoist.type}).appendTo(h);r.login.hoist.watch(b,function(a){r.config.debug||(j.remove(),h.remove());c(a)});h.submit()}}}};
r.login.hoist={type:"cookie",watch:function(a,b){var c="hoist_"+a,d=setInterval(function(){if(data=$.cookie(c)){try{data=JSON.parse(data)}catch(a){data=null}$.cookie(c,null,{domain:r.config.cur_domain,path:"/"});clearInterval(d);b(data)}},100)}};
r.login.ui={init:function(){if(!r.config.logged)$(".content form.login-form, .side form.login-form").each(function(a,b){new r.ui.LoginForm(b)}),$(".content form.register-form").each(function(a,b){new r.ui.RegisterForm(b)}),this.popup=new r.ui.LoginPopup($(".login-popup")[0]),$(document).delegate(".login-required","click",$.proxy(this,"loginRequiredAction"))},loginRequiredAction:function(a){if(r.config.logged)return!0;else{var a=$(a.target),b=a.attr("href"),c;b&&b!="#"?c=b:(a=a.thing(),a.length&&(c=
a.find(".comments").attr("href")));this.popup.showLogin(!0,c&&function(){window.location=c});return!1}}};r.ui.LoginForm=function(){r.ui.Form.apply(this,arguments)};
r.ui.LoginForm.prototype=$.extend(new r.ui.Form,{showErrors:function(a){r.ui.Form.prototype.showErrors.call(this,a);a.length&&this.$el.find(".recover-password").addClass("attention")},showStatus:function(){this.$el.find(".error").css("opacity",1);r.ui.Form.prototype.showStatus.apply(this,arguments)},resetErrors:function(){if(this.$el.hasClass("login-form-side")){var a=this.$el.find(".error");a.is(":visible")&&a.fadeTo(100,0.35)}else r.ui.Form.prototype.resetErrors.apply(this,arguments)},_submit:function(){r.login.post(this,
"login",$.proxy(this,"handleResult"))},_handleResult:function(a){if(a.json.errors.length)r.ui.Form.prototype._handleResult.call(this,a);else if(this.successCallback)this.successCallback(a);else{var a=r.config.extension?"/."+r.config.extension:"/",a=/\/login\/?$/.test($.url().attr("path"))?a:window.location,b=this.$el.find('input[name="dest"]').val();window.location=b||a}},_handleNetError:function(a,b,c){r.ui.Form.prototype._handleNetError.apply(this,arguments);c.status==0&&r.config.currentOrigin!=
r.config.https_endpoint&&$("<p>").append($("<a>").text(r.strings("login_fallback_msg")).attr("href",r.config.https_endpoint+"/login")).appendTo(this.$el.find(".status"))},focus:function(){this.$el.find('input[name="user"]').focus()}});r.ui.RegisterForm=function(){r.ui.Form.apply(this,arguments);this.checkUsernameDebounced=_.debounce($.proxy(this,"checkUsername"),500);this.$user=this.$el.find('[name="user"]');this.$user.on("keyup",$.proxy(this,"usernameChanged"));this.$submit=this.$el.find(".submit button")};
r.ui.RegisterForm.prototype=$.extend(new r.ui.Form,{usernameChanged:function(){var a=this.$user.val();if(a!=this._priorName)this._priorName=a,this.$el.find(".error.field-user").hide(),this.$submit.attr("disabled",!1),this.$el.removeClass("name-available name-taken"),this.checkUsernameDebounced(a),this.$el.toggleClass("name-checking",!!a)},checkUsername:function(a){a&&$.ajax({url:"/api/username_available.json",data:{user:a},success:$.proxy(this,"displayUsernameStatus"),complete:$.proxy(function(){this.$el.removeClass("name-checking")},
this)})},displayUsernameStatus:function(a){a.json&&a.json.errors?(this.showErrors(a.json.errors),this.$submit.attr("disabled",!0)):(this.$el.removeClass("name-available name-taken").addClass(a?"name-available":"name-taken"),this.$submit.attr("disabled",a==!1))},_submit:function(){r.login.post(this,"register",$.proxy(this,"handleResult"))},_handleResult:r.ui.LoginForm.prototype._handleResult,focus:r.ui.LoginForm.prototype.focus});
r.ui.LoginPopup=function(a){r.ui.Base.call(this,a);this.loginForm=new r.ui.LoginForm(this.$el.find("form.login-form:first"));this.registerForm=new r.ui.RegisterForm(this.$el.find("form.register-form:first"))};
r.ui.LoginPopup.prototype=$.extend(new r.ui.Base,{show:function(a,b){this.loginForm.successCallback=b;this.registerForm.successCallback=b;$.request("new_captcha",{id:this.$el.attr("id")});this.$el.find(".cover-msg").toggle(!!a).end().show()},showLogin:function(){this.show.apply(this,arguments);this.loginForm.focus()},showRegister:function(){this.show.apply(this,arguments);this.registerForm.focus()}});
$(function(){function a(a){$(a).parent().parent().addClass("edited");$(a).parent().parent().find(".status").empty()}function b(){$(this).data("saved")!=$(this).val()&&a(this)}function c(a){return function(){return post_form(this.parentNode,a)}}function d(a){return function(){$(this).removeClass("edited");return post_form(this,a)}}function f(){$(".flairselector li").removeClass("selected");$(this).addClass("selected");var a=$(this).parent().parent().siblings("form")[0];$(a).children('input[name="flair_template_id"]').val(this.id);
var a=$(a).children(".customizer"),b=a.children("input");$(this).hasClass("texteditable")?(a.addClass("texteditable"),b.removeAttr("disabled"),b.css("display","block"),b.val($.trim($(this).children(".flair").text())).select(),b.keyup(function(){$(".flairselection .flair").text($(b).val())})):(a.removeClass("texteditable"),b.attr("disabled","disabled").hide());a=$(".flairselector .flairremove").detach();$(".flairselection").html($(this).first().children().clone()).append(a);$(".flairselector .flairremove").css("display",
"inline-block");return!1}function j(){var a=$(this).parent().parent();$(a).children('input[name="flair_template_id"]').val("");$(a).children(".customizer").hide();a=$(".flairselector .flairremove").detach();$(a).hide();$(".flairselector li").removeClass("selected");$(".flairselection").empty().append(a)}function h(){$(this).parent().parent().siblings("input").val(this.id);post_form(this.parentNode.parentNode.parentNode,"selectflair");return!1}$(".flairlist").delegate(".flairtemplate form","submit",
d("flairtemplate")).delegate("form.clearflairtemplates","submit",d("clearflairtemplates")).delegate(".flairgrant .usertable form","submit",d("flair")).delegate(".flaircell input","focus",function(){a(this)}).delegate(".flaircell input","keyup",b).delegate(".flaircell input","change",b).delegate(".flairtemplate .flairdeletebtn","click",c("deleteflairtemplate")).delegate(".flairgrant .flairdeletebtn","click",c("deleteflair"));$(".flairtoggle").submit(function(){return post_form(this,"setflairenabled")});
$(".flairtoggle input").change(function(){$(this).parent().submit()});$(document).on("click",".tagline .flairselectbtn, .thing .flairselectbtn",function(a){function b(a){var c=$(a).children().length,d=Math.max(1,Math.min(3,Math.ceil(c/10))),e=Math.ceil(c/d),f=Math.max(150,$(a).width());$(a).width(f);if(d>1){$(a).css("float","left");for(var h=d*e-c,j=1;j<d;j++){var l=e;j<=h&&l--;var n=c-l;c-=l;l=$(a).children().slice(n).remove();$(l).width(f);$(a).after($("<ul>").css("float","left").append(l))}}return d*
(f+5)+50}close_menus(a);var c=this,d=$(c).siblings(".flairselector")[0];$(d).html('<img class="flairthrobber" src="'+r.utils.staticURL("throbber.gif")+'" />').addClass("active").height(18).width(18).css("padding-left",4).css("padding-top",4).css("padding-bottom",4).css("padding-right",4).css("left",$(c).position().left+$(c).width()-18+"px").css("top",$(c).position().top+"px");var t={};$(d).siblings("form").find("input").each(function(a,b){t[b.name]=b.value});$.request("flairselector",t,function(a){$(d).html(a);
var a=$(".flairselector ul"),a=Math.max(200,a.length?b(a):$(".error").width()+20),e=Math.max(100,$(c).position().left+$(c).width()-a);$(d).height("auto").width(a).css("left",e+"px").click(!1).find(".flairselection").click(!1).end().find("form").click(function(a){a.stopPropagation()}).submit(h).end().find(".customizer input").attr("disabled","disabled").end().find("li.selected").each(f).end().find("li:not(.error)").click(f).end().find(".flairremove").click(j).end()},!0,"html");return!1});$(".flairselector .dropdown").click(function(){open_menu(this);
$(this).addClass("active");return!1})});r.interestbar={init:function(){new r.ui.InterestBar($(".sr-interest-bar"))}};r.ui.InterestBar=function(){r.ui.Base.apply(this,arguments);this.$query=this.$el.find(".query");this.queryChangedDebounced=_.debounce($.proxy(this,"queryChanged"),500);this.$query.on("keyup",$.proxy(this,"keyPressed"));this.$query.on("focus",$.proxy(function(){this.$el.addClass("focus")},this)).on("blur",$.proxy(function(){this.$el.removeClass("focus")},this))};
r.ui.InterestBar.prototype={keyPressed:function(){var a=this.$query.val(),a=$.trim(a);if(a!=this._lastQuery)this._lastQuery=a,this.queryChangedDebounced(a),a&&a.length>1?this.$el.addClass("working"):(this.hideResults(),this.$el.removeClass("working error"))},queryChanged:function(a){a&&a.length>1&&$.ajax({url:"/api/subreddits_by_topic.json",data:{query:a},success:$.proxy(this,"displayResults"),error:$.proxy(this,"displayError")})},displayResults:function(a){this.$el.removeClass("working error");var b=
this.$el.find(".results li:first"),c=this.$el.find(".results li:last"),d=_.template('<li><a href="/r/<%= name %>" target="_blank">/r/<%= name %></a></li>');this.$el.find(".results").empty().append(b).append(_.map(a,d).join("")).append(c).slideDown(150)},hideResults:function(){this.$el.find(".results").slideUp(150)},displayError:function(a){this.$el.removeClass("working").addClass("error").find(".error-caption").text(r.strings("an_error_occurred_friendly",{status:a.status}));this.hideResults()}};
r.wiki={request:function(a){if(r.config.logged)a.data.uh=r.config.modhash;a.data.page=r.config.wiki_page;$.ajax(a)},baseApiUrl:function(){return r.wiki.baseUrl(!0)},baseUrl:function(a){var b="";a&&(b+="/api");b+="/wiki";r.config.is_fake||(b="/r/"+r.config.post_site+b);return b},init:function(){$("body").delegate(".wiki-page .revision_hide","click",this.toggleHide)},toggleHide:function(a){a.preventDefault();var a=$(this),b=r.wiki.baseApiUrl()+"/hide",c=a.parents(".revision");c.toggleClass("hidden");
r.wiki.request({url:b,type:"POST",dataType:"json",data:{revision:a.data("revision")},error:function(){c.toggleClass("hidden")},success:function(a){a.status?c.addClass("hidden"):c.removeClass("hidden")}})},addUser:function(a){a.preventDefault();$("#usereditallowerror").hide();var a=$(a.target),b=r.wiki.baseApiUrl()+"/alloweditor/add";r.wiki.request({url:b,type:"POST",data:{username:a.find('[name="username"]').val()},dataType:"json",error:function(){$("#usereditallowerror").show()},success:function(){location.reload()}})},
submitEdit:function(a){a.preventDefault();var b=$(a.target),a=r.wiki.baseApiUrl()+"/edit",c=$("#wiki_edit_conflict"),d=$("#wiki_special_error");c.hide();d.hide();params=r.utils.serializeForm(b);r.wiki.request({url:a,type:"POST",dataType:"json",data:params,success:function(){window.location=r.wiki.baseUrl()+"/"+r.config.wiki_page},statusCode:{409:function(a){var a=JSON.parse(a.responseText),d=b.children("#wiki_page_content");c.children("#youredit").val(d.val());c.children("#yourdiff").html(a.diffcontent);
b.children("#previous").val(a.newrevision);d.val(a.newcontent);c.fadeIn("slow")},415:function(a){var a=JSON.parse(a.responseText).special_errors,b=d.children("#specials");b.empty();for(i in a)b.append(a[i]+"<br/>");d.fadeIn("slow")},429:function(a){var a=JSON.parse(a.responseText).message,b=d.children("#specials");b.empty();b.text(a);d.fadeIn("slow")}}})},goCompare:function(){v1=$("input:radio[name=v1]:checked").val();v2=$("input:radio[name=v2]:checked").val();url=r.wiki.baseUrl()+"/"+r.config.wiki_page+
"?v="+v1;v2!=v1&&(url+="&v2="+v2);window.location=url}};
r.apps={init:function(){$(".authorized-app").delegate(".app-permissions li","mouseover mouseout",function(a){a.type=="mouseover"?$(this).find(".app-scope").show():$(this).find(".app-scope").hide()});$("#developed-apps").delegate(".edit-app-button","click",function(){$(this).toggleClass("collapsed").closest(".developed-app").removeClass("collapsed").find(".app-developers").remove().end().find(".edit-app").slideToggle().removeClass("collapsed").end()}).delegate(".edit-app-icon-button","click",function(){$(this).toggleClass("collapsed").closest(".developed-app").find(".ajax-upload-form").show()});
$("#create-app-button").click(function(){$(this).hide();$("#create-app").fadeIn()})},revoked:function(a){$(a).closest(".authorized-app").fadeOut()},deleted:function(a){$(a).closest(".developed-app").fadeOut()}};
r.gold={_googleCheckoutAnalyticsLoaded:!1,init:function(){$("div.content").on("click","a.give-gold, .gilded-comment-icon, .gold-payment .close-button",$.proxy(this,"_toggleCommentGoldForm"));$(".stripe-gold").click(function(){$("#stripe-payment").show()});$(".stripe-submit").on("click",this.makeStripeToken)},_toggleCommentGoldForm:function(a){var a=$(a.target),b=a.thing(),c=a.thing_id(),d="gold_form_"+c,f=$("#"+d);if(b.hasClass("user-gilded")||b.hasClass("deleted")||b.find(".author:first").text()==
r.config.logged)return!1;if(f.length)return f.toggle(),!1;if(!this._googleCheckoutAnalyticsLoaded)$.getScript("//checkout.google.com/files/digital/ga_post.js"),this._googleCheckoutAnalyticsLoaded=!0;var j=$(".gold-form.cloneable:first").clone(),b=a.thing().find(".entry .author:first").text();r.strings("gold_summary_comment_gift",{recipient:b});var h=j.find(".passthrough"),e=j.find('[name="cbbaseurl"]').val();j.removeClass("cloneable").attr("id",d).find("p:first-child em").text(b).end().find("button").attr("disabled",
"");h.val("");a.new_thing_child(j);j.show();var l=setTimeout(function(){j.addClass("working");j.find("button").addClass("disabled")},200);$.request("generate_payment_blob.json",{comment:c},function(a){clearTimeout(l);j.removeClass("working");h.val(a);j.find(".stripe-gold").on("click",function(){window.open("/gold/creditgild/"+a)});j.find(".coinbase-gold").on("click",function(){window.open(e+"?c="+a)});j.find("button").removeAttr("disabled").removeClass("disabled")});return!1},gildComment:function(a,
b,c){var d=$(".id-"+a);if(d.length){var a=d.children(".entry").find("p.tagline"),f=a.find(".gilded-comment-icon");c==null&&(c=f.data("count")||0,c++);d.addClass("gilded user-gilded");f.length||(f=$("<span>").addClass("gilded-comment-icon"),a.append(f));f.attr("title",b).data("count",c);c>1&&f.text("x"+c);d.children(".entry").find(".give-gold").parent().remove()}else console.log("couldn't gild comment "+a)},makeStripeToken:function(){var a=$("#stripe-payment"),b=a.find('[name="stripePublicKey"]').val(),
c=a.find(".stripe-submit"),d=a.find(".status"),f=a.find('[name="stripeToken"]'),j=a.find(".card-name").val(),h=a.find(".card-number").val(),e=a.find(".card-cvc").val(),l=a.find(".card-expiry-month").val(),p=a.find(".card-expiry-year").val(),n=a.find(".card-address_line1").val(),t=a.find(".card-address_line2").val(),m=a.find(".card-address_city").val(),u=a.find(".card-address_state").val(),q=a.find(".card-address_country").val(),w=a.find(".card-address_zip").val(),z=function(b,d){d.error?(c.removeAttr("disabled"),
b.html(d.error.message)):(f.val(d.id),post_form(a,"stripecharge/gold"))};Stripe.setPublishableKey(b);j?Stripe.validateCardNumber(h)?Stripe.validateExpiry(l,p)?Stripe.validateCVC(e)?n?m?u?q?w?(d.text(""),c.attr("disabled","disabled"),Stripe.createToken({name:j,number:h,cvc:e,exp_month:l,exp_year:p,address_line1:n,address_line2:t,address_city:m,address_state:u,address_country:q,address_zip:w},z)):d.text(r.strings("missing_credit_zip")):d.text(r.strings("missing_credit_country")):d.text(r.strings("missing_credit_state")):
d.text(r.strings("missing_credit_city")):d.text(r.strings("missing_credit_address")):d.text(r.strings("bad_credit_cvc")):d.text(r.strings("bad_credit_expiry")):d.text(r.strings("bad_credit_number")):d.text(r.strings("missing_credit_name"));return!1}};(function(a){a.gild_comment=function(b,c){r.gold.gildComment(b,c);a("#gold_form_"+b).fadeOut(400)}})(jQuery);
r.adzerk={origin:location.protocol=="https:"?"https://az.turbobytes.net":"http://static.adzerk.net",createSponsorshipAdFrame:function(){var a=$("<iframe>").attr({id:"ad_sponsorship",src:r.adzerk.origin+"/reddit/ads-load.html",frameBorder:0,scrolling:"no"});$(".side .sponsorshipbox").empty().append(a)}};$(window).on("message",function(a){a=a.originalEvent;a.origin==r.adzerk.origin&&(msg=a.data.split(":"),msg[0]=="ados.createAdFrame"&&r.adzerk.createSponsorshipAdFrame())});
$(function(){r.config.cursed&&($(".midcol .arrow").on("mouseover",function(a){var a=$(a.target),b=a.clone().css("position","absolute").css("margin",0).css(a.offset()).appendTo(a.parents(".content"));a.css("opacity",0);b.on("mouseover",function(){var a=Math.PI*2*Math.random();b.animate({"margin-left":"+="+20*Math.cos(a),"margin-top":"+="+20*Math.sin(a)},100)})}),$(".buttons a, form button, .pretty-form button").prop("onclick",null).on("click focus",function(a){$(a.currentTarget).blur().prop("tabindex",
"9999").css("white-space","nowrap").animate({"font-size":0,width:0,height:0,opacity:0},200);return!1}))});
r.strings.set({"missing_credit_zip": "missing zip code", "missing_credit_country": "missing country", "missing_credit_state": "missing state or province", "bad_credit_number": "invalid credit card number", "bad_credit_expiry": "invalid expiration date", "gold_summary_comment_gift": "Want to say thanks to *%(recipient)s* for this comment? Give them a month of [reddit gold](/gold/about).", "compact_suggest": "Looks like you're browsing on a small screen. Would you like to try [reddit's mobile interface](%(url)s)?", "an_error_occurred_friendly": "an error occurred. please try again later! (status: %(status)s)", "an_error_occurred": "an error occurred (status: %(status)s)", "missing_credit_city": "missing city", "login_fallback_msg": "try using our secure login form.", "bad_credit_cvc": "invalid cvc", "missing_credit_address": "missing address", "permissions": {"none_msg": "no permissions", "all_msg": "full permissions", "info": {"moderator": {"wiki": {"description": "manage the wiki and access to the wiki", "title": "wiki"}, "access": {"description": "manage the lists of contributors and banned users", "title": "access"}, "mail": {"description": "read and reply to moderator mail", "title": "mail"}, "config": {"description": "edit settings, sidebar, css, and images", "title": "config"}, "posts": {"description": "use the approve, remove, spam, distinguish, and nsfw buttons", "title": "posts"}, "flair": {"description": "manage user flair, link flair, and flair templates", "title": "flair"}}, "moderator_invite": {"wiki": {"description": "manage the wiki and access to the wiki", "title": "wiki"}, "access": {"description": "manage the lists of contributors and banned users", "title": "access"}, "mail": {"description": "read and reply to moderator mail", "title": "mail"}, "config": {"description": "edit settings, sidebar, css, and images", "title": "config"}, "posts": {"description": "use the approve, remove, spam, distinguish, and nsfw buttons", "title": "posts"}, "flair": {"description": "manage user flair, link flair, and flair templates", "title": "flair"}}}}, "missing_credit_name": "missing name"})
