r.ui.TOCScroller=Backbone.View.extend({scrollSpeed:0.4,events:{"click a":"scrollToLinkHash"},initialize:function(b){this.$doc=$(b.doc);this.$toc=$(b.toc);this.$progress=$('<div class="location">').appendTo(this.$toc);this.updateProgress=_.throttle(this._updateProgress,10)},start:function(){$(window).bind("scroll",$.proxy(this,"updateProgress"));$(window).bind("hashchange",_.bind(function(){this.updateProgress()},this));this.updateProgress()},scrollToLinkHash:function(b){this.smoothScrollToHash($(b.target).attr("href").match(/#.*/)[0]);
this.updateProgress();b.preventDefault()},smoothScrollToHash:function(b){var c=this._headingForHash(b),a=$(document).scrollTop(),c=Math.min(this._scrollMax(),c.offset().top);$("html, body").stop(!0).animate({scrollTop:c},{duration:this.scrollSpeed*Math.abs(c-a),step:function(b,c){var f=$(this).scrollTop();if(!(a>0&&f==0))Math.abs(f-a)>5&&$("html, body").stop(),a=c.now},complete:function(){location.replace(location.toString().replace(/#.*$/,"")+b)}})},_scrollMax:function(){return $(document).height()-
$(window).height()},_headingForHash:function(b){return this.$doc.find(document.getElementById(b.substr(1)))},_tocFor:function(b){return this.$toc.find("."+b.attr("id")).children("a")},_updateProgress:function(){var b=$(document).scrollTop(),c=this._scrollMax(),a=this._headingForHash(location.hash).filter("h2");if(a.length){var d=Math.min(c,a.offset().top)-b;if(Math.abs(d)<=10){this.$progress.css("top",this._tocFor(a).position().top);return}}d=$(_.find(this.$doc.children("h2"),function(a){return $(a).offset().top>=
b},this));a=d.prevAll("h2").first();if(!d.length||b==c)a=d=$("h2:last");if(a.length){var c=d.offset().top,e=a.offset().top,c=(b-e)/(c-e),d=this._tocFor(d),a=this._tocFor(a),d=d.position().top,a=a.position().top,c=r.utils.clamp(c,0,1);this.$progress.css("top",a+(d-a)*c)}else this.$progress.css("top",0)}});$(function(){new r.ui.scrollFixed($(".policy-page .doc-info"));(new r.ui.TOCScroller({el:$(".policy-page"),doc:$(".policy-page .md"),toc:$(".policy-page .doc-info .toc")})).start()});
