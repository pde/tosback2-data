(function(wui,$){var settings={};var timeout_id=null;var disabled=false;wui.rapidfire=function(options){settings=$.extend({timeout:1000*60*15,stations:[],format:"js",maxage:20,changedClass:null,changedColor:"#00AA00",unchangedColor:"#000000",elementsSelector:"span.pwsrt",titleSelector:"#pwsrtTitle"},options?options:{});window.CondsLoaded=wui.rapidfire.CondsLoaded;wui.rapidfire.stop();wui.rapidfire.setupNext()};wui.rapidfire.getWUIDomain=function(){var domainStr=document.domain;var domainarray=domainStr.split(".");var domaincom=domainarray[domainarray.length-1];var domainname=domainarray[domainarray.length-2];return domainname+"."+domaincom};wui.rapidfire.getURL=function(){var url="http://stationdata."+wui.rapidfire.getWUIDomain()+"/cgi-bin/stationlookup?station=";url+=settings.stations.join(",");url+="&format="+settings.format;url+="&maxage="+settings.maxage;url+="&rand="+new Date().getTime();return url};wui.rapidfire.setupNext=function(){timeout_id=setTimeout(wui.rapidfire.start,settings.timeout)};wui.rapidfire.start=function(){if(!disabled){var url=wui.rapidfire.getURL();$.getScript(url)}};wui.rapidfire.stop=function(){if(timeout_id){clearTimeout(timeout_id)}timeout_id=null};wui.rapidfire.CondsLoaded=function(conds){var elements=$(settings.elementsSelector);var len=elements.length;var seconds_now=parseInt(conds.now);for(var index=0;index<len;index++){var element=elements[index];var pwsid=element.getAttribute("pwsid");var pwsunit=element.getAttribute("pwsunit");var pwsvariable=element.getAttribute("pwsvariable");var englishunit=element.getAttribute("english");var metricunit=element.getAttribute("metric");var oldvalue=element.getAttribute("value");var pwssetobject=element.getAttribute("pwssetobject");if(conds[pwsid]&&conds[pwsid][pwsvariable]){var value=conds[pwsid][pwsvariable];var newHTML="";if(pwsvariable=="winddir"){if(pwssetobject=="winddir"){}else{newHTML=lookupWindStringFormat(value);value=lookupWindString(value)}}else{if(pwsvariable=="lu"){if(parseInt(oldvalue)<=parseInt(value)){oldvalue=value}newHTML=convertTime(conds[pwsid],oldvalue);element.innerHTML=newHTML;element.setAttribute("value",value)}else{newHTML=value}}if(oldvalue!=value){if(pwsvariable=="tempf"){newHTML=convertTempIntoUnits(pwsunit,value,englishunit,metricunit);if($("#"+pwsid+"tempfspark").length>0){updateTempGraph(value,pwsid)}}else{if(pwsvariable=="windspeedmph"){newHTML=convertWindIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="windgustmph"||pwsvariable=="maxwindgust"){newHTML=convertWindIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="humidity"){newHTML=value}else{if(pwsvariable=="dewptf"){newHTML=convertTempIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="maxtemp"){newHTML=convertTempIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="mintemp"){newHTML=convertTempIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="baromin"){newHTML=convertPressureIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="rainin"){newHTML=convertRainIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="dailyrainin"){newHTML=convertRainIntoUnits(pwsunit,value,englishunit,metricunit)}else{if(pwsvariable=="RealTime"){newHTML=convertRealTime(value)}}}}}}}}}}}if(settings.changedClass){$(element).addClass(settings.changedClass)}if(settings.changedColor){$(element).css("color",settings.changedColor)}if(newHTML){element.innerHTML=newHTML}element.setAttribute("value",value)}else{if(settings.changedClass){$(element).removeClass(settings.changedClass)}if(settings.changedColor){$(element).css("color",settings.unchangedColor)}}if(pwssetobject){if(pwssetobject=="winddir"){wui.rapidfire.setWind(element,conds[pwsid][pwsvariable],true)}else{var pwsaction=pwssetobject+'.setValue("'+conds[pwsid][pwsvariable]+'");';eval(pwsaction)}}}else{if(pwsvariable=="lu"){var seconds_diff=seconds_now-parseInt(oldvalue);conds[pwsid]={};conds[pwsid]["ages"]=parseInt(seconds_diff%60);conds[pwsid]["agem"]=parseInt(seconds_diff/60)%60;conds[pwsid]["ageh"]=parseInt(seconds_diff/3600);newHTML=convertTime(conds[pwsid],oldvalue);element.innerHTML=newHTML}}}var elt_title=$(settings.titleSelector);if(elt_title[0]){var old_title=document.title;var new_title=elt_title.text();new_title=$.trim(new_title).replace(/\n|\r/g,"");if(old_title!==new_title){document.title=new_title}}wui.rapidfire.setupNext()};wui.rapidfire.setWind=function(elt,val,animate){elt=$(elt);if(!elt[0]){return}val=parseInt(val);while(val>=360){val-=360}while(val<0){val+=360}var val_prev=elt.data("val")||0;var width=elt.width();var steps=val-val_prev;var increment=1;elt.stop();if(steps<0){steps*=-1;increment*=-1}if(steps>180){steps=360-steps;increment*=-1}if(steps==0){var left=-1*val*width;wui.rapidfire.setWind.step(elt,left,false)}else{if(!animate){var left=-1*val*width;wui.rapidfire.setWind.step(elt,left,false)}else{var val_tmp=val_prev;for(var i=0;i<steps;i++){val_tmp+=increment;if(val_tmp>=360){val_tmp-=360}if(val_tmp<0){val_tmp+=360}var left=-1*val_tmp*width;wui.rapidfire.setWind.step(elt,left,true)}}}elt.data("val",val);elt.attr("title",val+"??")};wui.rapidfire.setWind.step=function(elt,left,changed){var delay=$.fx.interval;var x=left+"px";var y=changed?"bottom":"top";elt.queue(function(next){elt.css("background-position",x+" "+y);next()});elt.delay(delay)};$(document).ready(function(){var elements=$(settings.elementsSelector).filter("[pwssetobject=winddir]");for(var i=0;i<elements.length;i++){var elt=elements.eq(i);var val=elt.attr("value");if(val){wui.rapidfire.setWind(elt,val,false)}}})})(wui,jQuery);