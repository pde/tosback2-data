(function(){var a=window.define||function(b){return b();};a("fitbit-widget-dropdown",["require","jquery"],function(d){var c=(typeof d==="function");var f=c?d("jquery"):window.jQuery;if(!c){var e=window.fitbit||{};e.modules=e.modules||{};if(f.isFunction(e.modules.dropdown)){return e;}}var b=function(g,h){if(!g||!g.length){return this._throwError("no catalyst specified");}this.catalyst=f(g).first();this.catalystActiveClass=null;this.anchorPoint="left below";this.elements={root:null,content:null};this.fadeEffectDuration=200;this.hideDelay=500;this.isManualShowEnabled=false;this.isMouseBoundaryDetectionEnabled=true;this.isMouseCursorInsideDropdown=false;this.namespace={css:"module-dd",event:"module-dropdown-"};this.positionOffset={x:0,y:0};this._initialize(h);};b.prototype={cancelHide:function(){if(this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null;}},clear:function(){f(this.elements.content).empty();},destroy:function(){this._fireCustomEvent("destroy");this.catalyst.off("."+this.namespace.event);for(var g in this.elements){f(g).remove();}this.catalyst.removeData("module-dropdown-id");delete this;},getCatalystPosition:function(){return this._getCatalystPosition();},getRootElement:function(){return(this.elements.root&&this.elements.root.length)?this.elements.root.get(0):null;},hide:function(){var g=f(this.elements.root);if(!g.is(":animated")){this._fireCustomEvent("beforeHide");this.catalyst.removeClass(this.catalystActiveClass);g.fadeOut(this.fadeEffectDuration,f.proxy(function(){this._fireCustomEvent("hide");},this));}},isVisible:function(){try{return this.elements.root.is(":visible");}catch(g){return false;}},render:function(g,h){if(g){if(!h){this.clear();}f(this.elements.content).append(g);this._fireCustomEvent("render");return true;}return false;},setPosition:function(){this._setPosition();},setPositionOffset:function(g,h){if(f.isNumeric(g)){this.positionOffset.x=g;}if(f.isNumeric(h)){this.positionOffset.y=h;}},show:function(){this.setPosition();this._fireCustomEvent("beforeShow");this.catalyst.addClass(this.catalystActiveClass);f(this.elements.root).fadeIn(this.fadeEffectDuration,f.proxy(function(){this._fireCustomEvent("show");},this));},subscribe:function(g,i,h){if(typeof g==="string"&&f.isFunction(i)){this.catalyst[(h===true)?"one":"on"](this._getEventName(g),i);return true;}return false;},toggle:function(){return this._toggle();},unsubscribe:function(g,h){if(typeof g==="string"){this.catalyst.off(this._getEventName(g),h);return true;}return false;},_applyConfiguration:function(h){if(f.isPlainObject(h)){var g=function(i){return(typeof i==="string"&&!(/^\s*$/).test(i));};if(g(h.anchorPoint)){this.anchorPoint=h.anchorPoint;}if(g(h.className)){this.customClassName=h.className;}if(g(h.catalystActiveClass)){this.catalystActiveClass=h.catalystActiveClass;}if(f.isNumeric(h.hideDelay)){this.hideDelay=h.hideDelay>0?h.hideDelay:0;}if(f.isNumeric(h.fadeEffectDuration)||h.fadeEffectDuration===false){this.fadeEffectDuration=h.fadeEffectDuration;}this.isMouseBoundaryDetectionEnabled=!(h.mouseBoundaryDetectionEnabled===false);this.isManualShowEnabled=(h.manualShowEnabled===true);}},_buildStructure:function(){var i=f.proxy(function(j){var k=this.namespace.css;if(typeof j==="string"){k+="-"+j.replace(/\s+/,"-");}return k;},this);var h=f("<div/>").addClass(i()).hide();if(this.customClassName){h.addClass(this.customClassName);}var g=f("<div/>").addClass(i("content")).appendTo(h);h.appendTo(document.body);f.extend(this.elements,{root:h,content:g});},_defineAnchorPointStrategies:function(){if(!this.anchorPointStrategies){this.anchorPointStrategies={"below":f.proxy(function(){var g=this._getCatalystPosition();return{"top":parseInt(this.positionOffset.y+g.y+g.h,10)+"px","bottom":"auto"};},this),"left":f.proxy(function(){var g=this._getCatalystPosition();return{"left":parseInt(this.positionOffset.x+g.x,10)+"px","right":"auto"};},this),"right":f.proxy(function(){var g=this._getCatalystPosition();return{"right":parseInt(f(window).width()-((0-this.positionOffset.x)+g.x+g.w),10)+"px","left":"auto"};},this)};}},_fireCustomEvent:function(g){this.catalyst.trigger(this._getEventName(g),this);},_getCatalystPosition:function(){var g=this.catalyst;var h=g.offset();return{x:Math.round(h.left),y:Math.round(h.top),w:Math.round(g.outerWidth(false)),h:Math.round(g.outerHeight(false))};},_getEventName:function(g){return(typeof g==="string"||f.isArray(g))?g+"."+this.namespace.event:null;},_getEventNames:function(g){if(g){if(typeof g==="string"){g=[g];}f.each(g,f.proxy(function(i,h){g[i]=this._getEventName(h);},this));}return(g&&g.length)?g:null;},_getPositionByAnchorPoint:function(){var h=this.anchorPoint.split(" ");if(h.length!==2){this._throwError("anchor point is invalid");}var g={};f.each(h,f.proxy(function(i,j){f.extend(g,this.anchorPointStrategies[j]());},this));if(f.isEmptyObject(g)){this._throwError("could not determine dropdown position from anchor point");}return g;},_getUniqueId:function(){if(!f.isNumeric(this.uniqueId)){this.uniqueId=parseInt(Math.random().toString().replace(".",""),10);}return this.uniqueId;},_initialize:function(g){var h=this._getUniqueId();this.namespace.event+=h;this._applyConfiguration(g);this._buildStructure();f(this.catalyst).add(this.elements.root).data("module-dropdown-id",h);this._initializeCatalyst();this._initializeMouseBoundaryDetection();this._defineAnchorPointStrategies();f(window).on(this._getEventName("resize"),f.proxy(function(){if(this.isVisible()){this._fireCustomEvent("hideAfterResize");this.hide();}},this));f(document.body).on(this._getEventName("click"),f.proxy(function(j){var i=f(j.target);if(this.isVisible()&&!(i.closest(this.catalyst).length||i.closest("."+this.namespace.css).length)){this.hide();}},this));this._fireCustomEvent("initialize");},_initializeCatalyst:function(){if(!this.isManualShowEnabled&&!this.isMouseDelayedShowEnabled){this.catalyst.on(this._getEventName("click"),f.proxy(function(g){if(g){g.preventDefault();}this._toggle();},this));}},_initializeMouseBoundaryDetection:function(){if(this.isMouseBoundaryDetectionEnabled){this.elements.root.on(this._getEventName("mouseenter"),f.proxy(function(){this._setMouseCursorInsideDropdown(true);},this)).on(this._getEventName("mouseleave"),f.proxy(function(){this._setMouseCursorInsideDropdown(false);if(!this.hideTimer&&this.isVisible()){this.hideTimer=setTimeout(f.proxy(function(){if(!this.isMouseCursorInsideDropdown){this.hide();}this.cancelHide();},this),this.hideDelay);}},this));}},_setMouseCursorInsideDropdown:function(g){if(g){this.isMouseCursorInsideDropdown=true;this._fireCustomEvent("mouseEnterDropdown");}else{this.isMouseCursorInsideDropdown=false;this._fireCustomEvent("mouseLeaveDropdown");}},_setPosition:function(){this.elements.root.css(this._getPositionByAnchorPoint());this._fireCustomEvent("position");},_throwError:function(g){console.log("Fitbit Dropdown Widget : "+(g||"unknown error"));},_toggle:function(){if(this.isVisible()){this.hide();return false;}else{this.show();return true;}}};if(c){return b;}else{e.modules.dropdown=b;return e;}});}());(function(c){c.tools=c.tools||{version:"@VERSION"};c.tools.overlay={addEffect:function(e,f,g){b[e]=[f,g];},conf:{close:null,closeOnClick:true,closeOnEsc:true,closeSpeed:"fast",effect:"default",fixed:!c.browser.msie||c.browser.version>6,left:"center",load:false,mask:null,oneInstance:true,speed:"normal",target:null,top:"10%"}};var d=[],b={};c.tools.overlay.addEffect("default",function(h,g){var f=this.getConf(),e=c(window);if(!f.fixed){h.top+=e.scrollTop();h.left+=e.scrollLeft();}h.position=f.fixed?"fixed":"absolute";this.getOverlay().css(h).fadeIn(f.speed,g);},function(e){this.getOverlay().fadeOut(this.getConf().closeSpeed,e);});function a(h,m){var o=this,f=h.add(o),n=c(window),k,j,i,e=c.tools.expose&&(m.mask||m.expose),l=Math.random().toString().slice(10);if(e){if(typeof e=="string"){e={color:e};}e.closeOnClick=e.closeOnEsc=false;}var g=m.target||h.attr("rel");j=g?c(g):null||h;if(!j.length){throw"Could not find Overlay: "+g;}if(h&&h.index(j)==-1){h.click(function(p){o.load(p);return p.preventDefault();});}c.extend(o,{load:function(u){if(o.isOpened()){return o;}var r=b[m.effect];if(!r){throw'Overlay: cannot find effect : "'+m.effect+'"';}if(m.oneInstance){c.each(d,function(){this.close(u);});}u=u||c.Event();u.type="onBeforeLoad";f.trigger(u);if(u.isDefaultPrevented()){return o;}i=true;if(e){c(j).expose(e);}var t=m.top,s=m.left,p=j.outerWidth(true),q=j.outerHeight(true);if(typeof t=="string"){t=t=="center"?Math.max((n.height()-q)/2,0):parseInt(t,10)/100*n.height();}if(s=="center"){s=Math.max((n.width()-p)/2,0);}r[0].call(o,{top:t,left:s},function(){if(i){u.type="onLoad";f.trigger(u);}});if(e&&m.closeOnClick){c.mask.getMask().one("click",o.close);}if(m.closeOnClick){c(document).bind("click."+l,function(v){if(!c(v.target).parents(j).length){o.close(v);}});}if(m.closeOnEsc){c(document).bind("keydown."+l,function(v){if(v.keyCode==27){o.close(v);}});}return o;},close:function(p){if(!o.isOpened()){return o;}p=p||c.Event();p.type="onBeforeClose";f.trigger(p);if(p.isDefaultPrevented()){return;}i=false;b[m.effect][1].call(o,function(){p.type="onClose";f.trigger(p);});c(document).unbind("click."+l).unbind("keydown."+l);if(e){c.mask.close();}return o;},getOverlay:function(){return j;},getTrigger:function(){return h;},getClosers:function(){return k;},isOpened:function(){return i;},getConf:function(){return m;}});c.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(q,p){if(c.isFunction(m[p])){c(o).bind(p,m[p]);}o[p]=function(r){if(r){c(o).bind(p,r);}return o;};});k=j.find(m.close||".close");if(!k.length&&!m.close){k=c('<a class="close"></a>');j.prepend(k);}k.click(function(p){o.close(p);});if(m.load){o.load();}}c.fn.overlay=function(e){var f=this.data("overlay");if(f){return f;}if(c.isFunction(e)){e={onBeforeLoad:e};}e=c.extend(true,{},c.tools.overlay.conf,e);this.each(function(){f=new a(c(this),e);d.push(f);c(this).data("overlay",f);});return e.api?f:this;};})(jQuery);define("jqtools-overlay",function(){});(function(b){b.tools=b.tools||{version:"@VERSION"};var e;e=b.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:true,closeOnEsc:true,zIndex:9998,opacity:0.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};function f(){if(b.browser.msie){var k=b(document).height(),j=b(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,k-j<20?j:k];}return[b(document).width(),b(document).height()];}function h(j){if(j){return j.call(b.mask);}}var i,d,c,a,g;b.mask={load:function(j,l){if(c){return this;}if(typeof j=="string"){j={color:j};}j=j||a;a=j=b.extend(b.extend({},e.conf),j);i=b("#"+j.maskId);if(!i.length){i=b("<div/>").attr("id",j.maskId);b("body").append(i);}var k=f();i.css({position:"absolute",top:0,left:0,width:k[0],height:k[1],display:"none",opacity:j.startOpacity,zIndex:j.zIndex});if(j.color){i.css("backgroundColor",j.color);}if(h(j.onBeforeLoad)===false){return this;}if(j.closeOnEsc){b(document).bind("keydown.mask",function(m){if(m.keyCode==27){b.mask.close(m);}});}if(j.closeOnClick){i.bind("click.mask",function(m){b.mask.close(m);});}b(window).bind("resize.mask",function(){b.mask.fit();});if(l&&l.length){g=l.eq(0).css("zIndex");b.each(l,function(){var m=b(this);if(!/relative|absolute|fixed/i.test(m.css("position"))){m.css("position","relative");}});d=l.css({zIndex:Math.max(j.zIndex+1,g=="auto"?0:g)});}i.css({display:"block"}).fadeTo(j.loadSpeed,j.opacity,function(){b.mask.fit();h(j.onLoad);c="full";});c=true;return this;},close:function(){if(c){if(h(a.onBeforeClose)===false){return this;}i.fadeOut(a.closeSpeed,function(){h(a.onClose);if(d){d.css({zIndex:g});}c=false;});b(document).unbind("keydown.mask");i.unbind("click.mask");b(window).unbind("resize.mask");}return this;},fit:function(){if(c){var j=f();i.css({width:j[0],height:j[1]});}},getMask:function(){return i;},isLoaded:function(j){return j?c=="full":c;},getConf:function(){return a;},getExposed:function(){return d;}};b.fn.mask=function(j){b.mask.load(j);return this;};b.fn.expose=function(j){b.mask.load(j,this);return this;};})(jQuery);define("jqtools-toolbox-expose",function(){});define("galileo/i18n/messageformat/locales",["require"],function(a){MessageFormat=window["MessageFormat"]||{};MessageFormat.locale=MessageFormat.locale||{};MessageFormat.locale.en=function(b){if(b===1){return"one";}return"other";};MessageFormat.locale.fr=function(b){if(b>=0&&b<2){return"one";}return"other";};MessageFormat.locale.de=function(b){if(b===1){return"one";}return"other";};MessageFormat.locale.es=function(b){if(b===1){return"one";}return"other";};MessageFormat.locale.ja=function(b){if(b===1){return"one";}return"other";};MessageFormat.locale.ru=function(b){if((b%10)==1&&(b%100)!=11){return"one";}if((b%10)>=2&&(b%10)<=4&&((b%100)<12||(b%100)>14)&&b==Math.floor(b)){return"few";}if((b%10)===0||((b%10)>=5&&(b%10)<=9)||((b%100)>=11&&(b%100)<=14)&&b==Math.floor(b)){return"many";}return"other";};});define("substitute",["require"],function(a){return function(d){if(typeof d!=="string"){return"";}if(arguments.length>1){for(var c=0,b=arguments.length;c<b;c++){d=d.replace("{"+c+"}",arguments[c+1]+"");}}return d;};});(function(){var a=window.define||function(b){return b();};a("fitbit-jquery-charsRemaining",["require","jquery","galileo/i18n/messageformat/locales","substitute"],function(e){var f=typeof e==="function";var b=document.getElementById("requirejs");var j=f?e("jquery"):window.jQuery;if(f&&!b){var q=e("galileo/i18n/messageformat/locales");var o=e("substitute");}else{var q=function(r){return r;};var o=fitbit.i18n.getResource;}var i={singular:"{0} character remaining",plural:"{0} characters remaining"};var g={css:"module-chars-remaining",plugin:"chars_remaining"};var h={maxlength:140,warningThreshold:20,warningClass:"warning",errorClass:"exceeded",tagName:"span"};function n(r){return j(r).data(g.plugin).config;}function p(r){var s=r===1?"singular":"plural";return o(i[s],r);}function c(r){return j(r).data(g.plugin).messageEl;}function m(r){r=j(r);var s=n(r);var u=r.val().length;var t=s.maxlength;var v=c(r);v.text(p(t-u));if(u>=t){if(!v.hasClass(s.errorClass)){v.removeClass(s.warningClass).addClass(s.errorClass);k(r,"lengthError");}}else{if(u>=t-s.warningThreshold){if(!v.hasClass(s.warningClass)){v.removeClass(s.errorClass).addClass(s.warningClass);k(r,"lengthWarning");}}else{if(v.hasClass(s.errorClass)){v.removeClass(s.errorClass);k(r,"lengthOkay");}if(v.hasClass(s.warningClass)){v.removeClass(s.warningClass);}}}}function l(r){console.log(g.plugin+" : "+r);}function k(r,s){j(r).trigger(s);}var d={init:function(s){var r=j.extend(h,s);var t=p(r.maxlength);if(!t||/^\s*$/.test(t)){l("error initializing, message keys not found");}return this.each(function(){var u=j(this);if(u.is("input[type='text'], input[type='password'], textarea")){var v=u.data(g.plugin);if(!v){var w=j("<"+r.tagName+"/>").addClass(g.css).html(t).insertAfter(u);u.data(g.plugin,{target:u,messageEl:w,config:r});u.on("paste."+g.plugin+" keyup."+g.plugin,function(){setTimeout(function(){m(u);},0);});}}});},reset:function(){return this.each(function(){var r=j(this);r.val("");m(r);});},destroy:function(){return this.each(function(){var r=j(this);c(r).remove();r.off("."+g.plugin).removeData(g.plugin);});}};j.fn.charsRemaining=function(r){if(j.isFunction(d[r])){return d[r].apply(this,Array.prototype.slice.call(arguments,1));}else{if(j.isPlainObject(r)||!r){return d.init.apply(this,arguments);}else{l('"'+r+'" does not exist');return this;}}};});})();(function(){var a=window.define||function(b){return b();};a("fitbit-jquery-peerMessageModal",["require","jquery","jqtools-overlay","jqtools-toolbox-expose","fitbit-jquery-charsRemaining"],function(c){if(typeof c==="function"){var f=c("jquery");c("jqtools-overlay");c("jqtools-toolbox-expose");c("fitbit-jquery-charsRemaining");}else{var f=window.jQuery;window.curvyCornersNoAutoScan=true;}if(f.isFunction(f.fn.peerMessageModal)){return;}var e=false;var g;var b;var d;f.fn.peerMessageModal=function(q){var m=f(this),j=180,i=f.extend({},f.fn.peerMessageModal.defaults,q),p=function(){k.launchModal();},l={overlay:{top:"center",left:"center",mask:{color:"#000",opacity:0.6},close:".closeModal, .cancel",zIndex:9999,onLoad:function(){h();b.get(0).focus();},onClose:function(){g.each(function(r,s){s.reset();});b.charsRemaining("reset");d.hide();}}},k={launchModal:function(){k.addData();m.overlay(l.overlay);k.overlay=m.data("overlay");k.overlay.load();}};k.addData=function(){var s=i.userThumb.replace(/\\"/g,'"');var r=m.find(".modal-header");r.find(".name").text(i.userName).end().find(".photo").empty().append(f("<img/>").attr({src:i.userThumb,width:40,height:40,alt:""}));};p();m.one("submit",g,function(r){r.preventDefault();if(o()){f.ajax({type:"GET",url:"/leaderboard/message",data:{apiFormat:"JSON",sendMessage:"on",recipientEncodedUserId:i.userId,msgToSend:b.val(),statType:i.statType,periodType:i.periodType,networkType:i.networkType,networkId:i.networkId,dataType:i.dataType},dataType:"json",success:function(s){d.fadeIn(200);setTimeout(function(){k.overlay.close();},2000);var t=(typeof i.trackingSource==="string")?i.trackingSource:location.href;n({source:t});}});}});function h(){if(e){return;}e=true;var r="failure";g=m.find(".wrapper-form");b=g.find("textarea").first();d=m.find(".message-success");b.charsRemaining({maxlength:j}).on("paste keyup",function(){setTimeout(function(){g.toggleClass(r,!o());},0);});}function o(){var r=b.val();return(r.length<=j)&&!(/^\s*$/).test(r);}function n(r){if(f.isArray(mpq)&&f.isPlainObject(r)){mpq.push(["track","send message",f.extend({"token":mpqSocialFeaturesPrj,"user_action":"sendMessage"},r)]);}}};});}());(function(){var a=window.define||function(b){return b();};a("fitbit-header-notificationDropdown",["require","jquery","fitbit-widget-dropdown","fitbit-jquery-peerMessageModal","galileo/i18n/messageformat/locales"],function(d){var e=typeof d==="function";var b=document.getElementById("requirejs");if(e){var g=d("jquery");var f=d("fitbit-widget-dropdown");d("fitbit-jquery-peerMessageModal");}else{var g=window.jQuery;var f=g.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;}if(e&&!b){var l=d("galileo/i18n/messageformat/locales");null;var i={badges:"Badges",friend_rankings:"Friend Rankings",reply:"Reply",send_message:"Send Message",view_request:"View Request",loading_notifications:"Loading...",empty_state_notifications:"You have no notifications."};var j=function(m){return i[m]?i[m]:"";};}else{var j=function(m){return fitbit.i18n.getResource("com.fitbit.app.user.friends.label."+m);};}var c="isNotificationDropdownInitialized";var k=g("#catalyst-notify");if(k.data(c)){return;}var h=function(){g.firstNotifRequest=true;var q={notifications:{},subsequentNotifications:{}},t=true,o="notifyList",v=k,w={friendReq:[j("view_request"),"/user/"],messageSingle:[j("reply"),"#umm"],cheer:[j("reply"),"#umm"],taunt:[j("reply"),"#umm"],passSingle:[j("send_message"),"#umm"],passedBySingle:[j("send_message"),"#umm"],passMultiple:[j("friend_rankings"),"/friends/leaders"],badge:[j("badges"),"/badges/all"],messageCorporate:["",""]};function p(y){var x=g("<ul>").addClass("listCont");g.isArray(y.result)&&g.each(y.result,function(){var B=this,C={},z="";g.each(w,function(D,E){if(D==B.notifType){z=E[0];C.link=E[1];C.actionType=B.notifType;}});if(g.isPlainObject(this.msgMetaData)){C.dataType=this.msgMetaData.dataType;C.statType=this.msgMetaData.statType;C.periodType=this.msgMetaData.periodType;C.networkType=this.msgMetaData.networkType;C.networkId=this.msgMetaData.networkId;}C.userId=this.thumbUsrEncId;C.userName=this.thumbUsrDisplayName;C.userThumb=this.thumbImage;if(C.actionType=="messageCorporate"){C=null;}if(this.thumbMetaData){var A=g("<div>").addClass("thumb thumb-badge").append(g("<img>").addClass("photo").attr("src",this.thumbImage).attr("alt",""),g("<span>").addClass("num").text(this.thumbMetaData.badgeValue),g("<span>").addClass("unit").text(this.thumbMetaData.badgeUnit));}else{A=g("<div>").addClass("thumb").append(g("<img>").addClass("photo").attr("src",this.thumbImage).attr("alt",this.thumbUsrDisplayName||""));}g("<li>").addClass("clearfix").addClass(this.hasBeenRead).data("action",C).append(g("<div>").addClass("timeAction").append(g("<span>").text(this.notifTimeLabel),g("<span>").addClass("link").text(z)),A,g("<div>").addClass("icon").addClass(this.notifType).addClass(this.hasBeenRead),g("<div>").addClass("meat").append(g("<h6>").text(this.notifSysGenMsg),g("<span>").text(this.notifUsrGenMsg))).appendTo(x);});x=x.add(g("<div>").addClass("paginate").addClass(!isNaN(y.result.length)&&y.result.length<15?"hide":"").append(g("<span>").text(g("#notificationDropdownTemplate").html())));return x;}q.generateTemplateHTML=function(B){var A=g("#notificationDropdownTemplate").html(),x=!g.isEmptyObject(q.notifications)?q.notifications:false,z=!g.isEmptyObject(q.subsequentNotifications)?q.subsequentNotifications:false,y={};if(z&&B){y=p(q.subsequentNotifications);}else{if(x){y=p(q.notifications);}else{return false;}}return y;};q.showLoader=function(){NotifDD.render('<div class="initialLoading">'+j("loading_notifications")+"</div>");if(t){if(!NotifDD.isVisible()){NotifDD.show();}}else{NotifDD.toggle();}};q.displayNotifList=function(x,y){var z=!g.isEmptyObject(q.notifications)?q.notifications.result.length:0;NotifDD.render(x,y);if(!t&&!y){q.markAsRead();}if(t||y){if(!NotifDD.isVisible()){NotifDD.show();}}else{NotifDD.toggle();}if(!y){n();r();}};q.init=function(x){if(t){q.bindEvents();}q.displayNotifList(q.generateTemplateHTML());t=false;};q.bindEvents=function(){g("."+o).on("click",".paginate",function(){var x=this;g(x).addClass("spinner");g.ajax({type:"GET",url:"/notifications/view",data:{apiFormat:"JSON",lowEventId:s(false)},dataType:"json",success:function(y){if(y.result.length>0){h.saveJSON(y);q.displayNotifList(q.generateTemplateHTML(true),true);g(x).html("").removeClass("spinner, paginate").addClass("divider");u({user_action:"load more"});}}});});g("."+o).on("click","li",function(){var x=g(this).data("action");if(/^#umm/.test(x.link)){q.notificationMessageModal(x);return;}if(/^\/user\/$/.test(x.link)){x.link+=x.userId;}q.notificationLink(x);});NotifDD.subscribe("show",function(){u({user_action:"show"});});NotifDD.subscribe("hide",function(){u({user_action:"hide"});});};q.notificationLink=function(x){u({notification_type:x.actionType});window.location=x.link;};q.notificationMessageModal=function(x){if(NotifDD.isVisible()){NotifDD.hide();}g("#peerMessageModal").peerMessageModal(g.extend(x,{trackingSource:"reply to "+x.actionType}));u({"!NOTIFICATION_TYPE":x.actionType});};q.saveJSON=function(x){if(x&&t&&x.result.length>0){g.extend(q.notifications,x);}else{if(x&&x.result.length>0){g.extend(q.subsequentNotifications,x);}}};q.markAsRead=function(){g("."+o).find("li").addClass("read").end().find(".icon").addClass("read").end().find(".paginate").removeClass("spinner");};q.newDropdown=function(){if(v.length){NotifDD=new f(v,{className:o+" subnav subnav-app",anchorPoint:"below right",manualShowEnabled:true,catalystActiveClass:"active",mouseBoundaryDetectionEnabled:false});NotifDD.setPositionOffset(-51,0);}};function r(){k.find(".icon-notify").removeClass("unread");}function n(y){var x=s(true);if(x){g.ajax({type:"GET",url:"/notifications/view",data:{apiFormat:"JSON",updateLastViewed:"on",highEventId:x},dataType:"json",success:function(z){}});}}function s(x){var A=q.notifications.result?q.notifications.result:null,B=q.subsequentNotifications.result?q.subsequentNotifications.result:null,z=[],y=[];if(g.isArray(A)&&g.isArray(B)){z=g.merge(A,B);}else{if(g.isArray(A)){z=A;}else{return false;}}g.each(z,function(C,D){y.push(parseInt(D.notifId));});return Math[x?"max":"min"].apply(null,y);}function u(x){var y=window.mpq;if(g.isArray(y)&&g.isPlainObject(x)){y.push(["track","Social: View Notifications",g.extend({token:mpqMasterPrj,user_action:"list item click",uid:m()},x)]);}}function m(){var x=window.mpq;try{var z=mpqSocialFeaturesPrj!==mpqQAPrj;return z?"":x.metrics.super_properties.all.distinct_id;}catch(y){}return"";}return q;}();g(function(){h.newDropdown();k.addClass("hasdropdown");k.data(c,true);k.on("mousedown",function(){var m=j("empty_state_notifications");if(g.firstNotifRequest){h.showLoader();g.firstNotifRequest=false;g.ajax({type:"GET",url:"/notifications/view",data:{apiFormat:"JSON"},dataType:"json",success:function(n){if(n.result.length>0){h.saveJSON(n);h.init();}else{g(".initialLoading").addClass("empty").html(m);}}});}else{h.init();}});});});})();define("galileo/util/date",["require","galileo/i18n/messageformat/locales","substitute"],function(a){var d=a("galileo/i18n/messageformat/locales");var f=a("substitute");null;var c={just_now:"just now",seconds:"{0} secs ago",minute:"{0} min ago",minutes:"{0} mins ago",hour:"{0} hr ago",hours:"{0} hrs ago",day:"{0} day ago",days:"{0} days ago",week:"{0} wk ago",weeks:"{0} wks ago",months:"{0} months ago",years:"{0} years ago"};function e(q,r){if(r){try{q=b(q,q.charAt(q.length-1)==="Z");}catch(k){if(console){console.log("getRelativeDate: improperly formatted ISO8601 date string");}return"";}}var p=function(t,s){return c[t]?f(c[t],s):"";};var n=Math.floor(((new Date).getTime()-(new Date(q)).getTime())/1000);var o="";if($.isNumeric(n)){var h=60,i=h*60,m=i*24,g=m*7,j=g*4,l=j*52;if(n<30){o=p("just_now",n);}else{if(n<h){o=p("seconds",n);}else{if(n<h*2){o=p("minute","1");}else{if(n<i){o=p("minutes",Math.floor(n/h));}else{if(n<i*2){o=p("hour","1");}else{if(n<m){o=p("hours",Math.floor(n/i));}else{if(n<m*2){o=p("day","1");}else{if(n<g){o=p("days",Math.floor(n/m));}else{if(n<g*2){o=p("week","1");}else{if(n<j*3){o=p("weeks",Math.floor(n/g));}else{if(n<l*2){o=p("months",Math.floor(n/j));}else{o=p("years",Math.floor(n/l));}}}}}}}}}}}}return o;}function b(j,l){var i=j.match(/([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?/);var k=0;var g=new Date(i[1],0,1);if(i[3]){g.setMonth(i[3]-1);}if(i[5]){g.setDate(i[5]);}if(i[7]){g.setHours(i[7]);}if(i[8]){g.setMinutes(i[8]);}if(i[10]){g.setSeconds(i[10]);}if(i[12]){g.setMilliseconds(Number("0."+i[12])*1000);}if(i[14]){k=Number(i[16])*60+Number(i[17]);k*=i[15]=="-"?1:-1;}if(!l){k-=g.getTimezoneOffset();}var h=new Date;h.setTime(Number(Number(g)+k*60*1000));return h;}return{getRelativeDate:e,getDateFromISO8601:b};});define("messages-deviceNames",["require","galileo/i18n/messageformat/locales"],function(a){var b=a("galileo/i18n/messageformat/locales");null;return{FLOJO:{name:"Aria",displayName:"Aria Scale"},KEPLER:{name:"Classic",displayName:"Classic Tracker"},TYCHO:{name:"Ultra",displayName:"Ultra Tracker"},GALILEO:{name:"Zip",displayName:"Zip Tracker"},HADRON:{name:"One",displayName:"One Tracker"},QUARK:{name:"Flex",displayName:"Flex Tracker"}};});define("messages-batteryLevels",["require","galileo/i18n/messageformat/locales"],function(a){var b=a("galileo/i18n/messageformat/locales");null;return{empty:"Empty",low:"Low",medium:"Medium",high:"High",full:"Full",unknown:"???"};});define("galileo/builder/text",["require","jquery"],function(a){a("jquery");return function(h,g){var c={italic:{"font-style":"italic"},bold:{"font-weight":"bold"},uppercase:{"text-transform":"uppercase"},underline:{"text-decoration":"underline"},nounderline:{"text-decoration":"none"}};var e=h.split(/(?:\s|\/)+/),d={};while(e.length&&e[0] in c){Object.merge(d,c[e.shift()]);}var f=/\d+(\.\d*)?(px|em|%|pt|en)/;if(e.length&&e[0].match(f)){Object.merge(d,{"font-size":e.shift()});}if(e.length&&e[0].match(f)){Object.merge(d,{"line-height":e.shift()});}if(e.getLast()&&e.getLast().indexOf("#")==0){Object.merge(d,{color:e.pop()});}var b=e.join(" ").trim();if(b!=""){Object.merge(d,{fontFamily:b});}return $("<span>").css(d).text(g);};});define("galileo/builder/util",["require","./text"],function(b){var e=b("./text");function d(f,g){return $("<span>").append($("<span>").css("display","inline-block").width(10).height(10).css("backgroundColor",f),c(10),e("uppercase 12px #666",g));}function c(f){return $("<span>").css("display","inline-block").width(f);}function a(f){return $("<p>").html("&nbsp").height(f);}return{hspace:c,vspace:a,legend:d};});(function(){this.MooTools={version:"1.4.5",build:"ab8ea8824dc3b24b6666867a2c4ed58ebb762cf0"};var o=this.typeOf=function(i){if(i==null){return"null";}if(i.$family!=null){return i.$family();}if(i.nodeName){if(i.nodeType==1){return"element";}if(i.nodeType==3){return(/\S/).test(i.nodeValue)?"textnode":"whitespace";}}else{if(typeof i.length=="number"){if(i.callee){return"arguments";}if("item" in i){return"collection";}}}return typeof i;};var j=this.instanceOf=function(t,i){if(t==null){return false;}var s=t.$constructor||t.constructor;while(s){if(s===i){return true;}s=s.parent;}if(!t.hasOwnProperty){return false;}return t instanceof i;};var f=this.Function;var p=true;for(var k in {toString:1}){p=null;}if(p){p=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"];}f.prototype.overloadSetter=function(s){var i=this;return function(u,t){if(u==null){return this;}if(s||typeof u!="string"){for(var v in u){i.call(this,v,u[v]);}if(p){for(var w=p.length;w--;){v=p[w];if(u.hasOwnProperty(v)){i.call(this,v,u[v]);}}}}else{i.call(this,u,t);}return this;};};f.prototype.overloadGetter=function(s){var i=this;return function(u){var v,t;if(typeof u!="string"){v=u;}else{if(arguments.length>1){v=arguments;}else{if(s){v=[u];}}}if(v){t={};for(var w=0;w<v.length;w++){t[v[w]]=i.call(this,v[w]);}}else{t=i.call(this,u);}return t;};};f.prototype.extend=function(i,s){this[i]=s;}.overloadSetter();f.prototype.implement=function(i,s){this.prototype[i]=s;}.overloadSetter();var n=Array.prototype.slice;f.from=function(i){return(o(i)=="function")?i:function(){return i;};};Array.from=function(i){if(i==null){return[];}return(a.isEnumerable(i)&&typeof i!="string")?(o(i)=="array")?i:n.call(i):[i];};Number.from=function(s){var i=parseFloat(s);return isFinite(i)?i:null;};String.from=function(i){return i+"";};f.implement({hide:function(){this.$hidden=true;return this;},protect:function(){this.$protected=true;return this;}});var a=this.Type=function(u,t){if(u){var s=u.toLowerCase();var i=function(v){return(o(v)==s);};a["is"+u]=i;if(t!=null){t.prototype.$family=(function(){return s;}).hide();}}if(t==null){return null;}t.extend(this);t.$constructor=a;t.prototype.$constructor=t;return t;};var e=Object.prototype.toString;a.isEnumerable=function(i){return(i!=null&&typeof i.length=="number"&&e.call(i)!="[object Function]");};var q={};var r=function(i){var s=o(i.prototype);return q[s]||(q[s]=[]);};var b=function(t,x){if(x&&x.$hidden){return;}var s=r(this);for(var u=0;u<s.length;u++){var w=s[u];if(o(w)=="type"){b.call(w,t,x);}else{w.call(this,t,x);}}var v=this.prototype[t];if(v==null||!v.$protected){this.prototype[t]=x;}if(this[t]==null&&o(x)=="function"){m.call(this,t,function(i){return x.apply(i,n.call(arguments,1));});}};var m=function(i,t){if(t&&t.$hidden){return;}var s=this[i];if(s==null||!s.$protected){this[i]=t;}};a.implement({implement:b.overloadSetter(),extend:m.overloadSetter(),alias:function(i,s){b.call(this,i,this.prototype[s]);}.overloadSetter(),mirror:function(i){r(this).push(i);return this;}});new a("Type",a);var d=function(s,x,v){var u=(x!=Object),B=x.prototype;if(u){x=new a(s,x);}for(var y=0,w=v.length;y<w;y++){var C=v[y],A=x[C],z=B[C];if(A){A.protect();}if(u&&z){x.implement(C,z.protect());}}if(u){var t=B.propertyIsEnumerable(v[0]);x.forEachMethod=function(G){if(!t){for(var F=0,D=v.length;F<D;F++){G.call(B,B[v[F]],v[F]);}}for(var E in B){G.call(B,B[E],E);}};}return d;};d("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",f,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=m.overloadSetter();Date.extend("now",function(){return +(new Date);});new a("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null";}.hide();Number.extend("random",function(s,i){return Math.floor(Math.random()*(i-s+1)+s);});var g=Object.prototype.hasOwnProperty;Object.extend("forEach",function(i,t,u){for(var s in i){if(g.call(i,s)){t.call(u,i[s],s,i);}}});Object.each=Object.forEach;Array.implement({forEach:function(u,v){for(var t=0,s=this.length;t<s;t++){if(t in this){u.call(v,this[t],t,this);}}},each:function(i,s){Array.forEach(this,i,s);return this;}});var l=function(i){switch(o(i)){case"array":return i.clone();case"object":return Object.clone(i);default:return i;}};Array.implement("clone",function(){var s=this.length,t=new Array(s);while(s--){t[s]=l(this[s]);}return t;});var h=function(s,i,t){switch(o(t)){case"object":if(o(s[i])=="object"){Object.merge(s[i],t);}else{s[i]=Object.clone(t);}break;case"array":s[i]=t.clone();break;default:s[i]=t;}return s;};Object.extend({merge:function(z,u,t){if(o(u)=="string"){return h(z,u,t);}for(var y=1,s=arguments.length;y<s;y++){var w=arguments[y];for(var x in w){h(z,x,w[x]);}}return z;},clone:function(i){var t={};for(var s in i){t[s]=l(i[s]);}return t;},append:function(w){for(var v=1,t=arguments.length;v<t;v++){var s=arguments[v]||{};for(var u in s){w[u]=s[u];}}return w;}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(i){new a(i);});var c=Date.now();String.extend("uniqueID",function(){return(c++).toString(36);});})();Array.implement({every:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&!c.call(d,this[b],b,this)){return false;}}return true;},filter:function(d,f){var c=[];for(var e,b=0,a=this.length>>>0;b<a;b++){if(b in this){e=this[b];if(d.call(f,e,b,this)){c.push(e);}}}return c;},indexOf:function(c,d){var b=this.length>>>0;for(var a=(d<0)?Math.max(0,b+d):d||0;a<b;a++){if(this[a]===c){return a;}}return -1;},map:function(c,e){var d=this.length>>>0,b=Array(d);for(var a=0;a<d;a++){if(a in this){b[a]=c.call(e,this[a],a,this);}}return b;},some:function(c,d){for(var b=0,a=this.length>>>0;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true;}}return false;},clean:function(){return this.filter(function(a){return a!=null;});},invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b);});},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a];}return d;},link:function(c){var a={};for(var e=0,b=this.length;e<b;e++){for(var d in c){if(c[d](this[e])){a[d]=this[e];delete c[d];break;}}}return a;},contains:function(a,b){return this.indexOf(a,b)!=-1;},append:function(a){this.push.apply(this,a);return this;},getLast:function(){return(this.length)?this[this.length-1]:null;},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null;},include:function(a){if(!this.contains(a)){this.push(a);}return this;},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b]);}return this;},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1);}}return this;},empty:function(){this.length=0;return this;},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue;}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b]);}return d;},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b];}}return null;},hexToRgb:function(b){if(this.length!=3){return null;}var a=this.map(function(c){if(c.length==1){c+=c;}return c.toInt(16);});return(b)?a:"rgb("+a+")";},rgbToHex:function(d){if(this.length<3){return null;}if(this.length==4&&this[3]==0&&!d){return"transparent";}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c);}return(d)?b:"#"+b.join("");}});String.implement({test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this);},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:String(this).indexOf(a)>-1;},trim:function(){return String(this).replace(/^\s+|\s+$/g,"");},clean:function(){return String(this).replace(/\s+/g," ").trim();},camelCase:function(){return String(this).replace(/-\D/g,function(a){return a.charAt(1).toUpperCase();});},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase());});},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(a){return a.toUpperCase();});},escapeRegExp:function(){return String(this).replace(/([-.*+?^{$}()|[\]\/\\])/g,"\\$1");},toInt:function(a){return parseInt(this,a||10);},toFloat:function(){return parseFloat(this);},hexToRgb:function(b){var a=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null;},rgbToHex:function(b){var a=String(this).match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null;},substitute:function(a,b){return String(this).replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1);}return(a[c]!=null)?a[c]:"";});}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this));},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a;},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this);}},toFloat:function(){return parseFloat(this);},toInt:function(a){return parseInt(this,a||10);}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.from(arguments)));};}});Number.implement(a);})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]();}catch(c){}}return null;}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a));}catch(b){}return null;},bind:function(e){var a=this,b=arguments.length>1?Array.slice(arguments,1):null,d=function(){};var c=function(){var g=e,h=arguments.length;if(this instanceof c){d.prototype=a.prototype;g=new d;}var f=(!b&&!h)?a.call(g):a.apply(g,b&&h?b.concat(Array.slice(arguments)):b||arguments);return g==e?f:g;};return c;},pass:function(b,c){var a=this;if(b!=null){b=Array.from(b);}return function(){return a.apply(c,b||arguments);};},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b);},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c);}});(function(){var j=this.document;var g=j.window=this;var a=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),h=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d=h[1]=="ie"&&j.documentMode;var n=this.Browser={extend:Function.prototype.extend,name:(h[1]=="version")?h[3]:h[1],version:d||parseFloat((h[1]=="opera"&&h[4])?h[4]:h[2]),Platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||b.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(j.evaluate),air:!!(g.runtime),query:!!(j.querySelector),json:!!(g.JSON)},Plugins:{}};n[n.name]=true;n[n.name+parseInt(n.version,10)]=true;n.Platform[n.Platform.name]=true;n.Request=(function(){var p=function(){return new XMLHttpRequest();};var o=function(){return new ActiveXObject("MSXML2.XMLHTTP");};var e=function(){return new ActiveXObject("Microsoft.XMLHTTP");};return Function.attempt(function(){p();return p;},function(){o();return o;},function(){e();return e;});})();n.Features.xhr=!!(n.Request);var i=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description;},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version");})||"0 r0").match(/\d+/g);n.Plugins.Flash={version:Number(i[0]||"0."+i[1])||0,build:Number(i[2])||0};n.exec=function(o){if(!o){return o;}if(g.execScript){g.execScript(o);}else{var e=j.createElement("script");e.setAttribute("type","text/javascript");e.text=o;j.head.appendChild(e);j.head.removeChild(e);}return o;};String.implement("stripScripts",function(o){var e="";var p=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(q,r){e+=r+"\n";return"";});if(o===true){n.exec(e);}else{if(typeOf(o)=="function"){o(e,p);}}return p;});n.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(e,o){g[e]=o;});this.Document=j.$constructor=new Type("Document",function(){});j.$family=Function.from("document").hide();Document.mirror(function(e,o){j[e]=o;});j.html=j.documentElement;if(!j.head){j.head=j.getElementsByTagName("head")[0];}if(j.execCommand){try{j.execCommand("BackgroundImageCache",false,true);}catch(f){}}if(this.attachEvent&&!this.addEventListener){var c=function(){this.detachEvent("onunload",c);j.head=j.html=j.window=null;};this.attachEvent("onunload",c);}var l=Array.from;try{l(j.html.childNodes);}catch(f){Array.from=function(o){if(typeof o!="string"&&Type.isEnumerable(o)&&typeOf(o)!="array"){var e=o.length,p=new Array(e);while(e--){p[e]=o[e];}return p;}return l(o);};var k=Array.prototype,m=k.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(e){var o=k[e];Array[e]=function(p){return o.apply(Array.from(p),m.call(arguments,1));};});}})();(function(){var a=Object.prototype.hasOwnProperty;Object.extend({subset:function(d,g){var f={};for(var e=0,b=g.length;e<b;e++){var c=g[e];if(c in d){f[c]=d[c];}}return f;},map:function(b,e,f){var d={};for(var c in b){if(a.call(b,c)){d[c]=e.call(f,b[c],c,b);}}return d;},filter:function(b,e,g){var d={};for(var c in b){var f=b[c];if(a.call(b,c)&&e.call(g,f,c,b)){d[c]=f;}}return d;},every:function(b,d,e){for(var c in b){if(a.call(b,c)&&!d.call(e,b[c],c)){return false;}}return true;},some:function(b,d,e){for(var c in b){if(a.call(b,c)&&d.call(e,b[c],c)){return true;}}return false;},keys:function(b){var d=[];for(var c in b){if(a.call(b,c)){d.push(c);}}return d;},values:function(c){var b=[];for(var d in c){if(a.call(c,d)){b.push(c[d]);}}return b;},getLength:function(b){return Object.keys(b).length;},keyOf:function(b,d){for(var c in b){if(a.call(b,c)&&b[c]===d){return c;}}return null;},contains:function(b,c){return Object.keyOf(b,c)!=null;},toQueryString:function(b,c){var d=[];Object.each(b,function(h,g){if(c){g=c+"["+g+"]";}var f;switch(typeOf(h)){case"object":f=Object.toQueryString(h,g);break;case"array":var e={};h.each(function(k,j){e[j]=k;});f=Object.toQueryString(e,g);break;default:f=g+"="+encodeURIComponent(h);}if(h!=null){d.push(f);}});return d.join("&");}});})();(function(){var b={};var a=this.DOMEvent=new Type("DOMEvent",function(c,g){if(!g){g=window;}c=c||g.event;if(c.$extended){return c;}this.event=c;this.$extended=true;this.shift=c.shiftKey;this.control=c.ctrlKey;this.alt=c.altKey;this.meta=c.metaKey;var i=this.type=c.type;var h=c.target||c.srcElement;while(h&&h.nodeType==3){h=h.parentNode;}this.target=document.id(h);if(i.indexOf("key")==0){var d=this.code=(c.which||c.keyCode);this.key=b[d];if(i=="keydown"){if(d>111&&d<124){this.key="f"+(d-111);}else{if(d>95&&d<106){this.key=d-96;}}}if(this.key==null){this.key=String.fromCharCode(d).toLowerCase();}}else{if(i=="click"||i=="dblclick"||i=="contextmenu"||i=="DOMMouseScroll"||i.indexOf("mouse")==0){var j=g.document;j=(!j.compatMode||j.compatMode=="CSS1Compat")?j.html:j.body;this.page={x:(c.pageX!=null)?c.pageX:c.clientX+j.scrollLeft,y:(c.pageY!=null)?c.pageY:c.clientY+j.scrollTop};this.client={x:(c.pageX!=null)?c.pageX-g.pageXOffset:c.clientX,y:(c.pageY!=null)?c.pageY-g.pageYOffset:c.clientY};if(i=="DOMMouseScroll"||i=="mousewheel"){this.wheel=(c.wheelDelta)?c.wheelDelta/120:-(c.detail||0)/3;}this.rightClick=(c.which==3||c.button==2);if(i=="mouseover"||i=="mouseout"){var k=c.relatedTarget||c[(i=="mouseover"?"from":"to")+"Element"];while(k&&k.nodeType==3){k=k.parentNode;}this.relatedTarget=document.id(k);}}else{if(i.indexOf("touch")==0||i.indexOf("gesture")==0){this.rotation=c.rotation;this.scale=c.scale;this.targetTouches=c.targetTouches;this.changedTouches=c.changedTouches;var f=this.touches=c.touches;if(f&&f[0]){var e=f[0];this.page={x:e.pageX,y:e.pageY};this.client={x:e.clientX,y:e.clientY};}}}}if(!this.client){this.client={};}if(!this.page){this.page={};}});a.implement({stop:function(){return this.preventDefault().stopPropagation();},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation();}else{this.event.cancelBubble=true;}return this;},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault();}else{this.event.returnValue=false;}return this;}});a.defineKey=function(d,c){b[d]=c;return this;};a.defineKeys=a.defineKey.overloadSetter(true);a.defineKeys({"38":"up","40":"down","37":"left","39":"right","27":"esc","32":"space","8":"backspace","9":"tab","46":"delete","13":"enter"});})();(function(){var a=this.Class=new Type("Class",function(h){if(instanceOf(h,Function)){h={initialize:h};}var g=function(){e(this);if(g.$prototyping){return this;}this.$caller=null;var i=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return i;}.extend(this).implement(h);g.$constructor=a;g.prototype.$constructor=g;g.prototype.parent=c;return g;});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.');}var g=this.$caller.$name,h=this.$caller.$owner.parent,i=(h)?h.prototype[g]:null;if(!i){throw new Error('The method "'+g+'" has no parent.');}return i.apply(this,arguments);};var e=function(g){for(var h in g){var j=g[h];switch(typeOf(j)){case"object":var i=function(){};i.prototype=j;g[h]=e(new i);break;case"array":g[h]=j.clone();break;}}return g;};var b=function(g,h,j){if(j.$origin){j=j.$origin;}var i=function(){if(j.$protected&&this.$caller==null){throw new Error('The method "'+h+'" cannot be called.');}var l=this.caller,m=this.$caller;this.caller=m;this.$caller=i;var k=j.apply(this,arguments);this.$caller=m;this.caller=l;return k;}.extend({$owner:g,$origin:j,$name:h});return i;};var f=function(h,i,g){if(a.Mutators.hasOwnProperty(h)){i=a.Mutators[h].call(this,i);if(i==null){return this;}}if(typeOf(i)=="function"){if(i.$hidden){return this;}this.prototype[h]=(g)?i:b(this,h,i);}else{Object.merge(this.prototype,h,i);}return this;};var d=function(g){g.$prototyping=true;var h=new g;delete g.$prototyping;return h;};a.implement("implement",f.overloadSetter());a.Mutators={Extends:function(g){this.parent=g;this.prototype=d(g);},Implements:function(g){Array.from(g).each(function(j){var h=new j;for(var i in h){f.call(this,i,h[i],true);}},this);}};})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this;},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false;},clearChain:function(){this.$chain.empty();return this;}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase();});};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true;}return this;},addEvents:function(b){for(var c in b){this.addEvent(c,b[c]);}return this;},fireEvent:function(e,c,b){e=a(e);var d=this.$events[e];if(!d){return this;}c=Array.from(c);d.each(function(f){if(b){f.delay(b,this,c);}else{f.apply(this,c);}},this);return this;},removeEvent:function(e,d){e=a(e);var c=this.$events[e];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b];}}return this;},removeEvents:function(d){var e;if(typeOf(d)=="object"){for(e in d){this.removeEvent(e,d[e]);}return this;}if(d){d=a(d);}for(e in this.$events){if(d&&d!=e){continue;}var c=this.$events[e];for(var b=c.length;b--;){if(b in c){this.removeEvent(e,c[b]);}}}return this;}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue;}this.addEvent(c,b[c]);delete b[c];}}return this;}});})();if(typeof JSON=="undefined"){this.JSON={};}(function(){var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var escape=function(chr){return special[chr]||"\\u"+("0000"+chr.charCodeAt(0).toString(16)).slice(-4);};JSON.validate=function(string){string=string.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"");return(/^[\],:{}\s]*$/).test(string);};JSON.encode=JSON.stringify?function(obj){return JSON.stringify(obj);}:function(obj){if(obj&&obj.toJSON){obj=obj.toJSON();}switch(typeOf(obj)){case"string":return'"'+obj.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+obj.map(JSON.encode).clean()+"]";case"object":case"hash":var string=[];Object.each(obj,function(value,key){var json=JSON.encode(value);if(json){string.push(JSON.encode(key)+":"+json);}});return"{"+string+"}";case"number":case"boolean":return""+obj;case"null":return"null";}return null;};JSON.decode=function(string,secure){if(!string||typeOf(string)!="string"){return null;}if(secure||JSON.secure){if(JSON.parse){return JSON.parse(string);}if(!JSON.validate(string)){throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");}}return eval("("+string+")");};})();define("mootools",function(){});define("galileo/util/channel",["require","mootools"],function(a){a("mootools");return function(b){var d=[],c;return{fns:d,give:function(){c=arguments;d.map(function(e){e.apply(this,c);});},take:function(f,e){f=e?f.bind(e):f;d.push(f);if(b&&c){f.apply(this,c);}return function(){d.erase(f);};}};};});define("galileo/prototype/function",["require","mootools","galileo/util/channel"],function(a){a("mootools");var b=a("galileo/util/channel");Function.extend({id:function(c){return c;},takeKey:function(){var c=Array.from(arguments);return function(e){var d=c.slice(0);while(d.length){e=e[d.shift()];}return e;};},join:function(){var g=Array.from(arguments),e=g.pop(),f=[],c=this,d=0;g.map(function(i,h){i(function(j){if(!(h in f)){d++;}f[h]=j;if(d==g.length){e.apply(c,f);}});});}});Function.implement({memoizeCPS:function(){var f=this,c={},d={},g=this.length;var e=function(){var i=Array.from(arguments),l=i.slice(0,g-1),h=i[g-1]||Function.id,j=JSON.encode(l);if(!(j in c)){c[j]=b();c[j].take(function(k){d[j]=k;});f.apply(this,l.concat([function(k){c[j].give(k);}]));}if(d[j]){h(d[j]);}c[j].take(h);return d[j];};e.update=function(){var h=Array.from(arguments),j=h.slice(0,g-1),i=JSON.encode(j);f.apply(this,j.concat([function(k){c[i].give(k);}]));};},throttle:function(f){var d,h,i,j,g,k,e=this;var c=function(){g=j=false;}.debounce(f);return function(){d=this;h=arguments;var l=function(){i=null;if(g){e.apply(d,h);}c();};if(!i){i=setTimeout(l,f);}if(j){g=true;}else{k=e.apply(d,h);}c();j=true;return k;};},once:function(){var c=false,d,e=this;return function(){if(c){return d;}c=true;return d=e.apply(this,arguments);};},after:function(d){var c=this;if(d<=0){return c();}return function(){if(--d<1){return c.apply(this,arguments);}};},debounce:function(f,c){var e,d=this;return function(){var i=this,h=arguments;var g=function(){e=null;if(!c){d.apply(i,h);}};if(c&&!e){d.apply(i,h);}clearTimeout(e);e=setTimeout(g,f);};},then:function(d){var c=this;return function(){return[c.apply(this,arguments),d.apply(this,arguments)];};}});});define("galileo/prototype/array",["require","mootools"],function(a){a("mootools");Array.implement({reindex:function(d){var b=[];for(var c=0;c<d.length;c++){b[c]=this[d[c]];}return b;},sortBy:function(b){this.sort(function(c,f){var e=b(c),d=b(f);return e<d?-1:(e>d?1:0);});return this;},group:function(c){if(this.length<c){return[];}var b=this.slice(1).group(c);b.unshift(this.slice(0,c));return b;},zipWith:function(f,e){var b=Math.min(this.length,f.length),c=[];for(var d=0;d<b;d++){c.push(e(this[d],f[d],d));}return c;},shuffle:function(){for(var d=this.length-1;d>0;d--){var b=Math.floor(Math.random()*(d+1));var c=this[d];this[d]=this[b];this[b]=c;}return this;},find:function(c){for(var b=0;b<this.length;b++){if(c(this[b])===true){return this[b];}}return null;}});});define("galileo/prototype/date",["require","mootools","galileo/i18n/messageformat/locales"],function(d){d("mootools");var j=d("galileo/i18n/messageformat/locales");null;function f(m,k){var l=m.split(",").map(function(n){return n.trim();});if(l.length<=1){return k;}return l;}var i=f("Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday",["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]);var c=f("Sun, Mon, Tue, Wed, Thu, Fri, Sat",["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var a=f("January, February, March, April, May, June, July, August, September, October, November, December",["January","February","March","April","May","June","July","August","September","October","November","December"]);var e=f("Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec",["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]);var g=function(l,k){return function(o){var m=this.copy();m["set"+l](m["get"+l]()+k(o));return m;};};Date.implement({copy:function(){return new Date(this.getTime());},plusDays:g("Date",function(k){return k;}),minusDays:g("Date",function(k){return -k;}),plusWeeks:g("Date",function(k){return k*7;}),minusWeeks:g("Date",function(k){return -k*7;}),plusYears:g("FullYear",function(k){return k;}),minusYears:g("FullYear",function(k){return -k;}),ajaxEncode:function(){var k=function(l){if((""+l).length==1){return"0"+l;}else{return""+l;}};return this.getFullYear()+"-"+k(this.getMonth()+1)+"-"+k(this.getDate());}});Date.extend({parseMySqlDate:function(k){return k.replace(/-/g,"/");},ajaxDecode:function(l){var n=l.split(" ");var k=n[0].split("-");var m=n[1].split(":");return new Date(k[0],k[1]-1,k[2],m[0],m[1],m[2]);},forTime:function(k){var m=k.split(":");var l=new Date;l.setHours(m[0]);l.setMinutes(m[1]);return l;}});var h={"EEE, MMM d":"EEE, MMM d","EEE, M/d":"EEE, M/d","M/dd/yyyy":"M/dd/yyyy","MMMM dd, yyyy":"MMMM dd, yyyy","MMM dd, yyyy":"MMM dd, yyyy",MMM:"MMM","MMM dd":"MMM dd","MMM yyyy":"MMM yyyy","MMMM yyyy":"MMMM yyyy",EEE:"EEE","EEEE, MMMM dd":"EEEE, MMMM dd","EEE, MMM d, yyyy":"EEE, MMM d, yyyy","MMM d, hh:mm a":"MMM d, hh:mm a","hh:mm a":"hh:mm a","hh:mm:ss":"hh:mm:ss","HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss"};var b;Date.implement({localeFormat:function(k){var m=this.getFullYear()%100;var l={yyyy:this.getFullYear(),yy:m>9?""+m:"0"+m,MMMM:a[this.getMonth()],MMM:e[this.getMonth()],M:""+(this.getMonth()+1),dd:this.getDate()>9?""+this.getDate():"0"+this.getDate(),d:""+this.getDate(),EEEE:i[this.getDay()],EEE:c[this.getDay()],HH:this.getHours()>9?""+this.getHours():"0"+this.getHours(),hh:""+(this.getHours()%12||12),mm:this.getMinutes()>9?""+this.getMinutes():"0"+this.getMinutes(),ss:this.getSeconds()>9?""+this.getSeconds():"0"+this.getSeconds(),a:this.getHours()>=12?"PM":"AM"};if(!h[k]&&!l[k]){throw"Unsupported localized date format: "+k;}if(l[k]){return l[k];}b=b||new RegExp("("+Object.keys(l).sortBy(Function.takeKey("length")).reverse().join("|")+")","g");return h[k].replace(b,function(n){return l[n];});},diff:function(k){return this.getTime()-k.getTime();},diffInSeconds:function(k,m){var l=this.diff(k)/1000;return m?l:Math.round(l);},diffInMinutes:function(k,m){var l=this.diffInSeconds(k,true)/60;return m?l:Math.round(l);},diffInHours:function(k,m){var l=this.diffInMinutes(k,true)/60;return m?l:Math.round(l);},diffInDays:function(k,m){var l=this.diffInHours(k,true)/24;return m?l:Math.round(l);}});});define("galileo/prototype/number",["require"],function(a){Number.withDigits=function(b,c){return Math.round(b*Math.pow(10,c))/Math.pow(10,c);};});define("galileo/prototype/all",["require","./function","./array","./date","./number"],function(a){a("./function");a("./array");a("./date");a("./number");});define("galileo/widget/tabs",["require","galileo/prototype/all"],function(a){a("galileo/prototype/all");return function(h,j,i,d){var e=$("<ul>").css("listStyle","none"),g={},c=null,b=null;h.each(function(k){var l=k[0];g[l]=$("<li>").css("display","inline-block").text(l).click(function(){f(l);}).css(j).appendTo(e);if(!b){b={};Object.keys(i).each(function(m){b[m]=g[l].css(m);});}});f(d||Object.keys(h)[0]);return e;function f(k){if(c===k){return;}c=k;h.each(function(l){if(l[0]==k){l[1]();}});Object.each(g,function(m,l){if(l==k){m.css(i);}else{m.css(b);}});}};});define("galileo/widget/modal",["require","jquery"],function(a){var b=a("jquery"),d,c;return function(j){d=d||b(window);c=c||b(document);var h=b("<div>").addClass("backdrop").css({position:"fixed",left:0,top:0,width:"100%",height:"100%",zIndex:1000}).fadeIn(250);b("<div>").addClass("overlay").css({position:"fixed",left:0,top:0,opacity:0.5,width:"100%",height:"100%",backgroundColor:"#000"}).appendTo(h).on("click",function(m){if(this==m.target){l();}});h.appendTo(b("body"));var g=function(){};var i=j(l);i.appendTo(h);i.find(".close").on("click",l);c.on("keydown",k);f();d.on("resize",f);return{dialog:i,close:l,onClose:function(m){g=g.then(m);},position:f,overlay:h};function f(){var n=d.width(),m=d.height(),q=i.width(),p=i.height(),o={};o.left=n>=q?e(n,q):0;o.top=m>=p?e(m,p):0;i.css(o);}function e(n,m){return((n+m)/2)-m;}function l(){h.animate({"opacity":0},{duration:250,complete:function(){h.detach();}});d.off("resize",f);c.off("keydown",k);g();}function k(m){m.keyCode==27&&l();}};});define("galileo/modal/flex101",["require","galileo/builder/util","galileo/builder/text","galileo/i18n/messageformat/locales","galileo/widget/tabs","galileo/widget/modal"],function(e){var b=e("galileo/builder/util");var d=e("galileo/builder/text");var m=e("galileo/i18n/messageformat/locales");var a=e("galileo/widget/tabs");null;var f=[h("Charging","Your tracker battery lasts for about 5 days. To charge it, remove the tracker from the band and place it in the charger until all 5 lights are solid."),h("Syncing",("When your Flex is within 20 feet of the Wireless Sync Dongle, your Flex will sync automatically with your Fitbit account. You can also sync via your smartphone if it supports Bluetooth Low Energy (4.0). Learn more about {0} or about {1}.").substitute([j("Supported Devices","/devices"),j("Syncing","http://help.fitbit.com/customer/portal/articles/1020142-how-do-i-sync-my-flex-to-fitbit-com-")])),h("Wearing","Your Flex tracker should be placed inside the included wristband and worn on your non-dominant hand for best results. Flex is water resistant and can be worn in the shower and out in the rain."),i(),h("Goal Progress","Each light on your Flex tracker represents 20% of your goal. When you reach your goal, Flex will buzz and flash in celebration of your achievement."),h("Changing Goals",("To choose which goal is shown on your Flex display, go to {0} in your account. You can change a goal amount on the corresponding Dashboard tile.").substitute([j("Device Settings","/settings/device")])),h("Tracking Sleep","Sleep tracking can be turned on by tapping the top of the Flex display area until you feel the motor vibrate and the 2 outer lights turn on. Once in sleep tracking mode, the Tracker will show a two lights moving side-to-side. When you're awake and want to stop sleep tracking, repeat the taps until you feel the motor vibrate and see all lights flash. The iPhone and Android apps also allow you to start and stop a sleep recording."),h("Forgot to turn on sleep tracking?",("You can add a sleep log on the website or mobile app. Go to the Sleep section and add a sleep log. Need help? {0}.").substitute([j("Learn More","http://help.fitbit.com/customer/portal/articles/176101-can-i-log-my-sleep-if-i-didn%E2%80%99t-put-my-fitbit-one-or-ultra-tracker-into-sleep-mode-")])),h("Silent Alarms",("Set a Silent Alarm from the {0} of your account.").substitute([j("Devices area","/settings/alarms")]))];return function(){return e("galileo/widget/modal")(function(o){var n=$("<div>");return $("<div>").css({padding:31,backgroundColor:"white",width:500,position:"fixed"}).append(a([["basics",function(){n.empty().append(c([g("11"),g("12"),g("13")],f.slice(0,3)));}],["goals",function(){n.empty().append(c([g("21"),g("22"),g("23")],f.slice(3,6)));}],["sleep",function(){n.empty().append(c([g("31"),g("32"),g("33")],f.slice(6,9)));}]],{fontSize:"12px",fontWeight:"bold",color:"#999",cursor:"pointer",lineHeight:"23px",textTransform:"uppercase",padding:"0px 12px",borderBottom:"2px solid #999"},{color:"#333",borderBottom:"2px solid #55c2c2",cursor:"default"},"basics").css("float","right"),d("bold 25px #55c2c2","Flex 101"),$("<br>"),b.vspace(61),n,b.vspace(20),d("bold 18px/30px #fff","x").css({position:"absolute",right:-30,top:0,width:30,backgroundColor:"black",textAlign:"center",cursor:"pointer"}).click(o));});};function h(p,o){var n=$("<div>").append(d("bold 16px/22px #333",p),$("<br>"),d("14px/17px #333","").html(o));n.find("a").css({color:"#ff4588"});return n;}function j(o,n){return"<a href='"+n+"'>"+o+"</a>";}function i(){return $("<div>").append(d("bold 16px/22px #333","Goals"),$("<br>"),d("14px/17px #333","On the dashboard, see your progress towards goals for:"),$("<br>"),$("<br>"),$("<div>").css({width:200,display:"inline-block"}).append(d("14px/17px #333"," "+"Steps"),$("<br>"),d("14px/17px #333"," "+"Calories Burned")),$("<div>").css({width:200,display:"inline-block"}).append(d("14px/17px #333"," "+"Distance"),$("<br>"),d("14px/17px #333"," "+"Very Active Minutes")));}function g(n){return $("<img>").attr("src","/images/dashboard/galileo/flex101/"+n+".png");}function c(n,o){return $("<div>").append(l(n[0],o[0]),k(),l(n[1],o[1]),k(),l(n[2],o[2]));}function k(){return $("<div>").html("&nbsp").css({height:1,backgroundColor:"#ccc"});}function l(n,o){return $("<div>").append(b.vspace(23),b.hspace(15),n,b.hspace(27),$("<div>").css({width:407,display:"inline-block"}).append(o),b.vspace(23));}});(function(){var a=window.define||function(b){return b();};a("fitbit-header",["require","jquery","fitbit-widget-dropdown","fitbit-header-notificationDropdown","galileo/util/date","messages-deviceNames","messages-batteryLevels","galileo/modal/flex101"],function(g){var k=(typeof g==="function");var r=document.getElementById("requirejs");var b=null;if(k){var d=g("jquery");var o=g("fitbit-widget-dropdown");g("fitbit-header-notificationDropdown");}else{var d=window.jQuery;var o=d.isFunction(fitbit.modules.dropdown)&&fitbit.modules.dropdown;}if(k&&!r){var q=g("galileo/util/date").getRelativeDate;var u=g("messages-deviceNames");var n=g("messages-batteryLevels");var m="???";var j=function(w,v){return(u[w]&&u[w][v])?u[w][v]:m;};var f=function(v){return n[v]?n[v]:m;};b=g("galileo/modal/flex101");}else{var q=fitbit.util.getRelativeDate;var t="com.fitbit.app.device.message.";var j=function(w,v){return fitbit.i18n.getResource(t+"device_"+v+"_"+w);};var f=function(v){return fitbit.i18n.getResource(t+"battery_"+v);};}var c=function(){var w=window.mixpanel;var v=w.master;return v?v:w;};var p=d(".wrapper-header").first();if(p.data("fitbitHeaderInitialized")){return;}p.data("fitbitHeaderInitialized",true);var h=p.find(".wrapper-nav");var e=p.hasClass("nav-app");var s="active";var i="subnav";if(e){i+=" subnav-app";}h.on("click",".nav > li",function(w){if(d(w.currentTarget).hasClass("nav-products")){w.preventDefault();}else{var v=d(this).find("a").first().attr("href");if(v){w.preventDefault();location.href=v;}}});l();d(function(){var B=d(".wrapper-system-alerts");if(B.length){var y=".system-alert";var x=B.find(y);x.find(".exit").one("click",function(){var J=d(this).closest(y);var G={alertType:J.data("type"),deviceType:J.data("device")};var H=J.data("cw-program");if(H!=null){G.attributes={CORPORATE_PROGRAM_ID:H};}var I=JSON.stringify(G);var F={request:JSON.stringify({template:"user/dash/alertResponse.json.jsp",serviceCalls:[{name:"alert",method:"processAlert",args:{action:"CLOSE",alert:I}}]})};d.ajax({type:"post",url:"/ajaxapi",data:F,dataType:"json"});J.trigger("destroy.systemAlert");var K=(x.length>1)?"fadeOut":"slideUp";J[K](function(){var L=J.next(y);if(L.length){L.fadeIn(function(){J.remove();D(L);L.trigger("impression.systemAlert");});}else{B.slideUp(function(){B.remove();setTimeout(function(){d("body").trigger("resetGlobalTimeSelector");},0);});}});});var D=function(H){if(!H){return;}var F=H.first().data("cookie");if(F&&!(/^\s*$/).test(F)){var G=new Date();G.setTime(G.getTime()+2629743830);document.cookie="system_alert"+"="+F+"; expires="+G.toGMTString()+"; path=/;";}};var w=x.first();D(w);var E=function(G){if(typeof G!=="string"){return;}var F=["_trackEvent","GlobalAlertProductReview-"+G];if(arguments.length>1){F=F.concat(Array.prototype.slice.call(arguments,1));}try{fitbit.util.deferredTrack(F);}catch(H){if(console){console.log("header.js: 'fitbit.util.deferredTrack' is not available");}}};var C=function(G,F,H){if(!G){return;}var I={};F&&(I["!PRODUCT_SHOWN"]=F);typeof H!=void 0&&(I["!ACTION"]=H);c().track(G,I);};var z=function(F,G){C("Dash: Amazon Review Alert Clicked",F,G);};x.filter(".amazon-review").one("impression.systemAlert",function(){var F=d(this).data("device");E(F,"Display","Show");C("Dash: Amazon Review Alert",F);}).one("click contextmenu",".message a",function(G){var F=d(G.delegateTarget).data("device");E(F,"Click","LinkToAmazon");z(F,"review");}).one("destroy.systemAlert",function(G){var F=d(G.target).data("device");E(F,"Click","CloseForever");z(F,"close");});x.filter(".newDashInvite").one("impression.systemAlert",function(){c().track("Dash: Preview Promo");});w.trigger("impression.systemAlert");}if(o){var v=h.find(".hasdropdown");v.each(function(K,G){var H=d(G);var J=null;var I=null;var M=null;var O=false;function F(){if(M){clearTimeout(M);M=null;}if(I){clearTimeout(I);I=null;}}function N(){O=false;F();if(J&&J.isVisible()){I=setTimeout(function(){if(!J.isMouseCursorInsideDropdown&&!O){J.hide();H.removeClass(s);}F();},200);}}function L(){O=true;F();if(J){J.cancelHide();if(!J.isVisible()){M=setTimeout(function(){J.show();F();},350);}}}H.one("mouseover",function(){J=new o(H,{className:i,catalystActiveClass:s,hideDelay:200,manualShowEnabled:true});J.render(H.find(".subnav-content").first());L();}).on("mouseenter",L).on("mouseleave",N);});}var A=p.find(".nav-item-cart");if(A.length){d(document.body).on("hideCartIcon.siteHeader",function(){A.hide();}).on("showCartIcon.siteHeader",function(){A.show();});}});function l(){var w=p.find(".account > .nav-item-settings");if(w.length&&o){var x=".accountSettingsDropdown";var v;w.one("mouseover"+x+" mousedown"+x,function(y){w.off(x).addClass("hasdropdown");d.post("/ajaxapi",{request:JSON.stringify({serviceCalls:[{name:"trackerSettings",method:"getAlarms"},{name:"device",method:"getOwnerDevices"}],template:"common/defaultResponse.json.jsp"})},function(A){var B=A[0];var C=A[1];var z=[];if(C.length){d.each(C,function(E,H){if(H.type=="QUARK"&&b){d("#header-settings-subnav .flex101").removeClass("invisible");d("#header-settings-subnav .flex101 a").click(function(){b();v.hide();});}z.push(d("<li>").addClass("device-divider").append(d("<div>").addClass("hr")));var G=d("<li>").addClass("device").addClass("device-"+H.productName.toLowerCase());var F=d("<a>").addClass("gotoSettings").appendTo(G);H.settingsUrl&&F.attr("href",H.settingsUrl);F.append(d("<div>").addClass("icon"));var D=d("<div>").addClass("info").append(d("<span>").addClass("type").text(j(H.type,"displayName")),d("<br>"),d("<span>").addClass("sync deviceDetail").data("time",H.lastSyncTime).text(H.lastSyncTime>0?q(H.lastSyncTime):"")).appendTo(F);var I;d.each(B,function(J,K){if(K.trackerId===H.id&&K.enabled&&K.nextAlarmTimeUTC){if(!I){I=K;}else{if(K.nextAlarmTimeUTC<I.nextAlarmTimeUTC){I=K;}}}});if(I){D.append(d("<br>"),d("<span>").addClass("alarm deviceDetail").text(I.nextAlarmLocalDay+" "+I.localTime));F.attr("href","/settings/alarms/");}D.append(d("<div>").addClass("battery").addClass(H.battery?H.battery.toLowerCase():"").attr("title",H.battery?f(H.battery.toLowerCase()):""));z.push(G);});}z.push(d("<li>").addClass("divider"));d.each(z.reverse(),function(){d("#header-settings-subnav").prepend(this);});},"json");}).one("click",function(y){y.preventDefault();v=new o(w,{anchorPoint:"below right",className:i+" subnav-settings",catalystActiveClass:s,mouseBoundaryDetectionEnabled:false});var z=d("#header-settings-subnav");v.render(z);v.subscribe("beforeShow",function(){z.find(".device .sync").each(function(B,C){var A=parseInt(d(C).attr("data-time"));if(A>0){d(C).text(q(A));}});});v.subscribe("beforeShow",function(){var A=v.getRootElement();d(A).find(".link-dashboard").on("click",function(D){D.preventDefault();var B=d(this);var C=B.data("setting");d.get("/userSettings/dh/save?apiFormat=json&settings['show%20galileo%20dashboard']="+C,function(){window.location="/";});});},true);v.show();});}}});}());