var video_thumbnail_hover=false;var ajax_timeout=(window.location.hostname=="tumblr")?false:10*1000;if(typeof Ajax!="undefined"&&ajax_timeout){Ajax.Responders.register({onCreate:function(a){a.timeout=setTimeout(function(){if(a.transport.readyState>=1&&a.transport.readyState<=3){a.transport.abort();if(a.options.onFailure){a.options.onFailure(a.transport)}if(a.options.onComplete){a.options.onComplete(a.transport)}}},ajax_timeout)},onComplete:function(a){if(a.timeout){clearTimeout(a.timeout)}}})}if(typeof Element!="undefined"&&Element.addMethods){Element.addMethods({addClass:Element.addClassName,removeClass:Element.removeClassName})}function load_typekit(){if(typeof Typekit!="undefined"){return}TypekitConfig={kitId:"dzi2tiv"};(function(){var a=document.createElement("script");a.src="//use.typekit.com/"+TypekitConfig.kitId+".js";a.type="text/javascript";a.async="true";a.onload=a.onreadystatechange=function(){var c=this.readyState;if(c&&c!="complete"&&c!="loaded"){return}try{Typekit.load(TypekitConfig)}catch(d){}};var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})()}function select_field(a){var b=document.getElementsById(a);if(b.createTextRange){var c=b.createTextRange();c.moveStart("character",0);c.moveEnd("character",b.value.length);c.select()}else{if(b.setSelectionRange){b.setSelectionRange(0,b.value.length)}}}function get_cookie(d){var b=document.cookie;var g,f=b.split(";");var e,a=f.length;for(e=0;e<a;e+=1){if((g=f[e].replace(/^\s+|\s+$/g,"").split("="))[0]==d){return{name:g[0],value:g[1]}}}return false}function set_cookie(a,f,h,c){c=c||{};var b=new Date();var g=(typeof(c.path)!=="undefined")?c.path:"/";var e=(typeof(c.is_secure)!=="undefined")?true:false;var d=(typeof(c.domain)!=="undefined")?c.domain:"";b.setDate(b.getDate()+h);document.cookie=a+"="+escape(f)+((h==null)?"":";expires="+b.toGMTString())+";path="+g+((e===false)?"":";secure")+((d==="")?"":";domain="+d)}function unset_cookie(a){set_cookie(a,"",-1)}var trackable_follow=function(c,g,f,b,a,d,e){b=b||function(){};a=a||function(){};d=d||function(){};e=e||function(){};Tumblr.follow({tumblelog:f},{init:b,success:a,error:d,complete:e})};function toggle_video_embed(a){var b=jQuery;if(!b("#watch_video_"+a).is(":visible")){b("#video_embed_"+a).html(b("#video_code_"+a).val());b("#video_toggle_"+a).hide();b("#watch_video_"+a).show();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click","normal"])}}else{b("#video_embed_"+a).html("");b("#video_toggle_"+a).show();b("#watch_video_"+a).hide();if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","hide","normal"])}}}function cycle_video_thumbnails(b,c){var a=jQuery("#video_thumbnail_"+b);if(!a.attr("thumbnails")){return false}var d=a.attr("thumbnails").split("   |   ");if(!d.length){return false}if(c=="preload"){for(i=0;i<d.length;i++){add_to_image_queue(false,d[i])}}else{if(c=="start"){a.attr("original_src",a.src);a.attr("thumbnail_index",1);a.attr("src",d[1]);video_thumbnail_hover=window.setInterval(function(){index=parseInt(a.attr("thumbnail_index"),10)+1;if(index==d.length){index=0}a.attr("src",d[index]);a.attr("thumbnail_index",index)},500)}else{if(c=="stop"){window.clearInterval(video_thumbnail_hover);a.attr("src",a.attr("original_src"));a.removeAttr("thumbnail_index");a.removeAttr("original_src")}}}};
var Tumblr=window.Tumblr||{};Tumblr.flashVersion=function(){if(navigator.plugins&&navigator.plugins.length>0){var a=navigator.mimeTypes;if(a&&a["application/x-shockwave-flash"]&&a["application/x-shockwave-flash"].enabledPlugin&&a["application/x-shockwave-flash"].enabledPlugin.description){return parseInt(a["application/x-shockwave-flash"].enabledPlugin.description.split(" ")[2].split(".")[0],10)}}else{if(navigator.appVersion.indexOf("Mac")==-1&&window.execScript){try{var c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");var b=c.GetVariable("$version");return b.split(",")[0].split(" ")[1]}catch(d){}return 0}}};Tumblr.replaceIfFlash=function(b,a,c){if(Tumblr.flashVersion()>=b){document.getElementById(a).innerHTML=c}};Tumblr.renderVideo=function(c,g,e,a,b){var d=navigator.userAgent.toLowerCase();var f=(d.indexOf("iphone")!=-1);if(f){document.getElementById(c).innerHTML='<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" width="'+e+'" height="'+a+'" codebase="http://www.apple.com/qtactivex/qtplugin.cab"><param name="src" value="'+g+'"><param name="qtsrc" value="'+g+'"><param name="autoplay" value="false"><embed src="'+g+'" qtsrc="'+g+'" width="'+e+'" height="'+a+'" pluginspage="http://www.apple.com/quicktime/"></embed></object>'}else{replaceIfFlash(10,c,'<embed type="application/x-shockwave-flash" src="http://assets.tumblr.com/swf/video_player.swf?22" bgcolor="#000000" quality="high" class="video_player" wmode="transparent" allowfullscreen="true" height="'+a+'" width="'+e+'" flashvars="file='+encodeURIComponent(g)+(b?"&amp;"+b:"")+'"></embed>')}};Tumblr.windowDimensions=function(){if(window.innerWidth!==undefined){return{width:window.innerWidth,height:window.innerHeight}}else{if(document.documentElement){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}else{return{width:document.body.clientWidth,height:document.body.clientHeight}}}};Tumblr.Lightbox=(function(){var f=false;var h=false;var n=false;var d=[];var i=false;var g=false;var o=false;var e=false;var c={left:false,center:false,right:false};function m(r,u){if(document.getElementById("tumblr_lightbox")){return}if(!u){u=1}d=r;if(navigator&&navigator.userAgent.indexOf("Firefox")!=-1){var y=document.createElement("input");y.setAttribute("id","Tumblr_Lightbox_focus_input");y.setAttribute("type","text");y.style.position="fixed";y.style.top=0;y.style.left=0;document.body.appendChild(y);y.focus();document.body.removeChild(y)}else{window.focus()}if(!f){if(window.onkeydown){h=window.onkeydown}window.onkeydown=function(B){if(document.getElementById("tumblr_lightbox")){if(!B){B=window.event}var A=B.charCode?B.charCode:B.keyCode;if(!B.shiftKey&&!B.ctrlKey&&!B.altKey&&!B.metaKey){if(A==37){if(g>1){k(g-1)}}else{if(A==39){if(g<d.length){k(g+1)}}else{if(A==27||A==32||A==74||A==75){l()}}}}else{if((B.ctrlKey||B.metaKey)&&A==87){l();return false}}}if(h){h()}};if(window.onresize){n=window.onresize}window.onresize=function(){if(document.getElementById("vignette")){document.getElementById("vignette").style.display="none";if(e){clearTimeout(e)}e=setTimeout(function(){document.getElementById("vignette").style.display="inline-block"},100)}j();if(n){n()}};if(navigator&&navigator.userAgent.search("iPad")!=-1){document.addEventListener("touchmove",function(){l()},false)}f=true}document.body.style.overflow="hidden";var p=document.createElement("div");p.setAttribute("id","tumblr_lightbox");if(navigator&&navigator.userAgent.search("iPad")!=-1){p.style.position="absolute";p.style.top=document.body.scrollTop+"px";p.style.height=window.innerHeight+"px"}else{p.style.position="fixed";p.style.top="0px";p.style.bottom="0px"}p.style.left="0px";p.style.right="0px";p.style.zIndex=4294967294;p.style.overflow="hidden";p.style.backgroundColor=(navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#222":"rgba(17,17,17,0.92)";p.onclick=function(){if(i){i=false}else{l()}};if(!(navigator&&navigator.userAgent.search("iPad")!=-1)&&!(navigator&&navigator.userAgent.search("MSIE")!=-1)){var x=document.createElement("img");x.setAttribute("id","vignette");x.setAttribute("src","http://assets.tumblr.com/images/full_page_vignette.png");x.style.position="absolute";x.style.width="100%";x.style.height="100%";x.style.left="0px";x.style.top="0px";p.appendChild(x);var w=document.createElement("div");w.style.position="absolute";w.style.width="100%";w.style.height="100%";w.style.left="0px";w.style.top="0px";p.appendChild(w)}var s=document.createElement("div");s.style.position="absolute";s.style.left="50%";s.style.top="50%";if(!document.getElementById("tumblr_form_key")){s.style.width="100%"}p.appendChild(s);var q=["left","center","right"];while(stage_name=q.pop()){var v=document.createElement("a");v.setAttribute("id","tumblr_lightbox_"+stage_name+"_link");v.setAttribute("href","#");if(d.length<2){v.style.cursor="default"}s.appendChild(v);var t=document.createElement("img");t.setAttribute("id","tumblr_lightbox_"+stage_name+"_image");t.setAttribute("src","http://assets.tumblr.com/images/x.gif");t.style.mozBorderRadius="3px";t.style.webkitBorderRadius="3px";t.style.borderRadius="3px";if(navigator&&navigator.userAgent.indexOf("Chrome")!=-1){t.style.moxBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.webkitBoxShadow="0 4px 30px rgba(0,0,0,1)";t.style.boxShadow="0 4px 30px rgba(0,0,0,1)"}t.style.borderWidth="0px";t.style.position="absolute";if(stage_name=="center"){t.style.zIndex=4294967295}v.appendChild(t)}var z=document.createElement("div");z.setAttribute("id","tumblr_lightbox_caption");z.style.position="absolute";z.style.textAlign="center";z.style.font="bold 17px 'HelveticaNeue','Helvetica','Arial',sans-serif";z.style.color="#fff";z.style.paddingTop="20px";z.style.textShadow="0 4px 30px rgba(0,0,0,1)";z.style.display="inline-block";z.style.textRendering="optimizeLegibility";s.appendChild(z);document.body.appendChild(p);k(u);j()}function l(){document.body.style.overflow="";document.getElementById("tumblr_lightbox").style.display="none";document.body.removeChild(document.getElementById("tumblr_lightbox"))}function k(q){g=q;o=Math.round(Math.random()*1000000000000);document.getElementById("tumblr_lightbox_left_link").onclick=function(){i=true;k(q-1);return false};if(d.length==1){document.getElementById("tumblr_lightbox_center_link").onclick=function(){return false}}else{if(q<d.length){document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(q+1);return false}}else{document.getElementById("tumblr_lightbox_center_link").onclick=function(){i=true;k(1);return false}}}document.getElementById("tumblr_lightbox_right_link").onclick=document.getElementById("tumblr_lightbox_center_link").onclick;c.left=false;c.center=false;c.right=false;b("center",q-1);if(q>1){b("left",q-2)}if(q<d.length){b("right",q)}if(q+1<d.length){var p=new Image();p.src=d[q+1].low_res}}function b(q,s){var p=new Image();var r=false;p.className=o;p.onload=function(){if(this.className==o){this.className="high-res";c[q]=this;j()}};p.src=d[s].high_res;if(!p.complete){r=new Image();r.className=o;r.onload=function(){if(this.className==o&&(!c[q]||c[q].className=="placeholder")){this.className="low-res";c[q]=this;j()}};r.src=d[s].low_res;if(d[s].width&&d[s].height){if(r){r.style.maxWidth=d[s].width+"px";r.style.maxHeight=d[s].height+"px"}p.style.maxWidth=d[s].width+"px";p.style.maxHeight=d[s].height+"px"}if(!r.complete&&(d[s].width&&d[s].height)){c[q]=new Image(d[s].width,d[s].height);c[q].style.maxWidth=d[s].width+"px";c[q].style.maxHeight=d[s].height+"px";c[q].src="http://assets.tumblr.com/images/x.gif";c[q].className="placeholder"}}}function j(){var u=["right","left","center"];while(stage_name=u.pop()){var r=document.getElementById("tumblr_lightbox_"+stage_name+"_image");if(!r){continue}var s=c[stage_name];if(!s){r.style.display="none";continue}else{r.style.display="inline-block"}var q=s.style.maxWidth?parseInt(s.style.maxWidth,10):s.width;var p=s.style.maxHeight?parseInt(s.style.maxHeight,10):s.height;if(Tumblr.windowDimensions().width/Tumblr.windowDimensions().height<q/p){var t=(d.length==1)?0.85:0.75;if(Tumblr.windowDimensions().width*t>q&&(s.className=="high-res"||s.style.maxWidth)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.height=(p*((Tumblr.windowDimensions().width*t)/q))+"px";r.style.width=(Tumblr.windowDimensions().width*t)+"px"}}else{if(Tumblr.windowDimensions().height*0.85>p&&(s.className=="high-res"||s.style.maxHeight)){r.style.width=q+"px";r.style.height=p+"px"}else{r.style.width=(q*((Tumblr.windowDimensions().height*0.85)/p))+"px";r.style.height=(Tumblr.windowDimensions().height*0.85)+"px"}}if(stage_name=="center"){r.style.left=(0-parseInt(r.style.width,10)/2)+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}else{r.style[stage_name]=(0-(parseInt(r.style.width,10)+Tumblr.windowDimensions().width*0.42))+"px";r.style.top=(0-parseInt(r.style.height,10)/2)+"px"}r.src=s.src;r.style.backgroundColor=(s.className=="placeholder")?((navigator&&navigator.userAgent.indexOf("MSIE")!=-1)?"#444":"rgba(255,255,255,0.05)"):"transparent";if(stage_name=="center"&&d[g-1].caption){document.getElementById("tumblr_lightbox_caption").innerHTML=d[g-1].caption;document.getElementById("tumblr_lightbox_caption").style.width=(Tumblr.windowDimensions().width*0.7)+"px";document.getElementById("tumblr_lightbox_caption").style.top=(parseInt(r.style.height,10)*0.5)+"px";document.getElementById("tumblr_lightbox_caption").style.left=(0-Tumblr.windowDimensions().width*0.35)+"px";document.getElementById("tumblr_lightbox_caption").style.display="block"}else{if(stage_name=="center"){document.getElementById("tumblr_lightbox_caption").style.display="none"}}}}function a(){return !!document.getElementById("tumblr_lightbox")}return{init:m,isOpen:a}})();Tumblr.IframePreloader=function(a){for(var b in a){if(typeof b=="object"){for(var c in b){this.options[b][c]=b[c]}}else{this.options[b]=a[b]}}this.__create()};Tumblr.IframePreloader.prototype={options:{iframe_src:"",iframe_before_onload:function(){},iframe_after_onload:function(){},iframe_class:"",iframe_styles:{zIndex:8675309,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",border:"0px",overflow:"hidden"},preloader_class:"",preloader_innerHTML:'<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="http://assets.tumblr.com/images/full_page_vignette.png?709"/></div>',preloader_styles:{zIndex:8675310,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",overflow:"hidden",background:"rgba(17,17,17,0.92)"},close_class:"",close_innerHTML:"&times;",close_styles:{zIndex:8675311,position:"fixed",top:"10px",right:"15px",cursor:"pointer",font:"bold 20px Helvetica, sans-serif"}},iframe_loaded:false,__create:function(){this.id=Math.random().toString().split(".")[1];this.$container=document.createElement("div");this.$preloader=document.createElement("div");this.$preloader.id="iframe_preloader-preloader-"+this.id;this.$preloader.className=this.options.preloader_class;for(var d in this.options.preloader_styles){this.$preloader.style[d]=this.options.preloader_styles[d]}this.$preloader.innerHTML=this.options.preloader_innerHTML;this.$iframe=document.createElement("iframe");this.$iframe.id="iframe_preloader-iframe-"+this.id;this.$iframe.className=this.options.iframe_class;for(var c in this.options.iframe_styles){this.$iframe.style[c]=this.options.iframe_styles[c]}this.$iframe.src=this.options.iframe_src;this.$iframe.scrolling="no";this.$iframe.frameborder="0";this.$close=document.createElement("div");this.$close.id="iframe_preloader-close-"+this.id;this.$close.className=this.options.close_class;for(var b in this.options.close_styles){this.$close.style[b]=this.options.close_styles[b]}this.$close.innerHTML=this.options.close_innerHTML;var a=this;this.$close.onclick=function(){if(typeof pano_iframe_preloader!="undefined"&&pano_iframe_preloader){pano_iframe_preloader.remove()}};this.$iframe.onload=function(){a.options.iframe_before_onload();a.iframe_loaded=true;a.show();a.$close.style.display="none";a.options.iframe_after_onload()};this.hide_iframe();this.lock_body();this.$container.appendChild(this.$preloader);this.$container.appendChild(this.$iframe);this.$container.appendChild(this.$close);document.body.appendChild(this.$container)},hide:function(){this.hide_iframe();this.hide_preloader();this.unlock_body()},show:function(){if(this.iframe_loaded){this.show_iframe();this.hide_preloader()}else{this.hide_iframe();this.show_preloader()}this.lock_body()},remove:function(){this.hide();document.body.removeChild(this.$container);delete this.$container;delete this.$preloader;delete this.$iframe},lock_body:function(){document.body.style.overflow="hidden"},unlock_body:function(){document.body.style.overflow=""},show_preloader:function(){this.window.focus();this.$preloader.style.display="block"},hide_preloader:function(){this.$preloader.style.display="none"},show_iframe:function(){this.$iframe.contentWindow.focus();this.$iframe.style.opacity=1},hide_iframe:function(){this.$iframe.style.opacity=0}};var pano_iframe_preloader=false;Tumblr.PanoLightboxInit=function(b,a){if((!b&&window.event&&(window.event.metaKey||window.event.altKey))||(b&&(b.metaKey||b.altKey))){return true}pano_iframe_preloader=new Tumblr.IframePreloader({iframe_src:a});return false};Tumblr.findIframe=function(c){var b=document.getElementsByTagName("iframe");for(var a=0;a<b.length;a++){if(b[a].contentWindow===c){return b[a]}}return false};Tumblr.findIframeURL=function(a){var c=document.getElementsByTagName("iframe");for(var b=0;b<c.length;b++){if(c[b].outerHTML.indexOf('"'+a+'"')){return c[b]}}return false};Tumblr.getIframeCoords=function(a){var b;if(typeof a==="string"){b=Tumblr.findIframeURL(a)}else{b=Tumblr.findIframe(a)}if(!b){return false}return Tumblr.getElementOffset(b)};Tumblr.getElementOffset=function(b){var d=b,c=b.getBoundingClientRect(),e=c.left,a=c.top;return[e,a]};Tumblr.iframeInView=function(c,a,b){return Tumblr.isInView(Tumblr.findIframe(c),a,b)};Tumblr.isInView=function(d,c,g){if(!d){return false}if(typeof g!=="number"){g=0}var b=document.body.scrollTop||0;var f=b+window.innerHeight;var e=Tumblr.getOffsetTop(d);var a=e+d.offsetHeight;if((e<b)&&(a>f)){return true}else{if(c){return((b<e)&&(f>a))}else{return((a>b+g)&&(e<f-g))}}};Tumblr.getOffsetTop=function(a,b){if(typeof b!=="number"){b=0}b+=a.offsetTop;return a.offsetParent?Tumblr.getOffsetTop(a.offsetParent,b):b};Tumblr.getOffsetLeft=function(a,b){if(typeof b!=="number"){b=0}b+=a.offsetLeft;return a.offsetParent?Tumblr.getOffsetLeft(a.offsetParent,b):b};Tumblr.addStyle=function(a){var b;if(document.createStyleSheet){b=document.createStyleSheet();b.cssText=a}else{b=document.createElement("style");b.type="text/css";b.innerHTML=a;document.getElementsByTagName("head")[0].appendChild(b)}return b};Tumblr.addBodyClass=function(a){return document.body.className+=" "+a};Tumblr.removeBodyClass=function(b){b=b.split(" ");for(var a=0;a<b.length;a++){document.body.className=document.body.className.replace(new RegExp("(^|\\s+)("+b[a]+")($|\\s+)"),"")}return document.body.className};Tumblr.hasClass=function(b,a){return new RegExp("(\\s|^)"+a+"(\\s|$)").test(b.className)};Tumblr.addClass=function(b,a){if(!Tumblr.hasClass(b,a)){b.className+=" "+a}};Tumblr.removeClass=function(c,a){if(Tumblr.hasClass(c,a)){var b=new RegExp("(\\s|^)"+a+"(\\s|$)");c.className=c.className.replace(b," ")}};Tumblr.toggleClass=function(b,a){if(Tumblr.hasClass(b,a)){Tumblr.removeClass(b,a)}else{Tumblr.addClass(b,a)}};Tumblr.IframeContent=function(){var e,g,h,b;function i(){e=document.createElement("iframe");e.width=b.width;e.height=b.height;e.src="about:blank";for(var j in b.attr){e.setAttribute(j,b.attr[j])}e.setAttribute("frameborder","0");e.setAttribute("scrolling","no");e.setAttribute("webkitAllowFullScreen","");e.setAttribute("mozallowfullscreen","");e.setAttribute("allowFullScreen","");e.setAttribute("seamless","");e.setAttribute("style","display:block;background-color:transparent;overflow:hidden;");g.appendChild(e)}function d(){h="<!DOCTYPE html><html><head><title>Tumblr Video</title></head>";h+='<body class="'+b.body_class+'">';h+=b.content;h+="</body></html>"}function a(){e.onload=f;e.contentWindow.document.open("text/html","replace");e.contentWindow.document.write(h);e.contentWindow.document.close()}function c(){var j=e.contentWindow.document.body.offsetHeight;if(!j){return}e.height=j}function f(){c();if(typeof(b.onload)==="function"){b.onload()}}return{initialize:function(j){b=j;b.width=b.width||500;b.height=b.height||Math.floor(b.width*0.75);g=document.getElementById(b.container);if(!g){return false}i();d();a()}}};Tumblr.Asset=(function(){return{load:function(e,d){d=d||{};var b,f=d.callback||function(){},a=e.split("?")[0],c=a.split(".");c=c[c.length-1];if(c==="js"){b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",e)}if(c==="css"){b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("rel","stylesheet");b.setAttribute("href",e)}if(typeof(b)!="undefined"){b.onload=f;document.getElementsByTagName("head")[0].appendChild(b)}}}})();Tumblr.PostMessageListener=(function(){return{initialize:function(d){d=d||function(){};var c=window.addEventListener?"addEventListener":"attachEvent";var b=window[c];var a=c=="attachEvent"?"onmessage":"message";b(a,function(g){var f=g.data.split(";");d(f,g.origin)},false)}}})();Tumblr.PostMessageListener.initialize(function(b,a){Tumblr.VideoFeatureSupport.post_message_event(b,a);Tumblr.AudioFeatureSupport.post_message_event(b,a);Tumblr.IframeFeatureSupport.post_message_event(b,a);Tumblr.AnalyticsFeatureSupport.post_message_event(b,a);Tumblr.SubmissionFormResize.post_message_event(b,a);Tumblr.PhotosetResize.post_message_event(b,a);Tumblr.LikeButtonUpdate.post_message_event(b,a)});Tumblr.LikeButtonUpdate=(function(){return{post_message_event:function(c,a){if(c[0]==="tumblelog_like"){if(c[1]&&document.getElementById("like_button_"+c[1])){var b=document.getElementById("like_button_"+c[1]);if(c[2]==="liked"){Tumblr.addClass(b,"liked")}else{Tumblr.removeClass(b,"liked")}}}}}})();Tumblr.SubmissionFormResize=(function(){return{post_message_event:function(b,a){if(b[0]==="resize_submission_iframe"){var c=document.getElementById("submit_form");if(c){c.height=parseInt(b[2],10)+80}}}}})();Tumblr.PhotosetResize=(function(){return{post_message_event:function(c,b){if(c[0]==="resize_photoset_iframe"){var d=c[1],a=parseInt(c[2],10);document.getElementById("photoset_iframe_"+d).height=a}}}})();Tumblr.AnalyticsFeatureSupport=(function(){return{post_message_event:function(c,a){if(c[0]==="openInMobileAppSuccess"){if(typeof(open_in_mobile_app)==="function"){if(c[1]&&c[1].length){var b=parseInt(c[1],10);open_in_mobile_app(b)}}}}}})();Tumblr.IframeFeatureSupport=(function(){var f,b,a;function e(i,g){var h;if(typeof i.currentStyle!="undefined"){h=i.currentStyle}else{h=document.defaultView.getComputedStyle(i,null)}return h[g]||false}function c(){var h,i,g=document.querySelector('meta[name="color:Tumblr Controls"]');if(g){h=g.getAttribute("content")}if(!h){h="default"}f.contentWindow.postMessage("color_match;"+h,b)}function d(g){g=parseInt(g,10)||0;if(g>f.width){f.width=g+3}}return{post_message_event:function(h,g){a=document.getElementById("mobile_iframe");f=document.getElementById("tumblr_controls");b=h[1];if(a){if(h[0]==="show_mobile_banner"){if(h[2]==="1"){Tumblr.MobileBanner.showBanner();Tumblr.MobileBanner.mobile_origin=b}else{Tumblr.MobileBanner.showHeaderBanner()}}}else{if(f&&b){if(h[0]==="color_match"){c()}if(h[0]==="location_change"){if(!document.getElementById("iframe_flash_fix")){var i=document.createElement("div");i.id="iframe_flash_fix";i.innerHTML="&shy;<style> #tumblr_controls { visibility: hidden; } </style>";document.body.appendChild(i);document.getElementById("tumblr_controls").onload=function(){document.body.removeChild(i)}}}if(h[0]==="request_keywords"){if(typeof tumblr_meta_keyboards!="undefined"){f.contentWindow.postMessage("keywords;"+tumblr_meta_keyboards,b)}}if(h[0]==="resize_iframe"){d(h[1])}}}}}})();Tumblr.VideoFeatureSupport=(function(){var b={setup_controls:{}};function f(){if(document.getElementById("tumblr_video_iframe_fullscreen")){return true}var j=document.createElement("style");j.id="tumblr_video_iframe_fullscreen";j.innerHTML=".tumblr_video_iframe.fullwindow { top: 0; bottom: 0; right: 0; left: 0; position: fixed; z-index: 8675309; height: 100%; width: 100%; }";document.body.appendChild(j)}function e(j){f();if(j){b.iframe.className="tumblr_video_iframe fullwindow"}else{b.iframe.className="tumblr_video_iframe"}}function i(j){var k=document.getElementById("tumblr_controls");if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_lightbox/g,"")}document.body.className=document.body.className.replace(/\s+is_lightbox/g,"");document.body.style.overflow="visible";b.iframe.style.position="static";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.zIndex=0;if(k){k.style.display="block"}return}a();if(b.parent_post){b.parent_post.className+=" is_lightbox"}document.body.className+=" is_lightbox";document.body.style.overflow="hidden";b.iframe.style.position="fixed";b.iframe.style.height="100%";b.iframe.style.width="100%";b.iframe.style.top=0;b.iframe.style.right=0;b.iframe.style.left=0;b.iframe.style.bottom=0;b.iframe.style.zIndex=90210;if(k){k.style.display="none"}}function g(j){if(!j){if(b.parent_post){b.parent_post.className=b.parent_post.className.replace(/\s+is_fullscreen/g,"")}document.body.className=document.body.className.replace(/\s+is_fullscreen/g,"");return}if(b.parent_post){b.parent_post.className+=" is_fullscreen"}document.body.className+=" is_fullscreen"}function a(){if(b.setup_controls[b.id]){return}var j=document.querySelector("#post_"+b.id+" .tumblr_lightbox_controls .close_button");if(j){j.addEventListener("click",function(k){b.iframe.contentWindow.postMessage("exit_lightbox",b.origin_url);return false})}b.setup_controls[b.id]=true}function h(){if(typeof(get_cookie)==="function"){var j=get_cookie("supress_lightbox"),k=parseInt(j.value,10)||0;if(j&&k>3){return"supress_lightbox"}if(!j){return"enable_lightbox"}}return false}function d(k){if(typeof(set_cookie)==="function"){var j=get_cookie("supress_lightbox"),l=parseInt(j.value,10)||0;if(k>0&&k<5){}if(k===-1){if(l>1){}else{}}c(h())}}function c(l){if(!l){return}var k=document.querySelectorAll(".tumblr_video_iframe.has_lightbox");for(var j=0;j<k.length;j++){k[j].contentWindow.postMessage(l,"http://"+k[j].getAttribute("data-origin"))}}return{post_message_event:function(l,j){var k=l[2];b.iframe=document.getElementById("tumblr_video_iframe_"+k);if(!b.iframe){return}b.id=k;b.origin_url="http://"+b.iframe.getAttribute("data-origin");b.parent_post=document.getElementById("post_"+k);if(l[0]==="lightbox"){i((l[1]==="true")?true:false)}if(l[0]==="full_window"){e((l[1]==="true")?true:false)}if(l[0]==="full_screen"){g((l[1]==="true")?true:false)}}}})();Tumblr.AudioFeatureSupport=(function(){return{post_message_event:function(d,a){var c,b;if(d[0]==="audioPlayerReady"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])>=0){try{if(!c[b].style.webkitTransform){c[b].style.webkitTransform="translate3d(0px, 0px, 0px)"}}catch(f){}}}}else{if(d[0]==="audioPlayerPlaying"){c=document.getElementsByClassName("tumblr_audio_player");for(b=0;b<c.length;b++){if(c[b].className.indexOf(" tumblr_audio_player_"+d[1])<0){c[b].contentWindow.postMessage("pause","*")}}c=document.getElementsByClassName("tumblr_video_iframe");for(b=0;b<c.length;b++){c[b].contentWindow.postMessage("pause","*")}}}}}})();Tumblr.ToggleMobileFullscreenIframe=function(d,a){var c=window.innerHeight+"px";var b=document.getElementById(d);if(!a){if(b){b.className=b.className.replace(/\s+is_lightbox/,"");document.body.className=document.body.className.replace(/\s+is_lightbox/,"");document.body.style.overflow="";b.style.position="static";b.style.overflow="";b.style.height="";b.style.width="";b.style.zIndex=0;if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="block"}}return}if(b){b.className+=" is_lightbox";document.body.className+=" is_lightbox";document.body.style.overflow="hidden";b.style.position="fixed";b.style.overflow="hidden";b.style.height=c;b.style.width="100%";b.style.top=0;b.style.right=0;b.style.left=0;b.style.bottom=0;b.style.zIndex=90210;if(document.getElementById("tumblr_controls")){document.getElementById("tumblr_controls").style.display="none"}}};function flashVersion(){return Tumblr.flashVersion()}function renderVideo(c,e,d,a,b){Tumblr.renderVideo(c,e,d,a,b)}function replaceIfFlash(b,a,c){Tumblr.replaceIfFlash(b,a,c)}(function(){function a(){var e=document.getElementById("tumblr_controls");if(!e){return}var h=e.offsetTop;if(h==0){e.style.position="fixed";return}if(!e.classList){return}var j=e.clientHeight;var g="        html body iframe#tumblr_controls {            -webkit-transition-property: opacity;               -moz-transition-property: opacity;                -ms-transition-property: opacity;                 -o-transition-property: opacity;                    transition-property: opacity;            -webkit-transition-duration: .3s;               -moz-transition-duration: .3s;                -ms-transition-duration: .3s;                 -o-transition-duration: .3s;                    transition-duration: .3s;            -webkit-transition-timing-function: ease;               -moz-transition-timing-function: ease;                -ms-transition-timing-function: ease;                 -o-transition-timing-function: ease;                    transition-timing-function: ease;        }        html body iframe#tumblr_controls.tumblr_sticky_iframe {            position: fixed !important;            top: 0 !important;        }        ";var b;var d="tumblr_sticky_iframe_style";var i=document;if(i.createStyleSheet){b=i.createStyleSheet();b.cssText=g;if(d){b.owningElement.id=d}}else{b=i.createElementNS?i.createElementNS("http://www.w3.org/1999/xhtml","style"):i.createElement("style");b.appendChild(i.createTextNode(g));if(d){b.id=d}i.getElementsByTagName("head")[0].appendChild(b)}function f(){e.style.visibility="visible";e.style.opacity=1}function c(){var k=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(k>=(h+j)){if(e.classList.contains("tumblr_sticky_iframe")){return}e.style.visibility="hidden";e.style.opacity=0;e.classList.add("tumblr_sticky_iframe");setTimeout(f,400)}else{e.classList.remove("tumblr_sticky_iframe")}}window.setInterval(c,500)}if(window.addEventListener){window.addEventListener("DOMContentLoaded",a,false)}else{window.attachEvent("onload",a)}})();
(function(i,k,a){var e=["webkit","Moz","ms","O"];var p={};var o;function g(q,t){var r=k.createElement(q||"div");var s;for(s in t){r[s]=t[s]}return r}function h(r){for(var q=1,s=arguments.length;q<s;q++){r.appendChild(arguments[q])}return r}var j=function(){var q=g("style");h(k.getElementsByTagName("head")[0],q);return q.sheet||q.styleSheet}();function c(u,q,v,y){var r=["opacity",q,~~(u*100),v,y].join("-");var s=0.01+v/y*100;var x=Math.max(1-(1-u)/q*(100-s),u);var w=o.substring(0,o.indexOf("Animation")).toLowerCase();var t=w&&"-"+w+"-"||"";if(!p[r]){j.insertRule("@"+t+"keyframes "+r+"{0%{opacity:"+x+"}"+s+"%{opacity:"+u+"}"+(s+0.01)+"%{opacity:1}"+(s+q)%100+"%{opacity:"+u+"}100%{opacity:"+x+"}}",0);p[r]=1}return r}function n(u,v){var t=u.style;var q;var r;if(t[v]!==a){return v}v=v.charAt(0).toUpperCase()+v.slice(1);for(r=0;r<e.length;r++){q=e[r]+v;if(t[q]!==a){return q}}}function f(q,s){for(var r in s){q.style[n(q,r)||r]=s[r]}return q}function m(s){for(var q=1;q<arguments.length;q++){var r=arguments[q];for(var t in r){if(s[t]===a){s[t]=r[t]}}}return s}function l(q){var r={x:q.offsetLeft,y:q.offsetTop};while((q=q.offsetParent)){r.x+=q.offsetLeft;r.y+=q.offsetTop}return r}var d={lines:12,length:7,width:5,radius:10,color:"#000",speed:1,trail:100,opacity:1/4,fps:20,zIndex:2000000000,className:"spinner",top:"auto",left:"auto"};var b=function b(q){if(!this.spin){return new b(q)}this.opts=m(q||{},b.defaults,d)};b.defaults={};b.prototype={spin:function(x){this.stop();var B=this;var q=B.opts;var r=B.el=f(g(0,{className:q.className}),{position:"relative",zIndex:q.zIndex});var A=q.radius+q.length+q.width;var C;var z;if(x){x.insertBefore(r,x.firstChild||null);z=l(x);C=l(r);f(r,{left:(q.left=="auto"?z.x-C.x+(x.offsetWidth>>1):q.left+A)+"px",top:(q.top=="auto"?z.y-C.y+(x.offsetHeight>>1):q.top+A)+"px"})}r.setAttribute("aria-role","progressbar");B.lines(r,B.opts);if(!o){var u=0;var s=q.fps;var w=s/q.speed;var v=(1-q.opacity)/(w*q.trail/100);var y=w/q.lines;!function t(){u++;for(var D=q.lines;D;D--){var E=Math.max(1-(u+D*y)%w*v,q.opacity);B.opacity(r,q.lines-D,E,q)}B.timeout=B.el&&setTimeout(t,~~(1000/s))}()}return B},stop:function(){var q=this.el;if(q){clearTimeout(this.timeout);if(q.parentNode){q.parentNode.removeChild(q)}this.el=a}return this},lines:function(s,u){var r=0;var q;function t(v,w){return f(g(),{position:"absolute",width:(u.length+u.width)+"px",height:u.width+"px",background:v,boxShadow:w,transformOrigin:"left",transform:"rotate("+~~(360/u.lines*r)+"deg) translate("+u.radius+"px,0)",borderRadius:(u.width>>1)+"px"})}for(;r<u.lines;r++){q=f(g(),{position:"absolute",top:1+~(u.width/2)+"px",transform:u.hwaccel?"translate3d(0,0,0)":"",opacity:u.opacity,animation:o&&c(u.opacity,u.trail,r,u.lines)+" "+1/u.speed+"s linear infinite"});if(u.shadow){h(q,f(t("#000","0 0 4px #000"),{top:2+"px"}))}h(s,h(q,t(u.color,"0 0 1px rgba(0,0,0,.1)")))}return s},opacity:function(r,q,s){if(q<r.childNodes.length){r.childNodes[q].style.opacity=s}}};!function(){var r=f(g("group"),{behavior:"url(#default#VML)"});var q;if(!n(r,"transform")&&r.adj){for(q=4;q--;){j.addRule(["group","roundrect","fill","stroke"][q],"behavior:url(#default#VML)")}b.prototype.lines=function(v,u){var t=u.length+u.width;var B=2*t;function A(){return f(g("group",{coordsize:B+" "+B,coordorigin:-t+" "+-t}),{width:B,height:B})}var w=-(u.width+u.length)*2+"px";var z=f(A(),{position:"absolute",top:w,left:w});var y;function x(C,s,D){h(z,h(f(A(),{rotation:360/u.lines*C+"deg",left:~~s}),h(f(g("roundrect",{arcsize:1}),{width:t,height:u.width,left:u.radius,top:-u.width>>1,filter:D}),g("fill",{color:u.color,opacity:u.opacity}),g("stroke",{opacity:0}))))}if(u.shadow){for(y=1;y<=u.lines;y++){x(y,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)")}}for(y=1;y<=u.lines;y++){x(y)}return h(v,z)};b.prototype.opacity=function(t,s,v,u){var w=t.firstChild;u=u.shadow&&u.lines||0;if(w&&s+u<w.childNodes.length){w=w.childNodes[s+u];w=w&&w.firstChild;w=w&&w.firstChild;if(w){w.opacity=v}}}}else{o=n(r,"animation")}}();i.Spinner=b})(window,document);
var Tumblr=Tumblr||{};(function(b,a){var c={init:function(l){var h=b(document);var d="placeholder" in document.createElement("input");var j="placeholder" in document.createElement("textarea");l=b.extend({},l);var k=(l.els)?b(l.els):b("input, textarea");var i=l.clear_on_submit;var e=l.force;function m(p){var n=b(p.target);var o=n.get(0).nodeName.toLowerCase();if(!d||!j||e){if(n.hasClass("placeholder")){n.val("").removeClass("placeholder")}if(n.attr("data-type")=="password"){try{n.get(0).type="password"}catch(q){}}}}function f(n){if(!d||!j||e){g(n.target)}}function g(n){$input=b(n);var o=$input.attr("placeholder");if(o&&$input.val()===""){$input.addClass("placeholder").val(o)}if($input.attr("type")=="password"&&($input.val()===""||$input.val()===o)){try{$input.get(0).type="text"}catch(p){}$input.attr("data-type","password")}}if(!d||!j||e){h.on("focus",k.selector,m);h.on("blur",k.selector,f);_.each(k,function(o){g(o);if(i){var n=b(o);n.parents("form").on("submit",function(){if(n.val()===n.attr("placeholder")){n.val("")}})}})}}};a.PlaceHolders=c})(jQuery,Tumblr);
(function(c,a){var b=new (Backbone.View.extend({id:"glass_overlay",events:{click:"click"},locked:false,initialize:function(){},render:function(){c(document.body).prepend(this.$el);this.rendered=true;c(document).on("keydown",_.bind(this.keydown,this))},click:function(){if(this.locked){return}this.hide()},keydown:function(d){if(this.locked){return}if(this.visible){if(d.keyCode==27){this.hide()}}},show:function(e,d){Tumblr.KeyCommands.suspend();if(!this.rendered){this.render()}d=d||"";this.on_close=e||function(){};this.visible=true;this.$el.addClass("show");setTimeout(_.bind(function(){this.$el.addClass(d)},this),0)},hide:function(){this.visible=false;this.$el.removeClass("show");this.on_close();Tumblr.KeyCommands.resume()},lock:function(){this.locked=true},unlock:function(){this.locked=false}}))();a.Glass=b})(jQuery,Tumblr);(function(c,b){var a={get:function(d){return new RegExp(d+"=([^;]+)").test(unescape(document.cookie))?RegExp.$1:null},set:function(d,k,j,f){f=f||{};var e=new Date();var l=f.path?f.path:"/";var h=f.is_secure?true:false;var g=f.domain?f.domain:"";e.setTime(e.getTime()+(j*1000));document.cookie=d+"="+escape(k)+((j==null)?"":";expires="+e.toGMTString())+";path="+l+((h===false)?"":";secure")+((g==="")?"":";domain="+g)}};b.Cookie=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({events:{click:"click"},initialize:function(d){this.button=c(d.el||this.$el);this.popover=d.popover||this.$el.find(".popover");this.on_hide=d.on_hide||function(){};this.on_show=d.on_show||function(){};this.skip_glass=d.skip_glass||false;this.direction=d.direction||"down";this.align=d.align||"left";this.options.left=d.left||0;this.options.right=d.right||0;this.options.top=d.top||0;this.options.bottom=d.bottom||0;this.options.disable_auto_show=d.disable_auto_show;b.register(this)},click:function(){if(!this.options.disable_auto_show){this.show()}return},is_showing:false,show:function(){var d=this;if(!this.skip_glass){Tumblr.Glass.show(function(){d.hide();d.on_hide()})}if(!this.$el.is(this.popover.parent())){var f=this.button.position();var e={};if(this.direction!=="up"){e.top=(this.options.top+f.top)+"px"}else{e.bottom=(this.options.bottom-f.top-this.button.height())+"px"}if(this.align!=="right"){e.left=(this.options.left+f.left)+"px"}else{e.right=(this.options.right-f.left-this.button.width())+"px"}this.popover.css(e)}this.popover.show();this.on_show();this.is_showing=true},hide:function(){var d=this;if(!this.skip_glass){Tumblr.Glass.on_close=function(){d.popover.hide()};Tumblr.Glass.hide()}this.is_showing=false},toggle:function(){return this.is_showing?this.hide():this.show()}});b.instances=[];b.register=function(d){this.instances.push(d)};b.hide_all=function(){for(var d=0;d<this.instances.length;d++){this.instances[d].hide()}};a.Popover=b})(jQuery,Tumblr);(function(c,b){var a=Tumblr.Popover.extend({initialize:function(d){this.form=this.$("form");this.form.submit(_.bind(this.submit_form,this));Tumblr.Popover.prototype.initialize.apply(this,arguments)},show:function(){Tumblr.Popover.prototype.show.call(this);this.$("form :input").first().focus()},submit_form:function(){c.ajax({url:this.form.attr("action"),type:this.form.attr("method")||"post",data:this.form.serialize(),success:_.bind(this.on_success,this)||function(){},error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)},complete:_.bind(function(){this.hide()},this)});this.on_submit&&this.on_submit();return false}});b.PopoverWithForm=a})(jQuery,Tumblr);(function(c,a){var b=Tumblr.Popover.extend({events:{click:"click"},initialize:function(d){this.$popover=this.$el;this.popover=this.el},click:function(e){var d=e.target;if(d.id=="modal_alert_accept_button"){this.on_accept()}if(d.id=="modal_alert_cancel_button"){this.on_cancel()}},show:function(){Tumblr.Glass.show(null,"dark");this.$popover.removeClass("belowscreen").removeClass("abovescreen").addClass("up").addClass("modal_is_visible");c(document.body).addClass("popover_alert_active");this.on_show()},hide:function(){Tumblr.Glass.hide();this.$popover.addClass("abovescreen").removeClass("up").removeClass("belowscreen").removeClass("modal_is_visible");c(document.body).removeClass("popover_alert_active");this.on_hide()},cancel:function(){this.on_cancel()},on_accept:function(){this.hide()},on_show:function(){},on_hide:function(){},on_cancel:function(){}});a.Alert=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#search_field",events:{"click #track_tag_button":"track_tag","click #untrack_tag_button":"untrack_tag","mouseover #untrack_tag_button":"mouseover_tracking_button","mouseout #untrack_tag_button":"mouseout_tracking_button"},initialize:function(d){this.tag=this.$("#search_query").val();this.tracking_button=this.$("#untrack_tag_button")},track_tag:function(){this.post("/track_tag/"+this.tag);this.$el.find(".search_form").addClass("is_tracking")},untrack_tag:function(){this.post("/untrack_tag/"+this.tag);this.$el.find(".search_form").removeClass("is_tracking")},mouseover_tracking_button:function(){this.tracking_button.find("span").html(this.tracking_button.attr("data-untrack"))},mouseout_tracking_button:function(){this.tracking_button.find("span").html(this.tracking_button.attr("data-tracking"))},post:function(d){var e=c.ajax({url:d,type:"POST"});e.done(function(){c("#track_tag_button").toggle();c("#untrack_tag_button").toggle()});e.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)})}});b.TagFieldView=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(){if(!this.$el.length){return}this.popover=new Tumblr.Popover({el:this.$el,on_show:_.bind(function(){this.$el.addClass("show");this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.close_on_scroll()},this),on_hide:_.bind(function(){this.$el.removeClass("show");this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},this)});this.popover_button=this.$el.find(".popover_legal_link");this.popover_button.on("click",_.bind(function(d){this.popover.show();return false},this));this.update_position()},update_position:function(){var d=Math.floor(this.popover.popover.outerWidth()/2);this.popover.popover.css({marginLeft:-d+"px"})},close_on_scroll:function(){c(window).on("scroll.legalpopover",_.bind(function(){this.popover.hide();c(window).off("scroll.legalpopover")},this))}});Tumblr.LegalPopover=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#user_tools",events:{"focus #search_query":"focus_search_query","click #popover_tracked_tags .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_tracked_tags":"mouseenter"},initialize:function(){this.popover_selector=this.options.popover_selector||"#popover_tracked_tags";this.$search_field=this.$("#search_field");this.$search_form=this.$("#search_form");this.$search_query=this.$("#search_query");this.$popover=this.$(this.popover_selector);this.$tracked_tags=this.$(this.popover_selector+" .tracked_tags");this.$autocomplete_results=this.$(this.popover_selector+" .autocomplete_results");this.popover=new Tumblr.Popover({el:this.$search_query,popover:this.$popover,disable_auto_show:true,on_show:_.bind(function(){this.bind_key_nav()},this),on_hide:_.bind(function(){c("#unread_tag_notice").show();c("#search_query").addClass("with_unread");this.$search_field.removeClass("active");this.unbind_key_nav()},this)});this.setup_autocomplete();this.keyevents={bind_key_down:_.bind(this.keydown,this),bind_key_up:_.bind(this.keyup,this)}},setup_autocomplete:function(){this.auto_complete=new Tumblr.AutoCompleteTags({el:this.$search_query,store:"/svc/tags/featured",popover:this.popover,include:Tumblr.EXISTING_TAGS})},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")},mouseenter:function(d){if(this.in_popover(this.in_focus())){this.in_focus().blur()}},has_children:function(d){return(d.children().length>0)?true:false},click_popover:function(g){var f=this.$(g.currentTarget);var d=f.find("a").attr("href");if(g.metaKey||g.altKey){window.open(d)}else{window.location=d}this.popover.hide();g.stopPropagation();g.preventDefault()},bind_key_nav:function(){c(document).off("keydown",this.keyevents.bind_key_down);c(document).off("keyup",this.keyevents.bind_key_up);c(document).on("keydown",this.keyevents.bind_key_down);c(document).on("keyup",this.keyevents.bind_key_up)},unbind_key_nav:function(){c(document).off("keyup",this.keyevents.bind_key_up);c(document).off("keydown",this.keyevents.bind_key_down)},next:function(){this.$search_query.blur();this.currentIndex++;this.set_active("next")},previous:function(){this.$search_query.blur();this.currentIndex--;this.set_active("previous")},set_active:function(f){var d=c(this.popover_selector+" .popover_menu_item a").filter(":visible");var e=d.filter(":focus");if(e.length){this.currentIndex=(f==="previous")?d.index(e)-1:d.index(e)+1}if(this.currentIndex>=0&&this.currentIndex<d.length){d.get(this.currentIndex).focus()}else{if(this.currentIndex==-2&&f==="previous"){d.get(d.length-1).focus();this.currentIndex=d.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}},in_focus:function(){return c(document.activeElement)},contains:function(d){return(this.in_popover(d)||this.$search_query.is(d))?true:false},in_popover:function(d){return this.$popover.has(d).length},keyup:function(d){if(d.keyCode===9){if(!this.contains(this.in_focus())){this.popover.hide();this.unbind_key_nav();this.in_focus().blur()}}},keydown:function(d){switch(d.keyCode){case 27:this.$search_query.blur();return;case 38:d.preventDefault();this.previous();break;case 40:d.preventDefault();this.next();break;default:break}},submit:function(d){if(c.trim(this.$search_query.val())===""){return false}return true}});b.TagPopover=a})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(){this.init=true;this.init_value=this.$el.val();this.related_base_url=this.options.related_url||"/related_tags/";this.threshold=this.options.threshold||1;this.store=this.options.store||[];this.include=this.options.include||[];if(typeof this.store==="string"){this.ajax_store=true}this.popover=this.options.popover;this.$auto_results=b("#popover_tracked_tags .autocomplete_results");this.$tracked=b("#popover_tracked_tags .tracked_tags");this.$related=b("#popover_tracked_tags .related_tags");this.tags_template=b("#autocomplete_tags_template").html();this.related_template=b("#related_tags_template").html()},keyup:_.throttle(function(d){this.lookup()},100),get_store:function(d){if(this.store_cache){if(typeof d==="function"){d.call(this)}return}if(this.store_xhr){this.store_xhr.abort()}this.store_xhr=b.ajax({url:this.store,dataType:"json"});this.store_xhr.done(_.bind(function(e){this.store_cache=this.include_unique(e,this.include,"tag_id","tag");if(typeof d==="function"){d.call(this)}},this))},include_unique:function(j,d,h,e){if(!d.length){return j}if(h){var f=[];_.each(d,function(k){f.push(k[h])});var g=[];_.each(j,function(k){if(_.indexOf(f,k[h])===-1){g.push(k)}});j=b.merge(g,d);j.sort(function(n,l){var m=n[e].toLowerCase();var k=l[e].toLowerCase();if(m<k){return -1}if(m>k){return 1}return 0})}else{j=b.merge(d,j)}return j},lookup:function(){var e=b.trim(this.$el.val());var f=e.length;var d;if(f>=this.threshold&&!this.init&&e!==this.init_value){if(this.ajax_store){this.get_store(_.bind(function(){d=this.filter(this.store_cache,e);this.update(d)},this))}else{d=this.filter(this.store,e);this.update(d)}}else{this.update([])}this.init=false;this.init_value=""},escapeRegex:function(d){return d.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(f,e){var d=new RegExp(this.escapeRegex(e),"i");return b.grep(f,function(g){return d.test(g.tag||g)})},update:function(e){if(e.length){this.popover.show();var d={items:e};var f=_.template(this.tags_template);this.$auto_results.html(f(d));this.$tracked.hide();if(e.length===1){this.get_related(e[0]["tag"])}else{this.$related.empty()}}else{if(this.$tracked.children().length>0){this.$tracked.show()}else{this.popover.hide()}this.$auto_results.empty();this.$related.empty()}},get_related:function(d){var e=encodeURIComponent(d.toLowerCase());if(this.cache[e]){this.update_related(this.cache[e]);return}if(this.xhr){this.xhr.abort()}this.xhr=b.ajax({url:this.related_base_url+e,dataType:"json"});this.xhr.done(_.bind(function(f){this.cache[e]=f;this.update_related(f)},this))},update_related:function(d){if(d.length){var e=_.template(this.related_template);this.$related.html(e({items:d}))}},cache:{}});a.AutoCompleteTags=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#dashboard_controls_open_blog",events:{"click #popover_button_blogs":"click_popover_button","click #popover_blogs .popover_menu_item":"click_popover_blogs"},initialize:function(){if(c("#popover_blogs").length){this.popover=new Tumblr.Popover({el:this.$("#popover_button_blogs"),popover:this.$("#popover_blogs"),disable_auto_show:true,on_hide:function(){c("#all_channel_count_notice").show()}});this.sortable=new Tumblr.SortableView({el:this.$("#popover_blogs"),items:".item",callback:_.bind(this.save,this)})}},click_popover_button:function(d){if(d.target.id=="open_blog_link"){return}d.stopPropagation();d.preventDefault();this.popover.show();c("#all_channel_count_notice").hide()},click_popover_blogs:function(f){var e=this.$(f.currentTarget);var d=e.find("a").attr("href");if(f.metaKey||f.altKey){window.open(d)}else{window.location=d}this.popover.hide();f.stopPropagation();f.preventDefault()},save:function(e){var d=_.map(e.sequence(),function(f){return f.replace("menuitem-","")});c.ajax({type:"POST",url:"/order",data:"channel_names="+JSON.stringify(d)})}});a.BlogMenu=b})(jQuery,Tumblr);(function(c,b){var a=Tumblr.Popover.extend({events:{click:"toggle","click .popover_menu_item a":"select_language"},initialize:function(){if(!this.$el.length){return}Tumblr.Popover.prototype.initialize.apply(this,arguments);this.update_timezone();this.update_position();this.language_form=this.$el.find("#set_language");this.language_form_type=this.language_form.attr("method");this.language_form_url=this.language_form.attr("action")},show:function(){Tumblr.Popover.prototype.show.call(this);this.$el.closest("#sidebar_footer_nav").addClass("show_popover");this.update_position()},hide:function(){Tumblr.Popover.prototype.hide.call(this);this.$el.closest("#sidebar_footer_nav").removeClass("show_popover")},select_language:function(d){var e=c(d.target);d.preventDefault();c("#language_selected").val(e.attr("data-lang"));c("#language_switcher .current").removeClass("current");if(this.spinner){this.spinner.stop()}else{this.spinner=new Spinner({top:"auto",left:"100%",width:2,radius:3,length:2,color:"#444",className:"language_switcher_spinner"})}this.spinner.spin(e[0]);this.set_language()},set_language:function(){var d=this.language_form.serializeObject();c.ajax({type:this.language_form_type,url:this.language_form_url,data:d,complete:function(){if(d.redirect_to){window.location=d.redirect_to}else{window.location.reload()}}})},update_position:function(){var d=Math.floor(this.popover.outerWidth()/2);this.popover.css({marginLeft:-d+"px"})},update_timezone:function(){var e=new Date();var g=new Date(e.getFullYear(),0,1,0,0,0,0);var f=new Date(g.toGMTString().replace(/(.*)(\s\S+)/,"$1"));var d=Math.round((g-f)/(1000*60*60));this.$el.removeClass("americas europe_africa asia_pacific");switch(d){case -12:case -11:case -10:case -9:case -8:case -7:case -6:case -4:case -3:case -2:case -1:this.$el.addClass("americas");break;case 0:case 1:case 2:case 3:case 4:case 5:this.$el.addClass("europe_africa");break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:this.$el.addClass("asia_pacific");break;default:this.$el.addClass("americas");break}return d}});b.LanguageMenu=a})(jQuery,Tumblr);(function(b,a){var c={menus:{},init:function(){b("#posts").on("click",".user_menu_info",function(e){e.stopPropagation();e.preventDefault();var d=b(e.target);var g=d.parent(".user_menu_info_button");var h=g.find(".popover").attr("id");var f=c.menus[h]||new Tumblr.Popover({el:g,disable_auto_show:true});(c.menus[h])||(c.menus[h]=f);f.show()});b("#posts").on("click",".user_menu_item_toggle_following",c.toggle_following)},toggle_following:function(l){event.stopPropagation();event.preventDefault();var g=b(l.currentTarget);var k=g.parents(".user_menu_info_button");var m=k.find(".popover").attr("id");var j=c.menus[m];var d=g.data("tumblelog-hash");var h=g.data("tumblelog-name");var f=(b(".user_menu_item_toggle_following_"+d).first().attr("following")=="true"?true:false);if(f){if(_gaq){_gaq.push(["_trackEvent","User Menu","Unfollow",h])}Tumblr.remove_tumblelog_posts(d);j.hide();Tumblr.unfollow({tumblelog:h},{error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)}})}else{if(_gaq){_gaq.push(["_trackEvent","User Menu","Follow",h])}b(".user_menu_item_toggle_following_"+d).attr("following","true");b(".user_menu_list_item_follow_"+d).hide();b(".user_menu_list_item_unfollow_"+d).show();j.hide();Tumblr.follow({tumblelog:h,source:"FOLLOW_SOURCE_DASHBOARD"},{error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)}})}}};a.UserMenus=c})(jQuery,Tumblr);(function(c,a){var b=function(d){return function(g,f){if(!d){return}g=g||{};f=f||{};if(f.init){f.init()}var e=c.ajax({url:d,dataType:"json",type:"POST",data:{form_key:c("#tumblr_form_key").attr("content"),data:g}});e.success(function(){if(f.success){f.success()}});e.error(function(){if(f.error){f.error()}else{Tumblr.Dialog.alert(l10n_str.ajax_error)}});e.complete(function(){if(f.complete){f.complete()}});return e}};a.follow=b("/svc/follow");a.unfollow=b("/svc/unfollow");a.like=b("/svc/like");a.unlike=b("/svc/unlike");a.ignore=b("/svc/ignore");a.report=b("/svc/report")})(jQuery,Tumblr);(function(d,b){function c(){var e=d("body"),g=e.attr("id"),f="dashboard";if(g=="dashboard_likes"){f="likes"}if(g=="tagged_display"){f="tagged"}if(e.hasClass("tablet")){f="tablet"}return a.sources[f]}var a={init:function(){d("#posts").on("click",'.reblog_follow_button:not(".onboard")',function(f){f.stopPropagation();f.preventDefault();var e=d(this),g=d(document.body);e.addClass("active").addClass("animated").addClass("poof");window.setTimeout(function(){e.addClass("final_state")},1000);Tumblr.follow({tumblelog:e.attr("data-tumblelog-name"),source:c()},{success:function(){var h=d('[href="'+e.attr("data-tumblelog-name")+'"]');h.hide()},error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)}})})},sources:{dashboard:"FOLLOW_SOURCE_REBLOG",tagged:"FOLLOW_SOURCE_REBLOG_TAGGED",likes:"FOLLOW_SOURCE_REBLOG_LIKES",tablet:"FOLLOW_SOURCE_REBLOG_TABLET"}};b.ReblogFollowButtons=a})(jQuery,Tumblr);(function(b,a){a.DashboardLinkPops=Backbone.View.extend({initialize:function(){},el:"#left_column",events:{"click #posts a":"run_click"},run_click:function(d){if(b(d.target).hasClass("no_pop")||b(d.target).hasClass("photoset_photo")){return}if(b(d.target).closest(".no_pop, .post_controls, #new_post, .controls, .user_menu_list, form, .flash_notification").length>0){return}var c=b(d.target).attr("href");if(!c||c=="#"){return}d.preventDefault();window.open(c)}})})(jQuery,Tumblr);(function(b,a){a.Elevator=Backbone.View.extend({initialize:function(){this.render();this.$return_to_top=this.$el.find("#return_to_top");this.$sidebar_footer_nav=this.$el.find(".pinned_sidebar_footer");b(window).on("scroll",_.bind(_.debounce(this.toggle_elevator,500),this))},el:"body",events:{"click #return_to_top":"scroll_to_top"},scroll_to_top:function(c){c.preventDefault();b("html, body").animate({scrollTop:0},"slow")},toggle_elevator:function(){var c=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(c>=1500){this.fade_in()}else{this.fade_out()}},fade_in:function(){this.$return_to_top.addClass("show");this.$sidebar_footer_nav.addClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.addClass("hide_footer")},this),500)},fade_out:function(){this.$return_to_top.removeClass("show");this.$sidebar_footer_nav.removeClass("fade_footer");window.setTimeout(_.bind(function(){this.$sidebar_footer_nav.removeClass("hide_footer")},this),0)},render:function(){b("#return_to_top").remove();this.$el.append('<a href="#" id="return_to_top" class="return_to_top"><div class="return_to_top_icon"></div></a>')}})})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"body",post_types:["text","photo","quote","link","chat","audio","video"],suspended:false,last_key_code:0,mouseout_id:null,events:{keydown:"keydown",keyup:"keyup","click .post_tab_switching .tab_post_type":"click_tab_switch","mouseover .post_tab_switching .tab_post_type":"mouseover_tab_switch","mouseout .post_tab_switching .tab_post_type":"mouseout_tab_switch","click .post_tab_switching":"dismiss_fast_compose"},dismiss_fast_compose:function(d){if(this.post_keying){this.post_keys({toggle:"cancel"})}if(this.tab_switching){this.blog_switcher({toggle:"cancel"})}},click_tab_switch:function(d){this.post_keys({toggle:"stop"})},mouseover_tab_switch:function(d){window.clearTimeout(this.mouseout_id);this.post_keys({toggle:"start",pos:d.currentTarget.attributes["data-index"].value})},mouseout_tab_switch:function(d){this.mouseout_id=window.setTimeout(_.bind(function(){this.post_keys({toggle:"clear"})},this),250)},initialize:function(){this.logged_in=(!b(document.body).hasClass("logged_out"));this.auto_paginate=Tumblr.auto_paginate||false;this.animate_scroll=(Tumblr.animate_scroll!==undefined)?Tumblr.animate_scroll:false;this.scroll_speed=100;this.scroll_offset=7;this.pressed_keys=[];this.current_post=null;if(!Tumblr.enable_dashboard_key_commands){this.suspend()}this.blog_switcher_detection();if(Tumblr.is_xbox){this.animate_scroll=false}},suspend:function(){this.suspended=true},resume:function(){this.suspended=false},left:function(){if(!this.auto_paginate&&!b("#tumblr_lightbox").length){var d=b("#previous_page_link").attr("href");if(d){location.href=d}}},right:function(){if(!this.auto_paginate&&!b("#tumblr_lightbox").length){var d=b("#next_page_link").attr("href");if(d){location.href=d}}},next:function(d){if(d>(this.current_position+2)&&(d<this.go_to_position||!this.go_to_position)){this.go_to_position=d}},previous:function(d){if(d<(this.current_position-2)&&d>this.go_to_position){this.go_to_position=d}},check_offset:function(d){return(Math.abs(d-this.current_position)<2)},update_post_positions:function(){var d={};b("#posts > .post").each(function(){var e=b(this),f=e.attr("id");if(f&&f.indexOf("post_")===0){d[f]=e.offset().top}});this.post_positions=d},create_new:function(e){var d=b("#new_post_label_"+e);if(d.length){var f=Tumblr.PostForms.endpoints_to_types[e];var g=Tumblr.PostForms.parse_url_params(d.attr("href"));g.detached=true;Tumblr.PostForms.create({type:f,attach_to:"body",detached:true,mode:"index"},g)}else{document.location.href="/new/"+e;this.suspend()}},like:function(d){if(b("#like_form_"+d.replace("post_","")).length){Tumblr.like_post(d.replace("post_",""))}},notes:function(e){var d=b("#show_notes_link_"+e.replace("post_",""));if(d.length){d.click()}},reblog:function(d){var e=b("#"+d).find(".reblog_button");if(e.length){e.trigger("click")}},elevate:function(){var d=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;if(d>=1500){b("html, body").stop(true).animate({scrollTop:0},"slow")}},play:function(g,j){var d=b("#"+g),h=d.data("type");if(h=="video"){var f=d.find("iframe.tumblr_video_iframe");var k=d.find(".retro_video_preview");if(f.length>0){f[0].contentWindow.postMessage("toggle","http://"+f.attr("data-origin"));f[0].contentWindow.focus()}else{if(k.length>0){b(".big_play_button",k).click();j.preventDefault()}}}if(h=="photoset"){d.find(".photoset_row:first > a:first").click()}},fast_reblog:function(f,g,e){var j=b("#tumblr_form_key").attr("content"),d=b("#"+f),k=d.find(".reblog_button:not(.reblogged)");if(k.length&&this.check_offset(g)){k.addClass("animated").addClass("collapse_reblog_button");window.setTimeout(function(){k.addClass("final_state")},1000);e=e||false;var h=b.ajax({url:"/fast_reblog",type:"POST",data:{form_key:j,reblog_key:k.attr("data-reblog-key"),reblog_post_id:k.attr("data-reblog-id"),queue:e}});h.success(function(){k.addClass("reblogged");if(d.hasClass("promotion_pinned")&&!d.hasClass("is_mine")){var l=b.ajax({url:"/unpin",type:"POST",data:{form_key:j,post_id:f}})}});h.error(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)})}},show_plexi:function(){if(Tumblr.Plexi.findByToken("body-plexi")){this.body_plexi=Tumblr.Plexi.findByToken("body-plexi")}if(!this.body_plexi){this.body_plexi=new Tumblr.Plexi({token:"body-plexi"});this.body_plexi.create(document.body,{insertAt:"top",cssClass:"color"})}this.body_plexi.show({transition_class:"fast"})},hide_plexi:function(){if(Tumblr.Plexi.findByToken("body-plexi")){this.body_plexi=Tumblr.Plexi.findByToken("body-plexi")}if(this.body_plexi){this.body_plexi.hide()}},post_keys:function(g){g.toggle=g.toggle||null;g.shift=g.shift||null;g.pos=g.pos||null;if(this.tab_switching){return}var e=b("#post_tab_switching");if(!e.length){return}var f=e.find(".tab_post_type");if(g.toggle=="cancel"){if(!this.creating_new){this.hide_plexi()}this.creating_new=false;e.removeClass("active");clearTimeout(this.show_timeout);clearTimeout(this.fade_timeout);this.cancel_timeout=setTimeout(function(){e.addClass("inactive undimmed")},50);this.post_keying=false;this.post_tab_index=undefined;return}if(g.toggle=="clear"){this.post_tab_index=undefined;f.removeClass("selected loading")}if(g.toggle=="stop"){var d=null;if(this.post_tab_index!==undefined){d=this.post_types[this.post_tab_index]}this.post_tab_index=undefined;if(d){this.creating_new=true;this.create_new(d)}else{this.hide_plexi()}this.post_keys({toggle:"cancel"});return}if(g.toggle=="init"){this.show_plexi();clearTimeout(this.cancel_timeout);clearTimeout(this.fade_timeout);setTimeout(function(){f.removeClass("selected loading");e.removeClass("inactive");e.addClass("active");this.post_keys({toggle:"start"})}.bind(this),50);this.post_keying=true;return}if(g.toggle=="start"){clearTimeout(this.show_timeout);if(g.pos&&(g.pos-1==this.post_tab_index)){return}setTimeout(function(){e.removeClass("undimmed");f.removeClass("selected loading");if(this.post_tab_index===undefined){this.post_tab_index=g.pos?g.pos-1:0}else{this.post_tab_index=g.pos?g.pos-1:(this.post_tab_index+((g.shift)?-1:1));if(this.post_tab_index>=7){this.post_tab_index=0}if(this.post_tab_index<0){this.post_tab_index=6}}e.addClass("active");this.tab_current_post_type=f.eq(this.post_tab_index);this.tab_current_post_type.addClass("selected")}.bind(this),1);return}},blog_switcher:function(h){h.toggle=h.toggle||null;h.shift=h.shift||null;if(this.post_keying){return}this.tab_switching=(h.toggle.length)?true:false;var e=b("#tab_switching");if(!e.length){return}var g=e.find(".tab_blog");g.removeClass("selected loading");if(h.toggle=="cancel"){this.tab_switching=false;this.tab_index=undefined;this.hide_plexi();e.removeClass("active");setTimeout(function(){e.addClass("inactive")},500);return}if(h.toggle=="stop"){this.tab_index=undefined;var d=this.tab_current_blog.find("a.blog_name").attr("href");if(!document.location.href.match(d)){this.tab_current_blog.addClass("loading");var f=new Spinner(Tumblr.spinners.white).spin();this.tab_current_blog.append(f.el);document.location.href=d;this.suspend();b(window).on("keydown",function(){return false})}else{this.blog_switcher({toggle:"cancel"})}return}if(h.toggle=="start"){e.removeClass("inactive");this.show_plexi();setTimeout(_.bind(function(){if(this.tab_index===undefined){this.tab_index=1}else{this.tab_index=this.tab_index+((h.shift)?-1:1);if(this.tab_index>=g.length){this.tab_index=0}if(this.tab_index<0){this.tab_index=g.length-1}}e.addClass("active");this.tab_current_blog=g.eq(this.tab_index);this.tab_current_blog.addClass("selected")},this),50);return}},blog_switcher_detection:function(){if(window.devicePixelRatio){if(escape(navigator.javaEnabled.toString())=="function%20javaEnabled%28%29%20%7B%20%5Bnative%20code%5D%20%7D"){b("html").addClass("tab_switcher_chrome")}else{if(escape(navigator.javaEnabled.toString())!="function%20javaEnabled%28%29%20%7B%20%5Bnative%20code%5D%20%7D"){b("html").addClass("tab_switcher_safari")}}}},match_modifier_keys:function(h,d){if(typeof d=="string"){d=[d]}var f={shift:d.indexOf("shift")>-1,ctrl:d.indexOf("ctrl")>-1,alt:d.indexOf("alt")>-1,meta:d.indexOf("meta")>-1};var g={shift:h.shiftKey,ctrl:h.ctrlKey,alt:h.altKey,meta:h.metaKey};return _.isEqual(f,g)},keydown:function(m){if(this.suspended){return}if(this.animating){return}var l=m?m.target:window.event.srcElement;if(b(l).is("input:focus")){return}this.update_post_positions();this.current_position=(window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop)+7;this.go_to_position=0;var k=m.charCode?m.charCode:m.keyCode,g=(m.shiftKey||m.ctrlKey||m.altKey||m.metaKey),h;this.pressed_keys[k]=1;if((this.post_keying||this.tab_switching)&&!(m.ctrlKey||m.altKey||m.metaKey)){var d=[74,75,190,76,78,82,32,38,40,33,34,35,36];if(d.indexOf(k)>=0){return false}}if(k==37){this.left()}else{if(k==39){this.right()}else{if(!g){for(h in this.post_positions){var f=h,j=this.post_positions[h];if(k==74){this.next(j)}if(k==75){this.previous(j)}if(Tumblr.is_xbox&&k==40){this.next(j);m.preventDefault()}if(Tumblr.is_xbox&&k==38){this.previous(j);m.preventDefault()}if(k==190){this.elevate();m.preventDefault();return false}if(this.check_offset(j)){this.current_post=b("#"+f);if(k==76){this.like(f)}if(k==78){this.notes(f)}if(k==82){this.reblog(f)}if(k==32){this.play(f,m);if(this.current_post.length){if(this.current_post.attr("data-type")=="video"&&this.current_post.attr("data-direct-video")){return false}if(this.current_post.attr("data-type")=="photoset"){return false}}return true}}}if(this.animate_scroll){if(this.go_to_position&&!this.animating){this.animating=true;b("html,body").stop().animate({scrollTop:this.go_to_position-this.scroll_offset},this.scroll_speed,_.bind(function(){this.animating=false},this))}}else{if(this.go_to_position){window.scrollTo(0,this.go_to_position-this.scroll_offset)}}}}}if(navigator.platform=="MacIntel"){if(k==67&&this.post_keying){this.post_keys({toggle:"start",shift:m.shiftKey})}else{if(k==67&&this.match_modifier_keys(m,"alt")){this.post_keys({toggle:"init",shift:m.shiftKey})}}if(k==13&&this.post_keying){this.post_keys({toggle:"stop"});return false}if(k==27&&this.post_keying){this.post_keys({toggle:"cancel"});return false}if(k==37&&this.post_keying){this.post_keys({toggle:"start",shift:true});return false}if(k==39&&this.post_keying){this.post_keys({toggle:"start"});return false}if(k==9&&this.post_keying){this.post_keys({toggle:"start",shift:m.shiftKey});return false}if(m.altKey&&k==9){this.blog_switcher({toggle:"start",shift:m.shiftKey});return false}if(m.altKey&&k==192){this.blog_switcher({toggle:"start",shift:true});return false}if(m.altKey&&k==27&&this.tab_switching){this.blog_switcher({toggle:"cancel"});return false}if(m.altKey&&k==37&&this.tab_switching){this.blog_switcher({toggle:"start",shift:true});return false}if(m.altKey&&k==39&&this.tab_switching){this.blog_switcher({toggle:"start"});return false}if(m.altKey&&k==82&&this.logged_in){for(h in this.post_positions){this.fast_reblog(h,this.post_positions[h])}return false}if(m.altKey&&k==69&&this.logged_in){for(h in this.post_positions){this.fast_reblog(h,this.post_positions[h],true)}return false}}if(navigator.platform=="Win32"){if(this.pressed_keys[67]&&this.post_keying){this.post_keys({toggle:"start",shift:m.shiftKey})}else{if(this.pressed_keys[90]&&this.pressed_keys[67]){this.post_keys({toggle:"init",shift:m.shiftKey})}}if(this.pressed_keys[13]&&this.post_keying){this.post_keys({toggle:"stop"});return false}if(this.pressed_keys[27]&&this.post_keying){this.post_keys({toggle:"cancel"});return false}if(this.pressed_keys[37]&&this.post_keying){this.post_keys({toggle:"start",shift:true});return false}if(this.pressed_keys[39]&&this.post_keying){this.post_keys({toggle:"start"});return false}if(this.pressed_keys[9]&&this.post_keying){this.post_keys({toggle:"start",shift:m.shiftKey});return false}if(this.pressed_keys[90]&&this.pressed_keys[9]){this.blog_switcher({toggle:"start",shift:m.shiftKey});return false}if(this.pressed_keys[90]&&this.pressed_keys[27]&&this.tab_switching){this.blog_switcher({toggle:"cancel"});return false}if(this.pressed_keys[90]&&this.pressed_keys[192]){this.blog_switcher({toggle:"start",shift:true});return false}if(this.pressed_keys[90]&&this.pressed_keys[37]&&this.tab_switching){this.blog_switcher({toggle:"start",shift:true});return false}if(this.pressed_keys[90]&&this.pressed_keys[39]&&this.tab_switching){this.blog_switcher({toggle:"start"});return false}if(m.shiftKey&&k==82&&this.logged_in){for(h in this.post_positions){this.fast_reblog(h,this.post_positions[h])}return false}if(m.shiftKey&&k==69&&this.logged_in){for(h in this.post_positions){this.fast_reblog(h,this.post_positions[h],true)}return false}}},keyup:function(g){var f=g.charCode?g.charCode:g.keyCode,d=(g.shiftKey||g.ctrlKey||g.altKey||g.metaKey);this.pressed_keys[f]=0;if(navigator.platform=="MacIntel"){if(!g.altKey&&this.tab_switching){this.blog_switcher({toggle:"stop"});return false}}if(navigator.platform=="Win32"){if(!this.pressed_keys[90]&&this.tab_switching){this.blog_switcher({toggle:"stop"});return false}}}});a.KeyCommandsConstructor=c})(jQuery,Tumblr);(function(c,b){var a={white:{lines:16,length:11,width:4,radius:17,color:"#ffffff",speed:0.9,trail:34,shadow:false,hwaccel:false,className:"tumblr_default_spinner spinner",zIndex:2000000000,top:"50",left:"auto"}};b.spinners=a})(jQuery,Tumblr);(function(d,b){var c=Tumblr.PopoverWithForm.extend({initialize:function(e){this.$el.addClass("active");this.submit_button=this.$("button");this.textarea=this.$("form textarea");this.check_form_state();this.textarea.on("input",_.bind(this.check_form_state,this));Tumblr.PopoverWithForm.prototype.initialize.apply(this,arguments)},check_form_state:function(){this.submit_button.attr("disabled",this.textarea[0].value.length===0)},on_hide:function(){this.$el.removeClass("active")},on_submit:function(){this.submit_button.attr("disabled",true);this.submit_button.html(this.submit_button.data("label-loading"))},on_success:function(){this.$el.addClass("already_reply");this.$el.find("button").attr("disabled",false);this.$el.find("textarea").val("");this.submit_button.html(this.submit_button.data("label"));var e=this.$el.parents(".post");if(e.hasClass("promotion_pinned")&&!e.hasClass("is_mine")){d.ajax({url:"/unpin",type:"post",data:{post_id:e.attr("id").replace("post_",""),form_key:d("#tumblr_form_key").attr("content")}})}}});var a={init:function(){var e={};d("#posts").on("click",".reply_button",function(f){if(f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();var g=f.currentTarget.id;if(!e[g]){e[g]=new c({el:d(f.target)})}e[g].show()})}};b.ReplyButtons=a})(jQuery,Tumblr);(function(c,a){var d=Backbone.View.extend({initialize:function(){this.$post=this.$el.closest(".post")},clicked:function(){if(this.$el.closest(".logged_out").length||this.$el.data("reblogged")){return}this.reblog();this.$el.addClass("animated").addClass("collapse_reblog_button");window.setTimeout(_.bind(function(){this.$el.addClass("final_state")},this),1000)},reblog:function(){this.$el.data("reblogged",1);c.ajax({url:"/fast_reblog",type:"post",data:{reblog_key:this.$el.attr("data-reblog-key"),reblog_post_id:this.$el.attr("data-reblog-id"),form_key:this.$el.attr("data-user-form-key")},success:_.bind(function(){this.$el.addClass("reblogged");if(this.$post.hasClass("promotion_pinned")&&!this.$post.hasClass("is_mine")){this.unpin()}},this),error:function(){Tumblr.Dialog.alert(l10n_str.ajax_error)},complete:function(){}})},unpin:function(){c.ajax("/unpin",{type:"post",data:{post_id:this.$post.id().replace("post_",""),form_key:c("#tumblr_form_key").attr("content")}})}});var b={init:function(){var e={};c("#posts").on("click",".reblog_button",function(f){if(!f.altKey||f.target!=f.currentTarget){return}f.stopPropagation();f.preventDefault();new d({el:c(f.target)}).clicked()})}};a.ReblogButtons=b})(jQuery,Tumblr);(function(b,a){var c={init:function(){b("#posts").on("click",".panorama",function(e){if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey){return}var d=b(e.target).closest(".panorama");if(d.hasClass("with_clickthru")&&e.target.className!="zoomer"){return}e.stopPropagation();e.preventDefault();d.panorama({lightbox:true})})}};a.Panos=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({events:{"click .retro_video_preview":"show_video","click .hide_inline_video":"hide_video"},show_video:function(g){var f=c(g.currentTarget);var d=f.data("id");if(c("#video_preview_"+d).is(":visible")){c("#video_embed_"+d).html(c("#video_code_"+d).val());c("#video_preview_"+d).hide();c("#watch_video_"+d).show()}this.track_view(true);return false},hide_video:function(g){var d=c(g.currentTarget);var f=d.data("id");if(!c("#video_preview_"+f).is(":visible")){c("#video_embed_"+f).html("");c("#video_preview_"+f).show();c("#watch_video_"+f).hide()}return false},track_view:function(d){if(typeof _gaq!=="undefined"&&_gaq){_gaq.push(["_trackEvent","dashboard_video","click",d?"static":"normal"])}}});a.VideoThumbnails=b})(jQuery,Tumblr);(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;if(this.$el.data("resizeAnchor")){return this.$el.data("resizeAnchor")}this.$el.data("resizeAnchor",this);this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.config.resize=this.$el.css("resize")||"both";if(this.config.create_container){this.$container=c("<div/>").addClass(this.config.container_class).insertBefore(this.$el);this.$container.append(this.$el);this.$clearfix=c("<div/>").addClass(this.config.clearfix_class).insertAfter(this.$container)}this.$anchor=c("<span/>").attr({onclick:"return false;",tabindex:-1}).addClass(this.config.anchor_class).insertAfter(this.$el);this.anchor_visibility();this.resize_start=c.proxy(this._resize_start,this);this.resize_move=c.proxy(this._resize_move,this);this.resize_end=c.proxy(this._resize_end,this);this.$anchor.on("mousedown",this.resize_start);this.$parent=c(window);a.register(this);return this};a.prototype={__event_position:function(f){var d,g;d=f.pageX;g=f.pageY;return{x:d,y:g}},_resize_start:function(d){this.start_width=this.$el.outerWidth();this.start_height=this.$el.outerHeight();this.start_position=this.__event_position(d);this.$parent.on("mousemove",this.resize_move);this.$parent.on("mouseup",this.resize_end);d.preventDefault()},_resize_move:function(d){this.current_position=this.__event_position(d);switch(this.config.resize){case"vertical":this.set_height(this.current_position.y-this.start_position.y+this.start_height);break;case"horizontal":this.set_width(this.current_position.x-this.start_position.x+this.start_width);break;case"both":this.set_size(this.current_position.x-this.start_position.x+this.start_width,this.current_position.y-this.start_position.y+this.start_height);break;case"none":break}},_resize_end:function(d){this.$parent.off("mousemove",this.resize_move);this.$parent.off("mouseup",this.resize_end)},anchor_visibility:function(){if(this.config.resize==="none"){this.$anchor.hide()}else{this.$anchor.show()}},set_width:function(d){this.$el.css("width",Math.max(0,d))},set_height:function(d){this.$el.css("height",Math.max(0,d))},set_size:function(e,d){this.$el.css({width:Math.max(0,e),height:Math.max(0,d)})},destroy:function(){this.$anchor.remove();if(this.config.create_container){this.$el.insertBefore($container);this.$container.remove();this.$clearfix.remove()}}};a.instances=[];a.defaults={container_class:"resize_textarea_container",clearfix_class:"resize_textarea_clearfix",anchor_class:"resize_textarea_anchor",create_container:true};a.register=function(d){this.instances.push(d)};a.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.resizeanchor=function(d){return this.each(function(){new a(this,d)})};b.ResizeAnchor=a})(jQuery,Tumblr);(function(c,a){var b=function(f,d){if(!(this instanceof b)){return new b(f,d)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},b.defaults,this.options,this.metadata);var e=parseInt(this.$el.css("lineHeight"),10);this.minHeight=this.oldHeight=(this.config.minHeight)?this.config.minHeight:this.$el.height();this.maxHeight=(this.config.maxHeight)?this.config.maxHeight:false;this.padder=e;this.$el.css("min-height",this.minHeight);this.$el.each(c.proxy(function(g){this.create_shadow(g)},this));this.events={__input:c.proxy(this.__input,this),__mouseup:c.proxy(this.__mouseup,this)};this.$el.on("input",this.events.__input);this.$el.on("mouseup",this.events.__mouseup);this.update(this.$el);b.register(this);return this};b.prototype={__input:function(f){var d=c(f.currentTarget);this.update(d)},__mouseup:function(f){var d=c(f.currentTarget);this.oldHeight=d.outerHeight();if(this.oldHeight>=this.maxHeight){this.maxHeight=this.oldHeight}},create_shadow:function(d){this.$shadow=(c("."+this.config.shadowClass).length)?c("."+this.config.shadowClass):c("<div/>",{"class":this.config.shadowClass});this.$shadow.css({position:"absolute",top:-10000,left:-10000,width:this.$el.width(),fontSize:this.$el.css("fontSize"),fontFamily:this.$el.css("fontFamily"),fontWeight:this.$el.css("fontWeight"),lineHeight:this.$el.css("lineHeight")}).appendTo(document.body)},replace_value:function(d){return d.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>")},update:function(d){var f=this.replace_value(d.val());this.$shadow.css("width",this.$el.width());this.$shadow.html(f);var e=Math.max(this.$shadow.height()+this.padder,this.oldHeight);if((this.maxHeight&&(e<this.maxHeight))||!this.maxHeight){this.$el.css("height",e)}else{this.$el.css("height",this.maxHeight)}},destroy:function(){this.$shadow.remove();this.$el.off("input",this.events.__input);this.$el.off("mouseup",this.events.__mouseup)}};b.instances=[];b.defaults={shadowClass:"autoexpand_shadow",minHeight:false,maxHeight:400};b.register=function(d){this.instances.push(d)};b.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy()}};c.fn.autoexpand=function(d){return this.each(function(){new b(this,d)})};a.AutoExpand=b})(jQuery,Tumblr);(function(b,a){var c=function(e,d){if(!(this instanceof c)){return new c(e,d)}this.el=(typeof e==="string")?b(e).get(0):e;this.$el=b(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=b.extend({},c.defaults,this.options,this.metadata);if(this.config.event){this.config.events=this.config.event}if(this.config.selector){this.config.child_selector=this.config.selector}this.$relay_targets=b(this.$el.find(this.config.child_selector)).add(b(this.config.global_selector));this.$el.addClass(this.config.relay_class);this.$relay_targets.addClass(this.config.target_class);this.relay=b.proxy(this.__relay,this);this.events={};b.each(this.config.events.split(","),b.proxy(function(f,g){this.add_event(g)},this));this.$el.data("eventRelayObject",this);c.register(this);return this};c.prototype={__relay:function(d){if(this.__is_relay_element(d)){d.stopPropagation();this.$relay_targets.not(d.target).trigger(d)}},__is_relay_element:function(d){return this.$el.is(d.currentTarget)},add_event:function(d){this.events[d]=true;this.$el.on(d,this.relay)},remove_event:function(d){this.events[d]=false;this.$el.off(d,this.relay)},destroy:function(d){b.each(this.events,b.proxy(function(f){this.remove_event(f)},this));if(!d){c.unregister(this)}}};c.defaults={events:"click",child_selector:false,global_selector:false,relay_class:"click_relay",target_class:"click_relay_target"};c.instances=[];c.register=function(d){this.instances.push(d)};c.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};c.destroy_all=function(d){for(var e=0;e<this.instances.length;e++){this.instances[e].destroy(true)}this.instances=[]};b.fn.eventrelay=function(d){return this.each(function(){new c(this,d)})};a.EventRelay=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(){this.$password_meter=c("#password_strength_meter");this.$password=c("#signup_password");this.$email=c("#signup_email");this.$tumblelog=c("#signup_username");if(!this.$password.length){return}this.class_name="password_strength_meter";this.password_meter_markup='<div class="password_strength_meter inactive" id="password_strength_meter"><strong class="l5"></strong><strong class="l4 l5"></strong><strong class="l3 l4 l5"></strong><strong class="l2 l3 l4 l5"></strong><strong class="l1 l2 l3 l4 l5"></strong></div>';this.render();this.test_password();this.$password.on("keydown",_.bind(function(){this.last_val=this.get_password()},this));this.$password.on("keyup focus blur",_.throttle(_.bind(function(d){if(this.last_val!==this.get_password()){this.test_password(d)}},this),250))},render:function(){if(!this.$password_meter.length){this.$password.after(this.password_meter_markup);this.$password_meter=c("#password_strength_meter")}},set_inactive:function(){this.$password_meter.addClass("inactive")},set_active:function(){this.$password_meter.removeClass("inactive")},set_level:function(d){this.set_active();switch(d){case 1:this.$password_meter[0].className=this.class_name+" level_1";break;case 2:this.$password_meter[0].className=this.class_name+" level_2";break;case 3:this.$password_meter[0].className=this.class_name+" level_3";break;case 4:this.$password_meter[0].className=this.class_name+" level_4";break;case 5:this.$password_meter[0].className=this.class_name+" level_5";break;default:this.$password_meter[0].className=this.class_name;break}},test_password:function(d){if(!d||!this.$password.val().length){this.set_inactive();return}if(this.$password.val().length<5){this.block_registration_step="The password must be at least 5 characters.";return}this.get_password_strength()},update:function(){this.test_password()},get_email:function(){return this.$email.val()},get_password:function(){return this.$password.val()},get_username:function(){return this.$tumblelog.val()},get_form_data:function(){var d={};d.username=this.get_username();d.email=this.get_email();d.password=this.get_password();return d},get_password_strength:function(){if(this.pw_xhr){this.pw_xhr.abort()}this.pw_xhr=c.ajax({url:"/svc/account/validation",dataType:"json",type:"POST",data:this.get_form_data()});this.pw_xhr.done(_.bind(function(d){var e=d.score||0;this.set_level(e);this.block_registration_step=(d.reject_reason)?d.reject_reason:false;delete this.pw_xhr},this))}});Tumblr.PasswordStrengthMeter=b})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.options=d||{};if(typeof this.$el=="undefined"||this.$el.length===0||this.$el.find("leviathan").length!==0){this.remove();return false}this.uid=Math.floor(Math.random()*10000);this.$el.append(this.html());this.$loader=c(".leviathan.loader_"+this.uid);this.center();this.$u1=c("i.unum",this.$loader);this.$u2=c("i.duo",this.$loader);this.$u3=c("i.tres",this.$loader);this.ti=null;this.t1=null;this.t2=null;this.t3=null},start:function(){clearInterval(this.ti);var d=_.bind(function(){this.t1=this.rise(this.$u1,300,0);this.t2=this.rise(this.$u2,300,100);this.t3=this.rise(this.$u3,300,200)},this);d();this.ti=setInterval(_.bind(function(){clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3);d()},this,d),600);this.$loader.show()},stop:function(){this.$loader.hide();clearInterval(this.ti);clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3)},destroy:function(){this.stop();this.unbind();this.$loader.remove();this.remove()},center:function(){var e=this.$el.width();var d=this.$el.height();var g=this.$loader.width();var f=this.$loader.height();var j=(e/2)-(g/2);var h=(d/2)-(f/2);this.$loader.css({left:j,top:h})},rise:function(e,f,d){if(typeof e=="undefined"||e.length===0){return}return setTimeout(function(){e.stop(true,true).animate({height:"28px",opacity:1,marginTop:"0px"},f).animate({height:"20px",opacity:0.5,marginTop:"4px"},f)},d)},html:function(){return'<div class="loader_'+this.uid+' leviathan"><i class="unum"></i><i class="duo"></i><i class="tres"></i></div>'}});a.PillLoader=b})(jQuery,Tumblr);(function(b,a){a.ReportTumblelogView=Backbone.View.extend({el:"#report_tumblelog_bar",events:{"click .spam":"report_spam","click .harassment":"report_harassment","click .dismiss":"dismiss",mouseenter:"delay_dismiss",mouseleave:"timeout_dismiss"},initialize:function(c){a.Events.on("block_tumblelog",_.bind(this.block_tumblelog,this))},block_tumblelog:function(c){if(c.can_report){this.tumblelog=c.tumblelog;this.animate_in();this.timeout_dismiss()}},animate_in:function(){this.$el.find("#report_tumblelog_with_name").show();this.$el.find("#report_tumblelog_name").html(this.tumblelog);this.$el.fadeIn(300)},report_spam:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"1"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"spam"})}).always(_.bind(function(){this.dismiss()},this))},report_harassment:function(c){var d=this.tumblelog;a.report({tumblelog:d,reason:"2"}).done(function(){a.Events.trigger("report_tumblelog",{tumblelog:d,reason:"harassment"})}).always(_.bind(function(){this.dismiss()},this))},dismiss:function(c){this.$el.fadeOut(300,_.bind(function(){this.$el.find("#report_tumblelog_name").html("");this.$el.find("#report_tumblelog_with_name").hide()},this))},timeout_dismiss:function(c){c=c||3000;clearTimeout(this.dismissTimeout);this.dismissTimeout=setTimeout(_.bind(function(){this.dismiss()},this),3000)},delay_dismiss:function(c){clearTimeout(this.dismissTimeout)}})})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({initialize:function(){this.$no_posts_found=b(".no_posts_found");this.$left_column=b("#left_column");this.$right_column=b("#right_column");if(this.$no_posts_found.length&&this.$left_column.length&&this.$right_column.length){if(this.$right_column.css("min-height")!="0px"){return}var e=this.$left_column.height(),d=this.$right_column.height(),g=0,f="+";if(e<d){f="+";g=d-e}else{if(e>d){f="-";g=e-d;if(g>=50){g=0}}}this.center_padding(g,f)}},center_padding:function(d,f){if(d>0&&(f=="+"||f=="-")){var e=d/2;this.$no_posts_found.css("padding-top",f+"="+e).css("padding-bottom",f+"="+e)}}});a.FullHeightNoPostsFound=c})(jQuery,Tumblr);(function(h,f){AutoPaginator={start:function(){l=3;this.interval=setInterval(j,123)},stop:function(){loading_next_page=false;clearInterval(this.interval)}};_.extend(AutoPaginator,Backbone.Events);var l=3;loading_next_page=false;function g(p){if(typeof p==="undefined"||p===null){return false}var r=p.offsetTop;var o=window.pageYOffset||(document.documentElement&&document.documentElement.scrollTop)||document.body.scrollTop;var q=window.innerHeight||(document.documentElement&&document.documentElement.clientHeight)||document.body.clientHeight;return(r<(o+q))}function j(){if(!next_page){if(h("#auto_pagination_loader").is(":visible")){h("#auto_pagination_loader").hide()}AutoPaginator.stop();return}var o;if(next_page&&!loading_next_page&&(o=h("#posts").find(".post"))&&o.length>0&&(((o.length>=3)&&g(o[o.length-4]))||((o.length<3)&&g(o[o.length-1])))){loading_next_page=true;a();AutoPaginator.trigger("before",next_page);h("#auto_pagination_loader_loading").show();h("#auto_pagination_loader_failure").hide();d()}}function d(){l--;var o=h.ajax({url:next_page,type:"get"});o.done(function(q){c(q);var p=o.getResponseHeader("X-next-page");if(p){next_page=p}else{next_page=q.match('id="next_page_link" href="')?q.split('id="next_page_link" href="')[1].split('"')[0]:false}});o.fail(function(){if(l){d()}else{k()}})}function c(p){if(p.indexOf('<script type="text/javascript" language="javascript" src="http://assets.tumblr.com/languages/errors.js')!==-1){AutoPaginator.stop();return false}var o;if(p.indexOf("<!-- START POSTS -->")===-1){o=p}else{o=p.split("<!-- START POSTS -->")[1].split("<!-- END POSTS -->")[0]}h("#posts").append(o);b();loading_next_page=false;setTimeout(function(){if(typeof window.after_auto_paginate=="function"){after_auto_paginate()}e();AutoPaginator.trigger("after",next_page)},0)}function k(){AutoPaginator.stop();h("#auto_pagination_loader_loading").hide();h("#auto_pagination_loader_failure").show()}function b(){next_page=next_page.replace(/https?:\/\/.*?\//,"/");if(next_page.indexOf("/dashboard")===0){next_page=next_page.substring(0,next_page.lastIndexOf("/"))}if(window._gaq!==undefined){try{var o=tumblr_custom_tracking_url?tumblr_custom_tracking_url:next_page;_gaq.push(["_trackPageview",o])}catch(p){}}if(window.__qc){try{__qc.qpixelsent=[];__qc.firepixel({qacct:"p-19UtqE8ngoZbM"})}catch(p){}}if(typeof(COMSCORE)!=="undefined"){try{COMSCORE.beacon({c1:"2",c2:"15742520"})}catch(p){}}}var m=[];function a(){for(var o=m.length-1;o>=0;o--){if(typeof(m[o])==="function"){m[o]()}}}var n=[];function e(){for(var o=n.length-1;o>=0;o--){if(typeof(n[o])==="function"){n[o]()}}}f.AutoPaginator=AutoPaginator;window.BeforeAutoPaginationQueue=m;window.AfterAutoPaginationQueue=n})(jQuery,Tumblr);(function(g,f){var l={init:function(){_.each(j,function(m,n){l.add(false,m)});c()},add:h};var b=[],d=[],a=false,k=("https:"==document.location.protocol?"https://secure.assets.tumblr.com":"http://assets.tumblr.com"),j=[k+"/images/inline_photo_loading.gif",k+"/images/black_75.png",k+"/images/white_80.png",k+"/images/loading_reblog.gif"];function h(o,m,n){if(typeof n=="undefined"){n=false}d.push([o,m,n])}function e(){for(i=d.length-1;i>=0;i--){var p=d[i][0];var m=d[i][1];var o=d[i][2];if(p===false){img_obj=new Image();img_obj.src=m;b.push(img_obj)}else{var n=document.getElementById(p);if(!n){continue}if(o=="bg"){n.style.backgroundImage="url("+m+")"}else{if(o=="src"){n.src=m}}}d.splice(i,1)}}function c(){if(a){return true}a=window.setInterval(function(){if(typeof(d)!="undefined"&&d.length){e()}},500)}f.ImagePreloader=l;window.add_to_image_queue=h;window.process_image_queue=e;window.start_processing_image_queue=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({el:"#right_column",events:{"mousedown li":"on_mousedown"},on_mousedown:function(e){var d=this.$(e.currentTarget);if(d.length&&!d.hasClass("item")&&!d.hasClass("no_push")){this.$(".selected").removeClass("selected");d.addClass("selected")}}});a.PushButtons=b})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{"click .post_content img":"toggle"},toggle:function(k){var g=this.$(k.currentTarget).parents(".post_content");var f=g.find(".toggle_inline_image");f.toggleClass("inline_image");var h=g.find(".inline_external_image");_.each(h,_.bind(this.toggle_external,this));var j=g.find(".image_thumbnail");if(j.length){this.toggle_thumbnail(j)}var d=g.find(".photo_info");if(d.length){d.toggleClass("hidden")}},toggle_thumbnail:function(d){if(d.hasClass("enlarged")){d.removeClass("enlarged");d.attr("width",d.data("thumbnail-width"));d.attr("height",d.data("thumbnail-height"))}else{d.addClass("enlarged");d.attr("width",d.data("width"));d.attr("height",d.data("height"))}},toggle_external:function(f){var g=this.$(f);var d=g.attr("external_src");if(g.hasClass("enlarged")){g.attr("src",g.attr("original_src"));g.removeClass("enlarged")}else{g.attr("original_src",g.attr("src"));g.addClass("enlarged");if(g.attr("loader")){g.attr("src",g.attr("loader"))}var e=new Image();e.onload=function(){g.attr("src",d)};e.src=d}}});a.PhotoThumbnails=c})(jQuery,Tumblr);(function(d,a){var c=Backbone.View.extend({ignore:function(h){h.preventDefault();var g=l10n_str.confirm_block.replace("%1$s",this.tumblelog);a.Dialog.confirm(g,_.bind(function(){var j=this.tumblelog;a.ignore({tumblelog:j}).done(function(k){a.Events.trigger("block_tumblelog",{tumblelog:j,can_report:true})})},this))}});var e=c.extend({events:{"click .notification .block":"ignore","mousedown .notification_inner":"before_notification_click","mouseup .notification_inner":"after_notification_click","click .notification_inner":"notification_click","click .notification_follow_button":"notification_follow","click .photo_reply_image":"notification_photo_reply_image","mouseenter .notification .block":"notification_block_hover","mouseleave .notification .block":"notification_block_hover"},initialize:function(){this.tumblelog=this.$el.find("a.block").attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this));if(this.$el.find("a.block").length){this.$el.addClass("can_ignore")}},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}},update:function(){this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}});this.$el.find(".notification a.block").each(function(h,j){var g=d(j);g.closest(".notification").addClass("can_ignore")})},before_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.addClass("no_active")}},after_notification_click:function(h){var g=d(h.target);if(g.is(".photo_reply_image")||g.is(".photo_reply_image_container")){this.$el.removeClass("no_active")}},notification_click:function(j){var g=d(j.target);if(!g.is("a")&&!g.is(".photo_reply_image_container")){j.stopPropagation();j.preventDefault();var h=this.$el.find(".notification_target").attr("href");if(!h&&this.$el.find("a").length===1){h=this.$el.find("a").attr("href")}if(h){window.open(h)}}},notification_follow:function(h){h.stopPropagation();h.preventDefault();var g=d(h.target);var j=d(h.currentTarget);j.addClass("animated").addClass("poof");window.setTimeout(_.bind(function(){j.parent().remove();this.$el.removeClass("has_follow");j.addClass("final_state")},this),1000);a.follow({tumblelog:j.attr("data-tumblelog-name"),source:"FOLLOW_SOURCE_DASHBOARD_NOTIFICATION"},{success:function(){var k=d('[href="'+j.attr("data-tumblelog-name")+'"]');k.hide()},error:function(){a.Dialog.alert(l10n_str.ajax_error)}})},notification_photo_reply_image:function(h){var g=d(h.target);h.stopPropagation();h.preventDefault();g.closest(".photo_reply_image_container").toggleClass("expanded")},notification_block_hover:function(h){var g=this.$el.find(".notification_inner")}});a.Notifications=Backbone.View.extend({el:"#posts",events:{"click .notification_dismiss":"notification_dismiss"},initialize:function(){AfterAutoPaginationQueue.push(_.bind(this.updateViews,this));this.updateViews();this.$el.find(".notification .notification_text").each(function(h,j){var g=d(j);if(g.find("a").length>1){g.addClass("underline_links")}})},updateViews:function(){this.$el.find(".notification:not([data-view-exists])").each(function(j,k){var h=d(k);if(!h.attr("data-view-exists")){var g=new e({el:k});h.attr("data-view-exists",true)}})},notification_dismiss:function(k){k.stopPropagation();k.preventDefault();var h=d(k.target);var n=h.parents(".notification");var m=n.data("cookie");if(m){m=m.split("|");var j=m[0]||"";var l=m[1]||"";var o=parseInt(m[2],10)||null;if(j){set_cookie(j,l,o)}}var g=n.data("ajax");if(g){d.get(g)}n.css("display","none")}});var b=c.extend({events:{"click a.block":"ignore"},initialize:function(){this.tumblelog=this.$el.attr("data-tumblelog");a.Events.on("block_tumblelog",_.bind(this.tumblelog_block,this))},tumblelog_block:function(g){if(this.tumblelog==g.tumblelog){this.$el.addClass("ignored").addClass("no_active").addClass("no_hover").removeClass("can_ignore");this.$el.find(".block").remove();this.$el.unbind()}}});var f=b.extend({events:function(){return _.extend({},b.prototype.events,{click:"note_click",mouseenter:"note_hover",mouseleave:"note_out","mouseenter .avatar_frame":"note_img_hover","mouseleave .avatar_frame":"note_img_out","mouseleave .block":"note_img_out",mousedown:"note_down",mouseup:"note_up"})},note_down:function(h){var g=d(h.target);if(!g.is("a")&&!g.is("img")){this.$el.addClass("active")}},note_up:function(g){this.$el.removeClass("active")},note_hover:function(g){this.$el.addClass("hover")},note_out:function(g){this.$el.removeClass("hover").removeClass("active")},note_img_hover:function(g){this.$el.removeClass("hover")},note_img_out:function(g){this.$el.addClass("hover")},note_click:function(k){var h=d(k.target);var g=d(k.currentTarget);if(!h.is("a")&&!h.is("img")){k.stopPropagation();k.preventDefault();var j=g.find(".action").attr("data-post-url");window.open(j)}}});a.Notes=Backbone.View.extend({initialize:function(){},el:"#posts",loading_notes:false,events:{"click .post_control.reblog_count":"toggle_notes","click .more_notes_link_container":"more_notes"},create_note_views:function(g){g.find(".note:not([data-view-exists])").each(function(j,l){if(d(l).hasClass("reblog")){var k=new f({el:l})}else{var h=new b({el:l})}d(l).attr("data-view-exists",true)})},toggle_notes:function(g){g.preventDefault();if(this.loading_notes){return}this.loading_notes=true;$link=d(g.currentTarget);$post=$link.closest(".post");$note_outer_container=$post.find(".notes_outer_container");$note_container=$post.find(".notes_container");$notes=$post.find(".notes");$note_outer_container.show();$note_container.show();if($notes.is(":visible")){this.loading_notes=true;$notes.slideUp(300,_.bind(function(){this.loading_notes=false},this));return}if($link.attr("data-notes-loaded")){this.animate_in($notes);return}this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{},_.bind(function(h){$link.attr("data-notes-loaded",true);$notes.append(d(h).html());this.animate_in($notes);$note_outer_container.find(".notes_control").hide();this.create_note_views($notes)},this))},animate_in:function(g){this.loading_notes=true;g.slideDown(300,_.bind(function(){this.loading_notes=false},this))},more_notes:function(g){g.preventDefault();$more_container=d(g.currentTarget);$link=$more_container.find(".more_notes_link");$post=$more_container.closest(".post");$notes=$post.find(".notes");$loading=$post.find(".notes_loading").show();$link.hide();this.load_notes($post.attr("data-post-id"),$post.attr("data-tumblelog-key"),{from_id:$link.attr("data-next")},_.bind(function(h){$more_container.remove();$notes.find(".last_note").removeClass("last_note");$notes.append(d(h).html());this.create_note_views($notes)},this))},load_notes:function(g,l,j,k){var h="/dashboard/notes/"+g+"/"+l;if(j.from_id){h+="?from_c="+j.from_id}d.ajax(h).done(k)}})})(jQuery,Tumblr);(function(b,a){Tumblr.PostControls=Backbone.View.extend({initialize:function(){},el:"#posts",events:{"click .post_control.block_link":"ignore"},ignore:function(h){var g=b(h.currentTarget);var f=g.data("message");var d=g.data("tumblelog-name");var c=g.data("tumblelog-hash");Tumblr.Dialog.confirm(f,_.bind(function(){Tumblr.ignore({tumblelog:d});Tumblr.remove_tumblelog_posts(c)},this));return false}})})(jQuery,Tumblr);(function(c,a){var b={validate_tumblelog_name:function(d){return !(/^-|-$|[^\-a-z0-9]|tumblr/i).test(d)},has_starting_hyphen:function(d){return(/^-/).test(d)},has_ending_hyphen:function(d){return(/-$/).test(d)},clean_tumblelog_name:function(d){return d.toLowerCase().replace(/[^\-a-z0-9]/g,"-").replace(/^-+|-+$/g,"").replace(/tumblr/gi,"")}};a.BlogNameHelper=b})(jQuery,Tumblr);(function(c,a){var b={show:function(g){this.hide();var e="/send?lightbox=true";if(g&&g.href){e=g.href;e+=(e.indexOf("?")!==-1?"&":"?")+"lightbox=true"}var d=c('<div id="send_fan_mail_lightbox_loader"></div>');d.css({zIndex:4294967294,position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent url('/images/fan_mail/grid_bg_lightbox.png?709') center"});d.html('<div style="position:absolute; top:0; left:0; right:0; bottom:0; background:transparent center no-repeat url(\'/images/loading_big_fff_on_2e3133.gif?709\')"><img style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0.3;" src="/images/full_page_vignette.png?709"/></div>');c("body").append(d);var f=c('<iframe id="send_fan_mail_lightbox" scrolling="no" border="0" frameBorder="0"/>');f.attr("src",e);f.css({zIndex:4294967294,display:"none",position:"fixed",top:"0px",left:"0px",right:"0px",bottom:"0px",width:"100%",height:"100%",background:"transparent",overflow:"hidden"});f.load(function(){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("body").append(f)},hide:function(){c("#send_fan_mail_lightbox").hide().remove();c("#send_fan_mail_lightbox_loader").hide().remove()},sending:function(){c("#send_fan_mail_lightbox").hide().load(function(d){c("#send_fan_mail_lightbox_loader").hide();c("#send_fan_mail_lightbox").show()});c("#send_fan_mail_lightbox_loader").show()}};a.FanMail=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"mouseover .post_footer_links .tags":"mouseover","mousedown .post_footer_links .tags.draggable":"mousedown",mousemove:"mousemove"},initialize:function(){c("body").on("mouseup",_.bind(this.mouseup,this))},mouseover:function(h){var j=this.$(h.currentTarget);var g=j.parents(".post_footer_links");var f=g.width();var d=g.find(".source_url").width();this.max_width=f;if(d){this.max_width=f-d+8}if(j.width()>this.max_width){j.addClass("draggable")}h.preventDefault();h.stopPropagation()},mousedown:function(d){this.$dragging=this.$(d.currentTarget).addClass("dragging");this.mouse_down_left=d.offsetX||d.clientX-this.$(d.currentTarget).offset().left;d.preventDefault();d.stopPropagation()},mousemove:function(d){if(this.$dragging){this.$dragging.offset({left:d.pageX-this.mouse_down_left});d.preventDefault();d.stopPropagation()}},mouseup:function(g){if(this.$dragging==null){return}this.$dragging.removeClass("dragging");var f=parseInt(this.$dragging.css("left"),10);var d=this.$dragging.width();if(f>0||f<this.max_width-d){this.$dragging.animate({left:"0"})}this.$dragging=null;g.preventDefault();g.stopPropagation()}});b.DraggableTags=a})(jQuery,Tumblr);(function(e,c){function d(j,k,m){var g=(m==null)?e("#like_form_"+j):e("#"+m),h;if(!g.length){return}h=g.attr("action");if(typeof k=="undefined"){f(j)}else{k()}var l=e.ajax({url:h,data:g.serialize(),type:"post"});l.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)})}function f(k){var l=e("#like_button_"+k);var h=e("#like_form_"+k);var g=l.hasClass("already_like");var j=h.attr("action");e("#post_"+k).addClass("force_redraw");e("#post_"+k)[0].offsetHeight;e("#post_"+k).removeClass("force_redraw");var m=l.attr("data-root-post-id")||false;if(g){l.removeClass("already_like");h.attr("action",j.replace("/unlike","/like"));a(k);if(m){e(".like_root_"+m).removeClass("already_like")}}else{l.addClass("already_like");h.attr("action",j.replace("/like","/unlike"));b(k);if(m){e(".like_root_"+m).addClass("already_like")}}}function b(g){if(!(e("#notes_outer_container_"+g)[0]&&e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_less_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_more_"+g).show()}}function a(g){if(!(e("#show_notes_link_"+g)[0]&&e("#note_link_more_"+g)[0]&&e("#note_link_less_"+g)[0]&&e("#note_link_current_"+g)[0])){return false}e("#show_notes_link_"+g).show();if(e("#note_link_more_"+g).is(":visible")){e("#note_link_less_"+g).hide();e("#note_link_current_"+g).show();e("#note_link_more_"+g).hide()}else{e("#note_link_less_"+g).hide();e("#note_link_current_"+g).hide();e("#note_link_less_"+g).show()}}c.like_post=d;window.increment_note_count=b;window.decrement_note_count=a})(jQuery,Tumblr);(function(c,a){function b(e){c("#answer_form_"+e+" [name=redirect_to]").remove();var g="#answer_container_"+e,f=c(g)[0],m=f.children[0].className,l=c("#answer_text_"+e)[0],k=f.querySelector(".answer_avatar").outerHTML,j=c("#answer_form_"+e).serialize();if(!l.value){return}increment_note_count(e);c(f).addClass("updating");l.disabled=true;var h=c.ajax({url:"/answer",data:j,type:"post"});h.fail(function(){Tumblr.Dialog.alert(l10n_str.ajax_error)});h.done(function(n){setTimeout(function(){f.innerHTML='<div class="'+m+'">'+k+' <span class="answer_body">'+l.value.replace("<","&lt;")+"</span></div>";c(f).addClass("updated")},500)})}var d=Backbone.View.extend({el:"#posts",events:{"keyup .answer_form .answer_input":"keyup","submit .answer_form":"submit"},keyup:function(f){this.answer_input=c(f.currentTarget);this.answer_form=this.answer_input.closest(".answer_form");this.answer_length_label=this.answer_form.find(".answer_length");this.answer_input_value=this.answer_input.val();if(this.answer_input_value.length){this.answer_length_label.html(141-this.answer_input_value.length)}else{this.answer_length_label.html()}},submit:function(g){g.preventDefault();g.stopPropagation();var f=c(g.currentTarget).attr("data-post-id");if(f){b(f)}}});a.AnswerPost=d})(jQuery,Tumblr);(function(c,a){function b(e){var d=c(".post_tumblelog_"+e);d.fadeOut(500,function(){d.remove()})}a.remove_tumblelog_posts=b})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({events:{"click #logout_button":"logout",},logout:function(j){var h=b(j.currentTarget);var g=b("a",h);var f=h.data("message");var d=g.attr("href");if(_.isObject(Tumblr.Dialog)){Tumblr.Dialog.confirm(f,_.bind(function(){window.location.href=d}));return false}}});a.Header=c})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .photo_exif_flipper":"flip"},flip:function(d){d.preventDefault();d.stopPropagation();$el=c(d.currentTarget).parents(".flipcard");$el.addClass("initialized");_.defer(function(){$el.toggleClass("reveal_back")})}});b.ExifFlipcards=a})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"#posts",events:{"click .share_private":"toggle"},toggle:function(g){g.preventDefault();var d=c(g.currentTarget).parents("li").attr("data-post-id");var f=c("#share_"+d);f.toggle()}});b.SharePrivatePost=a})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"#dashboard_controls_open_blog .activity .count",initialize:function(g){if(this.$el.length){var d=this.$el.data("sparkline");if(typeof(this.$el.sparkline)=="function"){try{if(typeof(d)!=="object"){throw"sparkline is not an object"}if(_.max(d)===0){throw"sparkline has no interesting data"}this.$el.sparkline(d,{type:"line",lineColor:"#748696",fillColor:false,lineWidth:2,chartRangeMin:0,spotColor:false,minSpotColor:false,maxSpotColor:false,disableInteraction:true,width:"36px"});return}catch(f){}}this.$el.innerHTML="&#9658;";this.$el.addClass("sub_control link_arrow")}}});a.ActivitySparkline=c})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:"body",events:{"click #suggested_usernames .popover_menu_item":"handle_click"},handle_click:function(d){b("#signup_username").val(d.target.innerHTML).focus();b("#suggested_usernames_container").addClass("hidden")}});a.UsernameSuggester=c})(jQuery,Tumblr);jQuery(document).ready(function(a){Tumblr.Events=_.extend({},Backbone.Events);Tumblr.LinkButton.init();Tumblr.PhotoReply.init();Tumblr.UserMenus.init();Tumblr.ReblogFollowButtons.init();Tumblr.Panos.init();Tumblr.ReplyButtons.init();Tumblr.ReblogButtons.init();Tumblr.ImagePreloader.init();Tumblr.PlaceHolders.init();new Tumblr.Header({el:"#header"});new Tumblr.VideoThumbnails({el:a("#posts")});new Tumblr.PhotoThumbnails({el:a("#posts")});new Tumblr.BlogMenu();new Tumblr.DashboardLinkPops();new Tumblr.LanguageMenu({el:"#language_switcher"});new Tumblr.LegalPopover({el:"#popover_legal"});new Tumblr.ReportTumblelogView();new Tumblr.FullHeightNoPostsFound();new Tumblr.PushButtons();new Tumblr.Notifications();new Tumblr.DraggableTags();new Tumblr.ExifFlipcards();new Tumblr.AnswerPost();new Tumblr.SharePrivatePost();new Tumblr.Notes();new Tumblr.PostControls();new Tumblr.ActivitySparkline()});
(function(c,a){var b=function(d){if(!(this instanceof b)){return new b(d)}this.token=d.token||"";if(d.instance){this.instance=d.instance;this.$instance=c(d.instance)}this.hide_timeout=null;this.transition_class=null;this.$hide_timeout=c(this.hide_timeout);b.register(this)};b.prototype={create:function(e,f){f=f||{};var d=c(e);this.$instance=c("<div/>",{"data-token":this.token,"class":"plexi"});this.instance=this.$instance.get(0);if(f.cssClass){this.$instance.addClass(f.cssClass)}d.append(this.$instance)},show:function(d){d=d||{};this.transition_class=d.transition_class||false;if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}setTimeout(c.proxy(function(){clearTimeout(this.$hide_timeout);if(this.transition_class){this.$instance.addClass(this.transition_class)}this.$instance.addClass("show");if(!this.$instance.hasClass("instant")){this.$instance.addClass("active")}},this),1)},hide:function(){this.$instance.removeClass("show");this.$hide_timeout=setTimeout(c.proxy(function(){this.$instance.removeClass("show instant active fast");if(this.transition_class){this.$instance.removeClass(this.transition_class)}},this),50)}};b.instances=[];b.register=function(d){this.instances.push(d)};b.findByToken=function(f){var d;for(var e=0;e<this.instances.length;e++){if(this.instances[e].token==f){d=this.instances[e]}}if(!d){var h=c('.plexi[data-token="'+f+'"]');if(h.length){var g=new Tumblr.Plexi({instance:h,token:f});this.instances.push(g);return g}}return d};a.Plexi=b})(jQuery,Tumblr);
Tumblr.SortableView=Backbone.View.extend({initialize:function(a){this.items=this.$(".item");this.items.attr("draggable",true);this.items.find("a").attr("draggable",false);this.items.find("img").attr("draggable",false);this.callback=a.callback||function(){};this.placeholder=this.items.first().clone().empty().get(0)},events:{"dragstart .item":"on_dragstart","dragenter .item":"on_dragenter","dragover .item":"on_dragover","drop .item":"on_drop","dragend .item":"on_dragend"},on_dragstart:function(a){a.originalEvent.dataTransfer.effectAllowed="move";try{a.originalEvent.dataTransfer.setData("text/html","foo")}catch(a){}this.dragged=a.currentTarget;this.$(this.dragged).addClass("sortable-dragging");a.stopPropagation()},on_dragenter:function(d){var c=d.currentTarget;if(c==this.placeholder){return false}this.$(this.dragged).hide();var a=this.$(c).index(".item");var b=this.$(this.placeholder).index(".item");if(b<a){this.$(c).after(this.placeholder)}else{this.$(c).before(this.placeholder)}this.last_droppable=c;d.stopPropagation()},on_dragover:function(a){a.stopPropagation();return false},on_drop:function(a){a.stopPropagation();this.$(this.dragged).insertAfter(this.placeholder);return false},on_dragend:function(a){this.$(this.dragged).removeClass("sortable-dragging").show();this.$(this.placeholder).detach();this.dragged=null;a.stopPropagation();this.callback(this)},sequence:function(){var a=this.$(".item").toArray();return _.uniq(_.pluck(a,"id"))}});
(function(c,b){var a=Backbone.View.extend({el:"#toaster",debug_mode:false,defaults:{max_toast:5,toast_padding:623,away_speed:350,close_buttons:false,queue_heartbeat:1000,pause_on_hover:true,only_when_footer_hidden:true},default_toast:{id:null,type:"text",on_create:false,on_destory:false,animation:true,message:" ",img1:{url:null,badge:" ",is_link:false,href:"#"},img2:{url:null,badge:" ",is_link:false,href:"#"},icon:{type:"regular",href:"#"},notification:{object:null,title:"",body:"",icon:false},is_link:false,href:"#",position_class:"toast_only",close:false,expires:7023,in_queue:false},toast_count:0,toasts:{},desk_notify_support:false,page_visible:true,transition_support:true,is_ipad:false,toast_ids:[],queue_ids:[],paused:false,t_paused:null,unpause_expires:2000,t_queue_heartbeat:null,toast_padding_mult:0,push_lock:false,time_until_lock:50,t_push_lock:null,footer_overlaps:false,templates:{text:'<li id="toast_{{id}}" class="toast toast_text {{position_class}}"><span class="toast_border"><span class="toast_outer"><span class="toast_inner">{{#is_link}}<a class="anchor" href="{{{href}}}" target="blank"></a>{{/is_link}}<span class="txt">{{{message}}}</span></span></span>{{#close}}<span class="close"></span>{{/close}}</span></li>',image_text:'<li id="toast_{{id}}" class="toast toast_image_text {{position_class}}"><span class="toast_border"><span class="toast_outer"><span class="toast_inner">{{#is_link}}<a class="anchor" href="{{{href}}}" target="blank"></a>{{/is_link}}<span class="frame box_left {{{img1.badge}}}">{{#img1.is_link}}<a href="{{{img1.href}}}" target="_blank">{{/img1.is_link}}<img src="{{{img1.url}}}" width="28" height="28" />{{#img1.is_link}}</a>{{/img1.is_link}}</span><span class="txt">{{{message}}}</span></span></span>{{#close}}<span class="close"></span>{{/close}}</span></li>',image_text_image:'<li id="toast_{{id}}" class="toast toast_image_text_image {{position_class}}"><span class="toast_border"><span class="toast_outer"><span class="toast_inner">{{#is_link}}<a class="anchor" href="{{{href}}}" target="blank"></a>{{/is_link}}<span class="frame box_left {{{img1.badge}}}">{{#img1.is_link}}<a href="{{{img1.href}}}" target="_blank">{{/img1.is_link}}<img src="{{{img1.url}}}" width="28" height="28" />{{#img1.is_link}}</a>{{/img1.is_link}}</span><span class="txt">{{{message}}}</span><span class="frame box_right {{{img2.badge}}}">{{#img2.is_link}}<a href="{{{img2.href}}}" target="_blank">{{/img2.is_link}}<img src="{{{img2.url}}}" width="28" height="28" />{{#img2.is_link}}</a>{{/img2.is_link}}</span></span></span>{{#close}}<span class="close"></span>{{/close}}</span></li>',image_text_icon:'<li id="toast_{{id}}" class="toast toast_image_text_icon {{position_class}}"><span class="toast_border"><span class="toast_outer"><span class="toast_inner">{{#is_link}}<a class="anchor" href="{{{href}}}" target="blank"></a>{{/is_link}}<span class="frame box_left {{{img1.badge}}}">{{#img1.is_link}}<a href="{{{img1.href}}}" target="_blank">{{/img1.is_link}}<img src="{{{img1.url}}}" width="28" height="28" />{{#img1.is_link}}</a>{{/img1.is_link}}</span><span class="txt">{{{message}}}</span><a class="frame box_right icon {{{icon.type}}}" href="{{{icon.href}}}"><span class="inside icon {{{icon.type}}}"></span></a></span></span>{{#close}}<span class="close"></span>{{/close}}</span></li>'},events:{mouseover:"hover_in",mouseout:"hover_out"},initialize:function(d){this.options=_.extend(this.defaults,this.options);this.debug_order=0;if(this.options.only_when_footer_hidden){this._sidebar_hide_helpers()}if(window.webkitNotifications||window.Notification){this.desk_notify_support=true}c('<style type="text/css"> #toaster .toast .toast_border { background-color: '+c("body").css("background-color")+" !important; } </style>").appendTo("head");var e=document.createElement("div").style;this.transition_support="transition" in e||"WebkitTransition" in e||"MozTransition" in e||"msTransition" in e||"OTransition" in e;this.is_ipad=(navigator.userAgent.match(/iPad/i)===null)?false:true;this._queue_heartbeat();this._add_visibility_helper();return this},debug:function(d){this.debug_mode=d;console.log("Debug mode is now "+(d?"on":"off")+".")},tumblrbot:function(e){var d={type:"image_text",message:"<strong>"+e+"</strong>",is_link:false,href:"#",img1:{url:"/images/toast_tumblrbot.png",is_link:true,href:"http://tumblrbot.tumblr.com/"}};this.add_toast(d)},can_display_toasts:function(){$window=c(window);if(c(window).innerHeight()<400||c(window).innerWidth()<960){return false}return this.page_visible},footer_will_overlap:function(){if(this.options.only_when_footer_hidden){return this.footer_overlaps}return false},is_screen_full:function(){return(this.toast_ids.length>=this.options.max_toast)},is_screen_empty:function(){return(this.toast_ids.length===0)},is_queue_empty:function(){return(this.queue_ids.length===0)},_queue_heartbeat:function(){clearTimeout(this.t_queue_heartbeat);var d=function(){if(this.is_queue_empty()||!this.is_screen_empty()){this._queue_heartbeat()}else{this.push_lock=true;var g=this.queue_ids.length;this.toast_padding_mult=0;for(var e=0;e<=g;e++){if((e<this.options.max_toast)&&(e<g)){var f=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(f);this._delayed_add_toast_to_dom(f,(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++}else{break}}this._queue_heartbeat()}};this.t_queue_heartbeat=setTimeout(_.bind(d,this),this.options.queue_heartbeat)},_delayed_add_toast_to_dom:function(f,d){var e=setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),d)},_add_next_queue_item:function(){if(!this.is_queue_empty()){var d=this.queue_ids[0];this.queue_ids.splice(0,1);this.toast_ids.push(d);this._add_toast_to_dom(d);this._queue_heartbeat()}},add_toast:function(d){var e={};jQuery.extend(e,this.default_toast,d);this._toast(e)},_toast:function(e){var f=this.toast_count++;var d=(this.push_lock||!this.is_queue_empty()||this.is_screen_full());if(d){this.queue_ids.push(f)}else{if(this.toast_ids.length===0){this.toast_padding_mult=0}this.toast_ids.push(f)}e=jQuery.extend(e,{id:f});var g=this._get_toast_template(e.type);$toast=c(g(e));this.toasts[f]={id:f,$el:$toast,options:e,in_queue:d,t:null};if(!d){setTimeout(_.bind(function(){this._add_toast_to_dom(f)},this),(this.toast_padding_mult*this.options.toast_padding));this.toast_padding_mult++;clearTimeout(this.t_push_lock);this.t_push_lock=setTimeout(_.bind(function(){this.push_lock=true;this.toast_padding_mult=0},this),this.time_until_lock)}return f},_add_toast_to_dom:function(d){if(this.footer_will_overlap()||!this.can_display_toasts()||typeof this.toasts[d]==="undefined"){this._nuke_toast(d);return}this.toasts[d].t=this._set_toast_timeout(d);this.$el.append(this.toasts[d].$el);if(this.transition_support){setTimeout(_.bind(function(){this._update_position_helpers()},this),200)}else{this._update_position_helpers()}c("#toast_"+d).addClass("animation");setTimeout(function(){c("#toast_"+d).addClass("slide_open")},50);this._measure_helpers(d);this._click_helpers(d)},_sidebar_hide_helpers:function(){var e=c("#right_column");if(e.length!==1){return}var f=e.outerWidth();var d=e.outerHeight();setInterval(_.bind(function(){var p=c(window).innerHeight();var n=window.pageYOffset;var m=n+p;var o=e.offset();var k=o.top;var h=o.top+d;if((n+(p/2.5))<h){this.footer_overlaps=true;for(var l=this.toast_ids.length-1;l>=0;l--){this.pop_toast(this.toast_ids[l])}for(var g=this.queue_ids.length-1;g>=0;g--){this._nuke_toast(this.queue_ids[g])}this._queue_heartbeat()}else{this.footer_overlaps=false}},this),800)},_measure_helpers:function(d){$txt=c("#toast_"+d+" .txt");if($txt.length>0){var e=$txt.height();if(e>0&&e<=20){$txt.addClass("nowrap")}}},_click_helpers:function(d){$anchor=c("#toast_"+d+" .anchor");if($anchor.length>0){$anchor.on("mousedown",function(){c("#toast_"+d).addClass("toast_active")});$anchor.on("click, mouseup, mouseleave",function(){c("#toast_"+d).removeClass("toast_active")})}},reset_all_timeouts:function(){c.each(this_toast_ids,_.bind(function(e,d){this._set_toast_timeout(d)},this))},set_all_timeouts:function(d){c.each(this.toast_ids,_.bind(function(f,e){this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},hover_in:function(){if(this.is_ipad){return}clearTimeout(this.t_paused);if(!this.paused){this._clear_all_timeouts()}this.paused=true;this.$el.addClass("hover")},hover_out:function(){if(this.is_ipad){return}this.t_paused=setTimeout(_.bind(function(){this.paused=false;this.$el.removeClass("hover");c.each(this.toast_ids,_.bind(function(f,e){var d=this.unpause_expires+(f*this.options.toast_padding);this.toasts[e].t=this._set_custom_toast_timeout(e,d)},this))},this),150)},pop_toast:function(e){if(this.debug_mode||typeof this.toasts[e]==="undefined"){return}clearTimeout(this.toasts[e].t);var d=jQuery.inArray(e,this.toast_ids);this.toast_ids.splice(d,1);delete this.toasts[e];this._freeze_toast(e);this._animate_away(e);this._update_position_helpers();if(this.can_display_toasts()&&!this.footer_will_overlap()&&(this.toast_ids.length==(this.options.max_toast-1))){this._add_next_queue_item()}else{this._queue_heartbeat()}clearTimeout(this.t_push_lock);if(this.is_screen_empty()){this.push_lock=false}},_nuke_all_toast:function(){c.each(this.toasts,_.bind(function(e,d){this._nuke_toast(d.id)},this));this._queue_heartbeat()},_nuke_toast:function(e){var d=jQuery.inArray(e,this.toast_ids);if(d!==-1){this.toast_ids.splice(d,1)}var f=jQuery.inArray(e,this.queue_ids);if(f!==-1){this.queue_ids.splice(f,1)}if(d!==-1||f!==-1){clearTimeout(this.toasts[e].t);delete this.toasts[e];var g=c("#toast_"+e);if(g.length>0){g.remove()}}this._update_position_helpers();return},_clear_all_timeouts:function(){c.each(this.toast_ids,_.bind(function(e,d){clearTimeout(this.toasts[d].t)},this))},_animate_away:function(e){var d=c("#toast_"+e);if(d.length===0){return}c("#toast_"+e).addClass("fade_out");setTimeout(function(){c("#toast_"+e).remove()},(this.options.away_speed+15))},_freeze_toast:function(d){var l=c("#toast_"+d);if(l.length===0){return}var e=l.position();var j=c("#toaster").height();var h=l.outerHeight();var i=l.width();var k=l.height();var g=e.top;var f=e.left;l.css({position:"absolute",bottom:(j-h)+"px",left:f+"px",width:i,height:k})},_get_toast_template:function(d){return Handlebars.compile(this.templates[d])},_toast_expire:function(d){this.pop_toast(d)},_add_visibility_helper:function(){var g,h,f={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(g in f){if(f.hasOwnProperty(g)&&g in document){h=f[g];break}}if(h){document.addEventListener(h,e)}else{if(c.browser.msie&&(parseInt(c.browser.version,10)<=9)){document.onfocusin=document.onfocusout=e}else{window.onfocus=window.onblur=e}}var d=this;function e(j){var i=document.body;j=j||window.event;if(j.type=="focus"||j.type=="focusin"){d.page_visible=true}else{if(j.type=="blur"||j.type=="focusout"){d.page_visible=false}else{d.page_visible=this[g]?false:true}}}},_set_toast_timeout:function(d){if(typeof this.toasts[d]!="object"){return null}return this._set_custom_toast_timeout(d,this.toasts[d].options.expires)},_set_custom_toast_timeout:function(f,d){if(typeof this.toasts[f]!="object"){return null}clearTimeout(this.toasts[f].t);var e=function(){this._toast_expire(f)};return setTimeout(_.bind(e,this),d)},_update_position_helpers:function(){var f=0;var d=0;for(var e=this.toast_ids.length-1;e>=0;e--){if(c("#toast_"+this.toast_ids[e]).is(":visible")){d++}}c.each(this.toast_ids,function(h,g){$this_toast=c("#toast_"+g);if($this_toast.length>0){$this_toast.removeClass("toast_only toast_top toast_bottom toast_middle");if(d==1){$this_toast.addClass("toast_only")}else{if(f===0){$this_toast.addClass("toast_top")}else{if(f===(d-1)){$this_toast.addClass("toast_bottom")}else{$this_toast.addClass("toast_middle")}}}f++}})}});b.Toaster=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({translations:{},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},_helper_icon_target_type:function(d){return d.target_post_type},_helper_media_url:function(d){return d.media_url},_helper_from_tumblelog_link:function(d){return'<a href="'+d.from_tumblelog_url+'" target="_blank">'+d.from_tumblelog_name+"</a>"},_helper_other_user_badge:function(d){var e=d.type;if(e==="answer"){e="reply"}if(e==="photo_reply"){e="reply"}return e},_helper_blockquote:function(d){return"<blockquote>"+d+"</blockquote>"},_helper_is_empty:function(d){return(d==="")},_helper_has_reply:function(d){if((typeof d.quote_summary=="string")&&!this._helper_is_empty(d.quote_summary)){return true}else{return false}},_helper_summary_txt:function(d){if((typeof d.summary=="string")&&!this._helper_is_empty(d.summary)){return": <em>"+d.summary+"</em>"}else{return""}},_helper_post_noun:function(d){return d.noun_type=="question"?"post":d.noun_type},_base_other_user_action:function(d){var g={img1:{url:d.from_tumblelog_avatar,badge:this._helper_other_user_badge(d),is_link:true,href:d.from_tumblelog_url}};var f={};if(d.type=="follower"){f={type:"image_text"}}else{if(d.type=="photo_reply"){f={type:"image_text_image",img2:{url:d.photo_reply_url,is_link:true,href:d.target_post_url}}}else{if(d.target_post_type=="photo"){f={type:"image_text_image",img2:{url:this._helper_media_url(d),is_link:true,href:d.target_post_url}}}else{f={type:"image_text_icon",icon:{type:this._helper_icon_target_type(d),href:d.target_post_url}}}}}var e={};jQuery.extend(e,g,f);return e},notification_center_convert:function(f,d){var e={type:"image_text",message:"<strong>"+f+"</strong>",is_link:true,href:d.url,img1:{url:d.tumblelog.avatar,is_link:true,href:d.tumblelog.url}};return e},like:function(d){var e=this._base_other_user_action(d);var g="%1$s liked your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reblog:function(d){var e=this._base_other_user_action(d);var g="%1$s reblogged your "+this._helper_post_noun(d);g+=this._helper_has_reply(d)?" and added:":"";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));if(this._helper_has_reply(d)){g+=this._helper_blockquote(d.quote_summary)}var f={message:g,is_link:true,href:d.new_post_url};jQuery.extend(f,e);return f},answer:function(d){var e=this._base_other_user_action(d);var g="%1$s answered your question";g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.answer_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d)+this._helper_blockquote(d.reply_text);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},photo_reply:function(d){var e=this._base_other_user_action(d);var g="%1$s replied to your "+this._helper_post_noun(d);g=this.__(g).replace("%1$s",this._helper_from_tumblelog_link(d));g+=this._helper_summary_txt(d);var f={message:g,is_link:true,href:d.target_post_url};jQuery.extend(f,e);return f},follower:function(d){var e=this._base_other_user_action(d);var g="%1$s started following %2$s";if(this.has("primary_tumblelog")){if(this.get("primary_tumblelog")==d.target_tumblelog_name){g="%1$s started following you"}}g=this.__(g);g=g.replace("%1$s",this._helper_from_tumblelog_link(d));g=g.replace("%2$s",d.target_tumblelog_name);var f={message:g,is_link:true,href:d.from_tumblelog_url};jQuery.extend(f,e);return f}});a.ToastKit=new b()})(jQuery,Tumblr);(function(c,a){var b=Backbone.Model.extend({enabled:true,debug_mode:false,poll_route:"/svc/poll",is_sleeping:false,total_sleep_heartbeats:0,total_empty_heatbeats:0,hash_history:{},use_hash_history:true,visibility_check:2000,i_visibility_check:null,is_window_visible:true,defaults:{toast_mode:0,primary_tumblelog:false,start_timestamp:false,check_posts:false,check_inbox:false,current_speed:1,initial_delay:0,poll_speeds:{0:10000,1:20000,2:30000,3:50000,4:60000,5:80000},sleep_speed:300000,sleep_max:18,slowdown_beats:10,poll_padding:30000},use_timestamps:true,last_timestamp:false,t_heartbeat:null,is_first_heartbeat:true,poll_lock:false,initialize:function(d){this.options=d;Tumblr.ToastKit.set("primary_tumblelog",d.primary_tumblelog);if(typeof Tumblr.Cookie==="object"){var e=Tumblr.Cookie.get("last_toast");if(e){e=parseInt(e,10);if(e!==0&&e>this.options.start_timestamp){this.options.start_timestamp=e}}}if(this.options.start_timestamp){this.update_timestamp(this.options.start_timestamp)}if(this.options.toast_mode===0){this.options.current_speed=3}this._set_heartbeat();this.i_visibility_check=setInterval(_.bind(this._check_visibility,this),this.visibility_check)},kill_switch:function(){this.enabled=false;this.poll_lock=true;clearTimeout(this.t_heartbeat)},debug_endless:function(){this.use_timestamps=false;this.use_hash_history=false;this.options.current_speed=0;this.heartbeat();return true},heartbeat:function(){clearTimeout(this.t_heartbeat);if(!this.enabled){return false}if(this.total_empty_heatbeats>=this.options.slowdown_beats){this.total_empty_heatbeats=0;this.poll_slower()}if(this.is_sleeping){this.total_sleep_heartbeats++;if(this.total_sleep_heartbeats<=this.options.sleep_max){this.poll()}else{}}else{this.poll()}this._set_heartbeat();return},get_next_heartbeat:function(){return this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed]},_check_visibility:function(){var d=Tumblr.Toaster.can_display_toasts();if(this.is_window_visible&&!d){this.sleep()}if(!this.is_window_visible&&d){this.wakeup()}this.is_window_visible=d},_set_heartbeat:function(){var d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.current_speed];if(this.is_first_heartbeat){this.is_first_heartbeat=false;d=this.is_sleeping?this.options.sleep_speed:this.options.poll_speeds[this.options.initial_delay]}this.t_heartbeat=setTimeout(_.bind(function(){this.heartbeat()},this),d)},poll_faster:function(){var d=this.options.current_speed;if((d-1)>=0){this.options.current_speed--}},poll_slower:function(){var d=this.options.current_speed;var e=_.size(this.options.poll_speeds);if((d+1)<e){this.options.current_speed++}},sleep:function(){this.is_sleeping=true;this.total_sleep_heartbeats=0},wakeup:function(){this.is_sleeping=false;this.total_sleep_heartbeats=0;this._set_heartbeat()},poll:function(){if(this.poll_lock){return}this.poll_lock=true;var g={notifications_next:(this.get_next_heartbeat()+this.options.poll_padding),magick:Math.floor(Math.random()*100001)};if(this.options.toast_mode!==0){var d={notifications:true};jQuery.extend(g,d)}if(this.use_timestamps&&this.last_timestamp&&!this.debug_mode){jQuery.extend(g,{from:this.last_timestamp})}if(this.options.check_posts){var h={unread:true};jQuery.extend(g,h)}if(this.options.check_inbox){var e={inbox:true};jQuery.extend(g,e)}var f=c.ajax({url:this.poll_route,type:"GET",data:g});f.done(_.bind(function(i){this.poll_lock=false;if(this.options.toast_mode!==0){this.parse_notifications(i)}if(this.options.check_posts){this.parse_unread(i)}if(this.options.check_inbox){this.parse_inbox(i)}if(typeof i.next_from!=="undefined"){this.update_timestamp(i.next_from)}},this));f.fail(_.bind(function(){this.kill_switch()},this))},update_timestamp:function(d){d=parseInt(d,10);if(this.last_timestamp===false||d>this.last_timestamp){this.last_timestamp=d;if(typeof Tumblr.Cookie==="object"){Tumblr.Cookie.set("last_toast",d,365*24*60*60)}}},parse_unread:function(f){if(typeof f.unread!=="number"){return}var e=f.unread;if(e){var d=e;if(e>=100){this.options.check_posts=false;d="100+"}if(e>0){document.title="("+d+") "+(document.title.indexOf(")")!=-1?document.title.split(")")[1]:document.title);c(".new_post_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}}},parse_inbox:function(f){if(typeof f.inbox!=="number"){return}var e=f.inbox;if(e){var d=e;if(e>0){c(".inbox_notice_container").each(_.bind(function(h,g){var j=c(g);j.find(".tab_notice_value").text(d);j.show()},this))}else{c(".inbox_notice_container").hide()}}},parse_notifications:function(e){if(typeof e.notifications!=="object"){return}var d=e.notifications;if(d.length>0){c(d).each(_.bind(function(h,f){var j=false;if(this.use_hash_history){var k=f.hash;if(k in this.hash_history){this.hash_history[k]++;j=true}else{this.hash_history[k]=1}}if(!j&&this.options.toast_mode!==0){var g=false;switch(f.type){case"like":g=Tumblr.ToastKit.like(f);break;case"reblog":g=Tumblr.ToastKit.reblog(f);break;case"answer":g=Tumblr.ToastKit.answer(f);break;case"reply":g=Tumblr.ToastKit.reply(f);break;case"photo_reply":g=Tumblr.ToastKit.photo_reply(f);break;case"follower":g=Tumblr.ToastKit.follower(f);break}if(g){Tumblr.Toaster.add_toast(g)}}},this));this.poll_faster();this.total_empty_heatbeats=0}else{this.total_empty_heatbeats++}}});a.Thoth=b})(jQuery,Tumblr);
/*!
 * Tumblr.Dialog
 * A highly customizable queuing dialog system with easy replacements for alert() and prompt()
 * Features:
 *   - Add custom templates
 *   - Tab between buttons + enter/escape support
 *   - Default buttons tied to keys
 *   - Multiple dialogs queue for user
 *   - Multiple button styles
 *   - Callbacks everywhere
 */
(function(c,b){var a=Backbone.View.extend({el:".ui_dialog",translations:{},defaults:{},default_templates:{dialog:'<div class="ui_dialog <%= type %>"><span class="text"><%= text %></span><div class="buttons"><%= buttons_html %></div></div>',button:'<button class="ui_button btn_<%= btn_id %> chrome <%= btn_class %>" data-btn-id="<%= btn_id %>"><span><%= text %></span></button>'},events:{"click .ui_button":"button_click"},default_dialog:{text:"",type:"default",visible_glass:true,close_by_space:true,animate:true,animate_in:{dialog_el:".ui_dialog",dialog_class:"add_animation fadeIn"},on_close:function(){},on_open:function(){}},initialize:function(d){this.options=_.extend(this.defaults,this.options);this.templates=this.default_templates;this.is_visible=false;this.dialog_queue_order=[];this.dialog_queue={};this.queue_counter=0;this.current_dialog=false;this.current_dialog_id=0;this.uid=0;this._init_click_lock();this._setup_keys()},add_translations:function(d){jQuery.extend(this.translations,d)},unset_translations:function(){this.translations={}},__:function(d){return this.translations[d]||d},dialog:function(d){if(!_.isObject(d)){return false}return this._dialog(d)},confirm:function(h,g,i,e,d){if(_.isUndefined(e)){e=this.__("Ok")}if(_.isUndefined(d)){d=this.__("Cancel")}if(!_.isFunction(g)){g=function(){}}if(!_.isFunction(i)){i=function(){}}var f={text:h,type:"confirm",visible_glass:true,escape_button:1,buttons:{0:{text:e,selected:true,btn_class:"blue",close:true,callback:((_.isFunction(g))?g:function(){})},1:{text:d,close:true,callback:((_.isFunction(i))?i:function(){})}}};return this._dialog(f)},alert:function(g,f,d){if(_.isUndefined(d)){d=this.__("Ok")}if(!_.isFunction(f)){f=function(){}}var e={text:g,type:"alert",visible_glass:true,escape_button:0,buttons:{0:{text:d,selected:true,btn_class:"blue",close:true,callback:((_.isFunction(f))?f:function(){})}}};return this._dialog(e)},button_click:function(h){var g=c(h.currentTarget);var f=g.data("btn-id");if(_.isUndefined(this.current_dialog.buttons[f])){return false}var d=this.current_dialog.buttons[f];if((!_.isUndefined(d.close)&&d.close)||_.isUndefined(d.close)){this.close()}if(_.isFunction(d.callback)){d.callback()}},is_active:function(d){if((this.current_dialog===false)||(this.current_dialog.uid!=d)){return false}return true},close:function(f){if(this.current_dialog===false){return false}if(_.isUndefined(f)){f=false}if(f!==false&&this.current_dialog.uid!=f){return false}this.$dialog_lock.hide();c(".ui_dialog_pos").remove();this.is_visible=false;if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.resume()}if(_.isFunction(this.current_dialog.on_close)){this.current_dialog.on_close()}this.current_dialog=false;if(this.dialog_queue_order.length>0){var d=this.dialog_queue_order.shift();var e=this.dialog_queue[d];delete this.dialog_queue[d];this._dialog(e)}},_tab:function(g){$tab_containers=this.$el.find(".buttons .tab_frame");$tab_focus=$tab_containers.filter(".focus");var h=$tab_containers.index($tab_focus);var f=$tab_containers.length;var d=false;if((h+1)<f){d=h+1}else{d=0}$tab_focus.removeClass("focus");$tab_containers.eq(d).addClass("focus")},_select:function(d){$button_focus=$tab_containers=this.$el.find(".buttons .tab_frame.focus");if($button_focus.length===1){$button_focus.find(".ui_button").click()}},_escape:function(d){if(_.isUndefined(this.current_dialog.escape_button)){return}var f=this.$el.find(".btn_"+this.current_dialog.escape_button);if(f.length){f.click()}},_dialog:function(e){if(_.isUndefined(e.uid)){e.uid=this._get_uid()}if(this.current_dialog!==false){this.dialog_queue_order.push(this.queue_counter);this.dialog_queue[this.queue_counter]=e;this.queue_counter++;return e.uid}_.defaults(e,this.default_dialog);var f=this._build_buttons(e.buttons);_.extend(e,{buttons_html:f});var d=false;if(_.isObject(e.templates)){d=_.template(e.templates.dialog)}else{d=_.template(this.templates.dialog)}var g=d(e);this.$dialog_lock.show();if(!_.isUndefined(e.visible_glass)){if(e.visible_glass){this.$dialog_lock.addClass("opaque")}}else{this.$dialog_lock.removeClass("opaque")}this.current_dialog_id=e.uid;this.current_dialog=e;c("body").append('<div id="dialog_'+this.current_dialog_id+'" class="ui_dialog_pos">'+g+"</div>");this.$el=c("#dialog_"+this.current_dialog_id);this.is_visible=true;if(e.animate&&_.isObject(e.animate_in)&&this.$el.find(e.animate_in.dialog_el).length){this.$el.find(e.animate_in.dialog_el).addClass(e.animate_in.dialog_class)}this._focus();if(_.isObject(Tumblr.KeyCommands)){Tumblr.KeyCommands.suspend()}if(_.isFunction(e.on_open)){e.on_open()}this.el=this.$el[0];this.delegateEvents();return e.uid},_button:function(h,f,i,g){var e=_.template(this.templates.button);if(_.isObject(this.current_dialog.templates)){e=this.current_dialog.templates.button}if(g){f+=" default-pulse"}var d=e({btn_class:f,text:h,btn_id:((!_.isUndefined(i))?i:"")});d='<div class="tab_frame">'+d+"</div>";return d},_focus:function(){if(!this.current_dialog){return false}for(var e in this.current_dialog.buttons){var d=this.current_dialog.buttons[e];if(!_.isUndefined(d.selected)&&d.selected){$button=this.$el.find(".btn_"+e);if($button.length>0){$button.parent().addClass("focus")}}}},_setup_keys:function(){c(document).on("keydown",_.bind(function(g){var f=(g.ctrlKey||g.shiftKey||g.metaKey);if(!this.is_visible||f){return}var d=g.keyCode||g.which;if(d===9){g.preventDefault();this._tab(g)}if(d===13||((d===32)&&this.current_dialog.close_by_space)){g.preventDefault();this._select(g)}if(d===27){g.preventDefault();this._escape(g)}},this))},_build_buttons:function(k){if(!_.isObject(k)){return""}var h=0;for(var g in k){if(k.hasOwnProperty(g)){h++}}var f="";for(var e=0;e<h;e++){if(_.isUndefined(k[e])){continue}var l=(!_.isUndefined(k[e].text))?k[e].text:"";var d=(!_.isUndefined(k[e].btn_class))?k[e].btn_class:"";var j=(!_.isUndefined(k[e].selected))?k[e].selected:false;f+=this._button(l,d,e,j)}return f},_init_click_lock:function(){this.$dialog_lock=false;c(_.bind(function(){c("body").prepend('<div class="ui_dialog_lock"></div>');this.$dialog_lock=c("body > .ui_dialog_lock")},this))},_get_uid:function(){return this.uid++}});b.Dialog=new a()})(jQuery,Tumblr);
(function(a){Tumblr.PhotoReply=Backbone.View.extend({options:{post_id:undefined,mb_limit:10,status:"inactive",progress:0,image:undefined},initialize:function(b){this.post_id=this.options.post_id||this.$el.data("postId");this.status=this.options.status||"inactive";this.progress=this.options.progress||0;this.disabled=true;this.$post=this.$el.closest(".post");this.$container=this.$post.find(".photo_reply_container");this.$icon=this.$(".photo_reply_icon");this.$progress=this.$(".photo_reply_icon_progress");this.$image=this.$(".photo_reply_image");this.$icon.addClass("show_progress_bar");this.__proxy_functions();if(this.status!=="has_image"){this.enable_dropzone()}this.$el.data("tumblr_photoreply",this);this.constructor.register(this)},__proxy_functions:function(){this._show_image=a.proxy(this.show_image,this);this._hide_image=a.proxy(this.hide_image,this);this._upload_file_add=a.proxy(this.upload_file_add,this);this._upload_submit=a.proxy(this.upload_submit,this);this._upload_progress=a.proxy(this.upload_progress,this);this._upload_end=a.proxy(this.upload_end,this);this._upload_cancel=a.proxy(this.upload_cancel,this);this._upload_stop=a.proxy(this.upload_stop,this);this._dragenter=a.proxy(this.dragenter,this);this._dragleave=a.proxy(this.dragleave,this);this._drop=a.proxy(this.drop,this)},attach_image:function(c){var b={width:"",height:"",src:""};if(typeof c==="string"){b.src=c}else{if(c.url){b.src=c.url}if(c.height){b.height=c.height}if(c.width){b.width=c.width}}this.$container.addClass("fileupload");if(!(this.$image&&this.$image.length)){this.$image=a('<img src="" alt="" class="photo_reply_image"/>');this.$image.appendTo(this.$container).on("load",this._show_image)}this.$image.attr(b)},show_image:function(){if(!(this.$image&&this.$image.length)){return false}this.$container.css("max-height",this.$image.get(0).naturalHeight).addClass("has_photo_reply")},hide_image:function(){this.$container.removeClass("has_photo_reply").css("max-height","")},enable_dropzone:function(){this.disabled=false;this.$post.on({dragenter:this._dragenter,dragleave:this._dragleave,drop:this._drop});this.$post.find("*").on("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').on("click",this._upload_cancel).attr("disabled",false);this.create_uploader({form:this.$el,dropzone:this.$post})},disable_dropzone:function(){this.disabled=true;this.$post.off({dragenter:this.dragenter,dragleave:this.dragleave,drop:this.drop});this.$post.removeClass("photo_reply_hover");this.$post.find("*").off("dragenter dragover",this.cancel_event);this.$el.find('input[type="file"]').off("click",this._upload_cancel).attr("disabled",true)},create_uploader:function(b){this.destroy_uploader();this.$uploader=a(b.form).fileupload({dataType:"json",maxNumberOfFiles:1,dropZone:b.dropzone,pasteZone:null,add:this._upload_file_add,submit:this._upload_submit,send:this._upload_start,progress:this._upload_progress,always:this._upload_end,stop:this._upload_stop})},destroy_uploader:function(){if(this.$uploader&&this.$uploader.data("fileupload")){a(this.$uploader).fileupload("destroy")}},dragenter:function(b){this.$post.addClass("photo_reply_hover")},dragleave:function(b){if(this.event_in_bounds(b)){return false}this.$post.removeClass("photo_reply_hover")},drop:function(b){this.$post.removeClass("photo_reply_hover")},show_coddled_progress:function(b){return this.show_progress(b,20)},show_progress:function(b,c){if(c){b=Math.max(c,Math.min(b,100-c))}this.$progress.css("width",b+"%");return b},upload_submit:function(f,d){if(this.disabled){return false}if(this.status!=="inactive"){return false}var b=!!d.files.length;a.each(d.files,a.proxy(function(e,g){if(g.size&&g.size>this.options.mb_limit*1048576){b=false}},this));if(!b){var c=l10n_str.ajax_error;if(l10n_str.over_max_file_size_mb){c=l10n_str.over_max_file_size_mb.replace("%1$s",this.options.mb_limit)}alert(c);return false}},upload_file_add:function(c,b){this.jqXHR=b.submit()},upload_start:function(c,b){this.status="uploading";this.progress=0;this.show_progress(this.progress)},upload_progress:function(c,b){this.progress=parseInt(b.loaded/b.total*100,10);this.show_coddled_progress(this.progress)},upload_end:function(d,c){var b;if(c.textStatus==="success"){b=c.result}else{b=a.parseJSON(c.jqXHR.responseText)}if(b&&b.meta&&b.meta.status&&b.meta.status===200){if(b&&b.response&&b.response[0].url){this.image=b.response[0];this.progress=100;this.status="has_image";this.disable_dropzone();this.attach_image(this.image)}}else{if(c&&c.errorThrown==="abort"){this.progress=0;this.status="inactive"}else{this.progress=0;this.status="error";alert(b&&b.response?b.response:l10n_str.ajax_error)}}this.show_progress(this.progress)},upload_cancel:function(){try{this.jqXHR.abort()}catch(b){}this.progress=0;this.show_progress(this.progress);this.enable_dropzone()},upload_stop:function(){this.destroy_uploader()},cancel_event:function(b){b.preventDefault();b.stopPropagation();return false},event_in_bounds:function(f){var d=f.currentTarget.getBoundingClientRect();var c=f.originalEvent;var b,g;if(typeof c.clientX==="undefined"){b=c.pageX;g=c.pageY}else{b=c.clientX;g=c.clientY}return !(b>d.left+d.width-1||b<d.left||g>d.top+d.height-1||g<d.top)}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},clean_up:function(d){if(!document.body){return}var c,b;for(c=0;c<this.instances.length;c++){b=this.instances[c];if(!(b.$el.data("tumblr_photoreply")&&b.$el.closest(document.body).length)){b.remove();c--}}},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".photo_reply_form").each(a.proxy(function(c,d){if(!a(d).data("tumblr_photoreply")){new Tumblr.PhotoReply({el:d})}},this));return this}})})(jQuery);
(function(a){Tumblr.LinkButton=Backbone.View.extend({events:{click:"follow_link"},initialize:function(b){this.$el.addClass("clickable");this.determine_size();this.$el.data("tumblr_linkbutton",this);this.constructor.register(this)},determine_size:function(){this.$el.removeClass("small");if(this.$(".link_title").text().length>100||this.$(".link_text").height()>110){this.$el.addClass("small")}},follow_link:function(b){if(a(b.target).is(".link_title")){return true}b.preventDefault();b.stopPropagation();this.$(".link_title").click();return false}},{instances:[],register:function(b){this.instances.push(b)},unregister:function(b){this.instances.splice(_.indexOf(this.instances,b),1)},init:function(){if(!this._scan){this._scan=a.proxy(this.scan,this)}if(_.indexOf(AfterAutoPaginationQueue,this._scan)<0){AfterAutoPaginationQueue.push(this._scan)}this.scan()},scan:function(b){b=a.extend({},b);a(b.el||".link_button").each(a.proxy(function(c,d){if(!a(d).data("tumblr_linkbutton")){new Tumblr.LinkButton({el:d})}},this));return this}})})(jQuery);
var Tumblr=Tumblr||{};(function(c,b){var a=function(d,e){if(!(this instanceof a)){return new a(d)}this.options=d;this.config=c.extend({},a.defaults,this.options);this._=c.extend({},a.init,this.init);this.evt=c.extend({},a.events);c.each(this.evt,c.proxy(function(f){if(typeof this.config[f]==="function"){this.evt[f]=this.config[f]}},this));this.clock=false;this.still=true;this.motion=false;this.paused=false;a.register(this);return this};a.prototype={start_clock:function(){if(this.clock){return false}this.clock=true;clearInterval(this.ticker);this.ticker=setInterval(c.proxy(this.tick,this),this.config.dt)},stop_clock:function(){this.clock=false;clearInterval(this.ticker)},tick:function(d){if(!d){d=this.config.dt}return this.paused?false:this.__tick(d)},__tick:function(f,e){if(this.evt.pre_tick&&!this.evt.pre_tick.apply(this,[this])){return this}if(!f){f=this.config.dt}if(!e){this.set_properties({px0:this._.px,vx0:this._.vx,ax0:this._.ax,py0:this._.py,vy0:this._.vy,ay0:this._.ay,pz0:this._.pz,vz0:this._.vz,az0:this._.az,dt:f})}if(!f){return this}this.still=true;this.motion=false;var d=f*f;if(this.config.x&&(this._.vx||this._.ax)){this._.px=this._.px+this._.vx*f+0.5*this._.ax*d;this._.vx=this.__almost_zero(this._.vx+this._.ax*f);if(this._.drag<1){this._.vx*=this._.drag}if(this._.vx){this.still=false}if(this._.vx||this._.ax){this.motion=true}}if(this.config.y&&(this._.vy||this._.ay)){this._.py=this._.py+this._.vy*f+0.5*this._.ay*d;this._.vy=this.__almost_zero(this._.vy+this._.ay*f);if(this._.drag<1){this._.vy*=this._.drag}if(this._.vy){this.still=false}if(this._.vy||this._.ay){this.motion=true}}if(this.config.z&&(this._.vz||this._.az)){this._.pz=this._.pz+this._.vz*f+0.5*this._.az*d;this._.vz=this.__almost_zero(this._.vz+this._.az*f);if(this._.drag<1){this._.vz*=this._.drag}if(this._.vz){this.still=false}if(this._.vz||this._.az){this.motion=true}}if(this.evt.post_tick){this.evt.post_tick.apply(this,[this])}if(this.still&&this.evt.when_still){this.evt.when_still.apply(this,[this])}if(!this.motion&&this.evt.no_motion){this.evt.no_motion.apply(this,[this])}return this},__split_tick:function(g,f,h){if(typeof h!=="function"){return this.__tick(g,true)}var d=f*g;var e=g-d;if(e){this.__tick(e)}h.apply(this,[this]);if(d){this.__tick(d)}return this},__almost_zero:function(d){return Math.abs(d)<this.config.threshold?0:d},set_properties:function(d,e){if(c.isPlainObject(d)){c.extend(this._,d)}else{this._[d]=e}return this},calculate_velocity:function(g,h,n){if(g.length<2){return false}if(this.evt.slide_start){this.evt.slide_start.apply(this,[this])}var l=0,j=g.length-1;var e=(new Date()).getTime()-h;for(var f=0;f<g.length;f++){if(g[f][0]<e){l=f+1}}if(l>=j){return false}var m=g[l],k=g[j],d=k[0]-m[0];this.set_properties({vx0:this._.vx,vy0:this._.vy,vx:(m[1]-k[1])/d,vy:(m[2]-k[2])/d});if(n){this.autostart_xy()}return this},autostart_xy:function(){var d=(this.config.x&&this._.vx)||(this.config.y&&this._.vy);if(d){this.start_clock()}return d},autostop_xy:function(){var d=!(this._.vx&&this.config.x)&&!(this._.vy&&this.config.y);if(d){this.stop_clock()}return d}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.dt=15;a.tick=function(e){if(typeof e!=="number"){e=this.dt}for(var d=0;d<this.instances.length;d++){this.instances[d].tick(e)}};a.init={px:0,vx:0,ax:0,py:0,vy:0,ay:0,pz:0,vz:0,az:0,px0:0,vx0:0,ax0:0,py0:0,vy0:0,ay0:0,pz0:0,vz0:0,az0:0,drag0:0.9,drag:0.9,dt:null};a.events={pre_tick:false,post_tick:false,slide_start:false,when_still:false,no_motion:false};a.defaults={x:true,y:false,z:false,threshold:0.005,dt:a.dt};b.Physics=a})(jQuery,Tumblr);(function(c,b){var a=function(e,d){if(!(this instanceof a)){return new a(e,d)}this.el=(typeof e==="string")?c(e).get(0):e;this.$el=c(e);this.options=d;this.metadata=this.$el.data("plugin-options");this.config=c.extend({},a.defaults,this.options,this.metadata);this.$parent=c(this.config.parent);this.start=c.proxy(this.__start,this);this.end=c.proxy(this.__end,this);this.move=c.proxy(this.__move,this);this.click=c.proxy(this.__click,this);this.scroll=c.proxy(this.__scroll,this);this.__init();a.register(this);return this};a.prototype={__init:function(){this.__reset_positions();if(this.autostart){this.enable()}this.touch=("ontouchstart" in window||"onmsgesturechange" in window)&&navigator.msMaxTouchPoints>1;if(this.touch){c.extend(this.config,{start:"touchstart",end:"touchend",move:"touchmove"})}this.physics=this.config.physics?new Tumblr.Physics(this.config.physics):false},enable:function(){this.enable_dragging();if(this.config.can_scroll){this.enable_scrolling()}},enable_dragging:function(){this.dragging=false;this.$el.on(this.config.start,this.start);this.$el.on(this.config.click,this.click)},enable_scrolling:function(){this.scrolling=false;this.$el.on(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},disable:function(){this.disable_dragging();this.disable_scrolling()},disable_dragging:function(){this.dragging=false;this.$el.off(this.config.start,this.start);this.$el.off(this.config.click,this.click);this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move)},disable_scrolling:function(){this.scrolling=false;this.$el.off(this.config.scroll,this.scroll);clearTimeout(this.enable_scrolling_delay)},__start:function(d){this.dragging=true;this.$parent.on(this.config.blur,this.end);this.$parent.on(this.config.end,this.end);this.$parent.on(this.config.move,this.move);this.__reset_positions();this.__event_position(d);this.start_position=this.end_position=this.positions[0];if(this.config.start_position){this.config.start_position(this.start_position[1],this.start_position[2])}if(this.physics){this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vx:0,vy:0}).stop_clock()}d.stopPropagation();return false},__end:function(d){this.dragging=false;this.$parent.off(this.config.blur,this.end);this.$parent.off(this.config.end,this.end);this.$parent.off(this.config.move,this.move);if(this.config.end_position){this.config.end_position(this.end_position[1],this.end_position[2])}if(this.physics){this.physics.calculate_velocity(this.positions,this.config.pos_time,true)}},__click:function(d){if(this.__any_movement()){d.stopPropagation();return false}return true},__move:function(f){var d=this.__event_position(f);this.end_position=this.positions[this.positions.length-1];if(this.config.update_position){this.config.update_position(d.x-this.start_position[1],d.y-this.start_position[2],false)}},__scroll:function(d){if(this.physics&&this.physics.clock){d.preventDefault();this.physics.set_properties({vx0:this.physics._.vx,vy0:this.physics._.vy,vz0:0,vx:0,vy:0,vz:0}).stop_clock();this.physics.motion=false;if(this.physics.evt.no_motion){this.physics.evt.no_motion.apply(this.physics,[this.physics])}return false}if(this.config.update_position){this.config.update_position(this.$el.scrollLeft(),this.$el.scrollTop(),true)}},__event_position:function(f,h){var d,g;if(this.touch){if(!f.originalEvent.targetTouches.length){return false}d=f.originalEvent.targetTouches[0].pageX;g=f.originalEvent.targetTouches[0].pageY}else{d=f.pageX;g=f.pageY}if(h){return{x:d,y:g}}else{return this.__record_position(d,g)}},__any_movement:function(){if(this.positions<2){return false}var e=this.positions[0],d=this.positions[this.positions.length-1];return d[0]!==e[0]||d[1]!==e[1]},__reset_positions:function(){delete this.start_position;delete this.end_position;this.positions=[];this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop()},__record_position:function(d,f){if(c.isPlainObject(d)){f=d.y;d=d.x}var e=(new Date()).getTime();this.positions.push([e,d,f]);if(this.positions.length-1===this.config.pos_limit){this.positions.shift()}else{if(this.positions.length>this.config.pos_limit){this.positions.splice(-this.config.pos_limit,this.positions.length)}}this.positions.push([e,d,f]);return{x:d,y:f}},sync_scroll:function(e){if(!this.config.can_scroll){return}this.disable_scrolling();var d=c(e);this.$el.scrollLeft(d.scrollLeft());this.$el.scrollTop(d.scrollTop());this.scroll_x=this.$el.scrollLeft();this.scroll_y=this.$el.scrollTop();if(this.physics){this.physics.set_properties({px:this.scroll_x,py:this.scroll_Y})}clearTimeout(this.enable_scrolling_delay);this.enable_scrolling_delay=setTimeout(c.proxy(this.enable_scrolling,this),200)}};a.instances=[];a.register=function(d){this.instances.push(d)};a.unregister=function(d){this.instances.splice(this.instances.indexOf(d),1)};a.defaults={pos_limit:5,pos_time:200,start:"mousedown",end:"mouseup",move:"mousemove",click:"click",scroll:"scroll",blur:"blur",parent:window,can_scroll:true,physics:false,start_position:false,end_position:false,update_position:false,autostart:true};b.DragRelay=a})(jQuery,Tumblr);(function(c,a){var d=function(e){this.options=e;this.__init(this.config);return this};d.prototype={__init:function(){Tumblr.Glass.show(function(){this.__destroy()}.bind(this));this.click=c.proxy(this.__click,this);this.resize=c.proxy(this.__resize,this);this.keydown=c.proxy(this.__keydown,this);this.keyup=c.proxy(this.__keyup,this);this.keycancel=c.proxy(this.__keycancel,this);this.__create();if(this.options.pano){this.__clone_pano(this.options.pano)}this.__open()},__bind_events:function(){this.$lightbox.on("click",this.click);c(window).on("resize",this.resize);c(window).on("keydown",this.keydown)},__unbind_events:function(){this.$lightbox.off("click",this.click);c(window).off("resize",this.resize);c(window).off("keydown",this.keydown);c(window).off("keyup",this.keyup);c(window).off("blur",this.keycancel)},__create:function(){this.$lightbox=c("<div/>").attr("class","pano_lightbox").appendTo(c("body"));this.$lightbox.css({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:4294967294,overflow:"hidden",backgroundColor:"rgba(15,15,15,0.95)"});c("<img/>").attr("id","vignette").attr("src","http://assets.tumblr.com/images/full_page_vignette.png").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox);c("<div/>").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%",height:"100%"}).appendTo(this.$lightbox)},__destroy:function(){this.__unbind_events();this.$lightbox.css("display","none").remove();this.pano.$parent.css("overflow","");delete this.$lightbox;if(window.top!=window.self){if(typeof window.top.pano_iframe_preloader!="undefined"&&window.top.pano_iframe_preloader){window.top.pano_iframe_preloader.remove()}}b.unregister(this)},__clone_pano:function(e){this.$pano=c(e).clone(false).appendTo(this.$lightbox);this.pano=new b(this.$pano,{side_margins:100});this.pano.lightbox=this},__open:function(){this.__bind_events();this.pano.__center_vertically(c(window).height());this.pano.$parent.css("overflow","hidden")},__close:function(){Tumblr.Glass.hide()},__click:function(f){if(c(f.target).closest(".pano_dragger").length||c(f.target).closest(".pano_thumb").length){return}this.__close()},__resize:function(f){this.pano.__enforce_max_height();this.pano.__center_vertically(c(window).height());this.pano.__draw_shades();c("#vignette").css("display","none")},__keydown:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if((g.ctrlKey||g.metaKey)&&f===87){this.__close();return false}if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:-0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 39:if(this.arrowed){return false}this.arrowed=true;this.pano.physics.set_properties({drag0:this.pano.physics._.drag,drag:1,vx0:this.pano.physics._.vx,vx:0.9}).autostart_xy();c(window).on("blur",this.keycancel);c(window).on("keyup",this.keyup);return false;case 27:case 32:case 74:case 75:this.__close();return false}},__keyup:function(g){if(!g){return false}var f=g.charCode?g.charCode:g.keyCode;if(!g.shiftKey&&!g.ctrlKey&&g.altKey&&!g.metaKey){return true}switch(f){case 37:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false;case 39:this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0}).autostop_xy();c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup);return false}},__keycancel:function(f){if(this.arrowed){this.arrowed=false;this.pano.physics.set_properties({drag:this.pano.physics._.drag0,vx0:this.pano.physics._.vx,vx:0}).autostop_xy()}c(window).off("blur",this.keycancel);c(window).off("keyup",this.keyup)}};var b=function(f,e){if(!(this instanceof b)){return new b(f,e)}this.el=(typeof f==="string")?c(f).get(0):f;this.$el=c(f);if(this.$el.data("panoObject")){return this.$el.data("panoObject")}this.options=e;this.metadata=this.$el.data("plugin-options");this.config=c.extend({physics:{post_tick:c.proxy(function(g){this.viewport_size();if(g._.px<=0){g.set_properties({px:0,vx:0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}else{if(g._.px>=(this.display_width+(this.display_side_margins*2))-this.viewport_width){g.set_properties({px:(this.display_width+(this.display_side_margins*2))-this.viewport_width,vx:-0.1*Math.abs(g._.vx)});if(this.lightbox){this.lightbox.keycancel()}}}this.set_position(g._.px,g._.py,true)},this),slide_start:c.proxy(function(g){this.relay.disable_scrolling();this.scrubber_relay.disable_scrolling()},this),no_motion:c.proxy(function(g){g.stop_clock();this.relay.enable_scrolling();this.scrubber_relay.enable_scrolling();this.relay.sync_scroll(this.$viewport)},this)},autostart:true},this.options,this.metadata);this.__init(this.config);return this};b.prototype={__init:function(e){this.img_loaded=c.proxy(this.__img_loaded,this);this.img_ready=c.proxy(this.__img_ready,this);this.__create();c.extend(this.config,{start_position:c.proxy(this.set_start_position,this),end_position:c.proxy(this.set_end_position,this),update_position:c.proxy(this.set_position,this)});this.relay=new Tumblr.DragRelay(this.$dragger,this.config);this.physics=this.relay.physics;this.scrubber_relay=new Tumblr.DragRelay(this.$scrubber,c.extend({},this.config,{can_scroll:false,physics:false,start_position:c.proxy(this.set_inverted_start_position,this),update_position:c.proxy(this.set_inverted_position,this)}));this.__load_pano_image();b.register(this)},__create:function(){if(this.$el.is("a")){this.$orig_a=this.$el;this.$orig_img=this.$el.children("img")}else{this.$orig_img=this.$el}this.src=this.$orig_img.data("panoSrc");this.href=this.$orig_img.data("panoHref");this.width=this.$orig_img.data("panoWidth");this.height=this.$orig_img.data("panoHeight");this.position_height=Math.min(80,this.$orig_img.data("thumbHeight"));this.position_width=this.$orig_img.data("thumbWidth")*(this.position_height/this.$orig_img.data("thumbHeight"));this.position_width=Math.min(500,this.position_width);this.$parent=c("body");this.$container=c("<div/>").attr("class","pano_container loading");this.$view_container=c("<div/>").attr("class","pano_view_container").appendTo(this.$container);this.$viewport=c("<div/>").attr("class","pano_viewport").appendTo(this.$view_container);this.$img_container=c("<div/>").attr("class","pano_img_container").css({width:this.width,height:this.height,padding:"0 "+this.options.side_margins+"px"}).appendTo(this.$viewport);this.$img=c("<img/>").attr({src:"http://assets.tumblr.com/images/x.gif","class":"pano_img"}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$loader_img=c("<img/>").attr({"class":"pano_loader_img",src:this.$orig_img.attr("src")}).css({width:this.width,height:this.height}).appendTo(this.$img_container);this.$position=c("<div/>").attr("class","pano_position").css({width:this.position_width,height:this.position_height}).appendTo(this.$container);this.$thumb=c("<img/>").attr("class","pano_thumb").attr("src",this.$orig_img.attr("src")).appendTo(this.$position);this.$shade_left=c("<div/>").attr("class","pano_shade left").appendTo(this.$position);this.$shade_right=c("<div/>").attr("class","pano_shade right").appendTo(this.$position);this.$scrubber=c("<div/>").attr("class","pano_scrubber grab").appendTo(this.$position);this.$dragger=c("<div/>").attr("class","pano_dragger grab").css({height:this.height}).appendTo(this.$container);this.$scroller=c("<div/>").attr("class","pano_scroller").css({width:this.width,height:this.height,borderLeft:this.options.side_margins+"px solid transparent",borderRight:this.options.side_margins+"px solid transparent"}).appendTo(this.$dragger);this.$el.css("display","none").data("panoObject",this).after(this.$container);this.__set_img_dimensions(this.width,this.height,this.options.side_margins);this.__enforce_max_height();return this},__destroy:function(){this.$img.off("load",this.img_ready);this.$container.remove();delete this.$container;delete this.$view_container;delete this.$viewport;delete this.$img;delete this.$loader_img;delete this.$position;delete this.$thumb;delete this.$pos_frame;delete this.$dragger;this.$el.css("display","").data("panoObject","")},__load_pano_image:function(e){if(!e){e=this.src}this.img_poll=setInterval(this.img_ready,1000);this.$img.on("load",this.img_loaded).attr("src",e);this.__img_init()},__img_init:function(){this.relay.enable();this.scrubber_relay.enable();this.__scrubber_sizing();this.set_position(0,0)},__img_ready:function(e){if(!e){e=this.$img[0]}if(e&&e.src&&e.complete){this.__img_loaded()}},__img_loaded:function(f){this.__scrubber_sizing();this.$container.removeClass("loading");clearInterval(this.img_poll)},__scrubber_sizing:function(){this.viewport_size();var e=100*this.viewport_width/(this.$img.width()+(this.options.side_margins*2));this.$scrubber.width(Math.min(e,100)+"%");if(Math.min(e,100)==100){this.$position.css("opacity","0")}else{this.$position.css("opacity","1")}},__draw_shades:function(){if(this.relay.touch){return}this.$shade_left.css("width",Math.max(0,this.scrubber_x));this.$shade_right.css("width",Math.max(0,this.position_width-this.scrubber_x-this.$scrubber.width()))},__set_img_dimensions:function(g,e,f){this.$img_container.css({width:g,height:e});this.$img.css({width:g,height:e});this.$loader_img.css({width:g,height:e});this.$dragger.css({height:e});this.$scroller.css({width:g,height:e});this.display_width=g;this.display_height=e;if(typeof f==="number"){this.$img_container.css({padding:"0 "+f+"px"});this.$scroller.css({borderLeft:f+"px solid transparent",borderRight:f+"px solid transparent"});this.display_side_margins=f}},__enforce_max_height:function(f){f=f||200;var g=c(window).height()-this.$position.outerHeight(true);g-=30;var e=Math.max(f,Math.min(this.height,g));var h=this.width*(e/this.height);this.__set_img_dimensions(h,e);this.$img_container.css("min-width",c(window).width()-2*this.display_side_margins);this.__scrubber_sizing()},__center_vertically:function(e){this.$container.css("top",(e/2)-(this.$container.height()/2))},set_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$viewport.scrollLeft();this.start_y=this.$viewport.scrollTop()},set_inverted_start_position:function(e,f){this.$parent.addClass("grabbing");this.start_x=this.$scrubber.position().left;this.start_y=this.$scrubber.position().top},set_end_position:function(e,f){this.$parent.removeClass("grabbing");this.relay.sync_scroll(this.$viewport)},viewport_size:function(){this.viewport_width=this.$viewport.width();this.viewport_height=this.$viewport.height()},set_position:function(f,g,e){this.viewport_size();if(e){this.position_x=f;this.position_y=g}else{this.position_x=this.start_x-f;this.position_y=this.start_y-g}this.$viewport.scrollLeft(this.position_x);this.position_x=this.$viewport.scrollLeft();this.scrubber_x=this.$scrubber.width()*this.position_x/this.viewport_width;this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades()},set_inverted_position:function(f,g,e){this.viewport_size();if(e){this.scrubber_x=f}else{this.scrubber_x=this.start_x+f}this.scrubber_x=Math.max(0,Math.min(this.scrubber_x,(this.$position.width()-this.$scrubber.width())));this.position_x=this.$viewport.width()*this.scrubber_x/this.$scrubber.width();this.$scrubber.css("left",parseInt(this.scrubber_x,10)+"px");this.__draw_shades();this.$viewport.scrollLeft(this.position_x)}};b.instances=[];b.register=function(e){this.instances.push(e)};b.unregister=function(e){this.instances.splice(this.instances.indexOf(e),1)};c.fn.panorama=function(e){e=e||{};var f=e.lightbox||false;return this.each(function(){if(f){new d(c.extend({},e,{pano:this}))}else{new b(this,e)}})};a.Panorama=b})(jQuery,Tumblr);
(function(c,b,d){var a=function(h,e,f){var i;return function g(){var l=this,k=arguments;function j(){if(!f){h.apply(l,k)}i=null}if(i){clearTimeout(i)}else{if(f){h.apply(l,k)}}i=setTimeout(j,e||100)}};jQuery.fn[b]=function(e){return e?this.bind("resize",a(e)):this.trigger(b)};jQuery.fn[d]=function(e){return e?this.bind("scroll",a(e)):this.trigger(d)}})(jQuery,"smartresize","smartscroll");var Tumblr=Tumblr||{};(function(c,a){var b=Backbone.View.extend({el:".hello_posts_ui",initialize:function(d){this.options=d||{};this.options.bufferPx=d.bufferPx||Math.round(c(window).height()*0.667);this.options.pixelsFromNavToBottom=d.pixelsFromNavToBottom||175;this.options.url=this.options.url||"/tagged/"+this.options.tag;this.options.form_key=c("#tumblr_form_key").attr("content");this.options.no_results=(c(".hello_posts_ui").data("results")===0);this.before_pager_queue=[];this.after_pager_queue=[];this.handle_no_more_posts_queue=[];this.$auto_pagination_loader=c("#auto_pagination_loader");this.$auto_pagination_loading=c("#auto_pagination_loader_loading");this.$auto_pagination_failure=c("#auto_pagination_loader_failure");this.$auto_pagination_no_posts=c("#auto_pagination_loader_no_posts");this.$auto_pagination_loader.hide();this.$auto_pagination_loader.children().hide();c(window).smartscroll(this.check_posts.bind(this),100);c(window).smartresize(this.check_posts.bind(this),1000)},check_posts:function(){if(this.nearbottom()&&!this.updating&&!this.options.no_results){this.update()}},append_posts:function(d){this.$el.append(d);if(window.HelloTags){window.HelloTags.update()}},nearbottom:function(){var e=this.options,d=0+this.$el.height()-c(window).scrollTop()-c(window).height();return(d-e.bufferPx<e.pixelsFromNavToBottom)},execute_queue:function(d){if(!d.length){return}for(var e=d.length-1;e>=0;e--){if(typeof(d[e])==="function"){d[e]()}}},before_auto_pagination:function(){this.execute_queue(this.before_pager_queue)},after_auto_pagination:function(){this.execute_queue(this.after_pager_queue)},handle_no_more_posts:function(){this.$auto_pagination_loader.show();this.$auto_pagination_no_posts.show();this.$auto_pagination_loading.hide();this.execute_queue(this.handle_no_more_posts_queue)},updating:false,update:function(){this.updating=true;this.$auto_pagination_loader.show();this.$auto_pagination_loading.show();this.before_auto_pagination();if(this.options.before==-1){this.handle_no_more_posts();return false}var d=c.ajax({url:this.options.url,type:"GET",data:{form_key:this.options.form_key,before:this.options.before}});d.success(function(e){this.options.before=parseInt(d.getResponseHeader("X-next-page"),10);this.append_posts(e)}.bind(this));d.error(function(){this.$auto_pagination_loader.show();this.$auto_pagination_failure.show()});d.complete(function(){this.updating=false;this.$auto_pagination_loader.hide();this.$auto_pagination_loading.hide();this.after_auto_pagination()}.bind(this))}});a.HelloAutoPager=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:".hello_posts_ui",initialize:function(d){this.options=d||{};this.collection_needs_update=true;this.last_charmed=false;this.$last_charmed=false;this.in_viewport=null;this.heartbeat=setInterval(this.update_walker.bind(this),2723);this.delay_t=null;c(window).scroll(this.user_scrolled.bind(this))},user_scrolled:function(){clearTimeout(this.delay_t);this.delay_t=setTimeout(function(){this.collection_needs_update=true}.bind(this),151)},update_walker:function(){var e=false;if(this.collection_needs_update){this.collection_needs_update=false;var d=this.all_the_gifs();d.removeClass("is_walking");d.addClass("not_walking");this.in_viewport=this.gifs_in_viewport(d)}e=this.next_to_charm(this.in_viewport);if(e){if(this.$last_charmed){this.$last_charmed.removeClass("is_walking");this.$last_charmed.addClass("not_walking")}e.data("start_gif")();e.addClass("is_walking");e.removeClass("not_walking");this.last_charmed=e.data("id");this.$last_charmed=e}},all_the_gifs:function(){return this.$el.find(".ht_post.gif_player_ready")},gifs_in_viewport:function(d){var e=[];d.each(function(g,f){if(this.elInView(f)){e.push(c(f))}}.bind(this));return e},next_to_charm:function(g){var e=g.length;if(e<=0){return false}var f=g[0];if(this.last_charmed){for(var d=0;d<g.length;d++){if((c(g[d]).data("id")==this.last_charmed)&&(d+1)<e){f=g[(d+1)];break}}}return f},elInView:function(f){var h=f.offsetTop;var g=f.offsetLeft;var e=f.offsetWidth;var d=f.offsetHeight;while(f.offsetParent){f=f.offsetParent;h+=f.offsetTop;g+=f.offsetLeft}return(h<(window.pageYOffset+window.innerHeight)&&g<(window.pageXOffset+window.innerWidth)&&(h+d)>window.pageYOffset&&(g+e)>window.pageXOffset)}});b.HelloGifWalker=a})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({initialize:function(d){this.options=d||{};if(typeof this.$el=="undefined"||this.$el.length===0||this.$el.find("leviathan").length!==0){this.remove();return false}this.is_dark=this.options.dark||false;this.uid=Math.floor(Math.random()*10000);this.$el.append(this.html());this.$loader=c(".leviathan.loader_"+this.uid);if(this.is_dark){this.$loader.addClass("dark")}this.center();this.$u1=c("i.unum",this.$loader);this.$u2=c("i.duo",this.$loader);this.$u3=c("i.tres",this.$loader);this.ti=null;this.t1=null;this.t2=null;this.t3=null},start:function(){clearInterval(this.ti);var d=function(){this.t1=this.rise(this.$u1,300,0);this.t2=this.rise(this.$u2,300,100);this.t3=this.rise(this.$u3,300,200)}.bind(this);d();this.ti=setInterval(function(){clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3);d()}.bind(this,d),600);this.$loader.show()},stop:function(){this.$loader.hide();clearInterval(this.ti);clearTimeout(this.t1);clearTimeout(this.t2);clearTimeout(this.t3)},destroy:function(){this.stop();this.unbind();this.$loader.remove();this.remove()},center:function(){var e=this.$el.width();var d=this.$el.height();var g=this.$loader.width();var f=this.$loader.height();var i=(e/2)-(g/2);var h=(d/2)-(f/2);this.$loader.css({left:i,top:h})},rise:function(e,f,d){if(typeof e=="undefined"||e.length===0){return}return setTimeout(function(){e.stop(true,true).animate({height:"28px",opacity:1,marginTop:"0px"},f).animate({height:"20px",opacity:0.5,marginTop:"4px"},f)},d)},html:function(){return'<div class="loader_'+this.uid+' leviathan"><i class="unum"></i><i class="duo"></i><i class="tres"></i></div>'}});a.HelloLoader=b})(jQuery,Tumblr);(function(c,b){var a=Backbone.View.extend({el:"body",events:{keydown:"keydown",keyup:"keyup"},initialize:function(d){this.options=d||{};this.row_size=3;this.keys_lock=false;this.down_lock=false;this.speed_lock=false;this.scroll_lock=false;this.shift=false;this.option=false;this.last_jumped_by_row=false;this.animate_on_alt=true;this.posts=c(".hello_posts_ui");this.current_row=null;this.speed_limit=53;this.scroll_pad=20;this.t_hover_lock=null;this.t_speed_limit=null;this.t_open_delay=null;this.$current_unit=false;this.pos=false;window.blur();window.focus()},update_pos:function(d){this.pos=d},keydown:function(j){var k=j?j.target:window.event.srcElement;if(c(k).is("input:focus")||c("#hello_glass").length){return}var d=j.charCode?j.charCode:j.keyCode,f=j.shiftKey,g=j.altKey,o=(j.ctrlKey||j.shiftKey||j.metaKey);if(d==27&&!o){$escape_unit=c("#sel_"+this.pos,this.posts);if($escape_unit.length&&typeof $escape_unit.data("animate_in")=="function"){$escape_unit.data("animate_in")()}j.preventDefault();return false}if(this.keys_lock||this.speed_lock||this.scroll_lock){return}this.speed_lock=true;this.down_lock=true;this.t_speed_limit=setTimeout(function(){this.speed_lock=false}.bind(this),this.speed_limit);var m=false;var l=false;var i=false;if(d==74&&!o){if(this.animate_on_alt&&g){m=this.next()}else{l=this.next_row()}i=true}if(d==75&&!o){if(this.animate_on_alt&&g){m=this.previous()}else{l=this.previous_row()}i=true}if(d==32){var n=this.posts.find(".ht_post.front");if(n.length){n.find(".go").click();j.preventDefault()}else{return true}}if(g){this.option=true;c("body").addClass("option");var h=this.posts.find(".unit.hover");if(h.length===1){if(typeof h.data("animate_out")=="function"){h.data("animate_out")()}}}if(i&&m){this.check_viewport(m,false)}else{if(i&&l){this.check_viewport(l,true)}}},keyup:function(d){this.down_lock=false;if(d.keyCode==18){this.close_open_units()}if(!d.altKey){this.option=false;c("body").removeClass("option")}return true},next:function(){if(this.pos===false||this.pos<-1){this.pos=-1}if(this.last_jumped_by_row){this.pos--}this.last_jumped_by_row=false;var e=this.pos;var d=this.pos+1;$open=c("#sel_"+d,this.posts);$close=c("#sel_"+e,this.posts);if($open.length===0){$open=false}if($close.length===0){$close=false}if($close){if(typeof $close.data("animate_in")=="function"){$close.data("animate_in")()}}if($open){var f=this.pos;this.$current_unit=$open;this.pos=d;return $open}},next_row:function(){if(this.last_jumped_by_row===false){this.close_open_units()}this.last_jumped_by_row=true;var e=false;var d=false;if(this.current_row===null){e=0}else{e=this.current_row+1}d=c(".hello_row:eq("+e+")",this.posts);if(!d||d.length===0){return}$first_unit=d.find(".unit:first");if($first_unit.length>0){this.pos=c(".unit",this.posts).index($first_unit);this.check_viewport($first_unit,true)}},previous:function(){if(this.pos===false||this.pos<=0){return false}if(this.last_jumped_by_row){this.pos++}this.last_jumped_by_row=false;var e=this.pos;var d=this.pos-1;$open=c("#sel_"+d,this.posts);$close=c("#sel_"+e,this.posts);if($open.length===0){$open=false}if($close.length===0){$close=false}if($close){if(typeof $close.data("animate_in")=="function"){$close.data("animate_in")()}}if($open){var f=this.pos;this.$current_unit=$open;this.pos=d;return $open}},previous_row:function(){if(this.last_jumped_by_row===false){this.close_open_units()}this.last_jumped_by_row=true;var e=false;var d=false;if(this.current_row===null){e=0}else{e=this.current_row-1}d=c(".hello_row:eq("+e+")",this.posts);if(!d||d.length===0){return}$first_unit=d.find(".unit:first");if($first_unit.length>0){this.pos=c(".unit",this.posts).index($first_unit);this.check_viewport($first_unit,true)}},close_open_units:function(){var d=this.posts.find(".front").parent();if(d.length===0){return}if(typeof d.data("animate_in")=="function"){d.data("animate_in")()}},check_viewport:function(i,j){if(!i||i.length===0){return false}var f=false;var g=0;clearTimeout(this.t_open_delay);clearTimeout(this.t_hover_lock);c("body").addClass("hello_keys_active");this.t_hover_lock=setTimeout(function(){c("body").removeClass("hello_keys_active")}.bind(this),1000);var d;if(!this.$current_unit||this.$current_unit.length===0){d=this.posts}else{d=this.$current_unit.get(0)}var h=i.parent();var l=i.parent().get(0);var e=c(".hello_row",this.posts).index(h);if(j){this.current_row=e;f=true;g=h.offset().top}else{if(e!=this.current_row){this.current_row=e;if(this.needs_scroll(l)){f=true;g=h.offset().top}}else{if(this.needs_scroll(d)){f=true;g=this.$current_unit.offset().top}}}if(f){if(!j){this.scroll_lock=true}var k=false;c("html, body").stop(true,true).animate({scrollTop:(g-this.scroll_pad)},j?100:300,function(){if(!k){clearTimeout(this.t_open_delay);k=true;this.speed_lock=true;this.t_speed_limit=setTimeout(function(){this.speed_lock=false}.bind(this),this.speed_limit);if(!j){this.t_open_delay=setTimeout(function(){if(typeof i.data("animate_out")=="function"){i.data("animate_out")()}}.bind(this),50)}}this.scroll_lock=false}.bind(this))}else{if(typeof i.data("animate_out")=="function"){i.data("animate_out")()}return false}},needs_scroll:function(f){var h=f.offsetTop;var g=f.offsetLeft;var e=f.offsetWidth;var d=f.offsetHeight;while(f.offsetParent){f=f.offsetParent;h+=f.offsetTop;g+=f.offsetLeft}return((h+d)>window.pageYOffset+window.innerHeight||h<(window.pageYOffset))}});b.HelloKeys=a})(jQuery,Tumblr);(function(b,a){var c=Backbone.View.extend({el:".hello_posts_ui",initialize:function(d){this.options=d||{};this.update();this._loaded_templates=false;this.use_gif_player=!(jQuery.browser.msie&&(parseInt(jQuery.browser.version,10)<9))},update:function(){if(!this.$el.length){return}b('.unit:not(".ready")',this.$el).each(function(e,g){$ht_post=b(".ht_post",g);if($ht_post.length>0){var f=b(".ht_post",g).data("type");if(f=="chat"){new Tumblr.HelloChat({el:g})}else{if(f=="photo"&&$ht_post.data("animated-gif")===true){new Tumblr.HelloGif({el:g})}else{new Tumblr.HelloPost({el:g})}}if($ht_post.data("lightbox")===true){var d=true;if(f=="video"){d=false}new Tumblr.HelloLightbox({el:g,use_cache:d});if(!this._loaded_templates){this.load_templates()}}}}.bind(this));b(".lightbox_item").each(function(e,d){new Tumblr.HelloLightbox({el:d});if(!this._loaded_templates){this.load_templates()}}.bind(this))},load_templates:function(){this._loaded_templates=true;var d=b.ajax({url:"/hello_lightbox/template",type:"GET"});d.success(function(e){window.Templates.Hello_Lightbox=e}.bind(this))}});a.HelloTags=c})(jQuery,Tumblr);(function(c,a){var b=Backbone.View.extend({_scroll_offset:0,use_cache:true,initialize:function(d){this.options=d||{};this.lightbox_trigger=this.options.lightbox_trigger||".go, .lightbox_trigger";this.post_selector=this.options.post_selector||".ht_post";this.$post_el=this.options.post_el||this.$el.find(this.post_selector+", .lightbox_data");this.follow_source=this.options.follow_source||"FOLLOW_SOURCE_BLOG_LIGHTBOX";this.post_id=parseInt(this.$post_el.data("id"),10);this.tumblelog=this.$post_el.data("tumblelog");this.$ht_post=this.$post_el||c(this.post_selector,this.el);this.$go=c(this.lightbox_trigger,this.el);this.is_visible=false;this.is_safari=(navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1);this.is_oldie=(jQuery.browser.msie&&(parseInt(jQuery.browser.version,10)<=9));if(!this.post_id||!this.tumblelog){return}this.$go.on("click",this.el,this.launch.bind(this))},close_lightbox:function(){c("html").removeClass("lightbox_open");c("body > .outter_wrapper").css({overflow:"auto",height:"auto"});c("#container").css({position:"static",top:"auto"});c("html, body").scrollTop(this._scroll_offset);if(this._loader){this._loader.destroy()}this._loader=false;c("#hello_glass .leviathan").remove();c("#hello_glass").remove();this.is_visible=false;c("#logged_out_header, .logged_out_header").css("top",0);c("body").css("background-position","0px 0px");this.$ht_post.removeClass("active");window.blur();window.focus();if(typeof(this.$el.data("reset"))==="function"){this.$el.data("reset")()}c(document).off("keyup");c(window).unbind("onmessage");c(window).unbind("message")},iframe_from_url:function(g,d){var f="/hello_lightbox/"+encodeURIComponent(g)+"/"+d+"?follow_source="+this.follow_source;var e='<iframe id="hello_lightbox" style="visibility:hidden;display:none;" allowtransparency="true" src="'+f+'" > </iframe>';c("#hello_glass").append(e)},iframe_from_template:function(j,d){var g="";if(typeof hello_post_cache=="object"&&typeof hello_post_cache[d]=="string"&&typeof hello_tumblelog_cache[j]=="string"){header_html=hello_tumblelog_cache[j];g=hello_post_cache[d]}else{this.iframe_from_url(j,d);return}var e=window.Templates.Hello_Lightbox;e=e.replace("<!--{BLOCK:TUMBLELOG_HEADER}-->",header_html);e=e.replace("<!--{BLOCK:FEATURED_POST}-->",g);e=e.replace("<!--{BLOCK:TUMBLELOG_NAME}-->",encodeURIComponent(j));e=e.replace("<!--{BLOCK:POST_ID}-->",d);c("#hello_glass").append('<iframe id="hello_lightbox" style="visibility:hidden;display:none;" allowtransparency="true"> </iframe>');var f=c("#hello_lightbox").get(0);var i=f.contentWindow||f.documentWindow;var h=i.document;h.open();h.write(e);h.close()},launch:function(e){if(e.metaKey||e.shiftKey||e.ctrlKey){return true}c("body").removeClass("option");this.$ht_post.addClass("active");if(c(".load",this.$go).length===0){this.$go.append('<div class="load"></div>');this._loader=new Tumblr.HelloLoader({el:c(".load",this.$go).get(0)});this._loader.start()}if(c("#hello_glass").length>0||this.post_id<=0){return false}c("body").prepend('<div id="hello_glass" class="loading"></div>');c(document).on("keyup",function(g){if(g.which==27){if(c("#tumblr_lightbox").length===0&&this.is_visible===false){this.close_lightbox()}}}.bind(this));var f=window.addEventListener?"addEventListener":"attachEvent";var d=f=="attachEvent"?"onmessage":"message";this._scroll_offset=window.pageYOffset;c("body > .outter_wrapper").css({overflow:"hidden",height:"100%"});c("#container").css({position:"relative",top:(this._scroll_offset*-1)});c("#logged_out_header, .logged_out_header").css("top",(this._scroll_offset*-1));c("body").css("background-position","0px "+(this._scroll_offset*-1)+"px");c("html, body").scrollTop(0);if(!this.options.use_cache||window.Templates.Hello_Lightbox==null||this.is_safari||this.is_oldie){this.iframe_from_url(this.tumblelog,this.post_id)}else{this.iframe_from_template(this.tumblelog,this.post_id)}c(window).bind(d,function(l){var n=l.originalEvent;if(n.data=="close_glass"){this.close_lightbox()}else{if(n.data=="page_ready"){c("html").addClass("lightbox_open");c("#hello_glass").removeClass("loading");c("#hello_lightbox").css("display","block").css("visibility","visible");this.is_visible=true;if(this._loader){this._loader.destroy()}this._loader=false;c("#hello_glass .leviathan").remove();c(".load",this.$go).remove();if(c("#hello_lightbox").length){c("#hello_lightbox")[0].contentWindow.blur();c("#hello_lightbox")[0].contentWindow.focus()}}else{if(n.data=="signup_account"){this.close_lightbox();if(SignupProcess){SignupProcess.update_view("signup_account")}}else{if(n.data.substring(0,14)=="open_lightbox/"){var j=n.data.substring(14);var h=j.split("/");var i=h[0];var m=h[1];this.is_visible=false;c("#hello_lightbox").remove();var k=c("#hello_glass");if(k.find(".leviathan").length===0){var g=new Tumblr.HelloLoader({el:k.get(0)});c("#hello_glass").data("loader",g);g.start()}this.iframe_from_url(m,i);return}}}}}.bind(this));c("#hello_glass").click(function(){this.close_lightbox()}.bind(this));e.preventDefault()}});a.HelloLightbox=b})(jQuery,Tumblr);(function(e,b){var a=-1;var f=Backbone.View.extend({initialize:function(g){this.options=g||{};this.animate_on_alt=true;this.$unit=e(this.el);this.$box=this.$unit.find("div.ht_post");this.$stage=this.$box.find(".stage");this.box_hover=false;this.$tags=this.$unit.find(".tags li");this.type=this.$box.data("type");this.post_id=this.$box.data("id");this.effect=this.$box.data("effect");this.box_width=this.$box.outerWidth();this.box_height=this.$box.outerHeight();this.nudge_padding=5;this.grow_thresh=50;this.bottom_limit=40;this.controls_hover=false;this.hover_intent_active=false;this.has_animation=false;this.is_animated=false;this.t_animation=null;this.original_pos_top=parseInt(this.$box.css("top"),10);this.original_pos_right=parseInt(this.$box.css("right"),10);this.original_pos_bottom=parseInt(this.$box.css("bottom"),10);this.original_pos_left=parseInt(this.$box.css("left"),10);this.bind_active_helpers();if(this.effect=="grow"){this.has_animation=true;this.add_grow()}this.$box.hover(function(){this.box_hover=true;this.$unit.addClass("hover")}.bind(this),function(){this.box_hover=false;this.$unit.removeClass("hover")}.bind(this));this.after_initialize();this.$el.data("reset",this.reset.bind(this));a++;while(e("#sel_"+a).length){a++}if(this.$unit.hasClass("large")&&this.$unit.hasClass("right")){this.$unit.attr("id","sel_"+(a+2));this.$unit.data("sel",(a+2));a--}else{this.$unit.attr("id","sel_"+a);this.$unit.data("sel",a)}if(this.$unit.hasClass("out_controls")){this.bottom_limit=0}this.$unit.addClass("ready")},after_initialize:function(){return true},reset:function(){var g=e(".load",this.$go);if(g.length>0){g.remove()}if(this.has_animation){clearTimeout(this.t_animation);this.t_animation=setTimeout(function(){if(!this.box_hover){this.animate_in();this.$el.removeClass("active")}}.bind(this),150)}return true},bind_active_helpers:function(){if(this.$tags.length>1){this.$tags.each(function(h,g){e(g).hover(function(){this.$unit.addClass("tag_when_active");this.$unit.removeClass("unit_when_active")}.bind(this),function(){this.$unit.removeClass("tag_when_active");this.$unit.addClass("unit_when_active")}.bind(this))}.bind(this))}this.$unit.mouseenter(function(){this.$unit.addClass("unit_when_active")}.bind(this));this.$unit.mouseleave(function(){this.$unit.addClass("unit_when_active")}.bind(this));this.$unit.hover(function(){this.$unit.addClass("hover")}.bind(this),function(){this.$unit.removeClass("hover")}.bind(this));$ht_controls=this.$unit.find(".ht_controls");if($ht_controls.length>0&&this.effect=="grow"){$ht_controls.mouseleave(function(){this.controls_hover=false;if(this.hover_intent_active){this.t_animation=setTimeout(function(){if(this.box_hover){this.$box.parent().data("animate_out")()}}.bind(this),50)}}.bind(this));$ht_controls.mouseenter(function(){this.controls_hover=true}.bind(this));$ht_controls.click(function(){if(!this.$unit.hasClass("tag_when_active")){this.$unit.find(".go").click()}}.bind(this))}},add_grow:function(){var m=this.$box.data("grow-width");var g=this.$box.data("grow-height");if(this.$stage.length&&this.$box.data("grow-freeze")){var j=this.$stage.find(".content");if(j.length){j.width(j.width());j.height(j.height())}}var p;if(m.toString().substr(-1)=="%"){p=m.toString();p=(parseInt(p.substr(0,p.length-1),10)/100)+1;m=parseInt(this.box_width*p,10)}if(g.toString().substr(-1)=="%"){p=g.toString();p=(parseInt(p.substr(0,p.length-1),10)/100)+1;g=parseInt(this.box_height*p,10)}if(m<this.box_width+this.grow_thresh){var h=m;m=this.box_width+this.grow_thresh;g=((m*g)/h)}if(g<(this.box_height+this.grow_thresh)){var n=g;g=this.box_height+this.grow_thresh;m=((g*m)/n)}var o=this;var i=this.animate_on_alt;var k=function(q){if(i&&!e("body").hasClass("option")){return}if(!e("body").hasClass("hello_keys_active")){if(typeof window.HelloKeys=="object"){window.HelloKeys.update_pos(o.$el.data("sel"))}o.animate_out(m,g)}};var l={over:k,out:this.animate_in.bind(this),sensitivity:7,interval:123};if(this.$unit.length&&this.$unit.hoverIntent){this.$unit.hoverIntent(l)}this.$el.off("click.ht_add_grow").on("click.ht_add_grow",function(){if(!this.is_animated){if(e("body").hasClass("option")){this.animate_out(m,g)}}}.bind(this,m,g));this.$el.data("animate_out",this.animate_out.bind(this,m,g));this.$el.data("animate_in",this.animate_in.bind(this))},animate_out:function(q,l){clearTimeout(this.t_animation);this.hover_intent_active=true;if(this.is_animated||this.controls_hover){return}this.is_animated=true;var n=e(".hello_posts_ui .ht_post").index(this.$box);$others_open=e(".hello_posts_ui .ht_post:not(:eq("+n+"))").filter(".is_expanded");if($others_open.length>0){$others_open.each(function(B,C){e(C).parent().data("animate_in")()})}e(".hello_posts_ui .ht_post:not(:eq("+n+"))").removeClass("front");this.$box.addClass("front").addClass("shadow");this.$box.removeClass("not_expanded");this.$box.addClass("is_expanded");var y=e(window).innerWidth();var x=e(window).innerHeight();var i=window.pageYOffset;var w=i+x;var u=0;var A=y;var h=this.$box.offset();var s=h.top;var m=h.left+this.box_width;var j=h.top+this.box_height;var o=h.left;var g=l;var v=q;if((l+(this.nudge_padding*2))>x){g=(x-(this.nudge_padding*2));v=((g*q)/x)}if((q+(this.nudge_padding*2))>y){v=(y-(this.nudge_padding*2));g=((v*l)/y)}var t=((g-this.box_height)/2)*-1;var z=((v-this.box_width)/2)*-1;var p=((g-this.box_height)/2)*-1;var k=((v-this.box_width)/2)*-1;var r=0;if((s+t)<i){r=((s+t)-i)-this.nudge_padding;t-=r;p+=r}else{if((j-p)>w){r=((j-p)-w)+this.nudge_padding;t-=r;p+=r}}if((o+k)<u){r=((o+k)-u)-this.nudge_padding;k-=r;z+=r}else{if((m-z)>A){r=((m-z)-A)+this.nudge_padding;k-=r;z+=r}}this.$box.css({top:parseInt(t+this.original_pos_top,10)+"px",right:parseInt(z+this.original_pos_right,10)+"px",bottom:parseInt(p+this.original_pos_bottom,10)+"px",left:parseInt(k+this.original_pos_left,10)+"px"});if(this.$stage.length&&this.$box.data("grow-stage-class")){this.$stage.addClass(this.$box.data("grow-stage-class"))}},animate_in:function(){this.hover_intent_active=false;if(this.$box.hasClass("active")){return}this.$box.removeClass("shadow");if(this.$stage.length&&this.$box.data("grow-stage-class")){this.$stage.removeClass(this.$box.data("grow-stage-class"))}clearTimeout(this.t_animation);this.t_animation=setTimeout(function(){this.$box.removeClass("front");this.$box.addClass("not_expanded");this.$box.removeClass("is_expanded")}.bind(this),220);this.$box.css({top:this.original_pos_top,right:this.original_pos_right,bottom:this.original_pos_bottom,left:this.original_pos_left});this.is_animated=false}});var d=f.extend({after_initialize:function(){var n=false;var m=false;$ul=this.$box.find("ul.conversation_lines");var j=this.$box.offset();var i=$ul.offset();var l=(j.top+this.box_height);if(this.$unit.hasClass("out_controls")){this.bottom_limit=10}$ul.find("li").each(function(s,q){$li=e(q);var p=$li.offset();var r=$li.outerHeight();if(((p.top-j.top)+r)>(this.box_height-this.bottom_limit)){if(s===0){m=true;var o=0;var t=l-p.top-this.bottom_limit;var u=l-p.top-($li.outerHeight()-$li.height())-this.bottom_limit;while($li.outerHeight()>t){if(o++>2000){break}$li.text(function(v,w){return w.replace(/\W*\s(\S)*$/,"...")})}$li.height(u);$ul.find("li:gt(0)").remove()}else{$li.remove();n=true}}}.bind(this));if(n&&!m){$ul.append('<li class="more">...</li>');var k=$ul.find("li:last");var g=k.offset();var h=k.outerHeight();if(((g.top-j.top)+h+10)>(this.box_height-this.bottom_limit)){$ul.find('li:not(".more"):last').remove()}}this.$box.addClass("hide_fade")}});var c=f.extend({after_initialize:function(){this.source=this.$box.data("source");this.$canvas=e("#gif_canvas_"+this.post_id);this.is_animating=false;this.$canvas.attr("width",this.box_width);this.$canvas.attr("height",this.box_height);this.image=new Image();this.image.src=this.source;this.image.onload=function(){this.image_loaded()}.bind(this);this.$box.data("start_gif",this.animation_on.bind(this));this.$box.data("stop_gif",this.animation_off.bind(this));this.$box.data("is_playing",this.is_playing.bind(this));this.$box.hover(this.animation_on.bind(this),this.animation_off.bind(this))},image_loaded:function(){var i=this.$box.data("grow-width");var g=this.$box.data("grow-height");if(i<=g){this.image_width=this.box_width;this.image_height=((this.box_width*g)/i);this.image_x=0;this.image_y=((this.image_height-this.box_height)/2)*-1}else{this.image_height=this.box_height;this.image_width=((this.box_height*i)/g);this.image_x=((this.image_width-this.box_width)/2)*-1;this.image_y=0}if(this.image_height<this.box_height){this.image_height=this.box_height;this.image_width=((this.box_height*i)/g);this.image_x=((this.image_width-this.box_width)/2)*-1;this.image_y=0}else{if(this.image_width<this.box_width){this.image_width=this.box_width;this.image_height=((this.box_width*g)/i);this.image_x=0;this.image_y=((this.image_height-this.box_height)/2)*-1}}this.$canvas.get(0).getContext("2d").drawImage(this.image,this.image_x,this.image_y,this.image_width,this.image_height);this.animation_off();var h="";if(e.browser.msie){h+=" ie"}this.$stage.append('<div class="big_gif_button'+h+'"><span class="jif">GIF</span></div>');this.$box.addClass("gif_player_ready").addClass("not_walking")},animation_on:function(){this.is_animating=true;this.$box.addClass("gif_playing");this.$box.removeClass("gif_paused");if(this.effect!="grow"){this.$box.addClass("is_walking");this.$box.removeClass("not_walking")}},animation_off:function(){this.is_animating=false;this.$box.addClass("gif_paused");this.$box.removeClass("gif_playing");if(this.effect!="grow"){this.$box.addClass("not_walking");this.$box.removeClass("is_walking")}},is_playing:function(){return this.is_animating}});b.HelloPost=f;b.HelloChat=d;b.HelloGif=c})(jQuery,Tumblr);function outerHTML(a){return a.outerHTML||(function(d){var c=document.createElement("div"),b;c.appendChild(d.cloneNode(true));b=c.innerHTML;c=null;return b})(a)}if("ab".substr(-1)!="b"){String.prototype.substr=function(a){return function(c,b){if(c<0){c=this.length+c}return a.call(this,c,b)}}(String.prototype.substr)};
(function(e,b){var f=Backbone.View.extend({el:".search_results_container",events:{"click .tumblelog_follow.follow":"follow","click .tumblelog_follow.unfollow":"unfollow"},initialize:function(){this.autopager_opts=this.options.autopager||{};this.results=this.options.results||0;this.strings=this.options.strings||{};this.query=this.options.query||false;if(!this.results){return}new Tumblr.Elevator();this.setup_autopager();this.setup_lightboxes()},__:function(g){return this.strings[g]||g},setup_lightboxes:function(){this.$posts=this.$el.find('.post[data-lightbox="true"]');this.$posts.each(function(){var g=e(this);if(g.data("lighbox_setup")){return}new Tumblr.HelloLightbox({el:g.parent(),post_el:g,lightbox_trigger:".post_glass",follow_source:"FOLLOW_SOURCE_BLOG_LIGHTBOX_SEARCH"});g.data("lighbox_setup",1)});this.$posts.on("click.search_results",function(){e(this).closest(".follow_blog").data("lightbox_opened",1)});this.setup_additional_lightbox_triggers()},setup_additional_lightbox_triggers:function(){var g=e(".follow_blog .name, .follow_blog .avatar");g.on("click",function(i){var h=e(this);i.stopPropagation();i.preventDefault();h.closest(".follow_blog").find(".post_glass").get(0).click()})},setup_autopager:function(){this.auto_pager=new Tumblr.SearchAutoPager({query:this.query,has_pages:this.autopager_opts.has_pages,before:this.autopager_opts.before,url:this.autopager_opts.url});this.auto_pager.before_pager_queue.push(this.before_autopager.bind(this));this.auto_pager.after_pager_queue.push(this.after_autopager.bind(this));this.auto_pager.handle_no_more_posts_queue.push(this.handle_no_more_posts.bind(this))},before_autopager:function(){this.start_autopager_loader()},after_autopager:function(){this.stop_autopager_loader();this.setup_lightboxes()},handle_no_more_posts:function(){this.message_autopager_loader("Sorry, we couldn't find any more results!")},start_autopager_loader:function(){this.$autopager_loader=e('<div class="search_loader"/>');this.$el.append(this.$autopager_loader);var g=new Tumblr.HelloLoader({el:this.$autopager_loader.get(0),dark:true});g.start()},stop_autopager_loader:function(){this.$autopager_loader.remove()},message_autopager_loader:function(g){this.stop_autopager_loader();this.$autopager_loader=e('<div class="search_loader has_message"/>');this.$autopager_loader.html(this.__(g));this.$el.append(this.$autopager_loader)},follow:function(i){var h=e(i.currentTarget),j=h.closest(".tumblelog_follow_toggle"),g=h.attr("data-tumblelog-name");i.preventDefault();Tumblr.follow({tumblelog:g,source:(h.closest(".follow_blog").data("lightbox_opened"))?"FOLLOW_SOURCE_SEARCH_RESULTS_AFTER_LIGHTBOX":"FOLLOW_SOURCE_SEARCH_RESULTS"},{success:function(){j.addClass("followed");e('.unfollow_button[data-tumblelog-name="'+g+'"]')}})},unfollow:function(i){var h=e(i.currentTarget),j=h.closest(".tumblelog_follow_toggle"),g=h.attr("data-tumblelog-name");i.preventDefault();Tumblr.unfollow({tumblelog:g},{success:function(){j.removeClass("followed");e('.follow_button[data-tumblelog-name="'+g+'"]')}})}});var c=Backbone.View.extend({initialize:function(){this.el=this.options.el;this$el=e(this.el);this.property=this.options.property||"background-color";this.interval=this.options.interval||0;if(!this.$el.length){return}this.random_color=setInterval(function(){this.setRandomColor({el:this.$el,property:this.property})}.bind(this),this.interval)},getRandomColor:function(g){return"#"+(Math.random()*16777215<<0).toString(16)},setRandomColor:function(g){var i=g.el||false;var h=g.property;if(i.length&&h){i.css(h,this.getRandomColor())}}});var a=Tumblr.TagPopover.extend({events:{"focus #search_query":"focus_search_query","blur #search_query":"blur_search_query","mouseup #search_query":"mouseup_search_query","keyup #search_query":"keyup_search_query","keydown #search_query":"keydown_search_query","click #popover_search .popover_menu_item":"click_popover","submit #search_form":"submit","mouseenter #popover_search":"mouseenter","mouseenter .popover_menu_item a":"mouseenter_search_type","mouseleave #popover_search":"mouseleave_search_type"},initialize:function(){this.options.popover_selector="#popover_search";Tumblr.TagPopover.prototype.initialize.call(this);this.search_term=this.$search_query.val();if(this.options.promo){this.should_show_promo()}this.capturing=(Tumblr.Capture)?new Tumblr.Capture.SearchPopover():null;this.pressed_keys=[]},should_show_promo:function(){if(Tumblr.Cookie.get("search_promo")!=1){this.show_promo()}},show_promo:function(){if(!this.promo_popover){this.promo_popover=new Tumblr.Popover({el:e("#popover_search_promo").parent(),popover:e("#popover_search_promo"),disable_auto_show:true,on_show:function(){e("#glass_overlay").addClass("blue");e("#search_field").addClass("showing_search_promo over_glass")},on_hide:this.hide_promo.bind(this)})}this.promo_popover.show();this.promo_popover.popover.find(".search_promo_button").on("click",function(g){this.hide_promo()}.bind(this));this.$search_query.on("focus.search_promo",function(g){this.hide_promo()}.bind(this))},hide_promo:function(){this.promo_popover.hide();this.promo_popover.popover.remove();this.$search_query.off("focus.search_promo");e("#glass_overlay").removeClass("blue");e("#search_field").removeClass("showing_search_promo over_glass");Tumblr.Cookie.set("search_promo",1);this.popover.show();this.$search_query.focus()},click_popover:function(i){var h=this.$(i.currentTarget);var g=h.find("a").attr("href");if(i.metaKey||i.altKey){window.open(g);i.stopPropagation();i.preventDefault()}this.popover.hide()},setup_autocomplete:function(){this.auto_complete=new Tumblr.AutoCompleteSearch({el:this.$search_query,store:"/svc/search",popover:this.popover,include:Tumblr.EXISTING_TAGS})},focus_search_query:function(){this.$search_field.addClass("active");this.currentIndex=-1;this.set_search_type(this.search_type);if(this.$search_query.val()==this.$search_query.attr("placeholder")){this.$search_query.val("")}if(this.$search_query.val().length){this.auto_complete.lookup()}else{if(!this.has_children(this.$tracked_tags)&&!this.has_children(this.$autocomplete_results)){return}this.popover.show();this.$("#unread_tag_notice").hide();this.$search_query.removeClass("with_unread")}},blur_search_query:function(){if(this.$search_query.val()==this.auto_complete.init_value){this.set_search_type(this.search_type)}if(this.$search_query.val()===""){this.set_search_type("tag")}},keyup_search_query:function(g){this.pressed_keys[g.keyCode]=0;if(this.$search_query.val()!==this.auto_complete.init_value){this.set_search_type("tag")}else{this.set_search_type(this.search_type)}if(!this.pressed_keys[16]){this.set_search_type(this.search_type)}},keydown_search_query:function(g){this.pressed_keys[g.keyCode]=1;if(this.pressed_keys[18]){this.set_search_type("blog")}if(this.pressed_keys[18]&&g.keyCode==13){g.stopPropagation();g.preventDefault();this.do_blog_search()}},mouseup_search_query:function(){this.$search_query.select()},set_active:function(j){var g=e(this.popover_selector+" .popover_menu_item a").filter(":visible");var i=g.filter(":focus");if(i.length){this.currentIndex=(j==="previous")?g.index(i)-1:g.index(i)+1}if(this.currentIndex>=0&&this.currentIndex<g.length){g.get(this.currentIndex).focus()}else{if(this.currentIndex==-2&&j==="previous"){g.get(g.length-1).focus();this.currentIndex=g.length-1}else{this.currentIndex=-1;this.$search_query.focus()}}var h=(this.currentIndex>=0)?e(g.get(this.currentIndex)):false;if(h.length){if(h.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}if(h.closest(".search_results_section").hasClass("tag")){this.set_search_type("tag")}}},set_search_type:function(g){this.search_type=g;if(g=="blog"){this.$search_form.removeClass("is_tag_search").addClass("is_blog_search")}if(g=="tag"){this.$search_form.addClass("is_tag_search").removeClass("is_blog_search")}},do_blog_search:function(){var g=e.trim(this.$search_query.val());document.location="/search/blogs?q="+g},mouseenter_search_type:function(h){var g=e(h.currentTarget);if(g.length&&g.closest(".search_results_section").hasClass("blog")){this.set_search_type("blog")}else{this.set_search_type("tag")}},mouseleave_search_type:function(){this.set_search_type("tag")}});var d=Backbone.View.extend({events:{keyup:"keyup"},initialize:function(){this.endpoint=this.options.endpoint||"/svc/search/";this.threshold=this.options.threshold||1;this.cache_size=this.options.cache_size||15;this.init_value=this.$el.val();this.form_key=e("#tumblr_form_key").attr("content");this.cache={};this.queries=[];this.popover=this.options.popover;this.search_loading_template=e("#search_loading_template").html();this.search_results_template=e("#search_results_template").html();this.search_results_item_blogs_template=e("#search_results_item_blogs").html();this.search_results_item_tags_template=e("#search_results_item_tags").html();this.$search_query=e("#search_query");this.$search_results_container=e("#search_results_container");this.$tracked_tags=e(".tracked_tags.search_results_section");this.tracked_tags_markup=e("<div>").append(this.$tracked_tags.clone()).html()},keyup:_.throttle(function(g){this.lookup()},100),prepare_search_data:function(){this.queries.push(this.search_query);return{q:this.search_query_raw,form_key:this.form_key}},get_results:function(g){g=g||function(){};if(this.cache[this.search_query]){this.results=this.cache[this.search_query];g.call(this);return}this.search_in_progress=true;this.results={tags:{},blogs:{}};this.store_xhr=e.ajax({url:this.endpoint,data:this.prepare_search_data(),dataType:"json",method:"post"});this.store_xhr.success(_.bind(function(h){this.results=h;this.add_to_cache(this.search_query,h)},this));this.store_xhr.error(_.bind(function(h){},this));this.store_xhr.complete(_.bind(function(h){this.search_in_progress=false;g.call(this)},this))},lookup:function(){var h=e.trim(this.$el.val());var i=h.length;var g;if(i>=this.threshold&&h.length){this.search_query=_.escape(h);this.search_query_raw=h;this.get_results(_.bind(function(){this.update()},this))}else{this.reset_popover()}this.init=false;this.init_value=""},show_tracked_tags:function(){if(this.$tracked_tags.children().length>0){this.$tracked_tags.show()}else{this.popover.hide()}},hide_tracked_tags:function(){this.$tracked_tags.hide()},reset_popover:function(){if(this.tracked_tags_markup.length){this.$search_results_container.html(this.tracked_tags_markup)}else{this.popover.hide()}},add_to_cache:function(g,h){this.cache[g]=h;if(_.size(this.cache)>this.cache_size){delete this.cache[this.queries[0]];this.queries.shift()}},add_query_to_tags:function(g){var h=_.find(g,function(k){return(k.tag==this.search_query)}.bind(this));if(!h){var j={0:{tag:this.search_query,url:"/tagged/"+this.search_query,is_query:true}};var i=_.extend(g,j);return i}return g},inject_search_substring:function(g,i){if(!this.search_query){return}var h=new RegExp(this._escapeRegExp(this.search_query),"gi"),j=this.decorate_search_substring;if(!h){return}_.each(g,function(l,k){if(i=="tag"){g[k].hilite_tag=l.tag.replace(h,j)}if(i=="blog"){g[k].hilite_name=l.name.replace(h,j);g[k].hilite_title=l.title.replace(h,j);g[k].hilite_url=l.url.replace(h,j)}});return g},decorate_search_substring:function(g){return"<u>"+g+"</u>"},_escapeRegExp:function(g){return g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\~\`\!\@\#]/g,"\\$&")},update:function(){if(!this.results){return}var i=this.results.tags,m=this.results.blogs,k="",h=false,g=false,j=_.template(this.search_results_template),l;i=this.add_query_to_tags(i);i=this.inject_search_substring(i,"tag");m=this.inject_search_substring(m,"blog");if(_.size(i)){l={results:{type:"tag",items:i,query:this.search_query,item_template:this.search_results_item_tags_template}};k+=j(l)}j=_.template(this.search_results_template);l={results:{type:"blog",items:m,query:this.search_query,item_template:this.search_results_item_blogs_template}};k+=j(l);if(k.length){this.$search_results_container.html(k);this.popover.show()}else{this.reset_popover()}}});SearchAutoPager=Tumblr.HelloAutoPager.extend({update:function(){if(!this.options.query||!this.options.has_pages){return}this.updating=true;this.before_auto_pagination();if(this.options.before==-1||!this.options.before){this.handle_no_more_posts();return false}var g=e.ajax({url:this.options.url,type:"GET",data:{q:this.options.query,form_key:this.options.form_key.toLowerCase(),before:this.options.before}});g.success(function(h){this.options.before=parseInt(g.getResponseHeader("X-next-page"),10);this.append_posts(h)}.bind(this));g.error(function(){});g.complete(function(){this.updating=false;this.after_auto_pagination()}.bind(this))}});b.SearchResults=f;b.SearchPopover=a;b.SearchAutoPager=SearchAutoPager;b.AutoCompleteSearch=d;b.RandomColor=c})(jQuery,Tumblr);
(function(c,b){var a={};a.UserActions=Backbone.View.extend({el:"body",initialize:function(){this.form_key=c("#tumblr_form_key").attr("content");this.tracking_data={};this.tracking_data.context={};this.track_context();c(window).on("beforeunload.capture",_.bind(this.send_data,this))},send_data:function(){if(this.sending_data){return}var d=c.ajax({url:this.svc_url,dataType:"json",type:"POST",data:{form_key:this.form_key,log:this.tracking_data},async:false});this.sending_data=true},get_post_id:function(f,g){g=g||".post";var e=0,d=f.closest(g);if(d.length){e=d.attr("id").replace("post_","")}return e},unique_cookie:function(){var d=Tumblr.Cookie.get("capture")||this.form_key;if(d==this.form_key){Tumblr.Cookie.set("capture",this.form_key)}return d},track_context:function(){this.tracking_data.context.id=this.unique_cookie();this.tracking_data.context.language=(window.navigator.userLanguage||window.navigator.language).toLowerCase();this.tracking_data.context.path=document.location.pathname},track_signup_buttons:function(e){var f=c(e.target),d=f.attr("id").replace("signup_button_","");this.tracking_data.signup_button[d]=1},track_search:function(e){var d=c(e.target);this.tracking_data.search=d.serialize()},track_explore_tag:function(e){var d=c(e.target);this.tracking_data.explore=d.text()},track_spotlight_blog:function(f){var d=c(f.target),e=d.find(".tumblelog_name").text();this.tracking_data.spotlight=e},track_small_links:function(f){var e=c(f.target),d=e.attr("href");if(d=="/explore"){this.tracking_data.explore_link=1}if(d=="/spotlight"){this.tracking_data.spotlight_link=1}},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e),d={post_id:e.text()};this.tracking_data.post_tags.push(d)},track_post_info:function(f){var g=c(f.target),d=this.get_post_id(g),e=g.text();this.tracking_data.post_info={post_id:e}},track_post_controls:function(g){var f=c(g.target),d=this.get_post_id(f),e;if(f.hasClass("reblog_button")){e="reblog"}if(f.hasClass("like_button")){e="like"}if(f.hasClass("reblog_count")||f.closest(".reblog_count").length){e="notes"}this.tracking_data.post_controls[d]=this.tracking_data.post_controls[d]||[];this.tracking_data.post_controls[d][e]=1},track_post_content:function(h){var f=c(h.target),d=f.closest(".post"),g=this.get_post_id(f),i=d.attr("data-type")||"unknown",e=f[0].outerHTML.replace(/[\n\r]/g," ").replace(/\>\s+\/</g,"");this.tracking_data.post_content[g]=this.tracking_data.post_content[g]||{};this.tracking_data.post_content[g].post_type=i;this.tracking_data.post_content[g].clicks=this.tracking_data.post_content[g].clicks||[];this.tracking_data.post_content[g].clicks.push(e)},track_j_k_keys:function(e){var d=e.keyCode;if((d==74||d==75)&&!c("body").hasClass("show_form")){this.tracking_data.keycommands=1}},track_auto_pager:function(d){this.page_number=this.page_number||1;this.tracking_data.auto_pager=this.page_number;this.page_number++},track_recommendations:function(h){var f=c(h.target);var e=f.closest(".ht_post").data("id"),g=(f.hasClass("hello_tag"))?"tag":"thumbnail",d=f.attr("href");this.tracking_data.recommendations.push({post_id:e,type:g,url:d})},track_related_tag:function(e){var d=c(e.target),f=false;if(!d.hasClass(".tag")){d=d.closest(".tag")}f=c.trim(d.text());if(f&&f.length){this.tracking_data.related_tags.push(f)}},track_related_blog:function(f){var d=c(f.target),e=false;if(!d.hasClass(".blog")){d=d.closest(".blog")}e=d.data("tumblelog");if(e&&e.length){this.tracking_data.related_blogs.push(e)}},track_tag_source:function(){if(c("body").hasClass("sassafras")){this.tracking_data.tag_source="sassafras"}else{this.tracking_data.tag_source="default"}}});a.OnboardingDash=a.UserActions.extend({events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .tracked_tag .tag":"track_explore_tag","click #tag_editors .blog":"track_spotlight_blog","click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click #right_column .small_links a":"track_small_links",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_dashboard";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.explore="";this.tracking_data.explore_link=0;this.tracking_data.spotlight="";this.tracking_data.spotlight_link=0;this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}}});a.OnboardingTags=a.OnboardingDash.extend({events:_.extend({"click #related_tags .tag":"track_related_tag"},a.OnboardingDash.prototype.events),initialize:function(){a.OnboardingDash.prototype.initialize.call(this);this.svc_url="/svc/log/capture/logged_out_tags";this.tracking_data.related_tags=[];this.track_tag_source()}});a.HelloDash=a.UserActions.extend({el:"body",events:{"submit #search_form":"track_search","click .signup_buttons .chrome":"track_signup_buttons","click .ht_post .hello_tag":"track_post_tags","click .ht_post .go":"track_go_lightbox",keydown:"track_j_k_keys"},get_post_id:function(f,g){g=g||".post";var e=0,d=f.closest(g);if(d.length){e=d.attr("id").replace("ht_post_","")}return e},track_post_tags:function(g){var e=c(g.target),f=this.get_post_id(e,".ht_post"),d={};d[f]=e.text();this.tracking_data.post_tags.push(d)},track_go_lightbox:function(e){var d=c(e.target);this.tracking_data.go_lightbox.push(this.get_post_id(d,".ht_post"))},track_post_zoom_effect:function(){if(c('.ht_post[data-effect="grow"]').length||c(".ht_post").data("grow")){this.tracking_data.has_zoom=1}},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_dash";this.tracking_data.signup_button={};this.tracking_data.search="";this.tracking_data.post_tags=[];this.tracking_data.go_lightbox=[];this.tracking_data.has_zoom=0;this.track_post_zoom_effect()}});a.HelloTags=a.HelloDash.extend({el:"body",events:_.extend({"click .related_blogs_navigation .blog":"track_related_blog","click .related_tags_navigation .tag":"track_related_tag"},a.HelloDash.prototype.events),initialize:function(){a.HelloDash.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_tags";this.tracking_data.related_blogs=[];this.tracking_data.related_tags=[];this.tracking_data.auto_pager=0;if(Tumblr.HelloDashAutoPager){Tumblr.HelloDashAutoPager.after_pager_queue.push(this.track_auto_pager.bind(this))}this.track_tag_source()}});a.HelloLightbox=a.UserActions.extend({events:{"click .post .tag":"track_post_tags","click .post_info a":"track_post_info","click .post_controls a":"track_post_controls","click .post_content > *":"track_post_content","click .recommendations a":"track_recommendations",keydown:"track_j_k_keys"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture/hello_lightbox";this.tracking_data.post_tags=[];this.tracking_data.post_info={};this.tracking_data.post_controls={};this.tracking_data.post_content={};this.tracking_data.keycommands=0;this.tracking_data.auto_pager=0;this.tracking_data.recommendations=[];this.track_auto_pager();if(window.AfterAutoPaginationQueue){window.AfterAutoPaginationQueue.push(this.track_auto_pager.bind(this))}}});a.PremiumRadar=a.UserActions.extend({el:"#tumblr_radar",events:{"click .radar_content a":"track_radar_content","click .radar_controls a":"track_radar_controls","click .radar_footer a":"track_radar_footer","click .sponsored_badge":"track_radar_badge"},initialize:function(){if(!this.$el.hasClass("premium")){return}a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_premium_radar";this.tracking_data.radar_id={};this.tracking_data.radar_content=[];this.tracking_data.radar_controls={};this.tracking_data.radar_footer=0;this.tracking_data.radar_badge=0},send_data:function(){if(!this.tracking_data.radar_id.post_id){return}a.UserActions.prototype.send_data.call(this)},track_radar_id:function(){if(this.tracking_data.radar_id.post_id){return}this.tracking_data.radar_id={tumblelog:this.$el.data("tumblelog"),post_id:this.$el.data("post-id")}},track_follow:function(d){if(d.hasClass("followed")){this.tracking_data.radar_controls.unfollow=1}if(!d.hasClass("followed")){this.tracking_data.radar_controls.follow=1}},track_like:function(d){if(d.hasClass("liked")){this.tracking_data.radar_controls.unlike=1}if(!d.hasClass("liked")){this.tracking_data.radar_controls.like=1}},track_reblog:function(e,d){this.tracking_data.radar_controls.reblog=(d.altKey)?2:1},track_radar_content:function(e){var d=c(e.target);d=(d.is("a"))?d:d.closest("a");this.tracking_data.radar_content.push({clicked:d.attr("href")});this.track_radar_id()},track_radar_controls:function(g){var f=c(g.target);f=(f.is("a"))?f:f.closest("a");var h=(f.hasClass("follow"))?"follow":((f.hasClass("reblog"))?"reblog":"like");if(h=="reblog"){var d=this;var e=function(i){d.track_reblog(c(i.target),i);d.track_radar_id();c("body").off("click.capturejs")};c("body").on("click.capturejs","#create_post > button",e)}else{this["track_"+h](f,g);this.track_radar_id()}},track_radar_footer:function(d){this.tracking_data.radar_footer=1;this.track_radar_id()},track_radar_badge:function(d){this.tracking_data.radar_badge=1;this.track_radar_id()}});a.SearchPopover=a.UserActions.extend({el:"#header",events:{"mousedown .tracked_tags .result_link":"track_tracked_tag","mousedown .tag .result_link":"track_tag","mousedown .blog .result_link":"track_blog","mousedown .blog .more_results_link":"track_blog","keydown #popover_search":"keyup"},initialize:function(){a.UserActions.prototype.initialize.call(this);this.svc_url="/svc/log/capture_search";this.$search_field=this.$el.find("#search_query");this.$search_popover=this.$el.find("#popover_search");this.tracking_data.query=0;this.tracking_data.tag=0;this.tracking_data.blog=0;this.tracking_data.search_tag=0;this.tracking_data.search_blog=0;this.tracking_data.tracked_tag=0},send_data:function(){if(this.tracking_data.query===0){return}a.UserActions.prototype.send_data.call(this)},get_query:function(){var d=c.trim(this.$search_field.val());return((d.length)?1:0)},get_tag_name:function(d){return c.trim(d.text()).replace("#","")},get_tumblelog_name:function(d){return(d)?d.attr("data-tumblelog-name"):""},track_query:function(d){this.tracking_data.query=this.get_query()},track_tag:function(e){var d=c(e.currentTarget);if(d.closest(".result.is_query").length){this.tracking_data.search_tag++}else{this.tracking_data.tag++}this.track_query()},track_tracked_tag:function(d){this.tracking_data.tracked_tag++;this.track_query()},track_blog:function(e){var d=c(e.currentTarget);if(d.hasClass("more_results_link")){this.tracking_data.search_blog++}else{this.tracking_data.blog++}this.track_query()},track_submit:function(d){this.track_query()},keyup:function(e){if(e.keyCode==13){var d=c(document.activeElement);if(d.hasClass("more_results_link")){this.tracking_data.search_blog++;this.track_query()}if(d.hasClass("result_link")){if(d.closest(".tracked_tags").length){this.tracking_data.tracked_tag++;this.track_query()}if(d.closest(".tag").length){if(d.closest(".result.is_query").length){this.tracking_data.search_tag++}else{this.tracking_data.tag++}this.track_query()}if(d.closest(".blog").length){this.tracking_data.blog++;this.track_query()}}}}});b.Capture=a})(jQuery,Tumblr);
