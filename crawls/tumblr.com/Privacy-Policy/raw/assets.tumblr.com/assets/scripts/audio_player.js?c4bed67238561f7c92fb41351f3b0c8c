(function(s,c,r){var q;a:{var e=/audio(\.min)?\.js.*/,d=document.getElementsByTagName("script");q=0;for(var i=d.length;q<i;q++){var b=d[q].getAttribute("src");if(e.test(b)){q=b.replace(e,"");break a}}q=""}e='      <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="$1" width="1" height="1" name="$1" style="position: absolute; left: -1px;">         <param name="movie" value="$2?playerInstance='+s+'.instances[\'$1\']&datetime=$3">         <param name="allowscriptaccess" value="always">         <embed name="$1" src="$2?playerInstance='+s+'.instances[\'$1\']&datetime=$3" width="1" height="1" allowscriptaccess="always">       </object>';d=q+"player-graphics.gif";q+="audiojs.swf";i=document.createElement("audio");i=!(i.canPlayType&&i.canPlayType("audio/mpeg;").replace(/no/,""));r[s]={instanceCount:0,instances:{},flashSource:e,settings:{autoplay:!1,loop:!1,preload:!0,imageLocation:d,swfLocation:q,useFlash:i,hasFlash:function(){if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"]){return !0}if(navigator.mimeTypes&&navigator.mimeTypes.length){var g=navigator.mimeTypes["application/x-shockwave-flash"];return g&&g.enabledPlugin}try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(f){}return !1}(),createPlayer:{markup:'          <div class="play-pause">             <p class="play"></p>             <p class="pause"></p>             <p class="loading"></p>             <p class="error"></p>           </div>           <div class="scrubber">             <div class="progress"></div>             <div class="loaded"></div>           </div>           <div class="time">             <em class="played">00:00</em>/<strong class="duration">00:00</strong>           </div>           <div class="error-message"></div>',playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:'        .audiojs audio { position: absolute; left: -1px; }         .audiojs { width: 460px; height: 36px; background: #404040; overflow: hidden; font-family: monospace; font-size: 12px;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #444), color-stop(0.5, #555), color-stop(0.51, #444), color-stop(1, #444));           background-image: -moz-linear-gradient(center top, #444 0%, #555 50%, #444 51%, #444 100%);           -webkit-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); -moz-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3);           -o-box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.3); }         .audiojs .play-pause { width: 25px; height: 40px; padding: 4px 6px; margin: 0px; float: left; overflow: hidden; border-right: 1px solid #000; }         .audiojs p { display: none; width: 25px; height: 40px; margin: 0px; cursor: pointer; }         .audiojs .play { display: block; }         .audiojs .scrubber { position: relative; float: left; width: 280px; background: #5a5a5a; height: 14px; margin: 10px; border-top: 1px solid #3f3f3f; border-left: 0px; border-bottom: 0px; overflow: hidden; }         .audiojs .progress { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #ccc; z-index: 1;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #ccc), color-stop(0.5, #ddd), color-stop(0.51, #ccc), color-stop(1, #ccc));           background-image: -moz-linear-gradient(center top, #ccc 0%, #ddd 50%, #ccc 51%, #ccc 100%); }         .audiojs .loaded { position: absolute; top: 0px; left: 0px; height: 14px; width: 0px; background: #000;           background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #222), color-stop(0.5, #333), color-stop(0.51, #222), color-stop(1, #222));           background-image: -moz-linear-gradient(center top, #222 0%, #333 50%, #222 51%, #222 100%); }         .audiojs .time { float: left; height: 36px; line-height: 36px; margin: 0px 0px 0px 6px; padding: 0px 6px 0px 12px; border-left: 1px solid #000; color: #ddd; text-shadow: 1px 1px 0px rgba(0, 0, 0, 0.5); }         .audiojs .time em { padding: 0px 2px 0px 0px; color: #f9f9f9; font-style: normal; }         .audiojs .time strong { padding: 0px 0px 0px 2px; font-weight: normal; }         .audiojs .error-message { float: left; display: none; margin: 0px 10px; height: 36px; width: 400px; overflow: hidden; line-height: 36px; white-space: nowrap; color: #fff;           text-overflow: ellipsis; -o-text-overflow: ellipsis; -icab-text-overflow: ellipsis; -khtml-text-overflow: ellipsis; -moz-text-overflow: ellipsis; -webkit-text-overflow: ellipsis; }         .audiojs .error-message a { color: #eee; text-decoration: none; padding-bottom: 1px; border-bottom: 1px solid #999; white-space: wrap; }                 .audiojs .play { background: url("$1") -2px -1px no-repeat; }         .audiojs .loading { background: url("$1") -2px -31px no-repeat; }         .audiojs .error { background: url("$1") -2px -61px no-repeat; }         .audiojs .pause { background: url("$1") -2px -91px no-repeat; }                 .playing .play, .playing .loading, .playing .error { display: none; }         .playing .pause { display: block; }                 .loading .play, .loading .pause, .loading .error { display: none; }         .loading .loading { display: block; }                 .error .time, .error .play, .error .pause, .error .scrubber, .error .loading { display: none; }         .error .error { display: block; }         .error .play-pause p { cursor: auto; }         .error .error-message { display: block; }',trackEnded:function(){},flashError:function(){var g=this.settings.createPlayer,f=o(g.errorMessageClass,this.wrapper),h='Missing <a href="http://get.adobe.com/flashplayer/">flash player</a> plugin.';this.mp3&&(h+=' <a href="'+this.mp3+'">Download audio file</a>.');r[s].helpers.removeClass(this.wrapper,g.loadingClass);r[s].helpers.addClass(this.wrapper,g.errorClass);f.innerHTML=h},loadError:function(){var g=this.settings.createPlayer,f=o(g.errorMessageClass,this.wrapper);r[s].helpers.removeClass(this.wrapper,g.loadingClass);r[s].helpers.addClass(this.wrapper,g.errorClass);f.innerHTML='Error loading: "'+this.mp3+'"'},init:function(){r[s].helpers.addClass(this.wrapper,this.settings.createPlayer.loadingClass)},loadStarted:function(){var g=this.settings.createPlayer,f=o(g.durationClass,this.wrapper),j=Math.floor(this.duration/60),h=Math.floor(this.duration%60);r[s].helpers.removeClass(this.wrapper,g.loadingClass);f.innerHTML=(10>j?"0":"")+j+":"+(10>h?"0":"")+h},loadProgress:function(g){var f=this.settings.createPlayer,h=o(f.scrubberClass,this.wrapper);o(f.loaderClass,this.wrapper).style.width=h.offsetWidth*g+"px"},playPause:function(){this.playing?this.settings.play():this.settings.pause()},play:function(){r[s].helpers.addClass(this.wrapper,this.settings.createPlayer.playingClass)},pause:function(){r[s].helpers.removeClass(this.wrapper,this.settings.createPlayer.playingClass)},updatePlayhead:function(g){var f=this.settings.createPlayer,h=o(f.scrubberClass,this.wrapper);o(f.progressClass,this.wrapper).style.width=h.offsetWidth*g+"px";f=o(f.playedClass,this.wrapper);h=this.duration*g;g=Math.floor(h/60);h=Math.floor(h%60);f.innerHTML=(10>g?"0":"")+g+":"+(10>h?"0":"")+h}},create:function(g,f){f=f||{};return g.length?this.createAll(f,g):this.newInstance(g,f)},createAll:function(h,f){var m=f||document.getElementsByTagName("audio"),l=[];h=h||{};for(var k=0,j=m.length;k<j;k++){l.push(this.newInstance(m[k],h))}return l},newInstance:function(g,f){var k=this.helpers.clone(this.settings),j="audiojs"+this.instanceCount,h="audiojs_wrapper"+this.instanceCount;this.instanceCount++;null!=g.getAttribute("autoplay")&&(k.autoplay=!0);null!=g.getAttribute("loop")&&(k.loop=!0);"none"==g.getAttribute("preload")&&(k.preload=!1);f&&this.helpers.merge(k,f);k.createPlayer.markup?g=this.createPlayer(g,k.createPlayer,h):g.parentNode.setAttribute("id",h);h=new r[c](g,k);k.css&&this.helpers.injectCss(h,k.css);k.useFlash&&k.hasFlash?(this.injectFlash(h,j),this.attachFlashEvents(h.wrapper,h)):k.useFlash&&!k.hasFlash&&this.settings.flashError.apply(h);(!k.useFlash||k.useFlash&&k.hasFlash)&&this.attachEvents(h.wrapper,h);return this.instances[j]=h},createPlayer:function(g,f,k){var j=document.createElement("div"),h=g.cloneNode(!0);j.setAttribute("class","audiojs");j.setAttribute("className","audiojs");j.setAttribute("id",k);h.outerHTML&&!document.createElement("audio").canPlayType?(h=this.helpers.cloneHtml5Node(g),j.innerHTML=f.markup,j.appendChild(h),g.outerHTML=j.outerHTML,j=document.getElementById(k)):(j.appendChild(h),j.innerHTML+=f.markup,g.parentNode.replaceChild(j,g));return j.getElementsByTagName("audio")[0]},attachEvents:function(g,f){if(f.settings.createPlayer){var k=f.settings.createPlayer,j=o(k.playPauseClass,g),h=o(k.scrubberClass,g);r[s].events.addListener(j,"click",function(){f.playPause.apply(f)});r[s].events.addListener(h,"click",function(l){l=l.clientX;var n=this,m=0;if(n.offsetParent){do{m+=n.offsetLeft}while(n=n.offsetParent)}f.skipTo((l-m)/h.offsetWidth)});f.settings.useFlash||(r[s].events.trackLoadProgress(f),r[s].events.addListener(f.element,"timeupdate",function(){f.updatePlayhead.apply(f)}),r[s].events.addListener(f.element,"ended",function(){f.trackEnded.apply(f)}),r[s].events.addListener(f.source,"error",function(){clearInterval(f.readyTimer);clearInterval(f.loadTimer);f.settings.loadError.apply(f)}))}},attachFlashEvents:function(g,f){f.swfReady=!1;f.load=function(h){f.mp3=h;f.swfReady&&f.element.load(h)};f.loadProgress=function(h,j){f.loadedPercent=h;f.duration=j;f.settings.loadStarted.apply(f);f.settings.loadProgress.apply(f,[h])};f.skipTo=function(h){h>f.loadedPercent||(f.updatePlayhead.call(f,[h]),f.element.skipTo(h))};f.updatePlayhead=function(h){f.settings.updatePlayhead.apply(f,[h])};f.play=function(){f.settings.preload||(f.settings.preload=!0,f.element.init(f.mp3));f.playing=!0;f.element.pplay();f.settings.play.apply(f)};f.pause=function(){f.playing=!1;f.element.ppause();f.settings.pause.apply(f)};f.setVolume=function(h){f.element.setVolume(h)};f.loadStarted=function(){f.swfReady=!0;f.settings.flashReady&&f.settings.flashReady.apply(f);f.settings.preload&&f.mp3&&f.element.init(f.mp3);f.settings.autoplay&&f.play.apply(f)}},injectFlash:function(g,f){var k=this.flashSource.replace(/\$1/g,f),k=k.replace(/\$2/g,g.settings.swfLocation),k=k.replace(/\$3/g,+new Date+Math.random()),j=g.wrapper.innerHTML,h=document.createElement("div");h.innerHTML=k+j;g.wrapper.innerHTML=h.innerHTML;g.element=this.helpers.getSwf(f)},helpers:{merge:function(g,f){for(attr in f){if(g.hasOwnProperty(attr)||f.hasOwnProperty(attr)){g[attr]=f[attr]}}},clone:function(g){if(null==g||"object"!==typeof g){return g}var f=new g.constructor,h;for(h in g){f[h]=arguments.callee(g[h])}return f},addClass:function(g,f){RegExp("(\\s|^)"+f+"(\\s|$)").test(g.className)||(g.className+=" "+f)},removeClass:function(g,f){g.className=g.className.replace(RegExp("(\\s|^)"+f+"(\\s|$)")," ")},injectCss:function(k,j){for(var u="",t=document.getElementsByTagName("style"),p=j.replace(/\$1/g,k.settings.imageLocation),m=0,n=t.length;m<n;m++){var l=t[m].getAttribute("title");if(l&&~l.indexOf("audiojs")){n=t[m];if(n.innerHTML===p){return}u=n.innerHTML;break}}t=document.getElementsByTagName("head")[0];m=t.firstChild;n=document.createElement("style");t&&(n.setAttribute("type","text/css"),n.setAttribute("title","audiojs"),n.styleSheet?n.styleSheet.cssText=u+p:n.appendChild(document.createTextNode(u+p)),m?t.insertBefore(n,m):t.appendChild(styleElement))},cloneHtml5Node:function(g){var f=document.createDocumentFragment(),h=f.createElement?f:document;h.createElement("audio");h=h.createElement("div");f.appendChild(h);h.innerHTML=g.outerHTML;return h.firstChild},getSwf:function(f){f=document[f]||window[f];return 1<f.length?f[f.length-1]:f}},events:{memoryLeaking:!1,listeners:[],addListener:function(g,f,h){g.addEventListener?g.addEventListener(f,h,!1):g.attachEvent&&(this.listeners.push(g),this.memoryLeaking||(window.attachEvent("onunload",function(){if(this.listeners){for(var k=0,j=this.listeners.length;k<j;k++){r[s].events.purge(this.listeners[k])}}}),this.memoryLeaking=!0),g.attachEvent("on"+f,function(){h.call(g,window.event)}))},trackLoadProgress:function(g){if(g.settings.preload){var f,j,h=/(ipod|iphone|ipad)/i.test(navigator.userAgent);f=setInterval(function(){-1<g.element.readyState&&(h||g.init.apply(g));1<g.element.readyState&&(g.settings.autoplay&&g.play.apply(g),clearInterval(f),j=setInterval(function(){g.loadProgress.apply(g);1<=g.loadedPercent&&clearInterval(j)}))},10);g.readyTimer=f;g.loadTimer=j}},purge:function(g){var f=g.attributes,h;if(f){for(h=0;h<f.length;h+=1){"function"===typeof g[f[h].name]&&(g[f[h].name]=null)}}if(f=g.childNodes){for(h=0;h<f.length;h+=1){purge(g.childNodes[h])}}},ready:function(C){var B=window,A=!1,z=!0,y=B.document,x=y.documentElement,w=y.addEventListener?"addEventListener":"attachEvent",v=y.addEventListener?"removeEventListener":"detachEvent",u=y.addEventListener?"":"on",t=function(f){if(!("readystatechange"==f.type&&"complete"!=y.readyState)&&(("load"==f.type?B:y)[v](u+f.type,t,!1),!A&&(A=!0))){C.call(B,f.type||f)}},p=function(){try{x.doScroll("left")}catch(f){setTimeout(p,50);return}t("poll")};if("complete"==y.readyState){C.call(B,"lazy")}else{if(y.createEventObject&&x.doScroll){try{z=!B.frameElement}catch(n){}z&&p()}y[w](u+"DOMContentLoaded",t,!1);y[w](u+"readystatechange",t,!1);B[w](u+"load",t,!1)}}}};r[c]=function(g,f){this.element=g;this.wrapper=g.parentNode;this.source=g.getElementsByTagName("source")[0]||g;var h=g.getElementsByTagName("source")[0];this.mp3=g.getAttribute("src")||(h?h.getAttribute("src"):null);this.settings=f;this.loadStartedCalled=!1;this.loadedPercent=0;this.duration=1;this.playing=!1};r[c].prototype={updatePlayhead:function(){this.settings.updatePlayhead.apply(this,[this.element.currentTime/this.duration])},skipTo:function(f){f>this.loadedPercent||(this.element.currentTime=this.duration*f,this.updatePlayhead())},load:function(f){this.loadStartedCalled=!1;this.source.setAttribute("src",f);this.element.load();this.mp3=f;r[s].events.trackLoadProgress(this)},loadError:function(){this.settings.loadError.apply(this)},init:function(){this.settings.init.apply(this)},loadStarted:function(){if(!this.element.duration){return !1}this.duration=this.element.duration;this.updatePlayhead();this.settings.loadStarted.apply(this);return !0},loadProgress:function(){null!=this.element.buffered&&this.element.buffered.length&&(this.loadStartedCalled||(this.loadStartedCalled=this.loadStarted()),this.loadedPercent=this.element.buffered.end(this.element.buffered.length-1)/this.duration,this.settings.loadProgress.apply(this,[this.loadedPercent]))},playPause:function(){this.playing?this.pause():this.play()},play:function(){/(ipod|iphone|ipad)/i.test(navigator.userAgent)&&0==this.element.readyState&&this.init.apply(this);this.settings.preload||(this.settings.preload=!0,this.element.setAttribute("preload","auto"),r[s].events.trackLoadProgress(this));this.playing=!0;this.element.play();this.settings.play.apply(this)},pause:function(){this.playing=!1;this.element.pause();this.settings.pause.apply(this)},setVolume:function(f){this.element.volume=f},trackEnded:function(){this.skipTo.apply(this,[0]);this.settings.loop||this.pause.apply(this);this.settings.trackEnded.apply(this)}};var o=function(j,h){var p=[];h=h||document;if(h.getElementsByClassName){p=h.getElementsByClassName(j)}else{var n,m,l=h.getElementsByTagName("*"),k=RegExp("(^|\\s)"+j+"(\\s|$)");n=0;for(m=l.length;n<m;n++){k.test(l[n].className)&&p.push(l[n])}}return 1<p.length?p:p[0]}})("audiojs","audiojsInstance",this);
(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(h,e){var d=new Date().getTime();var f=Math.max(0,16-(d-b));var g=window.setTimeout(function(){h(d+f)},f);b=d+f;return g}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());(function(d,b){var c=c||function(f){return f};var a=function(f){if(!(this instanceof a)){return new a(f)}this.options=f;this.config=d.extend(true,{},a.defaults,this.options);this.config.audiojs_settings=d.extend({},audiojs.settings,a.defaults.audiojs_settings,this.config.audiojs_settings);this.localized=d.extend({no_id3:"Listen",flash_error:'<a href="http://get.adobe.com/flashplayer/">Flash 9 is required to listen to audio.</a>'},this.config.localized);this.__init();a.register(this);return this};a.prototype={playing:false,onscreen:true,animation_interval:false,animation_callback:false,animation_arguments:[],last_tick:0,__init:function(){this.__build_track_list();this.title=a.format_title(this.tracks[0]);if(typeof this.config.template==="string"){this.config.template=_.template(this.config.template)}this.$container=d(this.config.template({service:this.config.service,source_title:this.config.source_title,source_url:this.config.source_url,cover:this.config.cover,tracks:this.config.tracks,title:this.title}));if(this.config.replace){d(this.config.replace).replaceWith(this.$container)}else{if(this.config.append_to){d(this.config.append_to).append(this.$container)}else{if(this.config.prepend_to){d(this.config.prepend_to).prepend(this.$container)}}}this.__cache_selectors();this.__proxy_functions();this.$player.addClass(this.config.player_classes);this.starting_track_id=this.config.start_at||0;if(!this.track_info(this.starting_track_id,"artist")&&!this.track_info(this.starting_track_id,"track")&&!this.track_info(this.starting_track_id,"album")){this.$message_text.html(this.localized.no_id3);this.$player.addClass("message")}this.__init_visualizations();this.config.audiojs_settings.createPlayer.markup="";this.config.audiojs_settings.createPlayer.css="";this.__init_audiojs();if(!this.audiojs.settings.useFlash||!this.audiojs.settings.hasFlash){this.bind_events()}d(document.body).trigger("tumblr:audio:ready",{audioplayer:this})},__init_audiojs:function(){this.element=this.config.el||this.__create_el(this.config.wrapper||this.$player.get(0));this.audiojs=audiojs.create(this.element,this.config.audiojs_settings);this.audiojs.audioplayer=this;this.check_flash_error()},__create_el:function(f){return d("<audio/>").attr({type:"audio/mp3"}).appendTo(f).get(0)},__cache_selectors:function(){this.$player=this.$container.find(".audio_player");if(this.track_info(0,"cover")){this.$container.addClass("has_art")}this.$controls=this.$container.find(".audio_controls");this.$visualizer=this.$container.find(".audio_visualizer");this.$message_container=this.$container.find(".audio_message_container");this.$message_text=this.$container.find(".audio_message_text");this.$overlay=this.$container.find(".audio_player_overlay");this.$progress_container=this.$container.find(".progress_container");this.$load_progress=this.$container.find(".load_progress");this.$play_progress=this.$container.find(".play_progress");this.$playhead=this.$container.find(".playhead");this.$seek_overlay=this.$container.find(".seek_overlay");this.$seek_position=this.$container.find(".seek_position");this.$seek_time=this.$container.find(".seek_time");this.$play_pause_container=this.$container.find(".play_pause_container");this.$play_button=this.$container.find(".play_button");this.$pause_button=this.$container.find(".pause_button");this.$text_wrapper=this.$container.find(".player_text_wrapper");this.$text=this.$container.find(".player_text");this.$track_name=this.$container.find(".track_name");this.$artist_name=this.$container.find(".artist_name");this.$album_name=this.$container.find(".album_name");this.truncate_text();this.$current_time=this.$container.find(".current_time");this.$total_time=this.$container.find(".total_time");this.$album_art_container=this.$container.find(".album_art_container");this.$main_album_art=this.$container.find(".album_art.main");this.$album_art=this.$container.find(".album_art").not(this.$main_album_art).hide()},__init_visualizations:function(){this.$visualizer.empty();if(this.config.eq){this.generate_equalizer();this.equalizer_levels(0);this.real_frequencies=a.has_equalizer_support();this.$container.addClass("has_visualizer")}},__proxy_functions:function(){this._on_focus_player=d.proxy(this.on_focus_player,this);this._album_art_lightbox=d.proxy(this.album_art_lightbox,this);this._on_overlay_mousedown=d.proxy(this.on_overlay_mousedown,this);this._on_seek_mouseenter=d.proxy(this.on_seek_mouseenter,this);this._on_seek_mousemove=d.proxy(this.on_seek_mousemove,this);this._on_seek_mouseleave=d.proxy(this.on_seek_mouseleave,this);this._on_seek_begin=d.proxy(this.on_seek_begin,this);this._on_seek_move=d.proxy(this.on_seek_move,this);this._on_seek_end=d.proxy(this.on_seek_end,this);this._on_audio_playing=d.proxy(this.on_audio_playing,this);this._on_audio_pause=d.proxy(this.on_audio_pause,this);this._play=d.proxy(this.play,this);this._pause=d.proxy(this.pause,this);this._load_progress=d.proxy(this.load_progress,this);this._play_progress=d.proxy(this.play_progress,this)},__build_track_list:function(f){this.tracks=f||this.config.tracks;if(!this.tracks.length){this.tracks=[d.extend({},a.defaults.tracks[0])];this.tracks[0].bpm=this.config.bpm;this.tracks[0].stream_url=this.config.stream_url;this.tracks[0].track=this.config.track;this.tracks[0].artist=this.config.artist;this.tracks[0].album=this.config.album;this.tracks[0].cover=this.config.cover}},bind_events:function(){if(a.has_touch_support()){this.$album_art_container.on("touchstart",this._album_art_lightbox);this.$overlay.on("touchstart",this._on_overlay_mousedown);this.$seek_overlay.on({mouseenter:this._on_seek_mouseenter,mouseleave:this._on_seek_mouseleave,mousemove:this._on_seek_mousemove,mousedown:this._on_seek_begin})}else{this.$player.on("mousedown",this._on_focus_player);this.$album_art_container.on("mousedown",this._album_art_lightbox);this.$overlay.on("mousedown",this._on_overlay_mousedown);this.$seek_overlay.on({mouseenter:this._on_seek_mouseenter,mouseleave:this._on_seek_mouseleave,mousemove:this._on_seek_mousemove,mousedown:this._on_seek_begin})}d(document.body).on({"tumblr:audio:playing":this._on_audio_playing,"tumblr:audio:pause":this._on_audio_pause})},unbind_events:function(){this.$album_art_container.off("touchstart",this._album_art_lightbox);this.$overlay.off("touchstart",this._on_overlay_mousedown);this.$player.off("mousedown",this._on_focus_player);this.$album_art_container.off("mousedown",this._album_art_lightbox);this.$overlay.off("mousedown",this._on_overlay_mousedown);this.$seek_overlay.off({mouseenter:this._on_seek_mouseenter,mouseleave:this._on_seek_mouseleave,mousemove:this._on_seek_mousemove,mousedown:this._on_seek_begin});d(document.body).off({mousemove:this._on_seek_move,mouseup:this._on_seek_end,"tumblr:audio:playing":this._on_audio_playing,"tumblr:audio:pause":this._on_audio_pause});this.unbind_key_events()},check_flash_error:function(){var f=this.audiojs.settings.useFlash&&!this.audiojs.settings.hasFlash;if(f&&!this.flash_error){this.audiojs.settings.flashError.apply(this.audiojs)}},on_focus_player:function(f){if(f&&!a.is_left_click(f)){return true}a.set_key_commands(true,true)},on_overlay_mousedown:function(f){if(f&&!a.is_left_click(f)){return true}if(this.flash_error){return true}else{if(!this.audiojs.loadedPercent){if(this.load_track(this.config.start_at)){this.play()}}else{if(!this.error){this.play_pause()}}}f.preventDefault()},on_seek_mouseenter:function(f){this.$progress_container.addClass("seek")},on_seek_mousemove:function(g){var f=this.get_seek_progress(g.pageX-this.$progress_container.offset().left);this.$seek_position.css("left",(100*f)+"%");if(this.$progress_container.width()*Math.abs(this.play_progress-f)<5){this.$player.addClass("playhead_hover")}else{this.$player.removeClass("playhead_hover")}if(this.total_time){this.$seek_time.text(a.format_time(f*this.total_time))}},on_seek_mouseleave:function(f){this.$player.removeClass("playhead_hover");this.$progress_container.removeClass("seek")},on_audio_playing:function(g,f){a.handling_on_play=true;if(a.config.one_at_a_time&&f.audioplayer!==this){if(this.current_state("unplayed")){this.paused_animation_start(true)}else{if(this.playing){this.pause()}}}a.handling_on_play=false},on_audio_pause:function(g,f){if(a.handling_on_play){return}if(a.config.one_at_a_time&&f.audioplayer!==this){if(this.current_state("unplayed")){this.demo_animation_start()}}},on_seek_begin:function(f){if(f&&!a.is_left_click(f)){return true}this.$player.addClass("seeking");d(document.body).addClass("grabbing");this.was_playing=this.audiojs.playing;if(this.was_playing){this.$player.addClass("was_playing")}this.pause();d(document.body).on({mousemove:this._on_seek_move,mouseup:this._on_seek_end});this.seek_move_timeout=_.delay(this._on_seek_move,50,f,true);this.on_focus_player(f);return false},on_seek_move:function(h,f){clearTimeout(this.seek_move_timeout);if(!f){this.$player.addClass("show_seek_time")}this.on_seek_mousemove(h);var g=this.get_seek_progress();this.set_play_progress(g);this.set_time(g*this.total_time,this.total_time)},on_seek_end:function(f){this.$player.removeClass("seeking show_seek_time was_playing");d(document.body).removeClass("grabbing");this.skip_to(Math.min(this.total_time?(this.total_time-0.1)/this.total_time:1,this.get_seek_progress(f.pageX-this.$progress_container.offset().left)));if(this.was_playing){this.play()}d(document.body).off({mousemove:this._on_seek_move,mouseup:this._on_seek_end})},load_track:function(h){if(this.current_track_id===h){return false}if(h>=this.tracks.length||h<0){return false}if(this.audiojs.playing){this.pause()}var g=!this.current_track_id;this.current_track_id=h;this.current_track=this.tracks[h];this.$track_name.text(this.current_track.track);this.$artist_name.text(this.current_track.artist);this.$album_name.text(this.current_track.album);this.$current_album_art=d(this.$album_art.get(h));this.$current_album_art.show();this.$album_art.not(this.$current_album_art).hide();this.truncate_text();this.$player.removeClass("message");var f=this.config.post_key?"?play_key="+this.config.post_key:"";this.audiojs.load(this.current_track.stream_url+f);this.equalizer_levels(0);if(!this.audiojs.settings.useFlash){this.use_audio_context(Tumblr.AudioPlayer.context)}return true},play_pause:function(){return this.audiojs.playing?this.audiojs.pause():this.audiojs.play()},play:function(){return this.audiojs.play()},pause:function(){return this.audiojs.pause()},skip_to:function(f){return this.audiojs.skipTo(f)},previous_track:function(){if(this.load_track(this.current_track_id-1)){this.play();return true}return false},next_track:function(){if(this.load_track(this.current_track_id+1)){this.play();return true}return false},get_seek_progress:function(f){if(typeof f!=="number"){f=this.$seek_position.position().left}return Math.max(0,Math.min(f/this.$progress_container.width(),1))},set_play_progress:function(f){this.$play_progress.width((100*f)+"%");this.$playhead.css("left",(100*f)+"%")},set_time:function(g,f){if(typeof g!=="number"){g=0}this.$current_time.text(a.format_time(g));if(typeof f!=="number"){return}this.$total_time.text(a.format_time(f))},set_load_progress:function(f){this.$load_progress.width((100*f)+"%")},album_art_lightbox:function(f){if(f&&!a.is_left_click(f)){return true}var g=this.current_track_info("cover");if(!g){return false}return this.config.lightbox.init([{high_res:g}])},truncate_text:function(g){var h=this.$text_wrapper.width();if(!h){if(typeof g!=="number"){g=10}if(g>0){_.delay(d.proxy(this.truncate_text,this),100,--g);return}}var f=this.max_lines(this.$track_name,3,"...");this.max_lines(this.$artist_name,4-f,"...")},max_lines:function(f,n,j){var m=d(f);var l=m.clone().css("opacity",0.5).text("A");m.after(l);var k=l.height(),h=k*n;if(!m.data("full_text")){m.data("full_text",m.text())}if(!h){l.remove();m.text("");return n}l.text(m.data("full_text"));if(l.height()<=h){l.remove();m.text(m.data("full_text"));return Math.ceil(m.height()/k)}if(typeof j!=="string"){j="..."}var i=m.data("full_text").split(" ");var g=0;do{l.text(i.slice(0,++g).join(" ")+j)}while(l.height()<=h&&g<=i.length);m.text(i.slice(0,g-1).join(" ")+j);l.remove();return Math.ceil(m.height()/k)},use_audio_context:function(g){if(!g){return false}this.context=g;this.source=this.context.createMediaElementSource(this.audiojs.source);this.analyser_node=this.context.createAnalyser();this.analyser_node.fftSize=128;this.analyser_node.smoothingTimeConstant=0.2;this.frequency_array=new Uint8Array(this.analyser_node.frequencyBinCount);this.nodes=[this.source,this.analyser_node,this.context.destination];for(var f=1;f<this.nodes.length;f++){this.nodes[f-1].connect(this.nodes[f])}},read_analyser_frequencies:function(l,h,r,p){if(this.analyser_node){this.analyser_node.getByteFrequencyData(this.frequency_array)}else{if(this.audiojs.settings.useFlash&&this.audiojs.settings.hasFlash){var s;try{s=this.audiojs.element.getByteFrequencyData()}catch(m){return false}if(!s||s==="NO_ACCESS"||s.match(/ERR/)){this.equalizer_levels(0);return false}var j=s.match(/.{1,2}/g);var q=Math.floor(0.5*j.length);var f;var o=true;this.frequency_array=[];for(var k=0;k<q;k++){f=0.5*(parseInt(j[k],16)+parseInt(j[k+q],16));if(f){o=false}this.frequency_array.push(f)}if(o){return false}}else{return false}}if(typeof r!=="number"){r=1}if(typeof p!=="number"){p=0}var g=a.scale_array_values(this.frequency_array,this.config.eq.bands+p,true,function(t,n){t*=r;if(l){t/=l}if(h){return Math.max(0,Math.min(t,1))}else{return t}});if(p){return g.slice(0,this.config.eq.bands)}else{return g}},generate_equalizer:function(){if(this.$equalizer){this.$equalizer.remove()}var h=this.config.eq;if(!h){return false}this.$equalizer=d("<div/>").addClass("audio_equalizer");if(!this.config.preview&&!this.$container.hasClass("has_art")){h.bands=7}var g,j;for(var f=0;f<h.bands;f++){g=d("<div/>").addClass("audio_equalizer_band").data({wait:0,peak:0,level:0}).appendTo(this.$equalizer);for(var i=0;i<h.levels;i++){j=d("<b>").appendTo(g);if(i===h.levels-1){j.addClass("peak")}}}this.$visualizer.append(this.$equalizer);return true},equalizer_levels:function(i,j,g,f){if(!this.$equalizer){return false}if(typeof i!=="number"&&!d.isArray(i)){var h=[];this.$equalizer.children(".audio_equalizer_band").each(function(k,l){h[k]=d(l).data("level")});return h}this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(n,q){var r=0;if(typeof i==="number"){r=i}else{if(i&&n<i.length&&i[n]){r=i[n]}}var o=d(q);var l=this.config.eq.levels;var m=Math.floor(r*(l-1));var p=parseFloat(o.data("peak"))||0;var k=j||(r>p);if(k){o.data({wait:10,peak:r})}o.data("level",r);o.children("b").each(function(s,u){var t=d(u);t.removeClass("on");if(!g&&l-m<s+1){t.addClass("on")}if(k){t.removeClass("peak");if(f){if(l-m-0.5*f<=s+1&&l-m+0.5*f>s+1){t.addClass("peak")}}else{if(l-m===s+1){t.addClass("peak")}}}})},this));return true},equalizer_image:function(f){if(!this.$equalizer){return false}this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(g,i){var h=d(i);h.children("b").each(function(l,k){var j=d(k);j.removeClass("on peak");if(g>=f.length){return}if(l>=f[g].length){return}if(f[g][l]<0){j.addClass("on")}else{if(f[g][l]>0){j.addClass("peak")}}})},this));return true},equalizer_dolphin:function(f,j,i,h){var g=a.offset_image(a.dolphin_frames[i?1:0],f,j,h);return this.equalizer_image(g)},equalizer_peaks:function(){if(!this.$equalizer){return false}var f=true;this.$equalizer.children(".audio_equalizer_band").each(d.proxy(function(j,n){var k=d(n);var l=parseFloat(k.data("peak"))||0;var o=parseFloat(k.data("level"))||0;var m=parseFloat(k.data("wait"))||0;if(l!==o){f=false}if(m>0){k.data("wait",m-1);return}l=Math.max(l-0.1,o);k.data("peak",l);var g=this.config.eq.levels;var h=Math.floor(l*(g-1));k.data("peak",l);k.children("b").each(function(p,r){var q=d(r);q.removeClass("peak");if(g-h===p+1){q.addClass("peak")}})},this));return f},set_animation_callback:function(h,f,g){if(!h){return this.reset_animation()}this.animation_callback=h;this.animation_interval=f||30;this.animation_arguments=g||[];this.last_tick=0},reset_animation:function(){this.animation_callback=false;this.animation_interval=false;this.animation_arguments=[];this.last_tick=0},animation_tick:function(f,g){if(!this.animation_callback){return false}if(!(g||this.onscreen)){return false}if(this.last_tick&&f-this.last_tick<this.animation_interval){return false}this.animation_callback.apply(this,this.animation_arguments);this.last_tick=f;return true},demo_animation_start:function(g){if(a.config.disable_inactive_loop){return false}if(!(g||this.$player.hasClass("inactive"))){return false}var f=60;var h=this.current_track_info("bpm")||150;this.demo_frequency=h/2/Math.PI/f;this.demo_loop_index=0;this.set_animation_callback(this.demo_animation_tick,f)},demo_animation_tick:function(){this.loop_index++;var f=Math.abs(Math.tan(Math.sin(this.demo_frequency*this.demo_loop_index))*2/Math.PI);f*=0.5*Math.max(0,Math.sin(0.5*this.demo_frequency*this.demo_loop_index))+0.5;f=0.4*Math.abs(f)+0.6;this.equalizer_levels(this.generate_demo_eq(0.75*f,0.3,0.2,1.6));this.equalizer_peaks()},playing_animation_start:function(){var f=30;if(typeof this.fallback_offset!=="number"){this.fallback_offset=0}if(this.real_frequencies){this.set_animation_callback(this.visualizer_animation_tick,f,[true,true,false])}else{this.set_animation_callback(this.fallback_animation_tick,f)}},paused_animation_start:function(g){var f=30;if(g){this.equalizer_levels(0)}this.set_animation_callback(this.visualizer_animation_tick,f,[false,true,true])},visualizer_animation_tick:function(h,i,f){if(h){this.equalizer_levels(this.read_analyser_frequencies(255,true,1.3,2))}var g=false;if(i){g=this.equalizer_peaks()}if(g&&f){this.reset_animation()}},fallback_animation_tick:function(){if(this.playing){this.fallback_offset++}this.equalizer_levels(this.generate_sine_eq(this.fallback_offset),true,true,2)},idle_animation_start:function(){if(!this.$equalizer){return}this.dolphin_width=6;this.dolphin_height=5;this.dolphin_x=-this.dolphin_width;this.dolphin_y=0;this.dolphin_left=false;this.dolphin_up=false;this.dolphin_frame=0;this.dolphin_min_x=-1;this.dolphin_max_x=this.config.eq.bands-this.dolphin_width+1;this.dolphin_min_y=-1;this.dolphin_max_y=this.config.eq.levels-this.dolphin_height+1;if(!a.dolphin_frames){a.generate_dolphins()}this.set_animation_callback(this.idle_animation_tick,300)},idle_animation_tick:function(){this.equalizer_dolphin(this.dolphin_x,this.dolphin_y,this.dolphin_frame,this.dolphin_left);this.dolphin_frame=(this.dolphin_frame+1)%a.dolphin_frames.length;if(this.dolphin_frame!==0){return}this.dolphin_x+=this.dolphin_left?-1:1;this.dolphin_y+=this.dolphin_up?-1:1;if(!this.dolphin_left&&this.dolphin_x>=this.dolphin_max_x){this.dolphin_x=this.dolphin_max_x;this.dolphin_left=true}else{if(this.dolphin_left&&this.dolphin_x<=this.dolphin_min_x){this.dolphin_x=this.dolphin_min_x;this.dolphin_left=false}}if(!this.dolphin_up&&this.dolphin_y>=this.dolphin_max_y){this.dolphin_y=this.dolphin_max_y;this.dolphin_up=true}else{if(this.dolphin_up&&this.dolphin_y<=this.dolphin_min_y){this.dolphin_y=this.dolphin_min_y;this.dolphin_up=false}}},visualizer_fallback_tick:function(){var h=this.fallback_offset++;var g=this.config.eq.bands;var f=_.range(g).map(function(j,k){return 0.3*Math.sin(k+0.3*h)+0.5});this.equalizer_levels(f,true,true,2)},generate_sine_eq:function(h,f){var g=this.config.eq?this.config.eq.bands:11;if(typeof h!=="number"){h=0}if(typeof f!=="number"){f=0.3}return _.range(g).map(function(j,k){return f*Math.sin(k+0.3*h)+0.5})},generate_demo_eq:function(i,h,f,g){if(typeof i!=="number"){i=1}if(typeof h!=="number"){pad=0}if(typeof f!=="number"){f=0}if(typeof g!=="number"){g=1}return _.range(this.config.eq.bands).map(d.proxy(function(j,k){var l=Math.max(0,Math.min(1-k/(this.config.eq.bands-1)+h,1));return Math.pow(i*l*(f*Math.random()+1-f),g)},this))},track_info:function(h,g){if(!this.tracks.length){return}if(typeof h==="undefined"){h=this.config.start_at}if(h<0||h>=this.tracks.length){return}var f=this.tracks[h];return g?f[g]:f},current_track_info:function(f){return this.track_info(this.current_track_id,f)},is_onscreen:function(g){if(typeof g!=="number"){g=50}var i=this.$container.offset().top;var f=this.$container.offset().top+this.$container.height();var h=d(window).scrollTop();var j=h+d(window).height();if(i>j+g){return(this.onscreen=false)}if(f<h-g){return(this.onscreen=false)}return(this.onscreen=true)},current_state:function(f){var g="";if(this.playing){g="playing"}else{if(this.$player.hasClass("unplayed")){g="unplayed"}else{if(this.$player.hasClass("inactive")){g="inactive"}else{if(this.$player.hasClass("error")){g="error"}else{g="paused"}}}}if(typeof f==="undefined"){return g}else{return(g===f)}}};a.instances=[];a.register=function(f){this.instances.push(f)};a.unregister=function(f){this.instances.splice(_.indexOf(this.instances,f),1)};a.config={disable_inactive_loop:true,draw_offscreen:false,one_at_a_time:true,auto_advance:false,key_commands:true};a.key_commands=false;a.idle_delay=1;a.__init_jukebox=function(f){this.config=d.extend(this.config,f);d(document.body).on({"tumblr:audio:playing":d.proxy(function(i,h){this.current_player_id=d.inArray(h.audioplayer,this.instances);this.current_player=h.audioplayer;d("iframe.tumblr_video_iframe").each(function(j,k){k.contentWindow.postMessage("pause","*")})},this),"tumblr:audio:pause":d.proxy(function(i,h){},this),"tumblr:audio:ended":d.proxy(function(i,h){if(this.config.auto_advance){if(this.current_player_id+1<this.instances.length){this.instances[this.current_player_id+1].on_overlay_mousedown()}}},this),mousedown:d.proxy(function(h){this.set_key_commands(false)},this),keydown:d.proxy(function(i){if(!i){return false}if(!this.key_commands){return true}if(!this.current_player){return true}var h=i.charCode?i.charCode:i.keyCode;switch(h){case 32:this.current_player.play_pause();i.preventDefault();i.stopPropagation();return false;case 37:if(!(i.ctrlKey||i.metaKey)){return true}i.preventDefault();i.stopPropagation();if(this.current_player.current_time>2){this.current_player.skip_to(0);return false}return !this.current_player.previous_track();case 39:if(!(i.ctrlKey||i.metaKey)){return true}i.preventDefault();i.stopPropagation();return !this.current_player.next_track();case 27:this.set_key_commands(false);return false}},this)});d(window).on({scroll:_.debounce(d.proxy(function(h){this.update_onscreen()},this),100)});this.update_all();try{Tumblr.PostMessageListener.initialize(function(i,h){if(i[0]==="video_do_play"){Tumblr.AudioPlayer.pause_all()}})}catch(g){}};a.update_all=function(){var f=(!this.current_player||!this.current_player.playing);this.replace_placeholders();d.each(this.instances,d.proxy(function(h,g){g.is_onscreen();if(f&&g.current_state("unplayed")){g.demo_animation_start(false)}},this));this.animation_start()};a.update_onscreen=function(){d.each(this.instances,function(g,f){f.is_onscreen()})};a.pause_all=function(f){d.each(this.instances,function(h,g){if(f&&f===g.config.post_id){return}g.pause()})};a.animation_start=function(){if(this.animating){return}this.animating=true;window.cancelAnimationFrame(this.animation_frame);this.animation_frame=window.requestAnimationFrame(this._animation_tick)};a.animation_tick=function(){var f=Date.now();d.each(this.instances,d.proxy(function(h,g){g.animation_tick(f,this.config.draw_offscreen)},this));if(this.animating){this.animation_frame=window.requestAnimationFrame(this._animation_tick)}};a._animation_tick=d.proxy(a.animation_tick,a);a.animation_stop=function(f){this.animating=false;window.cancelAnimationFrame(this.animation_frame)};a.inactive_player_demo=function(){d.each(this.instances,function(g,f){if(f.current_state("unplayed")){f.demo_animation_start(false)}})};a.when_dolphins_cry=function(){d.each(this.instances,function(g,f){f.idle_animation_start()})};a.create_context=function(){try{this.context=new webkitAudioContext();return this.context}catch(f){return false}};a.replace_placeholders=function(f,g){var h=f?d(f):d(document.body);h.find(".audio_player_container.placeholder").each(function(k,m){var j=d(m);var n=j.data();var o=d("<div/>");j.before(o);var l=new a({post_key:n.postKey,replace:o,player_classes:n.playerClasses,post_id:n.postId,service:n.service,source_title:n.sourceTitle,source_url:n.sourceUrl,cover:n.cover,tracks:[{bpm:n.bpm,stream_url:n.streamUrl,track:n.track,artist:n.artist,album:n.album,cover:n.cover}],localized:{no_id3:n.noId3,flash_error:n.flashError}});j.remove()});if(g){this.clean_up(true)}};a.clean_up=function(h){if(!document.body){return}var g,f;for(g=0;g<this.instances.length;g++){f=this.instances[g];if(!f.$container.closest(document.body).length){this.unregister(f);g--}}if(h){this.sort()}};a.sort=function(){d.each(d(".audio_player_container"),function(g,f){d(f).data("tumblr_audioplayer_sort",g)});this.instances.sort(function(g,f){return g.$container.data("tumblr_audioplayer_sort")-f.$container.data("tumblr_audioplayer_sort")});this.current_player_id=d.inArray(this.current_player,this.instances)};a.scale_array_values=function(g,l,k,j){if(l<=0){return[]}if(g.length===l){if(typeof j==="function"){return g.slice().map(j)}else{return g.slice()}}if(l===1){var i=_.reduce(g,function(o,p){return o+p},0);if(typeof j==="function"){return[j(i)]}else{return[i]}}var f=_.range(l);var h=g.length/l;if(h>1){return f.map(function(n,q){var s=q*h;var p=q*h+h;var t=1-s%1;var r=p%1;s=Math.floor(s);p=Math.floor(p);if(!r&&s+1<p){p-=1;r=1}var m=t*g[s]+r*g[p];for(var o=s+1;o<p;o++){m+=g[o]}if(k){m/=h}if(typeof j==="function"){return j(m)}else{return m}})}else{return f.map(function(n,o){var p=Math.floor(o*h);var m=g[p]*h;if(k){m/=h}if(typeof j==="function"){return j(m)}else{return m}})}};a.format_title=function(f){var g="";if(f.artist){g+=f.artist}if(f.track){if(g){g+=" "}g+="&quot;"+f.track+"&quot;"}if(f.album){if(g){g+=" "}g+="(from '"+f.album+"')"}return g};a.format_time=function(i){if(!i||i<0){i=0}function h(l,k){if(typeof l!=="string"){l=l.toString()}return l.length<k?h("0"+l,k):l}var j=Math.floor(i%60);var g=Math.floor(i/60)%60;var f=Math.floor(i/3600);if(f){return f+":"+h(g,2)+":"+h(j,2)}else{return g+":"+h(j,2)}};a.has_equalizer_support=function(){if(this.context||this.create_context()){if(/chrome/.test(navigator.userAgent.toLowerCase())){return true}}else{if(Tumblr.flashVersion()>=9){return false}}return false};a.has_touch_support=function(){return("ontouchstart" in window||("onmsgesturechange" in window&&navigator.msMaxTouchPoints>1))};a.is_left_click=function(f){return !(f&&(f.which>1||f.which<=1&&f.ctrlKey))};a.generate_image=function(g,j){var f,l,k=[];for(var h=0;h<g.length;h++){f=h%j;l=Math.floor(h/j);if(!k[f]){k[f]=[]}switch(g[h]){case" ":k[f][l]=0;break;case"o":k[f][l]=-1;break;default:case"x":k[f][l]=1;break}}return k};a.offset_image=function(j,f,k,g){j=j.slice();if(g){j.reverse()}if(f>0){d.each(_.range(f),function(){j.unshift([])})}else{if(f<0){j.splice(0,-f)}}if(k){for(var h=0;h<j.length;h++){j[h]=j[h].slice();if(k>0){d.each(_.range(k),function(){j[h].unshift(0)})}else{if(k<0){j[h].splice(0,-k)}}}}return j};a.generate_dolphins=function(){this.dolphin_frames=[this.generate_image("   x  x  xx xxxxxxx oxoo   x  ",6),this.generate_image("   x     xx x xxxxxxoxoox  x  ",6)];return this.dolphin_frames};a.set_key_commands=function(f,g){if(this.ignore_next){this.ignore_next=false;return this.key_commands}if(g){this.ignore_next=true}this.key_commands=this.config.key_commands&&f;return this.key_commands};var e=(function(){var j=new RegExp("audio(\\.min|_src|_player)?\\.js.*"),k=new RegExp("(^[^/]+//[^/]+|)(/.*$)|(.*)"),f=document.getElementsByTagName("script");for(var g=0,h=f.length;g<h;g++){var l=f[g].getAttribute("src");if(j.test(l)){return l.replace(k,"$1")}}return""})();a.defaults={template:_.template('<div class="audio_player_container"><div class="album_art_container"><% if (cover) { %><img src="<%= cover %>" alt="<%= title %>" class="album_art main"/><% }%><% _.each(tracks, function(t, i) { %><% if (t.cover) { %><img src="<%= t.cover %>" alt="<%= Tumblr.AudioPlayer.format_title(t) %>" class="album_art album_art_<%= i %>"/><% }%><% }); %></div><div class="audio_player inactive unplayed"><div class="audio_controls"><div class="progress_container"><div class="load_progress"></div><div class="play_progress"></div><i class="playhead"></i><i class="seek_position"></i><i class="seek_time"></i></div><div class="player_text_wrapper"><div class="player_text"><% if (tracks.length) { %><ul class="id3_tags"><li class="track_name"><%= tracks[0].track %></li><li class="artist_name"><%= tracks[0].artist %></li><li class="album_name"><%= tracks[0].album %></li></ul><% } %></div></div><ul class="time_container"><li class="current_time">0:00</li><li class="separator"> / </li><li class="total_time">0:00</li></ul><div class="seek_overlay"></div><div class="play_pause_container"><i class="play_button audio_player_button">'+c("Play")+'</i><i class="pause_button audio_player_button">'+c("Pause")+'</i><i class="error_x audio_player_button">'+c("X")+'</i></div><div class="audio_message_container"><span class="audio_message_text">'+c("Listen")+'</span></div></div><div class="audio_visualizer"></div><div class="audio_player_overlay"></div></div></div>'),preview:false,eq:{width:330,height:84,padding_x:16,padding_y:7,bands:11,levels:14,tick_width:18,tick_height:3,tick_radius:2,tick_margin_x:10,tick_margin_y:2},cover:"",service:"",source_title:"",source_url:"#",player_classes:"",autoplay:false,tracks:[{bpm:150,stream_url:"",track:"",artist:"",album:"",cover:""}],start_at:0,lightbox:Tumblr.Lightbox,audiojs_settings:{swfLocation:e+"/javascript/audio-js/audiojs.swf",createPlayer:{playPauseClass:"play_pause_container",scrubberClass:"progress_container",progressClass:"play_progress",loaderClass:"load_progress",timeClass:"time_container",durationClass:"total_time",playedClass:"current_time",errorMessageClass:"audio_message_text",playingClass:"playing",loadingClass:"loading",errorClass:"error"},css:"",trackEnded:function(g){var f=this.audioplayer;f.playing=false;audiojs.settings.trackEnded.apply(this,arguments);f.$player.addClass("inactive");f.paused_animation_start(true);f.idle_timeout=_.delay(d.proxy(f.idle_animation_start,f),a.idle_delay*1000);d(document.body).trigger("tumblr:audio:ended",{audioplayer:f})},flashError:function(){if(!this.audioplayer){return}audiojs.settings.flashError.apply(this,arguments);var f=this.audioplayer;f.playing=false;f.flash_error=true;f.error=true;f.$player.addClass("inactive error flash_error").removeClass("playing");f.$message_text.html(f.localized.flash_error)},loadError:function(){audiojs.settings.loadError.apply(this,arguments);var f=this.audioplayer;f.error=true;f.$player.addClass("inactive error").removeClass("playing");f.$message_text.html(c("Error"))},init:function(){return audiojs.settings.init.apply(this,arguments)},loadStarted:function(){audiojs.settings.loadStarted.apply(this,arguments);var f=this.audioplayer;f.error=false},loadProgress:function(f){return audiojs.settings.loadProgress.apply(this,arguments)},flashReady:function(){var f=this.audioplayer;f.__cache_selectors();f.__init_visualizations();f.bind_events()},play:function(){audiojs.settings.play.apply(this,arguments);var f=this.audioplayer;f.$player.removeClass("inactive unplayed");f.playing=true;f.playing_animation_start();clearTimeout(f.idle_timeout);d(document.body).trigger("tumblr:audio:playing",{audioplayer:f})},pause:function(){audiojs.settings.pause.apply(this,arguments);var f=this.audioplayer;f.playing=false;f.paused_animation_start();clearTimeout(f.idle_timeout);d(document.body).trigger("tumblr:audio:pause",{audioplayer:f})},updatePlayhead:function(g){audiojs.settings.updatePlayhead.apply(this,arguments);var f=this.audioplayer;f.$player.addClass("duration");f.total_time=this.element.duration||this.duration;f.current_time=f.total_time*g;f.play_progress=f.current_time/f.total_time;f.set_play_progress(f.play_progress);f.set_time(f.current_time,f.total_time);d(document.body).trigger("tumblr:audio:update",{current_time:a.format_time(f.current_time),total_time:a.format_time(f.total_time),audioplayer:f})}}};b.AudioPlayer=a;d(function(){if(Tumblr.AudioPlayerSettings&&!d.isEmptyObject(Tumblr.AudioPlayerSettings)){Tumblr.AudioPlayer.defaults=d.extend(Tumblr.AudioPlayer.defaults,Tumblr.AudioPlayerSettings)}if(window.AfterAutoPaginationQueue&&_.indexOf(AfterAutoPaginationQueue,a.replace_placeholders)<0){AfterAutoPaginationQueue.push(d.proxy(a.update_all,a))}a.__init_jukebox()});d(window).on("load",function(f){a.create_context()})})(jQuery,Tumblr);
