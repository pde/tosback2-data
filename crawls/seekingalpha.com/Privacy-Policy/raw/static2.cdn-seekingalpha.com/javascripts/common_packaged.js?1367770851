/*Created at: 05/05/13 12:20:48*/
var Prototype={Version:'1.6.1',Browser:(function(){var ua=navigator.userAgent;var isOpera=Object.prototype.toString.call(window.opera)=='[object Opera]';return{IE:!!window.attachEvent&&!isOpera,Opera:isOpera,WebKit:ua.indexOf('AppleWebKit/')>-1,Gecko:ua.indexOf('Gecko')>-1&&ua.indexOf('KHTML')===-1,MobileSafari:/Apple.*Mobile.*Safari/.test(ua)}})(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:(function(){var constructor=window.Element||window.HTMLElement;return!!(constructor&&constructor.prototype);})(),SpecificElementExtensions:(function(){if(typeof window.HTMLDivElement!=='undefined')
return true;var div=document.createElement('div');var form=document.createElement('form');var isSupported=false;if(div['__proto__']&&(div['__proto__']!==form['__proto__'])){isSupported=true;}
div=form=null;return isSupported;})()},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)
Prototype.BrowserFeatures.SpecificElementExtensions=false;var Abstract={};var Try={these:function(){var returnValue;for(var i=0,length=arguments.length;i<length;i++){var lambda=arguments[i];try{returnValue=lambda();break;}catch(e){}}
return returnValue;}};var Class=(function(){function subclass(){};function create(){var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))
parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent){subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)
klass.addMethods(properties[i]);if(!klass.prototype.initialize)
klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}
function addMethods(source){var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length){if(source.toString!=Object.prototype.toString)
properties.push("toString");if(source.valueOf!=Object.prototype.valueOf)
properties.push("valueOf");}
for(var i=0,length=properties.length;i<length;i++){var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super"){var method=value;value=(function(m){return function(){return ancestor[m].apply(this,arguments);};})(property).wrap(method);value.valueOf=method.valueOf.bind(method);value.toString=method.toString.bind(method);}
this.prototype[property]=value;}
return this;}
return{create:create,Methods:{addMethods:addMethods}};})();(function(){var _toString=Object.prototype.toString;function extend(destination,source){for(var property in source)
destination[property]=source[property];return destination;}
function inspect(object){try{if(isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}catch(e){if(e instanceof RangeError)return'...';throw e;}}
function toJSON(object){var type=typeof object;switch(type){case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(isElement(object))return;var results=[];for(var property in object){var value=toJSON(object[property]);if(!isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';}
function toQueryString(object){return $H(object).toQueryString();}
function toHTML(object){return object&&object.toHTML?object.toHTML():String.interpret(object);}
function keys(object){var results=[];for(var property in object)
results.push(property);return results;}
function values(object){var results=[];for(var property in object)
results.push(object[property]);return results;}
function clone(object){return extend({},object);}
function isElement(object){return!!(object&&object.nodeType==1);}
function isArray(object){return _toString.call(object)=="[object Array]";}
function isHash(object){return object instanceof Hash;}
function isFunction(object){return typeof object==="function";}
function isString(object){return _toString.call(object)=="[object String]";}
function isNumber(object){return _toString.call(object)=="[object Number]";}
function isUndefined(object){return typeof object==="undefined";}
extend(Object,{extend:extend,inspect:inspect,toJSON:toJSON,toQueryString:toQueryString,toHTML:toHTML,keys:keys,values:values,clone:clone,isElement:isElement,isArray:isArray,isHash:isHash,isFunction:isFunction,isString:isString,isNumber:isNumber,isUndefined:isUndefined});})();Object.extend(Function.prototype,(function(){var slice=Array.prototype.slice;function update(array,args){var arrayLength=array.length,length=args.length;while(length--)array[arrayLength+length]=args[length];return array;}
function merge(array,args){array=slice.call(array,0);return update(array,args);}
function argumentNames(){var names=this.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,'').replace(/\s+/g,'').split(',');return names.length==1&&!names[0]?[]:names;}
function bind(context){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=slice.call(arguments,1);return function(){var a=merge(args,arguments);return __method.apply(context,a);}}
function bindAsEventListener(context){var __method=this,args=slice.call(arguments,1);return function(event){var a=update([event||window.event],args);return __method.apply(context,a);}}
function curry(){if(!arguments.length)return this;var __method=this,args=slice.call(arguments,0);return function(){var a=merge(args,arguments);return __method.apply(this,a);}}
function delay(timeout){var __method=this,args=slice.call(arguments,1);timeout=timeout*1000
return window.setTimeout(function(){return __method.apply(__method,args);},timeout);}
function defer(){var args=update([0.01],arguments);return this.delay.apply(this,args);}
function wrap(wrapper){var __method=this;return function(){var a=update([__method.bind(this)],arguments);return wrapper.apply(this,a);}}
function methodize(){if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){var a=update([this],arguments);return __method.apply(null,a);};}
return{argumentNames:argumentNames,bind:bind,bindAsEventListener:bindAsEventListener,curry:curry,delay:delay,defer:defer,wrap:wrap,methodize:methodize}})());Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+'-'+
(this.getUTCMonth()+1).toPaddedString(2)+'-'+
this.getUTCDate().toPaddedString(2)+'T'+
this.getUTCHours().toPaddedString(2)+':'+
this.getUTCMinutes().toPaddedString(2)+':'+
this.getUTCSeconds().toPaddedString(2)+'Z"';};RegExp.prototype.match=RegExp.prototype.test;RegExp.escape=function(str){return String(str).replace(/([.*+?^=!:${}()|[\]\/\\])/g,'\\$1');};var PeriodicalExecuter=Class.create({initialize:function(callback,frequency){this.callback=callback;this.frequency=frequency;this.currentlyExecuting=false;this.registerCallback();},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),this.frequency*1000);},execute:function(){this.callback(this);},stop:function(){if(!this.timer)return;clearInterval(this.timer);this.timer=null;},onTimerEvent:function(){if(!this.currentlyExecuting){try{this.currentlyExecuting=true;this.execute();this.currentlyExecuting=false;}catch(e){this.currentlyExecuting=false;throw e;}}}});Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,(function(){function prepareReplacement(replacement){if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};}
function gsub(pattern,replacement){var result='',source=this,match;replacement=prepareReplacement(replacement);if(Object.isString(pattern))
pattern=RegExp.escape(pattern);if(!(pattern.length||pattern.source)){replacement=replacement('');return replacement+source.split('').join(replacement)+replacement;}
while(source.length>0){if(match=source.match(pattern)){result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}else{result+=source,source='';}}
return result;}
function sub(pattern,replacement,count){replacement=prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match){if(--count<0)return match[0];return replacement(match);});}
function scan(pattern,iterator){this.gsub(pattern,iterator);return String(this);}
function truncate(length,truncation){length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);}
function strip(){return this.replace(/^\s+/,'').replace(/\s+$/,'');}
function stripTags(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,'');}
function stripScripts(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');}
function extractScripts(){var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});}
function evalScripts(){return this.extractScripts().map(function(script){return eval(script)});}
function escapeHTML(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function unescapeHTML(){return this.stripTags().replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&');}
function toQueryParams(separator){var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair){if((pair=pair.split('='))[0]){var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash){if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});}
function toArray(){return this.split('');}
function succ(){return this.slice(0,this.length-1)+
String.fromCharCode(this.charCodeAt(this.length-1)+1);}
function times(count){return count<1?'':new Array(count+1).join(this);}
function camelize(){var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)
camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;}
function capitalize(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();}
function underscore(){return this.replace(/::/g,'/').replace(/([A-Z]+)([A-Z][a-z])/g,'$1_$2').replace(/([a-z\d])([A-Z])/g,'$1_$2').replace(/-/g,'_').toLowerCase();}
function dasherize(){return this.replace(/_/g,'-');}
function inspect(useDoubleQuotes){var escapedString=this.replace(/[\x00-\x1f\\]/g,function(character){if(character in String.specialChar){return String.specialChar[character];}
return'\\u00'+character.charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";}
function toJSON(){return this.inspect(true);}
function unfilterJSON(filter){return this.replace(filter||Prototype.JSONFilter,'$1');}
function isJSON(){var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);}
function evalJSON(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());}
function include(pattern){return this.indexOf(pattern)>-1;}
function startsWith(pattern){return this.indexOf(pattern)===0;}
function endsWith(pattern){var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;}
function empty(){return this=='';}
function blank(){return/^\s*$/.test(this);}
function interpolate(object,pattern){return new Template(this,pattern).evaluate(object);}
return{gsub:gsub,sub:sub,scan:scan,truncate:truncate,strip:String.prototype.trim?String.prototype.trim:strip,stripTags:stripTags,stripScripts:stripScripts,extractScripts:extractScripts,evalScripts:evalScripts,escapeHTML:escapeHTML,unescapeHTML:unescapeHTML,toQueryParams:toQueryParams,parseQuery:toQueryParams,toArray:toArray,succ:succ,times:times,camelize:camelize,capitalize:capitalize,underscore:underscore,dasherize:dasherize,inspect:inspect,toJSON:toJSON,unfilterJSON:unfilterJSON,isJSON:isJSON,evalJSON:evalJSON,include:include,startsWith:startsWith,endsWith:endsWith,empty:empty,blank:blank,interpolate:interpolate};})());var Template=Class.create({initialize:function(template,pattern){this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object){if(object&&Object.isFunction(object.toTemplateReplacements))
object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match){if(object==null)return(match[1]+'');var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null){var comp=match[1].startsWith('[')?match[2].replace(/\\\\]/g,']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable=(function(){function each(iterator,context){var index=0;try{this._each(function(value){iterator.call(context,value,index++);});}catch(e){if(e!=$break)throw e;}
return this;}
function eachSlice(number,iterator,context){var index=-number,slices=[],array=this.toArray();if(number<1)return array;while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);}
function all(iterator,context){iterator=iterator||Prototype.K;var result=true;this.each(function(value,index){result=result&&!!iterator.call(context,value,index);if(!result)throw $break;});return result;}
function any(iterator,context){iterator=iterator||Prototype.K;var result=false;this.each(function(value,index){if(result=!!iterator.call(context,value,index))
throw $break;});return result;}
function collect(iterator,context){iterator=iterator||Prototype.K;var results=[];this.each(function(value,index){results.push(iterator.call(context,value,index));});return results;}
function detect(iterator,context){var result;this.each(function(value,index){if(iterator.call(context,value,index)){result=value;throw $break;}});return result;}
function findAll(iterator,context){var results=[];this.each(function(value,index){if(iterator.call(context,value,index))
results.push(value);});return results;}
function grep(filter,iterator,context){iterator=iterator||Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(RegExp.escape(filter));this.each(function(value,index){if(filter.match(value))
results.push(iterator.call(context,value,index));});return results;}
function include(object){if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value){if(value==object){found=true;throw $break;}});return found;}
function inGroupsOf(number,fillWith){fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice){while(slice.length<number)slice.push(fillWith);return slice;});}
function inject(memo,iterator,context){this.each(function(value,index){memo=iterator.call(context,memo,value,index);});return memo;}
function invoke(method){var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});}
function max(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value>=result)
result=value;});return result;}
function min(iterator,context){iterator=iterator||Prototype.K;var result;this.each(function(value,index){value=iterator.call(context,value,index);if(result==null||value<result)
result=value;});return result;}
function partition(iterator,context){iterator=iterator||Prototype.K;var trues=[],falses=[];this.each(function(value,index){(iterator.call(context,value,index)?trues:falses).push(value);});return[trues,falses];}
function pluck(property){var results=[];this.each(function(value){results.push(value[property]);});return results;}
function reject(iterator,context){var results=[];this.each(function(value,index){if(!iterator.call(context,value,index))
results.push(value);});return results;}
function sortBy(iterator,context){return this.map(function(value,index){return{value:value,criteria:iterator.call(context,value,index)};}).sort(function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');}
function toArray(){return this.map();}
function zip(){var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))
iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});}
function size(){return this.toArray().length;}
function inspect(){return'#<Enumerable:'+this.toArray().inspect()+'>';}
return{each:each,eachSlice:eachSlice,all:all,every:all,any:any,some:any,collect:collect,map:collect,detect:detect,findAll:findAll,select:findAll,filter:findAll,grep:grep,include:include,member:include,inGroupsOf:inGroupsOf,inject:inject,invoke:invoke,max:max,min:min,partition:partition,pluck:pluck,reject:reject,sortBy:sortBy,toArray:toArray,entries:toArray,zip:zip,size:size,inspect:inspect,find:detect};})();function $A(iterable){if(!iterable)return[];if('toArray'in Object(iterable))return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
function $w(string){if(!Object.isString(string))return[];string=string.strip();return string?string.split(/\s+/):[];}
Array.from=$A;(function(){var arrayProto=Array.prototype,slice=arrayProto.slice,_each=arrayProto.forEach;function each(iterator){for(var i=0,length=this.length;i<length;i++)
iterator(this[i]);}
if(!_each)_each=each;function clear(){this.length=0;return this;}
function first(){return this[0];}
function last(){return this[this.length-1];}
function compact(){return this.select(function(value){return value!=null;});}
function flatten(){return this.inject([],function(array,value){if(Object.isArray(value))
return array.concat(value.flatten());array.push(value);return array;});}
function without(){var values=slice.call(arguments,0);return this.select(function(value){return!values.include(value);});}
function reverse(inline){return(inline!==false?this:this.toArray())._reverse();}
function uniq(sorted){return this.inject([],function(array,value,index){if(0==index||(sorted?array.last()!=value:!array.include(value)))
array.push(value);return array;});}
function intersect(array){return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});}
function clone(){return slice.call(this,0);}
function size(){return this.length;}
function inspect(){return'['+this.map(Object.inspect).join(', ')+']';}
function toJSON(){var results=[];this.each(function(object){var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}
function indexOf(item,i){i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)
if(this[i]==item)return i;return-1;}
function lastIndexOf(item,i){i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;}
function concat(){var array=slice.call(this,0),item;for(var i=0,length=arguments.length;i<length;i++){item=arguments[i];if(Object.isArray(item)&&!('callee'in item)){for(var j=0,arrayLength=item.length;j<arrayLength;j++)
array.push(item[j]);}else{array.push(item);}}
return array;}
Object.extend(arrayProto,Enumerable);if(!arrayProto._reverse)
arrayProto._reverse=arrayProto.reverse;Object.extend(arrayProto,{_each:_each,clear:clear,first:first,last:last,compact:compact,flatten:flatten,without:without,reverse:reverse,uniq:uniq,intersect:intersect,clone:clone,toArray:clone,size:size,inspect:inspect,toJSON:toJSON});var CONCAT_ARGUMENTS_BUGGY=(function(){return[].concat(arguments)[0][0]!==1;})(1,2)
if(CONCAT_ARGUMENTS_BUGGY)arrayProto.concat=concat;arrayProto.indexOf=indexOf;arrayProto.lastIndexOf=lastIndexOf;})();function $H(object){return new Hash(object);};var Hash=Class.create(Enumerable,(function(){function initialize(object){this._object=Object.isHash(object)?object.toObject():Object.clone(object);}
function _each(iterator){for(var key in this._object){var value=this._object[key],pair=[key,value];pair.key=key;pair.value=value;iterator(pair);}}
function set(key,value){return this._object[key]=value;}
function get(key){if(this._object[key]!==Object.prototype[key])
return this._object[key];}
function unset(key){var value=this._object[key];delete this._object[key];return value;}
function toObject(){return Object.clone(this._object);}
function keys(){return this.pluck('key');}
function values(){return this.pluck('value');}
function index(value){var match=this.detect(function(pair){return pair.value===value;});return match&&match.key;}
function merge(object){return this.clone().update(object);}
function update(object){return new Hash(object).inject(this,function(result,pair){result.set(pair.key,pair.value);return result;});}
function toQueryPair(key,value){if(Object.isUndefined(value))return key;return key+'='+encodeURIComponent(String.interpret(value));}
function toQueryString(){return this.inject([],function(results,pair){var key=encodeURIComponent(pair.key),values=pair.value;if(values&&typeof values=='object'){if(Object.isArray(values))
return results.concat(values.map(toQueryPair.curry(key)));}else results.push(toQueryPair(key,values));return results;}).join('&');}
function inspect(){return'#<Hash:{'+this.map(function(pair){return pair.map(Object.inspect).join(': ');}).join(', ')+'}>';}
function toJSON(){return Object.toJSON(this.toObject());}
function clone(){return new Hash(this);}
return{initialize:initialize,_each:_each,set:set,get:get,unset:unset,toObject:toObject,toTemplateReplacements:toObject,keys:keys,values:values,index:index,merge:merge,update:update,toQueryString:toQueryString,inspect:inspect,toJSON:toJSON,clone:clone};})());Hash.from=$H;Object.extend(Number.prototype,(function(){function toColorPart(){return this.toPaddedString(2,16);}
function succ(){return this+1;}
function times(iterator,context){$R(0,this,true).each(iterator,context);return this;}
function toPaddedString(length,radix){var string=this.toString(radix||10);return'0'.times(length-string.length)+string;}
function toJSON(){return isFinite(this)?this.toString():'null';}
function abs(){return Math.abs(this);}
function round(){return Math.round(this);}
function ceil(){return Math.ceil(this);}
function floor(){return Math.floor(this);}
return{toColorPart:toColorPart,succ:succ,times:times,toPaddedString:toPaddedString,toJSON:toJSON,abs:abs,round:round,ceil:ceil,floor:floor};})());function $R(start,end,exclusive){return new ObjectRange(start,end,exclusive);}
var ObjectRange=Class.create(Enumerable,(function(){function initialize(start,end,exclusive){this.start=start;this.end=end;this.exclusive=exclusive;}
function _each(iterator){var value=this.start;while(this.include(value)){iterator(value);value=value.succ();}}
function include(value){if(value<this.start)
return false;if(this.exclusive)
return value<this.end;return value<=this.end;}
return{initialize:initialize,_each:_each,include:include};})());var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject('Msxml2.XMLHTTP')},function(){return new ActiveXObject('Microsoft.XMLHTTP')})||false;},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator);},register:function(responder){if(!this.include(responder))
this.responders.push(responder);},unregister:function(responder){this.responders=this.responders.without(responder);},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json]);}catch(e){}}});}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--},onTimeout:function(){}});Ajax.Base=Class.create({initialize:function(options){this.options={method:'post',asynchronous:true,contentType:'application/x-www-form-urlencoded',encoding:'UTF-8',parameters:'',evalJSON:true,evalJS:true,timeOut:null,onTimeout:null};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isString(this.options.parameters))
this.options.parameters=this.options.parameters.toQueryParams();else if(Object.isHash(this.options.parameters))
this.options.parameters=this.options.parameters.toObject();}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url);},request:function(url){this.url=url;this.method=this.options.method;var params=Object.clone(this.options.parameters);if(!['get','post'].include(this.method)){params['_method']=this.method;this.method='post';}
this.parameters=params;if(params=Object.toQueryString(params)){if(this.method=='get')
this.url+=(this.url.include('?')?'&':'?')+params;else if(/Konqueror|Safari|KHTML/.test(navigator.userAgent))
params+='&_=';}
try{var response=new Ajax.Response(this);if(this.options.onCreate)this.options.onCreate(response);Ajax.Responders.dispatch('onCreate',this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous)this.respondToReadyState.bind(this).defer(1);this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=='post'?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType)
this.onStateChange();if(this.options.timeOut)setTimeout(function(){this.ProcessTimeout()}.bind(this),this.options.timeOut);}
catch(e){this.dispatchException(e);}},ProcessTimeout:function(){if(!this._complete){this.transport.onreadystatechange=Prototype.emptyFunction;delete this.transport.onreadystatechange;try{this.transport.abort();}
catch(e){}
this.transport=Prototype.emptyFunction;delete this.transport;if(this.options.onTimeout)this.options.onTimeout();}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete))
this.respondToReadyState(this.transport.readyState);},setRequestHeaders:function(){var headers={'X-Requested-With':'XMLHttpRequest','X-Prototype-Version':Prototype.Version,'Accept':'text/javascript, text/html, application/xml, text/xml, */*'};if(this.method=='post'){headers['Content-type']=this.options.contentType+
(this.options.encoding?'; charset='+this.options.encoding:'');if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005)
headers['Connection']='close';}
if(typeof this.options.requestHeaders=='object'){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push))
for(var i=0,length=extras.length;i<length;i+=2)
headers[extras[i]]=extras[i+1];else
$H(extras).each(function(pair){headers[pair.key]=pair.value});}
for(var name in headers)
this.transport.setRequestHeader(name,headers[name]);},success:function(){var status=this.getStatus();return!status||(status>=200&&status<300);},getStatus:function(){try{return this.transport.status||0;}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=='Complete'){try{this._complete=true;(this.options['on'+response.status]||this.options['on'+(this.success()?'Success':'Failure')]||Prototype.emptyFunction)(response,response.headerJSON);}catch(e){this.dispatchException(e);}
var contentType=response.getHeader('Content-type');if(this.options.evalJS=='force'||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i)))
this.evalResponse();}
try{(this.options['on'+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch('on'+state,this,response,response.headerJSON);}catch(e){this.dispatchException(e);}
if(state=='Complete'){this.transport.onreadystatechange=Prototype.emptyFunction;}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return!m||(m[0]=='#{protocol}//#{domain}#{port}'.interpolate({protocol:location.protocol,domain:document.domain,port:location.port?':'+location.port:''}));},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null;}catch(e){return null;}},evalResponse:function(){try{return eval((this.transport.responseText||'').unfilterJSON());}catch(e){this.dispatchException(e);}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch('onException',this,exception);}});Ajax.Request.Events=['Uninitialized','Loading','Loaded','Interactive','Complete'];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON();}
if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON();}},status:0,statusText:'',getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||'';}catch(e){return''}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders();}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name);},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders();},_getHeaderJSON:function(){var json=this.getHeader('X-JSON');if(!json)return null;json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!='force'&&!(this.getHeader('Content-type')||'').include('application/json'))||this.responseText.blank())
return null;try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin());}catch(e){this.request.dispatchException(e);}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete))onComplete(response,json);}).bind(this);$super(url,options);},updateContent:function(responseText){var receiver=this.container[this.success()?'success':'failure'],options=this.options;if(!options.evalScripts)responseText=responseText.stripScripts();if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion);}
else options.insertion(receiver,responseText);}
else receiver.update(responseText);}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start();},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent();},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments);},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText;}
this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency);},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options);}});function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++)
elements.push($(arguments[i]));return elements;}
if(Object.isString(element))
element=document.getElementById(element);return Element.extend(element);}
if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++)
results.push(Element.extend(query.snapshotItem(i)));return results;};}
if(!window.Node)var Node={};if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12});}
(function(global){var SETATTRIBUTE_IGNORES_NAME=(function(){var elForm=document.createElement("form");var elInput=document.createElement("input");var root=document.documentElement;elInput.setAttribute("name","test");elForm.appendChild(elInput);root.appendChild(elForm);var isBuggy=elForm.elements?(typeof elForm.elements.test=="undefined"):null;root.removeChild(elForm);elForm=elInput=null;return isBuggy;})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(SETATTRIBUTE_IGNORES_NAME&&attributes.name){tagName='<'+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes);}
if(!cache[tagName])cache[tagName]=Element.extend(document.createElement(tagName));return Element.writeAttribute(cache[tagName].cloneNode(false),attributes);};Object.extend(global.Element,element||{});if(element)global.Element.prototype=element.prototype;})(this);Element.cache={};Element.idCounter=1;Element.Methods={visible:function(element){return $(element).style.display!='none';},toggle:function(element){element=$(element);Element[Element.visible(element)?'hide':'show'](element);return element;},hide:function(element){element=$(element);element.style.display='none';return element;},show:function(element){element=$(element);element.style.display='';return element;},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element;},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML="<option value=\"test\">test</option>";if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION";}
el=null;return isBuggy;})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy;}}catch(e){return true;}})();var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3;}catch(e){isBuggy=true;}
s=null;return isBuggy;})();function update(element,content){element=$(element);if(content&&content.toElement)
content=content.toElement();if(Object.isElement(content))
return element.update().insert(content);content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==='SCRIPT'&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element;}
if(SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild);}
Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)});}
else{element.innerHTML=content.stripScripts();}}
else{element.innerHTML=content.stripScripts();}
content.evalScripts.bind(content).defer();return element;}
return update;})(),replace:function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();else if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts());}
element.parentNode.replaceChild(content,element);return element;},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML)))
insertions={bottom:insertions};var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){insert(element,content);continue;}
content=Object.toHTML(content);tagName=((position=='before'||position=='after')?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=='top'||position=='after')childNodes.reverse();childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer();}
return element;},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper))
$(wrapper).writeAttribute(attributes||{});else if(Object.isString(wrapper))wrapper=new Element(wrapper,attributes);else wrapper=new Element('div',wrapper);if(element.parentNode)
element.parentNode.replaceChild(wrapper,element);wrapper.appendChild(element);return wrapper;},inspect:function(element){element=$(element);var result='<'+element.tagName.toLowerCase();$H({'id':'id','className':'class'}).each(function(pair){var property=pair.first(),attribute=pair.last();var value=(element[property]||'').toString();if(value)result+=' '+attribute+'='+value.inspect(true);});return result+'>';},recursivelyCollect:function(element,property){element=$(element);var elements=[];while(element=element[property])
if(element.nodeType==1)
elements.push(Element.extend(element));return elements;},ancestors:function(element){return Element.recursivelyCollect(element,'parentNode');},descendants:function(element){return Element.select(element,"*");},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1)element=element.nextSibling;return $(element);},immediateDescendants:function(element){if(!(element=$(element).firstChild))return[];while(element&&element.nodeType!=1)element=element.nextSibling;if(element)return[element].concat($(element).nextSiblings());return[];},previousSiblings:function(element){return Element.recursivelyCollect(element,'previousSibling');},nextSiblings:function(element){return Element.recursivelyCollect(element,'nextSibling');},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element));},match:function(element,selector){if(Object.isString(selector))
selector=new Selector(selector);return selector.match($(element));},up:function(element,expression,index){element=$(element);if(arguments.length==1)return $(element.parentNode);var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Selector.findElement(ancestors,expression,index);},down:function(element,expression,index){element=$(element);if(arguments.length==1)return Element.firstDescendant(element);return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0];},previous:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.previousElementSibling(element));var previousSiblings=Element.previousSiblings(element);return Object.isNumber(expression)?previousSiblings[expression]:Selector.findElement(previousSiblings,expression,index);},next:function(element,expression,index){element=$(element);if(arguments.length==1)return $(Selector.handlers.nextElementSibling(element));var nextSiblings=Element.nextSiblings(element);return Object.isNumber(expression)?nextSiblings[expression]:Selector.findElement(nextSiblings,expression,index);},select:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element,args);},adjacent:function(element){var args=Array.prototype.slice.call(arguments,1);return Selector.findChildElements(element.parentNode,args).without(element);},identify:function(element){element=$(element);var id=Element.readAttribute(element,'id');if(id)return id;do{id='anonymous_element_'+Element.idCounter++}while($(id));Element.writeAttribute(element,'id',id);return id;},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name])return t.values[name](element,name);if(t.names[name])name=t.names[name];if(name.include(':')){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value;}}
return element.getAttribute(name);},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=='object')attributes=name;else attributes[name]=Object.isUndefined(value)?true:value;for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr])name=t.values[attr](element,value);if(value===false||value===null)
element.removeAttribute(name);else if(value===true)
element.setAttribute(name,name);else element.setAttribute(name,value);}
return element;},getHeight:function(element){return Element.getDimensions(element).height;},getWidth:function(element){return Element.getDimensions(element).width;},classNames:function(element){return new Element.ClassNames(element);},hasClassName:function(element,className){if(!(element=$(element)))return;var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)));},addClassName:function(element,className){if(!(element=$(element)))return;if(!Element.hasClassName(element,className))
element.className+=(element.className?' ':'')+className;return element;},removeClassName:function(element,className){if(!(element=$(element)))return;element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)"),' ').strip();return element;},toggleClassName:function(element,className){if(!(element=$(element)))return;return Element[Element.hasClassName(element,className)?'removeClassName':'addClassName'](element,className);},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue))
element.removeChild(node);node=nextNode;}
return element;},empty:function(element){return $(element).innerHTML.blank();},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition)
return(element.compareDocumentPosition(ancestor)&8)===8;if(ancestor.contains)
return ancestor.contains(element)&&ancestor!==element;while(element=element.parentNode)
if(element==ancestor)return true;return false;},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element;},getStyle:function(element,style){element=$(element);style=style=='float'?'cssFloat':style.camelize();var value=element.style[style];if(!value||value=='auto'){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null;}
if(style=='opacity')return value?parseFloat(value):1.0;return value=='auto'?null:value;},getOpacity:function(element){return $(element).getStyle('opacity');},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=';'+styles;return styles.include('opacity')?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element;}
for(var property in styles)
if(property=='opacity')element.setOpacity(styles[property]);else
elementStyle[(property=='float'||property=='cssFloat')?(Object.isUndefined(elementStyle.styleFloat)?'cssFloat':'styleFloat'):property]=styles[property];return element;},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;return element;},getDimensions:function(element){element=$(element);var display=Element.getStyle(element,'display');if(display!='none'&&display!=null)
return{width:element.offsetWidth,height:element.offsetHeight};var els=element.style;var originalVisibility=els.visibility;var originalPosition=els.position;var originalDisplay=els.display;els.visibility='hidden';if(originalPosition!='fixed')
els.position='absolute';els.display='block';var originalWidth=element.clientWidth;var originalHeight=element.clientHeight;els.display=originalDisplay;els.position=originalPosition;els.visibility=originalVisibility;return{width:originalWidth,height:originalHeight};},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,'position');if(pos=='static'||!pos){element._madePositioned=true;element.style.position='relative';if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0;}}
return element;},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right='';}
return element;},makeClipping:function(element){element=$(element);if(element._overflow)return element;element._overflow=Element.getStyle(element,'overflow')||'auto';if(element._overflow!=='hidden')
element.style.overflow='hidden';return element;},undoClipping:function(element){element=$(element);if(!element._overflow)return element;element.style.overflow=element._overflow=='auto'?'':element._overflow;element._overflow=null;return element;},cumulativeOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);},positionedOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(element.tagName.toUpperCase()=='BODY')break;var p=Element.getStyle(element,'position');if(p!=='static')break;}}while(element);return Element._returnOffset(valueL,valueT);},absolutize:function(element){element=$(element);if(Element.getStyle(element,'position')=='absolute')return element;var offsets=Element.positionedOffset(element);var top=offsets[1];var left=offsets[0];var width=element.clientWidth;var height=element.clientHeight;element._originalLeft=left-parseFloat(element.style.left||0);element._originalTop=top-parseFloat(element.style.top||0);element._originalWidth=element.style.width;element._originalHeight=element.style.height;element.style.position='absolute';element.style.top=top+'px';element.style.left=left+'px';element.style.width=width+'px';element.style.height=height+'px';return element;},relativize:function(element){element=$(element);if(Element.getStyle(element,'position')=='relative')return element;element.style.position='relative';var top=parseFloat(element.style.top||0)-(element._originalTop||0);var left=parseFloat(element.style.left||0)-(element._originalLeft||0);element.style.top=top+'px';element.style.left=left+'px';element.style.height=element._originalHeight;element.style.width=element._originalWidth;return element;},cumulativeScrollOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode;}while(element);return Element._returnOffset(valueL,valueT);},getOffsetParent:function(element){if(element.offsetParent)return $(element.offsetParent);if(element==document.body)return $(element);while((element=element.parentNode)&&element!=document.body)
if(Element.getStyle(element,'position')!='static')
return $(element);return $(document.body);},viewportOffset:function(forElement){var valueT=0,valueL=0;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body&&Element.getStyle(element,'position')=='absolute')break;}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||(element.tagName&&(element.tagName.toUpperCase()=='BODY'))){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0;}}while(element=element.parentNode);return Element._returnOffset(valueL,valueT);},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source);element=$(element);var delta=[0,0];var parent=null;if(Element.getStyle(element,'position')=='absolute'){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent);}
if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop;}
if(options.setLeft)element.style.left=(p[0]-delta[0]+options.offsetLeft)+'px';if(options.setTop)element.style.top=(p[1]-delta[1]+options.offsetTop)+'px';if(options.setWidth)element.style.width=source.offsetWidth+'px';if(options.setHeight)element.style.height=source.offsetHeight+'px';return element;}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:'class',htmlFor:'for'},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case'left':case'top':case'right':case'bottom':if(proceed(element,'position')==='static')return null;case'height':case'width':if(!Element.visible(element))return null;var dim=parseInt(proceed(element,style),10);if(dim!==element['offset'+style.capitalize()])
return dim+'px';var properties;if(style==='height'){properties=['border-top-width','padding-top','padding-bottom','border-bottom-width'];}
else{properties=['border-left-width','padding-left','padding-right','border-right-width'];}
return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10);})+'px';default:return proceed(element,style);}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==='title')return element.title;return proceed(element,attribute);});}
else if(Prototype.Browser.IE){Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return $(document.body)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});$w('positionedOffset viewportOffset').each(function(method){Element.Methods[method]=Element.Methods[method].wrap(function(proceed,element){element=$(element);try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
var position=element.getStyle('position');if(position!=='static')return proceed(element);var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle('position')==='fixed')
offsetParent.setStyle({zoom:1});element.setStyle({position:'relative'});var value=proceed(element);element.setStyle({position:position});return value;});});Element.Methods.cumulativeOffset=Element.Methods.cumulativeOffset.wrap(function(proceed,element){try{element.offsetParent}
catch(e){return Element._returnOffset(0,0)}
return proceed(element);});Element.Methods.getStyle=function(element,style){element=$(element);style=(style=='float'||style=='cssFloat')?'styleFloat':style.camelize();var value=element.style[style];if(!value&&element.currentStyle)value=element.currentStyle[style];if(style=='opacity'){if(value=(element.getStyle('filter')||'').match(/alpha\(opacity=(.*)\)/))
if(value[1])return parseFloat(value[1])/100;return 1.0;}
if(value=='auto'){if((style=='width'||style=='height')&&(element.getStyle('display')!='none'))
return element['offset'+style.capitalize()]+'px';return null;}
return value;};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,'');}
element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=='normal'))
element.style.zoom=1;var filter=element.getStyle('filter'),style=element.style;if(value==1||value===''){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute('filter');return element;}else if(value<0.00001)value=0;style.filter=stripAlpha(filter)+'alpha(opacity='+(value*100)+')';return element;};Element._attributeTranslations=(function(){var classProp='className';var forProp='for';var el=document.createElement('div');el.setAttribute(classProp,'x');if(el.className!=='x'){el.setAttribute('class','x');if(el.className==='x'){classProp='class';}}
el=null;el=document.createElement('label');el.setAttribute(forProp,'x');if(el.htmlFor!=='x'){el.setAttribute('htmlFor','x');if(el.htmlFor==='x'){forProp='htmlFor';}}
el=null;return{read:{names:{'class':classProp,'className':classProp,'for':forProp,'htmlFor':forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute);},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2);},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:"";},_getEv:(function(){var el=document.createElement('div');el.onclick=Prototype.emptyFunction;var value=el.getAttribute('onclick');var f;if(String(value).indexOf('{')>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;attribute=attribute.toString();attribute=attribute.split('{')[1];attribute=attribute.split('}')[0];return attribute.strip();};}
else if(value===''){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute)return null;return attribute.strip();};}
el=null;return f;})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null;},style:function(element){return element.style.cssText.toLowerCase();},title:function(element){return element.title;}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:'cellPadding',cellspacing:'cellSpacing'},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value;},style:function(element,value){element.style.cssText=value?value:'';}}};Element._attributeTranslations.has={};$w('colSpan rowSpan vAlign dateTime accessKey tabIndex '+'encType maxLength readOnly longDesc frameBorder').each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr;});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv});})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName('*'),results=[];for(var i=0,node;node=nodes[i];i++)
if(node.tagName!=="!")
results.push(node);return results;}
Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1)return element.firstDescendant();return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0];}})();}}
else if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==='')?'':(value<0.00001)?0:value;return element;};}
else if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==='')?'':(value<0.00001)?0:value;if(value==1)
if(element.tagName.toUpperCase()=='IMG'&&element.width){element.width++;element.width--;}else try{var n=document.createTextNode(' ');element.appendChild(n);element.removeChild(n);}catch(e){}
return element;};Element.Methods.cumulativeOffset=function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body)
if(Element.getStyle(element,'position')=='absolute')break;element=element.offsetParent;}while(element);return Element._returnOffset(valueL,valueT);};}
if('outerHTML'in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement)content=content.toElement();if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element;}
content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next();var fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling)
fragments.each(function(node){parent.insertBefore(node,nextSibling)});else
fragments.each(function(node){parent.appendChild(node)});}
else element.outerHTML=content.stripScripts();content.evalScripts.bind(content).defer();return element;};}
Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result;};Element._getContentFromAnonymousElement=function(tagName,html){var div=new Element('div'),t=Element._insertionTranslations.tags[tagName];if(t){div.innerHTML=t[0]+html+t[1];t[2].times(function(){div=div.firstChild});}else div.innerHTML=html;return $A(div.childNodes);};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element);},top:function(element,node){element.insertBefore(node,element.firstChild);},bottom:function(element,node){element.appendChild(node);},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling);},tags:{TABLE:['<table>','</table>',1],TBODY:['<table><tbody>','</tbody></table>',2],TR:['<table><tbody><tr>','</tr></tbody></table>',3],TD:['<table><tbody><tr><td>','</td></tr></tbody></table>',4],SELECT:['<select>','</select>',1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD});})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return!!(node&&node.specified);}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div['__proto__']){window.HTMLElement={};window.HTMLElement.prototype=div['__proto__'];Prototype.BrowserFeatures.ElementExtensions=true;}
div=null;})(document.createElement('div'))
Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!='undefined'){var proto=window.Element.prototype;if(proto){var id='_'+(Math.random()+'').slice(2);var el=document.createElement(tagName);proto[id]='x';var isBuggy=(el[id]!=='x');delete proto[id];el=null;return isBuggy;}}
return false;}
function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element))
element[property]=value.methodize();}}
var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency('object');if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=='undefined'){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()]);}}
return element;}}
return Prototype.K;}
var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!='undefined'||element.nodeType!=1||element==window)return element;var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName])Object.extend(methods,ByTag[tagName]);extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element;},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated);}}});extend.refresh();return extend;})();Element.hasAttribute=function(element,attribute){if(element.hasAttribute)return element.hasAttribute(attribute);return Element.Methods.Simulated.hasAttribute(element,attribute);};Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{"FORM":Object.clone(Form.Methods),"INPUT":Object.clone(Form.Element.Methods),"SELECT":Object.clone(Form.Element.Methods),"TEXTAREA":Object.clone(Form.Element.Methods)});}
if(arguments.length==2){var tagName=methods;methods=arguments[1];}
if(!tagName)Object.extend(Element.Methods,methods||{});else{if(Object.isArray(tagName))tagName.each(extend);else extend(tagName);}
function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName])
Element.Methods.ByTag[tagName]={};Object.extend(Element.Methods.ByTag[tagName],methods);}
function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value))continue;if(!onlyIfAbsent||!(property in destination))
destination[property]=value.methodize();}}
function findDOMClass(tagName){var klass;var trans={"OPTGROUP":"OptGroup","TEXTAREA":"TextArea","P":"Paragraph","FIELDSET":"FieldSet","UL":"UList","OL":"OList","DL":"DList","DIR":"Directory","H1":"Heading","H2":"Heading","H3":"Heading","H4":"Heading","H5":"Heading","H6":"Heading","Q":"Quote","INS":"Mod","DEL":"Mod","A":"Anchor","IMG":"Image","CAPTION":"TableCaption","COL":"TableCol","COLGROUP":"TableCol","THEAD":"TableSection","TFOOT":"TableSection","TBODY":"TableSection","TR":"TableRow","TH":"TableCell","TD":"TableCell","FRAMESET":"FrameSet","IFRAME":"IFrame"};if(trans[tagName])klass='HTML'+trans[tagName]+'Element';if(window[klass])return window[klass];klass='HTML'+tagName+'Element';if(window[klass])return window[klass];klass='HTML'+tagName.capitalize()+'Element';if(window[klass])return window[klass];var element=document.createElement(tagName);var proto=element['__proto__']||element.constructor.prototype;element=null;return proto;}
var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true);}
if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass))continue;copy(T[tag],klass.prototype);}}
Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh)Element.extend.refresh();Element.cache={};};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()};},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop);},getScrollHeight:function(){if(window.innerHeight&&window.scrollMaxY)return window.innerHeight+window.scrollMaxY;else if(document.body.scrollHeight>document.body.offsetHeight)return document.body.scrollHeight;else return document.body.offsetHeight;}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate)
return document;if(B.Opera&&window.parseFloat(window.opera.version())<9.5)
return document.body;return document.documentElement;}
function define(D){if(!element)element=getRootElement();property[D]='client'+D;viewport['get'+D]=function(){return element[property[D]]};return viewport['get'+D]();}
viewport.getWidth=define.curry('Width');viewport.getHeight=define.curry('Height');})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element)))return;var uid;if(element===window){uid=0;}else{if(typeof element._prototypeUID==="undefined")
element._prototypeUID=[Element.Storage.UID++];uid=element._prototypeUID[0];}
if(!Element.Storage[uid])
Element.Storage[uid]=$H();return Element.Storage[uid];},store:function(element,key,value){if(!(element=$(element)))return;if(arguments.length===2){Element.getStorage(element).update(key);}else{Element.getStorage(element).set(key,value);}
return element;},retrieve:function(element,key,defaultValue){if(!(element=$(element)))return;var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue;}
return value;},clone:function(element,deep){if(!(element=$(element)))return;var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,'*'),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0;}}
return Element.extend(clone);}});var Selector=Class.create({initialize:function(expression){this.expression=expression.strip();if(this.shouldUseSelectorsAPI()){this.mode='selectorsAPI';}else if(this.shouldUseXPath()){this.mode='xpath';this.compileXPathMatcher();}else{this.mode="normal";this.compileMatcher();}},shouldUseXPath:(function(){var IS_DESCENDANT_SELECTOR_BUGGY=(function(){var isBuggy=false;if(document.evaluate&&window.XPathResult){var el=document.createElement('div');el.innerHTML='<ul><li></li></ul><div><ul><li></li></ul></div>';var xpath=".//*[local-name()='ul' or local-name()='UL']"+"//*[local-name()='li' or local-name()='LI']";var result=document.evaluate(xpath,el,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);isBuggy=(result.snapshotLength!==2);el=null;}
return isBuggy;})();return function(){if(!Prototype.BrowserFeatures.XPath)return false;var e=this.expression;if(Prototype.Browser.WebKit&&(e.include("-of-type")||e.include(":empty")))
return false;if((/(\[[\w-]*?:|:checked)/).test(e))
return false;if(IS_DESCENDANT_SELECTOR_BUGGY)return false;return true;}})(),shouldUseSelectorsAPI:function(){if(!Prototype.BrowserFeatures.SelectorsAPI)return false;if(Selector.CASE_INSENSITIVE_CLASS_NAMES)return false;if(!Selector._div)Selector._div=new Element('div');try{Selector._div.querySelector(this.expression);}catch(e){return false;}
return true;},compileMatcher:function(){var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m,len=ps.length,name;if(Selector._cache[e]){this.matcher=Selector._cache[e];return;}
this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){this.matcher.push(Object.isFunction(c[name])?c[name](m):new Template(c[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.matcher.push("return h.unique(n);\n}");eval(this.matcher.join('\n'));Selector._cache[this.expression]=this.matcher;},compileXPathMatcher:function(){var e=this.expression,ps=Selector.patterns,x=Selector.xpath,le,m,len=ps.length,name;if(Selector._cache[e]){this.xpath=Selector._cache[e];return;}
this.matcher=['.//*'];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=ps[i].name;if(m=e.match(ps[i].re)){this.matcher.push(Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m));e=e.replace(m[0],'');break;}}}
this.xpath=this.matcher.join('');Selector._cache[this.expression]=this.xpath;},findElements:function(root){root=root||document;var e=this.expression,results;switch(this.mode){case'selectorsAPI':if(root!==document){var oldId=root.id,id=$(root).identify();id=id.replace(/([\.:])/g,"\\$1");e="#"+id+" "+e;}
results=$A(root.querySelectorAll(e)).map(Element.extend);root.id=oldId;return results;case'xpath':return document._getElementsByXPath(this.xpath,root);default:return this.matcher(root);}},match:function(element){this.tokens=[];var e=this.expression,ps=Selector.patterns,as=Selector.assertions;var le,p,m,len=ps.length,name;while(e&&le!==e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){p=ps[i].re;name=ps[i].name;if(m=e.match(p)){if(as[name]){this.tokens.push([name,Object.clone(m)]);e=e.replace(m[0],'');}else{return this.findElements(document).include(element);}}}}
var match=true,name,matches;for(var i=0,token;token=this.tokens[i];i++){name=token[0],matches=token[1];if(!Selector.assertions[name](element,matches)){match=false;break;}}
return match;},toString:function(){return this.expression;},inspect:function(){return"#<Selector:"+this.expression.inspect()+">";}});if(Prototype.BrowserFeatures.SelectorsAPI&&document.compatMode==='BackCompat'){Selector.CASE_INSENSITIVE_CLASS_NAMES=(function(){var div=document.createElement('div'),span=document.createElement('span');div.id="prototype_test_id";span.className='Test';div.appendChild(span);var isIgnored=(div.querySelector('#prototype_test_id .test')!==null);div=span=null;return isIgnored;})();}
Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:'/following-sibling::*',tagName:function(m){if(m[1]=='*')return'';return"[local-name()='"+m[1].toLowerCase()+"' or local-name()='"+m[1].toUpperCase()+"']";},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(m){m[1]=m[1].toLowerCase();return new Template("[@#{1}]").evaluate(m);},attr:function(m){m[1]=m[1].toLowerCase();m[3]=m[5]||m[6];return new Template(Selector.xpath.operators[m[2]]).evaluate(m);},pseudo:function(m){var h=Selector.xpath.pseudos[m[1]];if(!h)return'';if(Object.isFunction(h))return h(m);return new Template(Selector.xpath.pseudos[m[1]]).evaluate(m);},operators:{'=':"[@#{1}='#{3}']",'!=':"[@#{1}!='#{3}']",'^=':"[starts-with(@#{1}, '#{3}')]",'$=':"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']",'*=':"[contains(@#{1}, '#{3}')]",'~=':"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]",'|=':"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{'first-child':'[not(preceding-sibling::*)]','last-child':'[not(following-sibling::*)]','only-child':'[not(preceding-sibling::* or following-sibling::*)]','empty':"[count(*) = 0 and (count(text()) = 0)]",'checked':"[@checked]",'disabled':"[(@disabled) and (@type!='hidden')]",'enabled':"[not(@disabled) and (@type!='hidden')]",'not':function(m){var e=m[6],p=Selector.patterns,x=Selector.xpath,le,v,len=p.length,name;var exclusion=[];while(e&&le!=e&&(/\S/).test(e)){le=e;for(var i=0;i<len;i++){name=p[i].name
if(m=e.match(p[i].re)){v=Object.isFunction(x[name])?x[name](m):new Template(x[name]).evaluate(m);exclusion.push("("+v.substring(1,v.length-1)+")");e=e.replace(m[0],'');break;}}}
return"[not("+exclusion.join(" and ")+")]";},'nth-child':function(m){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",m);},'nth-last-child':function(m){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",m);},'nth-of-type':function(m){return Selector.xpath.pseudos.nth("position() ",m);},'nth-last-of-type':function(m){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",m);},'first-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-of-type'](m);},'last-of-type':function(m){m[6]="1";return Selector.xpath.pseudos['nth-last-of-type'](m);},'only-of-type':function(m){var p=Selector.xpath.pseudos;return p['first-of-type'](m)+p['last-of-type'](m);},nth:function(fragment,m){var mm,formula=m[6],predicate;if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';if(mm=formula.match(/^(\d+)$/))
return'['+fragment+"= "+mm[1]+']';if(mm=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(mm[1]=="-")mm[1]=-1;var a=mm[1]?Number(mm[1]):1;var b=mm[2]?Number(mm[2]):0;predicate="[((#{fragment} - #{b}) mod #{a} = 0) and "+"((#{fragment} - #{b}) div #{a} >= 0)]";return new Template(predicate).evaluate({fragment:fragment,a:a,b:b});}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(m){m[3]=(m[5]||m[6]);return new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(m);},pseudo:function(m){if(m[6])m[6]=m[6].replace(/"/g,'\\"');return new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(m);},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:[{name:'laterSibling',re:/^\s*~\s*/},{name:'child',re:/^\s*>\s*/},{name:'adjacent',re:/^\s*\+\s*/},{name:'descendant',re:/^\s/},{name:'tagName',re:/^\s*(\*|[\w\-]+)(\b|$)?/},{name:'id',re:/^#([\w\-\*]+)(\b|$)/},{name:'className',re:/^\.([\w\-\*]+)(\b|$)/},{name:'pseudo',re:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/},{name:'attrPresence',re:/^\[((?:[\w-]+:)?[\w-]+)\]/},{name:'attr',re:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/}],assertions:{tagName:function(element,matches){return matches[1].toUpperCase()==element.tagName.toUpperCase();},className:function(element,matches){return Element.hasClassName(element,matches[1]);},id:function(element,matches){return element.id===matches[1];},attrPresence:function(element,matches){return Element.hasAttribute(element,matches[1]);},attr:function(element,matches){var nodeValue=Element.readAttribute(element,matches[1]);return nodeValue&&Selector.operators[matches[2]](nodeValue,matches[5]||matches[6]);}},handlers:{concat:function(a,b){for(var i=0,node;node=b[i];i++)
a.push(node);return a;},mark:function(nodes){var _true=Prototype.emptyFunction;for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=_true;return nodes;},unmark:(function(){var PROPERTIES_ATTRIBUTES_MAP=(function(){var el=document.createElement('div'),isBuggy=false,propName='_countedByPrototype',value='x'
el[propName]=value;isBuggy=(el.getAttribute(propName)===value);el=null;return isBuggy;})();return PROPERTIES_ATTRIBUTES_MAP?function(nodes){for(var i=0,node;node=nodes[i];i++)
node.removeAttribute('_countedByPrototype');return nodes;}:function(nodes){for(var i=0,node;node=nodes[i];i++)
node._countedByPrototype=void 0;return nodes;}})(),index:function(parentNode,reverse,ofType){parentNode._countedByPrototype=Prototype.emptyFunction;if(reverse){for(var nodes=parentNode.childNodes,i=nodes.length-1,j=1;i>=0;i--){var node=nodes[i];if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}}else{for(var i=0,j=1,nodes=parentNode.childNodes;node=nodes[i];i++)
if(node.nodeType==1&&(!ofType||node._countedByPrototype))node.nodeIndex=j++;}},unique:function(nodes){if(nodes.length==0)return nodes;var results=[],n;for(var i=0,l=nodes.length;i<l;i++)
if(typeof(n=nodes[i])._countedByPrototype=='undefined'){n._countedByPrototype=Prototype.emptyFunction;results.push(Element.extend(n));}
return Selector.handlers.unmark(results);},descendant:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName('*'));return results;},child:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++){for(var j=0,child;child=node.childNodes[j];j++)
if(child.nodeType==1&&child.tagName!='!')results.push(child);}
return results;},adjacent:function(nodes){for(var i=0,results=[],node;node=nodes[i];i++){var next=this.nextElementSibling(node);if(next)results.push(next);}
return results;},laterSibling:function(nodes){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
h.concat(results,Element.nextSiblings(node));return results;},nextElementSibling:function(node){while(node=node.nextSibling)
if(node.nodeType==1)return node;return null;},previousElementSibling:function(node){while(node=node.previousSibling)
if(node.nodeType==1)return node;return null;},tagName:function(nodes,root,tagName,combinator){var uTagName=tagName.toUpperCase();var results=[],h=Selector.handlers;if(nodes){if(combinator){if(combinator=="descendant"){for(var i=0,node;node=nodes[i];i++)
h.concat(results,node.getElementsByTagName(tagName));return results;}else nodes=this[combinator](nodes);if(tagName=="*")return nodes;}
for(var i=0,node;node=nodes[i];i++)
if(node.tagName.toUpperCase()===uTagName)results.push(node);return results;}else return root.getElementsByTagName(tagName);},id:function(nodes,root,id,combinator){var targetNode=$(id),h=Selector.handlers;if(root==document){if(!targetNode)return[];if(!nodes)return[targetNode];}else{if(!root.sourceIndex||root.sourceIndex<1){var nodes=root.getElementsByTagName('*');for(var j=0,node;node=nodes[j];j++){if(node.id===id)return[node];}}}
if(nodes){if(combinator){if(combinator=='child'){for(var i=0,node;node=nodes[i];i++)
if(targetNode.parentNode==node)return[targetNode];}else if(combinator=='descendant'){for(var i=0,node;node=nodes[i];i++)
if(Element.descendantOf(targetNode,node))return[targetNode];}else if(combinator=='adjacent'){for(var i=0,node;node=nodes[i];i++)
if(Selector.handlers.previousElementSibling(targetNode)==node)
return[targetNode];}else nodes=h[combinator](nodes);}
for(var i=0,node;node=nodes[i];i++)
if(node==targetNode)return[targetNode];return[];}
return(targetNode&&Element.descendantOf(targetNode,root))?[targetNode]:[];},className:function(nodes,root,className,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);return Selector.handlers.byClassName(nodes,root,className);},byClassName:function(nodes,root,className){if(!nodes)nodes=Selector.handlers.descendant([root]);var needle=' '+className+' ';for(var i=0,results=[],node,nodeClassName;node=nodes[i];i++){nodeClassName=node.className;if(nodeClassName.length==0)continue;if(nodeClassName==className||(' '+nodeClassName+' ').include(needle))
results.push(node);}
return results;},attrPresence:function(nodes,root,attr,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var results=[];for(var i=0,node;node=nodes[i];i++)
if(Element.hasAttribute(node,attr))results.push(node);return results;},attr:function(nodes,root,attr,value,operator,combinator){if(!nodes)nodes=root.getElementsByTagName("*");if(nodes&&combinator)nodes=this[combinator](nodes);var handler=Selector.operators[operator],results=[];for(var i=0,node;node=nodes[i];i++){var nodeValue=Element.readAttribute(node,attr);if(nodeValue===null)continue;if(handler(nodeValue,value))results.push(node);}
return results;},pseudo:function(nodes,name,value,root,combinator){if(nodes&&combinator)nodes=this[combinator](nodes);if(!nodes)nodes=root.getElementsByTagName("*");return Selector.pseudos[name](nodes,value,root);}},pseudos:{'first-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.previousElementSibling(node))continue;results.push(node);}
return results;},'last-child':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(Selector.handlers.nextElementSibling(node))continue;results.push(node);}
return results;},'only-child':function(nodes,value,root){var h=Selector.handlers;for(var i=0,results=[],node;node=nodes[i];i++)
if(!h.previousElementSibling(node)&&!h.nextElementSibling(node))
results.push(node);return results;},'nth-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root);},'nth-last-child':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true);},'nth-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,false,true);},'nth-last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,formula,root,true,true);},'first-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,false,true);},'last-of-type':function(nodes,formula,root){return Selector.pseudos.nth(nodes,"1",root,true,true);},'only-of-type':function(nodes,formula,root){var p=Selector.pseudos;return p['last-of-type'](p['first-of-type'](nodes,formula,root),formula,root);},getIndices:function(a,b,total){if(a==0)return b>0?[b]:[];return $R(1,total).inject([],function(memo,i){if(0==(i-b)%a&&(i-b)/a>=0)memo.push(i);return memo;});},nth:function(nodes,formula,root,reverse,ofType){if(nodes.length==0)return[];if(formula=='even')formula='2n+0';if(formula=='odd')formula='2n+1';var h=Selector.handlers,results=[],indexed=[],m;h.mark(nodes);for(var i=0,node;node=nodes[i];i++){if(!node.parentNode._countedByPrototype){h.index(node.parentNode,reverse,ofType);indexed.push(node.parentNode);}}
if(formula.match(/^\d+$/)){formula=Number(formula);for(var i=0,node;node=nodes[i];i++)
if(node.nodeIndex==formula)results.push(node);}else if(m=formula.match(/^(-?\d*)?n(([+-])(\d+))?/)){if(m[1]=="-")m[1]=-1;var a=m[1]?Number(m[1]):1;var b=m[2]?Number(m[2]):0;var indices=Selector.pseudos.getIndices(a,b,nodes.length);for(var i=0,node,l=indices.length;node=nodes[i];i++){for(var j=0;j<l;j++)
if(node.nodeIndex==indices[j])results.push(node);}}
h.unmark(nodes);h.unmark(indexed);return results;},'empty':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++){if(node.tagName=='!'||node.firstChild)continue;results.push(node);}
return results;},'not':function(nodes,selector,root){var h=Selector.handlers,selectorType,m;var exclusions=new Selector(selector).findElements(root);h.mark(exclusions);for(var i=0,results=[],node;node=nodes[i];i++)
if(!node._countedByPrototype)results.push(node);h.unmark(exclusions);return results;},'enabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(!node.disabled&&(!node.type||node.type!=='hidden'))
results.push(node);return results;},'disabled':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.disabled)results.push(node);return results;},'checked':function(nodes,value,root){for(var i=0,results=[],node;node=nodes[i];i++)
if(node.checked)results.push(node);return results;}},operators:{'=':function(nv,v){return nv==v;},'!=':function(nv,v){return nv!=v;},'^=':function(nv,v){return nv==v||nv&&nv.startsWith(v);},'$=':function(nv,v){return nv==v||nv&&nv.endsWith(v);},'*=':function(nv,v){return nv==v||nv&&nv.include(v);},'~=':function(nv,v){return(' '+nv+' ').include(' '+v+' ');},'|=':function(nv,v){return('-'+(nv||"").toUpperCase()+'-').include('-'+(v||"").toUpperCase()+'-');}},split:function(expression){var expressions=[];expression.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(m){expressions.push(m[1].strip());});return expressions;},matchElements:function(elements,expression){var matches=$$(expression),h=Selector.handlers;h.mark(matches);for(var i=0,results=[],element;element=elements[i];i++)
if(element._countedByPrototype)results.push(element);h.unmark(matches);return results;},findElement:function(elements,expression,index){if(Object.isNumber(expression)){index=expression;expression=false;}
return Selector.matchElements(elements,expression||'*')[index||0];},findChildElements:function(element,expressions){expressions=Selector.split(expressions.join(','));var results=[],h=Selector.handlers;for(var i=0,l=expressions.length,selector;i<l;i++){selector=new Selector(expressions[i].strip());h.concat(results,selector.findElements(element));}
return(l>1)?h.unique(results):results;}});if(Prototype.Browser.IE){Object.extend(Selector.handlers,{concat:function(a,b){for(var i=0,node;node=b[i];i++)
if(node.tagName!=="!")a.push(node);return a;}});}
function $$(){return Selector.findChildElements(document,$A(arguments));}
var Form={reset:function(form){form=$(form);form.reset();return form;},serializeElements:function(elements,options){if(typeof options!='object')options={hash:!!options};else if(Object.isUndefined(options.hash))options.hash=true;var key,value,submitted=false,submit=options.submit;var data=elements.inject({},function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!='file'&&(element.type!='submit'||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){if(key in result){if(!Object.isArray(result[key]))result[key]=[result[key]];result[key].push(value);}
else result[key]=value;}}
return result;});return options.hash?data:Object.toQueryString(data);}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options);},getElements:function(form){var elements=$(form).getElementsByTagName('*'),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element);}
return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()])
elements.push(Element.extend(child));return elements;})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName('input');if(!typeName&&!name)return $A(inputs).map(Element.extend);for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name))
continue;matchingInputs.push(Element.extend(input));}
return matchingInputs;},disable:function(form){form=$(form);Form.getElements(form).invoke('disable');return form;},enable:function(form){form=$(form);Form.getElements(form).invoke('enable');return form;},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return'hidden'!=element.type&&!element.disabled;});var firstByIndex=elements.findAll(function(element){return element.hasAttribute('tabIndex')&&element.tabIndex>=0;}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName);});},focusFirstElement:function(form){form=$(form);form.findFirstElement().activate();return form;},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute('action')||'';if(action.blank())action=window.location.href;options.parameters=form.serialize(true);if(params){if(Object.isString(params))params=params.toQueryParams();Object.extend(options.parameters,params);}
if(form.hasAttribute('method')&&!options.method)
options.method=form.method;return new Ajax.Request(action,options);}};Form.Element={focus:function(element){$(element).focus();return element;},select:function(element){$(element).select();return element;}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair);}}
return'';},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element);},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element;},clear:function(element){$(element).value='';return element;},present:function(element){return $(element).value!='';},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!='input'||!(/^(?:button|reset|submit)$/i.test(element.type))))
element.select();}catch(e){}
return element;},disable:function(element){element=$(element);element.disabled=true;return element;},enable:function(element){element=$(element);element.disabled=false;return element;}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers={input:function(element,value){switch(element.type.toLowerCase()){case'checkbox':case'radio':return Form.Element.Serializers.inputSelector(element,value);default:return Form.Element.Serializers.textarea(element,value);}},inputSelector:function(element,value){if(Object.isUndefined(value))return element.checked?element.value:null;else element.checked=!!value;},textarea:function(element,value){if(Object.isUndefined(value))return element.value;else element.value=value;},select:function(element,value){if(Object.isUndefined(value))
return this[element.type=='select-one'?'selectOne':'selectMany'](element);else{var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return;}}
else opt.selected=value.include(currentValue);}}},selectOne:function(element){var index=element.selectedIndex;return index>=0?this.optionValue(element.options[index]):null;},selectMany:function(element){var values,length=element.length;if(!length)return null;for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected)values.push(this.optionValue(opt));}
return values;},optionValue:function(opt){return Element.extend(opt).hasAttribute('value')?opt.value:opt.text;}};Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue();},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value;}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element);}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=='form')
this.registerFormCallbacks();else
this.registerCallback(this.element);},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value;}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this);},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case'checkbox':case'radio':Event.observe(element,'click',this.onElementEvent.bind(this));break;default:Event.observe(element,'change',this.onElementEvent.bind(this));break;}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element);}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element);}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED='onmouseenter'in docEl&&'onmouseleave'in docEl;var _isButton;if(Prototype.Browser.IE){var buttonMap={0:1,1:4,2:2};_isButton=function(event,code){return event.button===buttonMap[code];};}else if(Prototype.Browser.WebKit){_isButton=function(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==1&&event.metaKey;default:return false;}};}else{_isButton=function(event,code){return event.which?(event.which===code+1):(event.button===code);};}
function isLeftClick(event){return _isButton(event,0)}
function isMiddleClick(event){return _isButton(event,1)}
function isRightClick(event){return _isButton(event,2)}
function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==='load'||type==='error'||(type==='click'&&currentTarget.tagName.toLowerCase()==='input'&&currentTarget.type==='radio'))
node=currentTarget;}
if(node.nodeType==Node.TEXT_NODE)
node=node.parentNode;return Element.extend(node);}
function findElement(event,expression){var element=Event.element(event);if(!expression)return element;var elements=[element].concat(element.ancestors());return Selector.findElement(elements,expression,0);}
function pointer(event){return{x:pointerX(event),y:pointerY(event)};}
function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+
(docElement.scrollLeft||body.scrollLeft)-
(docElement.clientLeft||0));}
function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+
(docElement.scrollTop||body.scrollTop)-
(docElement.clientTop||0));}
function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true;}
Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m;});if(Prototype.Browser.IE){function _relatedTarget(event){var element;switch(event.type){case'mouseover':element=event.fromElement;break;case'mouseout':element=event.toElement;break;default:return null;}
return Element.extend(element);}
Object.extend(methods,{stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return'[object Event]'}});Event.extend=function(event,element){if(!event)return false;if(event._extendedByPrototype)return event;event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});return Object.extend(event,methods);};}else{Event.prototype=window.Event.prototype||document.createEvent('HTMLEvents').__proto__;Object.extend(Event.prototype,methods);Event.extend=Prototype.K;}
function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,'prototype_event_registry',$H());}
var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent);}
if(respondersForEvent.pluck('handler').include(handler))return false;var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName))
return false;if(event.eventName!==eventName)
return false;Event.extend(event,element);handler.call(element,event);};}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode;}
catch(e){parent=element;}}
if(parent===element)return;handler.call(element,event);};}}else{responder=function(event){Event.extend(event,element);handler.call(element,event);};}}
responder.handler=handler;respondersForEvent.push(responder);return responder;}
function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null;}}
var CACHE=[];if(Prototype.Browser.IE)
window.attachEvent('onunload',_destroyCache);if(Prototype.Browser.WebKit)
window.addEventListener('unload',Prototype.emptyFunction,false);var _getDOMEventName=Prototype.K;if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){var translations={mouseenter:"mouseover",mouseleave:"mouseout"};return eventName in translations?translations[eventName]:eventName;};}
function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder)return element;if(eventName.include(':')){if(element.addEventListener)
element.addEventListener("dataavailable",responder,false);else{element.attachEvent("ondataavailable",responder);element.attachEvent("onfilterchange",responder);}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener)
element.addEventListener(actualEventName,responder,false);else
element.attachEvent("on"+actualEventName,responder);}
return element;}
function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,'prototype_event_registry');if(Object.isUndefined(registry))return element;if(eventName&&!handler){var responders=registry.get(eventName);if(Object.isUndefined(responders))return element;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});return element;}else if(!eventName){registry.each(function(pair){var eventName=pair.key,responders=pair.value;responders.each(function(r){Element.stopObserving(element,eventName,r.handler);});});return element;}
var responders=registry.get(eventName);if(!responders)return;var responder=responders.find(function(r){return r.handler===handler;});if(!responder)return element;var actualEventName=_getDOMEventName(eventName);if(eventName.include(':')){if(element.removeEventListener)
element.removeEventListener("dataavailable",responder,false);else{element.detachEvent("ondataavailable",responder);element.detachEvent("onfilterchange",responder);}}else{if(element.removeEventListener)
element.removeEventListener(actualEventName,responder,false);else
element.detachEvent('on'+actualEventName,responder);}
registry.set(eventName,responders.without(responder));return element;}
function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble))
bubble=true;if(element==document&&document.createEvent&&!element.dispatchEvent)
element=document.documentElement;var event;if(document.createEvent){event=document.createEvent('HTMLEvents');event.initEvent('dataavailable',true,true);}else{event=document.createEventObject();event.eventType=bubble?'ondataavailable':'onfilterchange';}
event.eventName=eventName;event.memo=memo||{};if(document.createEvent)
element.dispatchEvent(event);else
element.fireEvent(event.eventType,event);return Event.extend(event);}
Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),loaded:false});if(window.Event)Object.extend(window.Event,Event);else window.Event=Event;})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded)return;if(timer)window.clearTimeout(timer);document.loaded=true;document.fire('dom:loaded');}
function checkReadyState(){if(document.readyState==='complete'){document.stopObserving('readystatechange',checkReadyState);fireContentLoadedEvent();}}
function pollDoScroll(){try{document.documentElement.doScroll('left');}
catch(e){timer=pollDoScroll.defer();return;}
fireContentLoadedEvent();}
if(document.addEventListener){document.addEventListener('DOMContentLoaded',fireContentLoadedEvent,false);}else{document.observe('readystatechange',checkReadyState);if(window==top)
timer=pollDoScroll.defer();}
Event.observe(window,'load',fireContentLoadedEvent);})();Element.addMethods();Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(element,content){return Element.insert(element,{before:content});},Top:function(element,content){return Element.insert(element,{top:content});},Bottom:function(element,content){return Element.insert(element,{bottom:content});},After:function(element,content){return Element.insert(element,{after:content});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(element,x,y){if(this.includeScrollOffsets)
return this.withinIncludingScrolloffsets(element,x,y);this.xcomp=x;this.ycomp=y;this.offset=Element.cumulativeOffset(element);return(y>=this.offset[1]&&y<this.offset[1]+element.offsetHeight&&x>=this.offset[0]&&x<this.offset[0]+element.offsetWidth);},withinIncludingScrolloffsets:function(element,x,y){var offsetcache=Element.cumulativeScrollOffset(element);this.xcomp=x+offsetcache[0]-this.deltaX;this.ycomp=y+offsetcache[1]-this.deltaY;this.offset=Element.cumulativeOffset(element);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+element.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+element.offsetWidth);},overlap:function(mode,element){if(!mode)return 0;if(mode=='vertical')
return((this.offset[1]+element.offsetHeight)-this.ycomp)/element.offsetHeight;if(mode=='horizontal')
return((this.offset[0]+element.offsetWidth)-this.xcomp)/element.offsetWidth;},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(element){Position.prepare();return Element.absolutize(element);},relativize:function(element){Position.prepare();return Element.relativize(element);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(source,target,options){options=options||{};return Element.clonePosition(target,source,options);}};document.getElementsByClassName=function(className,parentElement){if(Prototype.BrowserFeatures.XPath){var q=".//*[contains(concat(' ', @class, ' '), ' "+className+" ')]";return document._getElementsByXPath(q,parentElement);}else{var children=($(parentElement)||document.body).getElementsByTagName('*');var elements=[],child;for(var i=0,length=children.length;i<length;i++){child=children[i];if(Element.hasClassName(child,className))
elements.push(Element.extend(child));}
return elements;}};Element.Methods.getElementsByClassName=function(element,className){return document.getElementsByClassName(className,element);}
Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(element){this.element=$(element);},_each:function(iterator){this.element.className.split(/\s+/).select(function(name){return name.length>0;})._each(iterator);},set:function(className){this.element.className=className;},add:function(classNameToAdd){if(this.include(classNameToAdd))return;this.set($A(this).concat(classNameToAdd).join(' '));},remove:function(classNameToRemove){if(!this.include(classNameToRemove))return;this.set($A(this).without(classNameToRemove).join(' '));},toString:function(){return $A(this).join(' ');}};Object.extend(Element.ClassNames.prototype,Enumerable);var SeekingAlpha={};SeekingAlpha.Initializer={PreLoadRepository:[],AfterLoadRepository:[],AfterAutoCompleteLoaded:[],Logger:[],Add:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.PreLoadRepository.push(Ref);},RunDelay:function(){SeekingAlpha.Initializer.PreLoadRepository.each(function(Ref,i){Ref();});},Run:function(){setTimeout(SeekingAlpha.Initializer.RunDelay,1);SeekingAlpha.Initializer.Add=SeekingAlpha.Initializer.LogAndRun;},LogAndRun:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);Ref();},AddAfterLoad:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.AfterLoadRepository.push(Ref);},RunAfterLoadDelay:function(){SeekingAlpha.Initializer.AfterLoadRepository.each(function(Ref,i){if(Ref)Ref();});},RunAfterLoad:function(){setTimeout(SeekingAlpha.Initializer.RunAfterLoadDelay,1);SeekingAlpha.Initializer.AddAfterLoad=SeekingAlpha.Initializer.LogAndRun;SeekingAlpha.Initializer.loaded=true;},AddAfterAutoCompleteLoaded:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);SeekingAlpha.Initializer.AfterAutoCompleteLoaded.push(Ref);},RunAfterAutoCompleteLoadedDelay:function(){SeekingAlpha.Initializer.AfterAutoCompleteLoaded.each(function(Ref,i){if(Ref)Ref();});},RunAfterAutoCompleteLoaded:function(){setTimeout(SeekingAlpha.Initializer.RunAfterAutoCompleteLoadedDelay,1);SeekingAlpha.Initializer.AddAfterAutoCompleteLoaded=SeekingAlpha.Initializer.LogAndRun;SeekingAlpha.Initializer.autoCompleteLoaded=true;},onDOMLoad:function(Ref){SeekingAlpha.Initializer.Logger.push(Ref);document.observe("dom:loaded",Ref);}};window.undefined=window.undefined;var SA={};SA.Destructor=function(){try{SA=null;}catch(e){}}
SA.UsingNamespace=function(ns){var names=ns.split(".");var scope=this;for(var i=0;i<names.length;i++){var name=names[i];if((i==0)&&(name=="SA"))
continue;if(!scope[name])
scope[name]=new Object();scope=scope[name];}
return scope;}
if(Event&&typeof(Event.observe)=="function")Event.observe(window,'unload',SA.Destructor);if(!window.console)console={};console.log=console.log||function(){};console.warn=console.warn||function(){};console.error=console.error||function(){};console.info=console.info||function(){};(function(){var scope=SA.UsingNamespace("SA.Data");scope.Cookies=new function(){this.set=function(name,value,days){var expires="";if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}
document.cookie=escape(name).replace('+','%2B')+"="+escape(value).replace('+','%2B')+expires+"; path=/";}
this.get=function(name){if(window.user_cookie&&user_cookie[name])return''+user_cookie[name];var escName=escape(name).replace('+','%2B').replace(/([.*?^=!:${}()|[\]\/\\])/g,'\\$1');var cookie=document.cookie.match(new RegExp('(?:^|;)\\s*'+escName+'=([^;]*)(?:;|$)'));if(cookie)return unescape(cookie[1]);return null;}
this.del=function(name){this.set(name,"",-1);}
this.exists=function(name){var val=this.get(name);return val!=null&&val!='';}}})();function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}else
var expires="";document.cookie=name+"="+value+expires+"; path=/";}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return unescape(c.substring(nameEQ.length,c.length)).gsub(/\+/,' ');}
if(typeof(user_cookie)!="undefined"&&user_cookie[name])return''+user_cookie[name];return null;}
function eraseCookie(name){createCookie(name,"",-1);}
function cookieExists(cookie_name){return(readCookie(cookie_name)!=null&&readCookie(cookie_name)!='');}
(roadblock=function(source){this.source=source;this.type="Roadblock";this.version=null;this.additional_login_title="";this.register_show=function(){throw("Register Show Function not assigned for the correct use of roadblock object");}
this.stocks="";this.email="";this.password="";this.cfa=null;this.register=function(){try{if(!this.cfa)stocksAr=SA.Models.StockModel.stringToStocksArray($('autocomplete_roadblock').value);clearErrors();if($('roadblock_error')){$('roadblock_error').innerHTML="";if(!this.cfa&&$('autocomplete_roadblock').value==$('autocomplete_roadblock').title){clientSideError($('autocomplete_roadblock'),"*Please register in order to continue");return;}
if(!this.cfa&&stocksAr[1].length>0){clientSideError($('autocomplete_roadblock'),"*Symbol(s) not recognized");$('roadblock_error').innerHTML+=": "+stocksAr[1].join(",");$('autocomplete_roadblock').value=stocksAr[0].join(", ");return;}
if(!this.cfa&&stocksAr[0].uniq().length<5){clientSideError($('autocomplete_roadblock'),"*Please enter at least 5 stocks to continue");return;}
if(!rxEmail.test($("roadblock_email").value)){clientSideError($("roadblock_email"),"*Invalid Email");return;}
if($("roadblock_password").value==$("roadblock_password").title){$("roadblock_password").focus();clientSideError($("roadblock_password"),"*Please choose a password");return;}
if($("roadblock_password").value.length<4){$("roadblock_password").focus();clientSideError($("roadblock_password"),"*Password too short");return;}}
$('roadblock_loader').show();var opt={}
if(!this.cfa)slugs=stocksAr[0].join(",");if(!this.cfa&&$("sendRta").checked){opt.noAlerts=false;opt.rtaSlugs=slugs;}else{opt.noAlerts=true;if(!this.cfa)opt.rtaSlugs=slugs;}
if(this.cfa){opt.cfa="cfa_user";}
opt.password=$("roadblock_password").value;opt.activity='roadblock';SA.Data.User.Register($("roadblock_email").value,this.source,rb_success,rb_fail,opt);}catch(e){Mone.event(rb.type,rb.source,"Js Error : roadblock register",{data:{error:e.message}});force_close();}}
this.addStocks=function(email){try{stocksAr=SA.Models.StockModel.stringToStocksArray($('autocomplete_roadblock').value);clearErrors();if($('roadblock_error')){$('roadblock_error').innerHTML="";if(!$('autocomplete_roadblock').Changed()){clientSideError($('autocomplete_roadblock'),"Please choose at least one stock");return;}
if(stocksAr[1].length>0){clientSideError($('autocomplete_roadblock'),"*Symbol(s) not recognized");$('roadblock_error').innerHTML+=": "+stocksAr[1].join(",");$('autocomplete_roadblock').value=stocksAr[0].join(", ");return;}
if(stocksAr[0].uniq().length==0){clientSideError($('autocomplete_roadblock'),"Please choose at least one stock");return;}}
$('roadblock_loader').show();var opt={}
slugs=stocksAr[0].join(",");Mone.event(rb.type,rb.source,"Stocks added logout:"+stocksAr[0].length);SA.Promotion.Quote.Register(email,slugs,add_success(email),rb_fail,opt);}catch(e){Mone.event(rb.type,rb.source,"Js Error : roadblock addStocks",{data:{error:e.message}});force_close();}}
this.addStocksLogin=function(email){try{if(!email){email=readCookie("user_email")}
stocksAr=SA.Models.StockModel.stringToStocksArray($('autocomplete_roadblock').value);clearErrors();if($('roadblock_error')){$('roadblock_error').innerHTML="";if(!$('autocomplete_roadblock').Changed()){clientSideError($('autocomplete_roadblock'),"Please choose at least one stock");return;}
if(stocksAr[1].length>0){clientSideError($('autocomplete_roadblock'),"*Symbol(s) not recognized");$('roadblock_error').innerHTML+=": "+stocksAr[1].join(",");$('autocomplete_roadblock').value=stocksAr[0].join(", ");return;}
if(stocksAr[0].uniq().length==0){clientSideError($('autocomplete_roadblock'),"Please choose at least one stock");return;}}
$('roadblock_loader').show();var opt={}
stocks=stocksAr[0].join(",");Mone.event(rb.type,rb.source,"Stocks added login:"+stocksAr[0].length);SA.Models.PortfolioModel.listPortfolios(function(pAr){rta="rta_articles,rta_market_currents";if(is_pro){rta+=",rta_pro_articles";}
portfolio=new SA.Models.PortfolioModel({portfolioUri:pAr[0].puri});portfolio.addSymbols(stocks,function(response){add_success2(email);if(response.errors){Mone.event(rb.type,rb.source,"Server side error: "+response.errors);}},function(){rb.close();Mone.event(rb.type,rb.source,"Fail to add symbols",{data:{stocks:stocks[0].join(",")}});},rta);return;},function(){});}catch(e){Mone.event(rb.type,rb.source,"Js Error : roadblock addStocksLogin",{data:{error:e.message}});force_close();}}
this.close=function(){force_close();}
this.add_success=function(email){if(!AlphaBox.isOpen)AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article thankyou">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">Thanks for registering to <strong>Seeking Alpha real-time email alerts</strong>.</div>');html.push('<p class="email_msg_popup">A confirmation email has been sent to <strong>'+(email||registered_mail)+'</strong>.</p>');html.push('<p class="last_p">Please confirm your registration by clicking the link in the email</p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));sugest_version=ABTest.identity%10;if(sugest_version==1||sugest_version==2){Mone.event(rb.type,rb.source,"sugest popup registration conversion with alerts");}}
this.add_success2=function(opt){if(!opt)opt={};var aHTML=[],addedTags=(opt.addedTags||[]);aHTML.push('<div class="customize_pop_bordeaux rta_pop">');aHTML.push('<h1>You have successfully subscribed to real-time alerts!</h1>');aHTML.push('<div>'+SA.Utils.joinWithAnd(addedTags)+(addedTags.length==1?' has':' have')+' been added to your portfolio. If you want to add/edit stocks <a href="/account/portfolio">visit your portfolio page</a></div>');aHTML.push('<div style="padding-top:10px">');aHTML.push('<div class="emails_be_sent">Emails will be sent to <strong>'+readCookie('user_email').replace(/ /g,'+')+'</strong> <span  class="update_email" style="color:#024999">[<a href="/account/account_preferences">Update email address</a>]</span></div>');aHTML.push('</div>');aHTML.push('</div>');aHTML.push('<div class="close_pop_bordeaux" onclick="AlphaBox.Close();"></div>');aHTML.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(aHTML.join(""));if(typeof(events)!="undefined"&&events.closedThankYouPopup)AlphaBox.onAfterClose=events.closedThankYouPopup;}
this.add_success3=function(opt){opt=opt||events||{};var aHTML=[];aHTML.push('<div class="customize_pop_bordeaux rta_welcome">');if(opt.welcomeBack)aHTML.push('<h1>Welcome back '+readCookie('user_nick')+',</h1>');aHTML.push('<h3 style="font-size:1em !important; padding-bottom:5px; font-weight:700;">You have successfully subscribed to real-time alerts!</h3>');aHTML.push('<div style="padding-bottom:10px;">A portfolio with your stocks is now available on your portfolio page.<br/>Add/Edit your stocks <a href="/account/portfolio" style="color:#024999 !important">here</a></div>');aHTML.push('<div class="emails_be_sent">Emails will be sent to <strong>'+readCookie('user_email').replace(/ /g,'+')+'</strong> <span class="update_email">[<a href="/account/account_preferences">Update email address</a>]</span></div>');aHTML.push('</div>');aHTML.push('<div class="close_pop_bordeaux" onclick="AlphaBox.Close();"></div>');aHTML.push('</div>');AlphaBox.Loading();AlphaBox.AddHtml(aHTML.join(" "));}
function clientSideError(obj,msg){$('roadblock_error').innerHTML=msg;var rta_reg=($('sendRta')&&$('sendRta').checked)?"Ticker addition alert conversion":"";Mone.event(rb.type,rb.source+' Register',"Error : "+msg,{data:{email:rb.email}});if(obj){obj.addClassName('bcred');}
return;}
function rb_success(){try{var rta_reg=($('sendRta')&&$('sendRta').checked)?"Ticker addition alert conversion":"";if($('sendRta')&&$('sendRta').checked)Mone.event(rb.type,rb.source+' Register',' Registration conversion alerts');else Mone.event(rb.type,rb.source+' Register',"Registration conversion no alerts");SA.Utils.Popup.roadblock_confirmation();}catch(e){Mone.event(rb.type,rb.source,"Js Error : roadblock success register ",{data:{error:e.message}});force_close();}}
function rb_fail(response){try{var rta_reg=($('sendRta')&&$('sendRta').checked)?"Ticker addition alert conversion":"";if($('roadblock_error')&&response.errors=="already_registered"){$('roadblock_error').innerHTML="*This email is already registered in the system.";}
if($('roadblock_error')&&response.errors=="Username has been already taken"){$('roadblock_error').innerHTML="*Username has been already taken.";}
if($('roadblock_error')&&response.errors=="regislogin"){Mone.event(rb.type,rb.source,"Regislogin");SA.Utils.Popup.regislogin_notification();}
if($('roadblock_loader'))$('roadblock_loader').hide();Mone.event(rb.type,rb.source+' Register',"Error : "+response.errors);}catch(e){Mone.event(rb.type,rb.source,"Js Error : roadblock fail register",{data:{error:e.message}});force_close();}}
function clearErrors(){$$('.bcred').each(function(o){o.removeClassName('bcred');});}
function force_close(){$('alphabox-modal-overlay').hide();$('alphabox-modal-window').hide();}})();(function(){var scope=SA.UsingNamespace("SA.Data");scope.iPad=function(){this.responseDelegate=null;this.instanceName=null;this.getData=function(){if(!this.instanceName){throw("Please set instanceName before using this method!");}
var src=document.createElement("script");src.src="http://itunes.apple.com/lookup?id=624497238&callback="+escape(this.instanceName+".buildEntityByJSON")+"&d="+Math.random();document.body.appendChild(src);}
this.buildEntityByJSON=function(json){var data={};if(json&&json.resultCount>0){var res=json.results[0];data.averageUserRating=res.averageUserRating;data.userRatingCount=res.userRatingCount;}
if(this.responseDelegate)
this.responseDelegate.handleResponse(data);}}})();var ipad_splash={};SeekingAlpha.Initializer.onDOMLoad(function(){ipad_splash.ipad_promotion_splash=function(){Mone.touch("full_splash_ipad_shown");promotion_ipad=document.createElement("div");promotion_ipad.addClassName("promotion_cnt promotionSplash ipad");var proHTML;proHTML=document.createElement("div");proHTML.className='proHTML';proHTML.innerHTML='<div class="app_splash">'+' <h1>The #1 Portfolio App is Now on iPad!</h1>'+'<h2>Enjoy faster browsing & a more comfortable<br> way to enjoy Seeking Alpha content.</h2>'+'<div class="iphones_image"></div>'+'<span class="buttons_box">'+'<div id="ipad_stars_splash" class="stars stars_5"></div>'+'<h3 onclick="ipad_splash.ipad_promotion_splash.close();Mone.event(\'ipad_promotion_full_splash\',\'promotion_full_splash_ipad\',\'ipad_full_splash_click\');SA.Data.Cookies.set(\'ipad_splash\',true,90);location.href=\'/download-app?source=promotion_full_splash_ipad\'">Download Now</h3>'+'<span class="continue" onclick="ipad_splash.ipad_promotion_splash.close();Mone.event(\'ipad_promotion_full_splash_close\',\'promotion_full_splash_ipad_close\',\'ipad_full_splash_click_close\');SA.Data.Cookies.set(\'ipad_splash\',true,90);">Continue to our mobile site &#187;</span>'+'</span>'+'</div>';promotion_ipad.appendChild(proHTML);viewPortTag=document.createElement('meta');viewPortTag.id="viewport";viewPortTag.name="viewport";viewPortTag.content="initial-scale=1; ";document.ontouchmove=function(e){e.preventDefault();}
document.body.appendChild(promotion_ipad);window.ipadDataSplashPromotion=new SA.Data.iPad();ipadDataSplashPromotion.instanceName="ipadDataSplashPromotion";var responseHandler=new Object();responseHandler.handleResponse=function(data){if(!data.averageUserRating)return;var stars=data.averageUserRating<4?"4":(data.averageUserRating+"").replace(".","");if($("ipad_stars_splash"))$("ipad_stars_splash").className="stars stars_"+stars;}
ipadDataSplashPromotion.responseDelegate=responseHandler;ipadDataSplashPromotion.getData();ipad_splash.ipad_promotion_splash.close=function(){promotion_ipad.style.display='none';document.ontouchmove=null;}}
var src=getURLParam("source");var from_SA_emails=(src&&src.match('email'))?true:false;if(SA.Utils.Env.isIPad&&!/3/.test(SA.Data.Cookies.get("user_devices"))&&!SA.Data.Cookies.get('ipad_splash')&&(top.location.href.indexOf('/article/')<0)){if(from_SA_emails)return;ipad_splash.ipad_promotion_splash();}});(function(){var scope=SA.UsingNamespace("SA.Models");scope.PortfolioModel=function(args){var portfolioUri=null;var QuoteData=null;var slugs=null;var stocksNumber;var title;var _this=this;var TransactionValue={1:1,2:-1}
var deleteAjaxRequest=0;this.RemovePortfolioTagID=function(pTagId,oncomplete,onfailed){if(!pTagId)return;deleteAjaxRequest++;new Ajax.Request('/account/remove_slug_from_portfolio',{asynchronous:true,evalScripts:true,parameters:{portfolio_tag_id:pTagId,pu:portfolioUri},onComplete:function(transport){if(deleteAjaxRequest==1){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){SetQuoteData(response.portfolio_stocks);SetStocksNumber();if(oncomplete)oncomplete();return;}else{if(onfailed)onfailed(response.errors);else alert(response.errors);}}
deleteAjaxRequest--;}});}
this.addSymbols=function(symbols,oncomplete,onfailed,alerts){alerts=alerts||"";if(!symbols)return;new Ajax.Request('/account/add_symbols_to_portfolio',{asynchronous:true,evalScripts:true,parameters:{symbols:symbols,pu:portfolioUri,rta:alerts},onComplete:function(transport){var response;try{response=transport.responseText.evalJSON()}catch(e){}
if(transport.status==200&&response&&response.errors==null){SetQuoteData(response.portfolio_stocks);SetSlugs(symbols);SetStocksNumber();try{symbols.split(",").each(function(slug){slug=slug.toLowerCase().replace(/ /g,"");if(slug!="")addToCookie('user_watchlist_slugs',slug);});}catch(e){}
if(oncomplete){if(typeof(oncomplete)=='function')oncomplete(response);else eval(oncomplete);}
return;}else{if(onfailed){response=response||{errors:"Unknown error"};if(typeof(oncomplete)=='function')onfailed(response);else eval(onfailed);}else alert(response.errors)}}});var slugs=symbols?symbols.replace(/^(\s*,)+|(,\s*)+$|\s+/g,'').replace(/,+/g,','):'',count=(slugs?slugs.split(',').length:0);if(window.pageTracker)pageTracker._trackEvent('Add To Portfolio',SA.Utils.unifiedPath(),''+count);}
this.createPortfolio=function(name,stocks,oncomplete,onfailed,email_alerts,eventLabel){var val=scope.PortfolioModel.CheckingValidation({title:name,allowEmptyTitle:true});if(!eventLabel)eventLabel=SA.Utils.unifiedPath();if(val[0]){response={errors:val[1]};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}
var params={name:name,stocks:stocks,rta:email_alerts,source:eventLabel};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
new Ajax.Request('/account/add_new_portfolio',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(stocks&&stocks!="")
try{var slugs=stocks.toLowerCase().replace(/ /g,"");if(slugs!=""&&user_cookie){user_cookie.user_watchlist_slugs=((user_cookie.user_watchlist_slugs||'')+','+slugs).split(',').sort().uniq(true).join(',').replace(/^,/,'');}}catch(e){}
SetPortfolioUri(response.portfolio_uri);if(typeof(oncomplete)=='function')oncomplete(response);else if(oncomplete)eval(oncomplete);}else{if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);}},on500:function(){if(typeof(onfailed)=='function')onfailed();else if(onfailed)eval(onfailed);}});var slugs=stocks?stocks.replace(/^(\s*,)+|(,\s*)+$|\s+/g,'').replace(/,+/g,','):'',count=(slugs?slugs.split(',').length:0);SA.Stats.GA.event("Create Portfolio",eventLabel,''+count);}
this.GetTransactionValue=function(tran){return TransactionValue[tran];}
this.GetStocksNumber=function(){return stocksNumber;}
this.GetUri=function(){return portfolioUri;}
this.GetQuoteData=function(){return QuoteData;}
this.RedirectToPortfolioPage=function(){if(portfolioUri)location.href="/account/portfolio?pu="+portfolioUri;}
this.RedirectToHoldingsPage=function(){if(portfolioUri)location.href="/account/edit_holdings?pu="+portfolioUri}
this.Destroy=function(oncomplete,onfailed){if(!portfolioUri)return;new Ajax.Request('/account/destroy_portfolio',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.SetRealTimeMarketCurrent=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;new Ajax.Request('/account/set_real_time_market_current',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri,alert:alert,source:source},onComplete:function(transport){var response;if(transport.status==200){try{response=transport.responseText.evalJSON();}catch(e){response={errors:"Unknown Error"};}}else{response={errors:"Unknown Error"};}
if(response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed(response.errors);}}});}
this.SetRealTimeArticles=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;new Ajax.Request('/account/set_real_time_articles',{asynchronous:true,evalScripts:true,parameters:{pu:portfolioUri,alert:alert,source:source},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.SetDailyPreMarketSummary=function(alert,oncomplete,onfailed,source){if(!portfolioUri||alert==null)return;var params={pu:portfolioUri,alert:alert,source:source};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
new Ajax.Request('/account/set_daily_pre_market_summary',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(oncomplete)oncomplete();}else{if(onfailed)onfailed();alert(response.errors);}}});}
this.GetSlugs=function(){return slugs;}
this.GetTitle=function(){return title;}
function SetPortfolioUri(uriName){portfolioUri=uriName;}
function SetSlugs(newSlugs){if(newSlugs)newSlugs=newSlugs.gsub(" ","");slugs=slugs?slugs+","+newSlugs:newSlugs;}
function Init(args){if(args){SetPortfolioUri(args.portfolioUri);SetQuoteData(args.quoteData);if(args.slugs)SetSlugs(args.slugs);else InitSlugs();if(args.title)SetTitle(args.title);SetStocksNumber();}}
function SetTitle(name){title=name;}
function SetStocksNumber(){var number=0;for(key in QuoteData){number=number+1}
stocksNumber=number;}
function SetQuoteData(data){QuoteData=data;}
function InitSlugs(){var s=[];for(q in QuoteData){s.push(QuoteData[q]["slug"]);}
SetSlugs(s.uniq().join(","));}
Init(args);}
scope.PortfolioModel.CheckingValidation=function(vars){var validations={};validations["title"]={reg:/^.{0,22}$/,msg:"Portfolio name can't be blank (maximum is 22 characters)",not_empty:!vars.allowEmptyTitle}
var validationErrors={};var bool=false
for(var validation in validations){if(!(validations[validation].reg.test(vars[validation]))||(validations[validation].not_empty&&vars[validation].trim().length==0)){validationErrors[validation]=validations[validation].msg;bool=true;}}
return[bool,validationErrors];}
scope.PortfolioModel.listPortfolios=function(onsuccess,onfailure,searchSymbol){var params={};if(searchSymbol)params['sym']=searchSymbol;new Ajax.Request('/account/get_portfolios_list',{asynchronous:true,parameters:params,onSuccess:function(response){if(onsuccess)try{var result=response.responseText.evalJSON();if(result.errors){if(onfailure)onfailure(result.errors);}else onsuccess(result);}catch(e){if(onfailure)onfailure("Invalid response");}},onFailure:function(){if(onfailure)onfailure("Unknown error");}});}
scope.PortfolioModel.AddSymbolsWithAlertsToPortfolios=function(purisForSymbols,symbols,alerts,oncomplete,onfailed,eventSource){if(!symbols||(!purisForSymbols&&!alerts))return;if(is_pro){if(!alerts.match('rta_pro_articles')){alerts+=',rta_pro_articles';}}
var params={slugs:symbols,puris:purisForSymbols,rta:alerts};if(!is_users_cookie_exists()){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];}else{var response={errors:"Invalid user"};if(typeof(onfailed)=='function')onfailed(response);else if(onfailed)eval(onfailed);return;}}
params.source=eventSource;if(window._saSource=="article_sidebar_signup")params.source+=" from article sidebar";new Ajax.Request('/account/add_symbols_with_alerts_to_portfolios',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response;try{response=transport.responseText.evalJSON();}catch(e){response={errors:"unknown error"};}
if(transport.status==200&&response&&response.errors==null){try{user_cookie.user_watchlist_slugs=((user_cookie.user_watchlist_slugs||'')+','+slugs).split(',').sort().uniq(true).join(',').replace(/^,/,'');}catch(e){}
if(oncomplete)oncomplete(response);}else{if(onfailed)onfailed(response);}}});}
scope.PortfolioModel.Update=function(){var puid=p.match(/([0-9]+)-/)[1];if(!puid)return;new Ajax.Request('/account/update',{asynchronous:true,evalScripts:true,parameters:{pu:puid},onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){SetQuoteData(response.portfolio_stocks);symbols=response.portfolio_stocks;SetStocksNumber();SetSlugs(symbols);try{symbols.split(",").each(function(slug){slug=slug.toLowerCase().replace(/ /g,"");if(slug!="")addToCookie('user_watchlist_slugs',slug);});}catch(e){}
return;}else{alert(response.errors);}}});}})();(function(){var scope=SA.UsingNamespace("SA.Models");scope.SubscriptionModel=function(args){}
scope.SubscriptionModel.subscribe=function(tag_ids,modes,source,onSuccess,onFailure){var params={tags:tag_ids,modes:modes,source:source};if(!SA.Data.User.loggedIn()&&!grAuth(params,onFailure))return;SA.Utils.ajax('/account/ajax_subscribe_to_tags',params,onSuccess,onFailure);}
scope.SubscriptionModel.unsubscribe=function(tag_ids,modes,onSuccess,onFailure,reason_id){var params={tags:tag_ids,modes:modes};if(reason_id)params.reason_id=reason_id;if(!SA.Data.User.loggedIn()&&!grAuth(params,onFailure))return;SA.Utils.ajax('/account/ajax_unsubscribe_from_tags',params,onSuccess,onFailure);}
scope.SubscriptionModel.addStocktoRtaCookie=function(rta,stock){if(user_cookie){if(user_cookie[rta]==null){user_cookie[rta]="";}
user_cookie[rta]+=","+stock.trim().toLowerCase();}}
scope.SubscriptionModel.removeStockfromRtaCookie=function(rta,stock){if(user_cookie&&user_cookie[rta]){user_cookie[rta]=user_cookie[rta].split(",").without(stock.trim().toLowerCase()).join(',');}}
var grAuth=function(params,onFailure){var gr=location.search.match(/[?&]gr=([^&]+)/);if(gr){params.gr=gr[1];return true;}else{var response={errors:"Invalid user"};if(typeof(onFailure)=='function')onFailure(response);else if(onFailure)eval(onFailure);return false;}}})();(function(){var scope=SA.UsingNamespace("SA.Models");scope.StockTalkModel={}
scope.StockTalkModel.popUp=function(st){AlphaBox.Loading();scope.StockTalkModel.openPopUp=true;if(oRefresher){oRefresher.Clear();}
AlphaBox.onAfterClose=function(){SA.Models.StockTalkModel.openPopUp=false;if(oRefresher)oRefresher.Activate();}
AlphaBox.onBeforeClose=function(){SA.Models.StockTalkModel.openPopUp=false;if(oRefresher)oRefresher.Activate();}
var st_id=st.getAttribute("st_id");var params={id:st_id,page:1,limit:5};SA.Models.StockTalkModel.getStockTalksReplies({params:params,st:$$('#li_'+st_id)[0]},scope.StockTalkModel.renderPopUp);}
scope.StockTalkModel.renderPopUp=function(response,st){var h=[];h.push("<div class='replyPopup'>");h.push("<div onclick='AlphaBox.Close();' class='lightbox_x'></div>");h.push("<div class='top' realy_st='true'>");h.push(st.innerHTML);h.push("</div>");h.push("<div class='latest_stocktalks_snippet popup'>");h.push("<div class='form_area'>");h.push("<ul replies_st='"+st.getAttribute("st_id")+"'>");var size=response.length;for(var i=0;i<size;i++){var ttt=SA.Models.StockTalkModel.renderSingleST(response[i],'small');h.push(ttt);}
h.push("</ul>");h.push("</div>");h.push(scope.StockTalkModel.replyTextArea(st.getAttribute("st_id")));h.push("<span class='close link' onclick='AlphaBox.Close();'>Close</span>");AlphaBox.AddHtml(h.join(" "));setTimeout(scope.StockTalkModel.addScrollerToPopup,100);}
scope.StockTalkModel.reportSpam=function(el){var st_id=el.getAttribute("st_id");SA.Models.Reports.send(el,'StockTalk',st_id,function(){el.parentNode.parentNode.addClassName('reported')});}
var objDiv=document.getElementById("divExample");scope.StockTalkModel.addScrollerToPopup=function(el){var pop=$$('.replyPopup');var alphabox=$('alphabox-modal-window');if(!alphabox)return;var formArea=$$('.replyPopup .form_area')[0];alphabox.addClassName('getPosition');alphabox.style.marginTop=-(alphabox.getHeight()/2)+"px";if(pop.length==0)return;el=='newStock'?formArea.scrollTop=formArea.scrollHeight:formArea.scrollTop=0;if($$('.latest_stocktalks_snippet ul')[0].getHeight()>370){pop[0].addClassName('scroll');}
else{pop[0].removeClassName('scroll');}
if($$('.latest_stocktalks_snippet ul')[0].getHeight()<1){pop[0].addClassName('noStocks');}
else{pop[0].removeClassName('noStocks');}}
scope.StockTalkModel.btn=null;scope.StockTalkModel.getStockTalksOnScroll=function(args){if(!args.btn)return;scope.StockTalkModel.btn=args.btn;scope.StockTalkModel.btn.currentPage=2;scope.StockTalkModel.btn.container=args.container;scope.StockTalkModel.btn.stopGet=false;scope.StockTalkModel.btn.slugs=args.slugs;scope.StockTalkModel.btn.subjects=args.subjects;scope.StockTalkModel.btn.user_id=args.user_id;scope.StockTalkModel.btn.typeOf=args.typeOf;scope.StockTalkModel.btn.limit=args.limit;scope.StockTalkModel.btn.order_by_reply=args.order_by_reply;scope.StockTalkModel.btn.addOnComplete=function(response){scope.StockTalkModel.btn.children[0].className="older_archives";new Insertion.Bottom(scope.StockTalkModel.btn.container,response.html);scope.StockTalkModel.btn.currentPage+=1;if(scope.StockTalkModel.btn.currentPage>=response.total_pages){scope.StockTalkModel.btn.stopGet=true;scope.StockTalkModel.btn.remove();}}
if(args.onclick)
scope.StockTalkModel.btn.onclick=function(){if(scope.StockTalkModel.btn.stopGet)return;if(SA.Models.StockTalkModel.btn.children[0])SA.Models.StockTalkModel.btn.children[0].className="loader";var params={page:scope.StockTalkModel.btn.currentPage,slugs:scope.StockTalkModel.btn.slugs,user_id:scope.StockTalkModel.btn.user_id,subjects:scope.StockTalkModel.btn.subjects,type_of:scope.StockTalkModel.btn.typeOf,limit:scope.StockTalkModel.btn.limit};if(scope.StockTalkModel.btn.order_by_reply)params.order_by_reply=1;SA.Models.StockTalkModel.getStockTalks(params,scope.StockTalkModel.btn.addOnComplete);}
else{SA.Utils.saScroll.add("st_getStockTalksOnScroll",function(){if(scope.StockTalkModel.btn.stopGet)return;if(!ScrollerCloseToElement(scope.StockTalkModel.btn,350))return;if(SA.Models.StockTalkModel.btn.children[0])SA.Models.StockTalkModel.btn.children[0].className="loader";var params={page:scope.StockTalkModel.btn.currentPage,slugs:scope.StockTalkModel.btn.slugs,user_id:scope.StockTalkModel.btn.user_id,subjects:scope.StockTalkModel.btn.subjects,type_of:scope.StockTalkModel.btn.typeOf,limit:scope.StockTalkModel.btn.limit};if(scope.StockTalkModel.btn.order_by_reply)params.order_by_reply=1;SA.Models.StockTalkModel.getStockTalks(params,scope.StockTalkModel.btn.addOnComplete);});}}
scope.StockTalkModel.bInProcces={}
scope.StockTalkModel.getStockTalks=function(params,onComplete,onFailed){if(scope.StockTalkModel.bInProcces["getStockTalks"])return;scope.StockTalkModel.bInProcces["getStockTalks"]=true;if(!params)return;new Ajax.Request('/stock_talk/ajax_get_stocktalks',{asynchronous:true,parameters:params,onSuccess:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.initSt();socialSA.init();},onComplete:function(){SA.Models.StockTalkModel.bInProcces["getStockTalks"]=false;},on500:function(response){if(onFailed)onFailed(response.errors);},on502:function(response){if(onFailed)onFailed(response.errors);}});}
scope.StockTalkModel.enterText=function(el){if(!is_users_cookie_exists()){scope.StockTalkModel.openPopUp=false;open_header_log_in_popup_lightbox('login','publish StockTalks');return;}
SA.Models.StockTalkModel.showBtn(el);if(el.isFocuse)return;el.isFocuse=true;el=SA.Utils.Expansion.Input(el);el.addClassName('focus_lightbox');el.clearAll();el.Onfocus=function(self){if(self.HasFocused)return;self.HasFocused=false;if(oRefresher)oRefresher.Clear();var st_id=self.getAttribute("st_id");st_id=st_id?'_'+self.getAttribute("st_id"):'';$('char_counter'+st_id).style.display='block';SA.Models.StockTalkModel.realTime.stop();}
el.Onblur=function(){if(oRefresher)oRefresher.Activate();SA.Models.StockTalkModel.realTime.run();}
var tempEl=$("stock_talk_form");if(tempEl&&el.id=="stock_talk_textarea")tempEl.addClassName("focus");else el.style.height='40px';if(el)el.clearAll();SA.Models.StockTalkModel.realTime.stop();}
scope.StockTalkModel.getMoreReplies=function(st){var st_id=st.getAttribute("st_id");if(!st_id)return;var section=$$("[st_section_id="+st_id+"]");if(section.length>0)section[0].setAttribute("is_open","true")
if(scope.StockTalkModel.getMoreReplies.bInProcces[st_id])return;scope.StockTalkModel.getMoreReplies.bInProcces[st_id]=true;var args={}
args.params={id:st_id.gsub("new","")};args.st={id:st_id};scope.StockTalkModel.getStockTalksReplies(args,function(response,st){var el=$$("[older_replies_st="+st.id+"]")[0];if(!el)return;$$("[replies_bt="+st.id+"]")[0].hide();var h=[];var size=response.length;for(var i=0;i<size;i++){if(($$("[st_id="+response[i].id+"]").length==0&&!st.id.match(/new/))||($$("[st_id="+response[i].id+"new]").length==0&&st.id.match(/new/)))
h.push(scope.StockTalkModel.renderSingleST(response[i],"stocktalk_message_plus_time"));}
el.innerHTML=h.join(" ");el.parentNode.style.display="block";},function(errors){scope.StockTalkModel.getMoreReplies.bInProcces[errors.st_id]=false;});}
scope.StockTalkModel.getMoreReplies.bInProcces={};scope.StockTalkModel.getStockTalksReplies=function(args,onComplete,onFailed){if(!args.params)return;new Ajax.Request('/stock_talk/ajax_get_replies',{asynchronous:true,parameters:args.params,onSuccess:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response,args.st);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.initSt();socialSA.init();}});}
scope.StockTalkModel.renderOnlyOrigin=function(sTalks,source,ulID){var size=sTalks.size();if(size==0)return"";var h;if(ulID)h=["<ul id='"+ulID+"'>"];else h=["<ul>"]
for(var i=0;i<size;i++){h.push(SA.Models.StockTalkModel.renderSingleST(sTalks[i],"stocktalk_message_plus_time small",source));}
h.push=["</ul>"];return h.join(" ");}
scope.StockTalkModel.renderSingleST=function(st,cls,source){var is_origin=st.origin;var cls_origin=is_origin?"origin":"";var subject_id=st.subject_id?'subject_id="'+st.subject_id+'"':"";var real_st=st.not_real_st?"":'realy_st="true" poster="'+st.user_id+'"';source=source||"";if(is_users_cookie_exists())cls_origin+=" login";cls=cls?cls:"";var h=[];var url_prefix=st.author?'/author/'+st.author:'/user/'+st.user_id;h.push('<li '+subject_id+' '+real_st+' st_id="'+st.id+'" class="single_stocktalk '+cls_origin+'" id="li_'+st.id+'">');h.push('<a sasource="'+source+'_pic" class="user_image '+(st.author?"author":"")+'" href="'+url_prefix+(st.author?'':'/profile')+'"/>');h.push('<img src="'+st.user_image+'"/>');h.push('</a>');h.push('<div class="'+cls+'">');h.push('<a sasource="'+source+'_nick" href="'+url_prefix+'/stocktalk"/>'+st.nick+'</a>');h.push(st.content);h.push('<div class="time_wrapper">');h.push('<span class="time_ago">'+st.publish_on+'</span>');if(is_origin&&real_st!=""){var small=cls==""?"":"small='true'"
if(small!=true){h.push('<a href="<%=  st.uri %>" sasource="st_pl" class="st_permalink" ></a>');}
h.push('<div class="reply_cnt">');var replies_number='';if(st.replies&&st.replies>0)replies_number="("+st.replies+")";h.push('<span class="reply_st link" '+small+' st_id="'+st.id+'" onclick="SA.Models.StockTalkModel.enterReply(this)">Reply<span reply_numbers='+st.id+' class="num_of_reply_st link">'+replies_number+'</span></span>');h.push('</div>');}
if(real_st!=""){h.push('<div class="delete_wrapper" style="display:none" id="delete_'+st.id+'">');h.push('<span class="bull">&bull;</span>');h.push('<span class="commenter_abuse"><span onclick="SA.Models.StockTalkModel.reportSpam(this)" st_id="'+st.id+'" class="link report_abuse"><span class="punctuation">!</span>Report Abuse</span></span>');h.push('<a href='+st.uri+' class="link" style="display:none"></a>');h.push('</div>');}
h.push('</div>');h.push('</div>');h.push('</li>');return h.join(" ");}
scope.StockTalkModel.showBtn=function(stTextArea){if(stTextArea.btnShow)return;stTextArea.btnShow=true;var sub_id=stTextArea.getAttribute("subject_id");sub_id=sub_id?sub_id:"";var btns=$$("[st_btn"+sub_id+"]");var size=btns.length;for(var i=0;i<size;i++){btns[i].style.display="block";}}
scope.StockTalkModel.openPopUp=false;scope.StockTalkModel.enterReply=function(rp){if(rp.getAttribute("small")&&!scope.StockTalkModel.openPopUp){scope.StockTalkModel.popUp(rp);return;}
if(!is_users_cookie_exists()){scope.StockTalkModel.openPopUp=false;open_header_log_in_popup_lightbox('login','publish StockTalks');return;}
var id=rp.getAttribute("st_id");var fEl;if(id)fEl=$("stock_talk_textarea_"+id);if(fEl){if($('reply_wrap_'+id))$('reply_wrap_'+id).removeClassName('no_replies');fEl.focus();if((fEl.viewportOffset().top+fEl.getHeight()>document.viewport.getHeight()))
window.scrollTo(0,document.viewport.getScrollOffsets().top+75);}}
scope.StockTalkModel.replyTextArea=function(st_id){var h=[];h.push('<form method="post" id="stock_talk_form_'+st_id+'" onsubmit="return false;">');h.push(' <div class="feed_text_image_cnt">');var user_nick=readCookie('user_nick');if(is_users_cookie_exists()&&user_nick==null||user_nick=="")
h.push('  <div><fieldset class=\'choose_username_stocktalk\' id=\'choose_username_row_'+st_id+'\'><input type=\'text\' value="Please choose username:" title="Please choose username:" class=\'text nick\' name=\'nick\' id=\'input_nick\' maxlength=\'80\' onfocus=\'SA.Utils.Expansion.Input(this); this.clearAll();\'/></fieldset></div>');h.push('  <div class="feed_text_content">');h.push('      <textarea subject_id="'+st_id+'" name="stock_talk[content]" style="color:#959595" id="stock_talk_textarea_'+st_id+'" onKeyDown="return charCounter(this,\'_'+st_id+'\');" onKeyUp="return charCounter(this,\'_'+st_id+'\');" onfocus="SA.Models.StockTalkModel.enterText(this); if (this.clearAll) this.clearAll();" tabindex="99" title="Add a reply...">Add a reply...</textarea>');h.push('      <div id="st_text_'+st_id+'">');h.push('        <div st_btn'+st_id+'  style="display:none" class="right_content">');h.push('          <div  id="char_counter_'+st_id+'" class="characters">140 characters</div>');h.push('          <span class="gigyaSubmitCNT">');h.push('          <div gigya_id="stocktalk_'+st_id+'" class="gigya_unit"></div>');h.push('          <input type="button" id="stocktalk_submit_button_'+st_id+'" tabindex="100" class="submit grad" value="Submit" onclick="ajax_submit_stock_talk(this, false, \'_'+st_id+'\');">');h.push('          </span>');h.push('        </div>');h.push('      </div>');h.push('  </div>');h.push(' </div>');h.push('</form>');return h.join(" ");}
scope.StockTalkModel.displayOptions=function(stElid,stocktalk_id,poster){var stEl=$(stElid);if(!(stEl))return;if(is_users_cookie_exists())stEl.addClassName("login");var permission_needed="spam fighter";var spam_fighter=readCookie('user_perm')&&readCookie('user_perm').indexOf(permission_needed)>-1
if(spam_fighter||(readCookie("user_id")==poster)){if(spam_fighter)
new Insertion.Top(stEl,'<div id="deletespan_'+stocktalk_id+'" onclick="delete_stocktalk(\''+stElid.id+'\',\''+stocktalk_id+'\',\'false\');" class="del_btn">&nbsp;</div>');else
new Insertion.Top(stEl,'<div st_id="'+stocktalk_id+'" onclick="SA.Models.StockTalkModel.Delete(this);" class="del_btn">&nbsp;</div>');}}
scope.StockTalkModel.Delete=function(el){var st_id=el.getAttribute("st_id");if(SA.Models.StockTalkModel.openPopUp){if(!confirm("Are you sure you want to remove this post?"))return;delete_stock_talk(null,st_id,false);}
else{var popup=["<div class='delete_lightbox'>"];popup.push("<h1>Are you sure you want to remove this post?</h1>");popup.push("<div class='grad close orange' id='deletespan_"+st_id+"' onclick='delete_stock_talk(this,\""+st_id+"\",false); AlphaBox.Close();'>Remove</div>");popup.push("<div class='grad close' onclick='AlphaBox.Close();'>Cancel</div>");popup.push("</div>");AlphaBox.Loading();AlphaBox.AddHtml(popup.join(" "));}}
scope.StockTalkModel.initSt=function(){var elements=$$('[realy_st=true]');var size=elements.length;for(var i=0;i<size;i++){scope.StockTalkModel.displayOptions(elements[i],elements[i].getAttribute("st_id"),elements[i].getAttribute("poster"));elements[i].setAttribute("realy_st",false);}}
scope.StockTalkModel.addNew=function(st_id,text){var el=$$("[replies_st="+st_id+"]");if(el.length>0){scope.StockTalkModel.fixReplyNumbers(st_id,1,"add");new Insertion.Bottom(el[0],text);}}
scope.StockTalkModel.minusOne=function(st_id){var el=$$("[replies_st="+st_id+"]");if(el.length>0)scope.StockTalkModel.fixReplyNumbers(st_id,-1,"add");}
scope.StockTalkModel.removeReply=function(reply){scope.StockTalkModel.minusOne(reply.getAttribute("subject_id"));reply.remove();}
scope.StockTalkModel.fixReplyNumbers=function(st_id,number,status){var el=$$("[reply_numbers="+st_id+"]");var size=el.length;if(size==0)return;var new_number=el[0].innerHTML.trim()!=""?parseInt(el[0].innerHTML.gsub(/\(|\)/,"")):0;switch(status){case"reset":new_number=number;break;case"add":new_number+=number;break;}
var comment_box=[];for(var i=0;i<size;i++){comment_box=$$("[st_section_id="+st_id+"] .add_reply_to_st_input_wrapper");if(new_number>0){el[i].innerHTML=el[i].getAttribute("without_closer")?new_number:"("+new_number+")";if(comment_box.length>0)comment_box[0].removeClassName('no_replies');}else{el[i].innerHTML="";if(comment_box.length>0)comment_box[0].addClassName('no_replies');}}}
scope.StockTalkModel.realTime=new function(){var self=this;this.bInProcces=false;this.sts={};this.lastUpdateTime=0;this.stIds=[];this.container;this.slugs;this.subjects;this.page_request;this.filter;this.interval;this.intervalTime=10000*9;this.posted=[];this.hasBeenInit=false;this.postedEl={};this.init=function(args){if(args.container)self.container=args.container;if(args.subjects)self.subjects=args.subjects;if(args.slugs)self.slugs=args.slugs;if(args.page_request)self.page_request=args.page_request;if(args.filter)self.filter=args.filter;self.order_by_reply=args.order_by_reply;self.hasBeenInit=true;self.collect();}
this.collect=function(){if(!self.hasBeenInit)return;var collected=$$("[st_section_id]");var size=collected.length;for(var i=0;i<size;i++){var st=collected[i];var id=st.getAttribute("st_section_id");self.addStId(id);self.sts[id]=self.getInfo(st);}
collected=$$("[posted_section_id]");size=collected.length;for(var i=0;i<size;i++){var id=collected[i].getAttribute("posted_section_id");self.posted.push(id);self.postedEl[id]=collected[i];}}
this.addStId=function(id){if(self.stIds.indexOf(id)==-1)self.stIds.push(id);}
this.getStIdString=function(){return self.stIds.join(",");}
this.getInfo=function(el){var hash={};hash.el=el;hash.replies={};hash.reply_ids=[];var st_id=el.getAttribute("st_section_id");var replies=el.select("[poster]");var size=replies.length;if(size>0){for(var i=0;i<size;i++){var re=replies[i];var r_id=re.getAttribute("st_id");if(r_id!=st_id){hash.reply_ids.push(r_id)
hash.replies[r_id]=re;}}}
return hash;}
this.update=function(data){scope.StockTalkModel.realTime.remove(data.deleted)
var updated=data.updated;for(st_id in updated){var replies=updated[st_id]["rep"];if(replies){var size=replies.length;for(var i=0;i<size;i++){var reply=replies[i];if(!self.sts[st_id].replies[reply.id]){var text=self.insertNewReply(reply);scope.StockTalkModel.addNew(st_id,text);self.sts[st_id].replies[reply.id]=$$("[st_id="+reply.id+"]")[0];self.sts[st_id].reply_ids.push(reply.id+"");var replies_number=self.sts[st_id].reply_ids.length;scope.StockTalkModel.fixReplyNumbers(st_id,updated[st_id]["reply_counts"],"reset");if(updated[st_id]["reply_counts"]>2&&!self.sts[st_id].el.getAttribute("is_open")){var remove_el_id=self.sts[st_id].reply_ids[0];self.sts[st_id].replies[remove_el_id].remove();self.sts[st_id].replies[remove_el_id]=false;self.sts[st_id].reply_ids=self.sts[st_id].reply_ids.slice(1,replies_number);if($$('[replies_bt='+st_id+']')[0])$$('[replies_bt='+st_id+']')[0].style.display="block";}}}}}
var latest=data.newset;for(st_id in latest){st=latest[st_id]
var nSt;if(!self.sts[st_id]&&st["st"]["is_just_a_stocktalk"]){nSt=['<ul st_section_id=\''+st_id+'\'>'];nSt.push(scope.StockTalkModel.renderSingleST(st["st"],"stocktalk_message_plus_time"));var showReplies="style='display:none'";if(st["st"].replies>2){showReplies="";}
nSt.push('<li replies_bt="'+st["st"].id+'" '+showReplies+' class="view_all_st_replies"><span st_id="'+st["st"].id+'" limit="'+st["st"].replies+'" onclick="SA.Models.StockTalkModel.getMoreReplies(this)">View all <span without_closer="true" reply_numbers="'+st["st"].id+'">'+st["st"].replies+'</span> replies</span></li>');nSt.push('<li><ul class="older_replies" older_replies_st=\''+st["st"].id+'\'></ul></li>');var replies=st["replies"];if(replies){for(var i=0;i<replies.length;i++){nSt.push(scope.StockTalkModel.renderSingleST(replies[i],"stocktalk_message_plus_time"));}}
nSt.push('<li><ul replies_st=\''+st["st"].id+'\'></ul></li>');nSt.push('<li class=\'add_reply_to_st_input_wrapper'+(replies?"":" no_replies")+'\' >');nSt.push(scope.StockTalkModel.replyTextArea(st["st"].id));nSt.push('</li>');nSt.push('</ul>');new Insertion.Top(self.container,nSt.join(" "));}else{if(self.posted.indexOf(st_id)==-1&&!st["st"]["is_just_a_stocktalk"]){nSt=['<ul posted_section_id="'+st_id+'">'];st["st"]["not_real_st"]=true;nSt.push(scope.StockTalkModel.renderSingleST(st["st"],"stocktalk_message_plus_time"));nSt.push('</ul>');new Insertion.Top(self.container,nSt.join(" "));}}}
scope.StockTalkModel.initSt();socialSA.init();self.collect();}
this.insertNewReply=function(reply){return scope.StockTalkModel.renderSingleST(reply,"stocktalk_message_plus_time")}
this.run=function(){if(!self.hasBeenInit)return;self.collect();self.interval=setInterval(function(){self.getNew(self.update)},self.intervalTime);}
this.stop=function(){clearInterval(self.interval);}
this.remove=function(st_ids){var size=st_ids.length;if(size==0)return;for(var i=0;i<size;i++){var el=self.sts[st_ids[i]]
if(el){el.el.remove();}
el=self.postedEl[st_ids[i]];if(el)el.remove();el=$('li_'+st_ids[i]);if(el)scope.StockTalkModel.removeReply(el);}}
this.getNew=function(onComplete,onFailed){if(self.bInProcces)return false;self.bInProcces=true;var ids=self.getStIdString();var t=self.lastUpdateTime;var params={st_ids:ids,time:t,page_request:self.page_request,subjects:self.subjects,slugs:self.slugs,filter:self.filter};if(self.order_by_reply)params.order_by_reply=1;new Ajax.Request('/stock_talk/ajax_get_newest',{asynchronous:true,evalScripts:true,parameters:params,onComplete:function(transport){var response=transport.responseText.evalJSON();if(transport.status==200&&response.errors==null){if(onComplete)onComplete(response);}else{if(onFailed)onFailed(response.errors);}
SA.Models.StockTalkModel.realTime.bInProcces=false;}});}}})();function delete_stocktalk_and_block_user(row_id,stocktalk_id,need_refresh){if(!confirm("Are you sure you want to delete this StockTalk?"))return;new Ajax.Request('/moderator/ajax_delete_stocktalk_and_block_user',{asynchronous:true,evalScripts:true,parameters:"stocktalk_id="+stocktalk_id+"&refresh="+need_refresh,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){var temp=$$("[st_section_id="+stocktalk_id+"]");if(temp.length>0)temp[0].remove();else $(row_id).remove();}}});}
function delete_stocktalk(row_id,stocktalk_id,need_refresh){if(!confirm("Are you sure you want to delete this StockTalk?"))return;new Ajax.Request('/moderator/ajax_delete_stocktalk',{asynchronous:true,evalScripts:true,parameters:"stocktalk_id="+stocktalk_id+"&refresh="+need_refresh,onComplete:function(transport){if(transport.status==200&&transport.responseText!="failed"){var temp=$$("[st_section_id="+stocktalk_id+"]");if(temp.length>0){temp[0].remove();}
var temp_new=$$("[st_section_id="+stocktalk_id+"new]");if(temp_new.length>0){temp_new[0].remove();}
else{var el=$("li_"+stocktalk_id);if(el)SA.Models.StockTalkModel.removeReply(el);var elnew=$("li_"+stocktalk_id+"new");if(elnew)SA.Models.StockTalkModel.removeReply(elnew);}}}});}
(function(){var scope=SA.UsingNamespace("SA.Models");scope.StockModel={}
scope.StockModel.reg=/\b[A-Z]+(?:\.[A-Z]+)?\b/g;scope.StockModel.isRealStock=function(stock){if(typeof(symbols)!="undefined"){return symbols.indexOf("<"+stock.toUpperCase()+">")!=-1;}else{return true;}}
scope.StockModel.stringToStocksString=function(stocks,sperator){sperator=sperator?sperator:",";return scope.StockModel.stringToStocksArray(stocks)[0].join(sperator);}
scope.StockModel.stringToStocksArray=function(stocks){var ar=stocks?stocks.toUpperCase().match(scope.StockModel.reg):null;var size=ar?ar.length:0;if(size==0)return[[],[]];var rec=[];var unrec=[];for(var i=0;i<size;i++)(scope.StockModel.isRealStock(ar[i]))?rec.push(ar[i]):unrec.push(ar[i]);return[rec,unrec];}
scope.StockModel.stringToSymbolLinkString=function(stocks,sperator,targetBlank){targetBlank=targetBlank||true
if(targetBlank)targetBlank="target='_blank'";sperator=sperator?sperator:",";var sym=scope.StockModel.stringToStocksArray(stocks)[0];var size=sym.length;var result=[];for(var i=0;i<size;i++){result.push("<a href='/symbol/"+sym[i].toLowerCase()+"' "+targetBlank+">"+sym[i].toUpperCase()+"</a>");}
return result.join(sperator)}
scope.isStockLink=function(string){return/\/symbol\/[a-zA-Z]{1,5}(\.[a-zA-Z]{1,2})?$/.test(string)}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Expansion=new function(){var OCOHandlers=[];this.Input=function(input,opt){var empty,error,emptyText,initVal,passwordObj=null,onEnterClb,focused=false;opt=opt||{};input=$(input);if(!input||input.SAExpanded)return input;input.onblur=function(){if(input.Empty()){empty=true;if(passwordObj){passwordObj.style.display='';input.style.display='none';}else{input.value=emptyText;input.addClassName('default_text');}}
input.style.color=empty?"#8D8D8D":"#000000";if(this.Onblur)this.Onblur(this);focused=false;if(input.attributes['trackblur']&&input.attributes['trackblur'].value=="on"){if(window.pageTracker){pageTracker._trackEvent("Input Event Tracking","On Blur",input.id);}}};input.onfocus=function(){input.style.color="#000000";input.removeClassName('default_text');if(empty||error)input.value="";if(input.Onfocus)input.Onfocus(this);empty=error=false;focused=true;if(input.attributes['trackfocus']&&input.attributes['trackfocus'].value=="on"){if(window.pageTracker){pageTracker._trackEvent("Input Event Tracking","On Focus",input.id);}}};input.onkeypress=function(e){if(input.attributes['trackenter']&&input.attributes['trackenter'].value=="on"&&e.keyCode==13){if(window.pageTracker){pageTracker._trackEvent("Input Event Tracking","On Press Enter",input.id);}}}
input.clearAll=function(){this.style.color="#000000";this.value="";input.ClearErrorMode();};input.Reset=function(){input.value="";if(!focused)input.onblur();input.ClearErrorMode();};input.Focused=function(){return focused;}
input.resetInitVal=function(){initVal=input.value;}
input.Changed=function(){return(input.GetValue()!=initVal);};input.Empty=function(){return empty||input.value.trim()=='';}
input.GetValue=function(){return empty?'':input.value.trim();};input.SetValue=function(value){empty=!value||value.trim()=='';input.value=value;if(!focused)input.onblur();};input.SetError=function(text){input.style.color='#ff0000';input.value=text;error=true;}
input.Error=function(){return error;}
input.ErrorMode=function(){input.addClassName('input_error');if(passwordObj)passwordObj.addClassName('input_error');try{input.focus();}catch(e){};}
input.ClearErrorMode=function(){input.removeClassName('input_error');if(passwordObj)passwordObj.removeClassName('input_error');}
input.setOnEnterKey=function(clb){if(onEnterClb)input.stopObserving('keypress',onEnterClb);if(clb){onEnterClb=function(event){if(event.keyCode==13)clb(event);};input.observe('keypress',onEnterClb);}else onEnterClb=null;}
var hasEmpty=typeof(input.getAttribute('empty'))=="string"?input.getAttribute('empty'):null;if(!hasEmpty&&input.title==input.value)input.value='';emptyText=hasEmpty||input.title||'';initVal=input.value.trim();if(emptyText&&/password/i.test(input.type)){passwordObj=$(document.createElement('input'));passwordObj.value=emptyText;passwordObj.className=input.className+' default_text';for(var field in input.style)if(input.style[field])passwordObj.style[field]=input.style[field];passwordObj.style.color="#8D8D8D";passwordObj.style.display='none';input.parentNode.insertBefore(passwordObj,input);var focus=input.focus;input.focus=function(){input.style.display='';passwordObj.style.display='none';setTimeout(function(){focus.apply(input);},10);focused=true;}
passwordObj.onfocus=function(){input.focus();}}
if(document.activeElement!=input)input.onblur();(input.attributes['emailautofill']&&input.attributes['emailautofill'].value=="on")?input.autocomplete='on':input.autocomplete='off';if(input.attributes['emailautofill']&&input.attributes['emailautofill'].value=="on"){try{input.value=readCookie('user_email').replace(/ /g,'+');input.style.color="#000000";empty=false;}catch(e){}}
if(opt.autocomplete){AutoCompleteSAConfig.Load('input_'+(input.id||''),{Input:input,AddAfterInput:true,Symbols:(opt.autocomplete.stocks||false),Authors:(opt.autocomplete.authors||false),MultipleInsert:(typeof(opt.autocomplete.MultipleInsert)=="undefined"?true:opt.autocomplete.MultipleInsert),AutoInsert:true,AfterSubmit:opt.onEnterKey});}else if(opt.onEnterKey)input.setOnEnterKey(opt.onEnterKey);input.SAExpanded=true;return input;}
this.setOnClickOutside=function(object,callback,skipCount){if((object=$(object))&&callback){var handler={obj:object,f:callback,skip:skipCount};for(var i=0;i<OCOHandlers.length;i++)if(OCOHandlers[i].obj==object){OCOHandlers[i]=handler;return;}
OCOHandlers.push(handler);}}
this.removeOnClickOutside=function(object){if((object=$(object)))for(var i=0;i<OCOHandlers.length;i++)if(OCOHandlers[i].obj==object){OCOHandlers.splice(i,1);return;}}
Event.observe(document,'click',function(event){var target=event.findElement(),len=OCOHandlers.length;for(var i=0;i<len;i++){var handler=OCOHandlers[i];if(handler.skip){handler.skip-=1;continue;}
if(target!=handler.obj&&!target.descendantOf(handler.obj)){try{handler.f(event);}catch(e){if(window.console)console.error("onClickOutside handler error: "+e.message);}}}});this.SATooltip=function(item){item=$(item);if(!item||item.saTooltipExpanded||item.readAttribute('tooltip').trim().length==0)return item;var tooltipEl;function hideTooltip(){if(tooltipEl)item.removeChild(tooltipEl);tooltipEl=null;}
function showTooltip(){if(tooltipEl)hideTooltip();tooltipEl=document.createElement("div");tooltipEl.className="tooltip_wrapper";tooltipEl.innerHTML=["<div class='square_bubble_wrapper sa_tooltip'>","<div class='left_bump'></div>","<div class='square_bubble'>","<div class='square_bubble_inner'>",item.readAttribute('tooltip'),"</div>","</div>","</div>"].join('');item.insert(tooltipEl);var width=tooltipEl.getWidth()+30+"px";tooltipEl.style.right="-"+width;}
item.observe('mouseover',showTooltip);item.observe('mouseout',hideTooltip);item.saTooltipExpanded=true;return item;}
this.SATooltip.initAll=function(container){container=$(container);if(!container)container=document.body;return container.select('[tooltip]').map(scope.Expansion.SATooltip);}
this.Error=function(el,opt){opt=opt||{};el=$(el);if(!el)return;el.show=function(html){if(html!==undefined)el.innerHTML=html;Element.show(el);}
if(!opt.noClass)el.addClassName('error');el.hide();return el;}};scope.saScroll=new function(){this.func={};this.delay_func={};this.timeOut={};this.add=function(func_name,func_to_run){SA.Utils.saScroll.func[func_name]=function(){clearTimeout(SA.Utils.saScroll.timeOut[func_name]);SA.Utils.saScroll.timeOut[func_name]=setTimeout(SA.Utils.saScroll.delay_func[func_name],100);};SA.Utils.saScroll.delay_func[func_name]=function(){func_to_run();};Event.observe(window,"scroll",SA.Utils.saScroll.func[func_name]);}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Env=new function(){var _nonie6=((/MSIE/i.test(navigator.userAgent))&&((/MSIE 7/i.test(navigator.userAgent))||(/MSIE 8/i.test(navigator.userAgent))));this.isIE=/MSIE/i.test(navigator.userAgent);this.isIE6=(/MSIE 6/i.test(navigator.userAgent)&&!_nonie6);this.isIE7=/MSIE 7/i.test(navigator.userAgent);this.isIE8=(/MSIE 8/i.test(navigator.userAgent)||(this.isIE7&&/trident\/\d/i.test(navigator.userAgent)));this.isIE9=(/MSIE 9/i.test(navigator.userAgent)||(this.isIE7&&/trident\/\d/i.test(navigator.userAgent)));this.isFirefox=/Firefox/i.test(navigator.userAgent);this.isOpera=/Opera/i.test(navigator.userAgent);this.isWebkit=/Webkit/i.test(navigator.userAgent);this.isChrome=/Chrome/i.test(navigator.userAgent);this.isIPod=/iPod/i.test(navigator.userAgent);this.isIPhone=/iPhone/i.test(navigator.userAgent);this.isIPad=/iPad/i.test(navigator.userAgent);this.isIOS5=/(iPad|iPhone);.*CPU.*OS 5_\d/i.test(navigator.userAgent);this.mobileOS=typeof orientation!='undefined'?true:false;this.touchOS=('ontouchstart'in document.documentElement)?true:false;this.isAndroid=/android/i.test(navigator.userAgent);this.WebkitVersion=(this.isWebkit)?parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]):0;this.touchSupport=('ontouchstart'in window&&!this.isChrome);this.hasTouch=((this.isAndroid||this.isIPad||this.isIPhone||this.isIPod)&&this.touchSupport);this.isAppleDevice=(this.isIPad||this.isIPhone||this.isIPod);this.hasOrientationChange=('onorientationchange'in window);this.useLocalStorage=('localStorage'in window);this.isStrict=(document.compatMode=="CSS1Compat");this.isFixeSupport=!(this.isIE6||(this.touchSupport&&!this.isIOS5));this.isMobile=(top.location.hostname.split(".")[0]=="m")};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Button=function(args){var ButtonElement=null;var onclick,loaderCls,loaderObj,locked=false;this.HideButton=function(){ButtonElement.style.visibility="hidden";}
this.ShowButton=function(){ButtonElement.style.visibility="visible";}
this.Lock=function(){locked=true;ButtonElement.onclick=null;if(loaderCls)ButtonElement.addClassName(loaderCls);else if(loaderObj)loaderObj.style.display='';}
this.UnLock=function(){locked=false;ButtonElement.onclick=onclick;if(loaderCls)ButtonElement.removeClassName(loaderCls);else if(loaderObj)loaderObj.style.display='none';}
this.Focus=function(){ButtonElement.focus();}
this.getElement=function(){return ButtonElement;}
this.SetClass=function(nClass){ButtonElement.className=nClass;}
this.ClassName=function(cName){ButtonElement.className=cName;}
this.GetElement=function(){return ButtonElement;}
this.SetOnclick=function(newOnclick){ButtonElement.onclick=onclick=newOnclick;}
this.click=function(){if(!locked)onclick();}
function Init(args){ButtonElement=$(args.element);ButtonElement.onclick=args.onclick;if(args.onclick)onclick=args.onclick;if(args.loaderObj)loaderObj=$(args.loaderObj);loaderCls=args.loaderCls;}
Init(args);};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Connection=new function(){this.Test=function(onsuccess){var c=document.createElement("img");c.onload=onsuccess;c.src="http://static1.seekingalpha.com/images/empty.gif?r"+(Math.round(100000*Math.random())+"="+(new Date()).getTime());}}})();(function(){SymbolData=new function(){var retries={},asset_hosts=null,script_container=null,symbols=[],refreshInterval=null,onBeforeLoadAll=null,_this=this,handleFunctions={},INDEX=0,priceChanges=null;this.Undefined=true;this.handle_data=function(symbol,data){var funcs=handleFunctions[symbol];if(!funcs)return;var len=funcs.length;for(var i=0;i<len;i++){if(funcs[i])funcs[i](symbol,data);}};this.handle_no_data=function(symbol){SymbolData.retry};this.AddHandleFunction=function(symbolArr,func){var len=symbolArr.length;for(var i=0;i<len;i++){var s=symbolArr[i].toUpperCase();if(!handleFunctions[s])handleFunctions[s]=[];if(handleFunctions[s].indexOf(func)==-1)handleFunctions[s].push(func);}}
this.load=function(symbol,no_asset_host){symbol=symbol.trim();var retry=retries[symbol];if(retry&&retry[1])clearInterval(retry[1]);if(symbol=='')return;var script=document.createElement('script');var host=(!no_asset_host&&asset_hosts)?asset_hosts[symbol.charCodeAt(0)%asset_hosts.length]:'';script.src=host+"/memcached2/portfolio_data/"+symbol.toLowerCase()+"?r="+Math.floor(Math.random()*10000);(script_container||document.body).appendChild(script);};this.retry=function(symbol){var retry=retries[symbol];if(!retry)retry=retries[symbol]=[0];if(retry[1]||retry[0]>=10)return;retry[0]++;retry[1]=setTimeout(function(){retry[1]=null;_this.load(symbol,retry[0]<4);},(retry[0]<4?1:10)*1000);};this.loadAll=function(){if(onBeforeLoadAll)onBeforeLoadAll();var len=symbols.length;for(var i=0;i<len;i++)_this.load(symbols[i]);};this.startRefresh=function(refresh_rate){_this.stopRefresh();if(refresh_rate)refreshInterval=setInterval(_this.loadAll,refresh_rate*1000);};this.stopRefresh=function(){if(refreshInterval)clearInterval(refreshInterval);refreshInterval=null;};this.setSymbols=function(list){symbols=list;}
this.NewSymbol=function(symbol,func){_this.addSymbols([symbol]);_this.AddHandleFunction([symbol],func);_this.load(symbol);}
this.addSymbols=function(lis){var ls=symbols.join(",").toUpperCase();var s=ls==""?lis.join(",").toUpperCase():symbols.join(",").toUpperCase()+","+lis.join(",").toUpperCase()
_this.setSymbols(s.split(",").uniq());}
this.getSymbols=function(){return symbols;}
this.config=function(opt){if(opt.script_container&&!(script_container&&!_this.Undefined))script_container=$(opt.script_container)
if(opt.asset_hosts&&!(asset_hosts&&!_this.Undefined))asset_hosts=opt.asset_hosts;if(opt.symbols)_this.addSymbols(opt.symbols);if(opt.onBeforeLoadAll&&!(onBeforeLoadAll&&!_this.Undefined))onBeforeLoadAll=opt.onBeforeLoadAll;if(opt.handle_data)_this.AddHandleFunction(opt.symbols,opt.handle_data);if(opt.handle_no_data&&!(_this.handle_no_data&&!_this.Undefined))_this.handle_no_data=opt.handle_no_data;if(opt.refresh_rate)_this.startRefresh(opt.refresh_rate);}
this.loadPriceChanges=function(pc){priceChanges=pc;SA.Data.Cache.set('price_changes',Object.toJSON(priceChanges));}
this.priceChanges=function(){if(!priceChanges){var cached=SA.Data.Cache.get('price_changes');if(cached)priceChanges=cached.evalJSON();}
return priceChanges;}
this.priceChange=function(slug){return(this.priceChanges()||{})[slug.toLowerCase()];}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.QuotesOnPage=new function(){var symbols=[];var qTags={};var _this=this;var DOWN="down";var UP="up";var NOT_AVILABLE=["N/A",""];this.Init=function(asset_host,refresh_rate){var tags=$$("[sa_quote]");InitQTags(tags);if(SymbolData.Undefined)
SymbolData.config({handle_data:SA.Utils.QuotesOnPage.SetSymbolData,handle_no_data:SymbolData.retry,script_container:'symbol_data_script_container',refresh_rate:refresh_rate,asset_hosts:asset_host,symbols:symbols});else
SymbolData.AddHandleFunction(symbols,SA.Utils.QuotesOnPage.SetSymbolData);}
this.GetQTags=function(){return qTags;}
this.SetSymbolData=function(s,d){var qts=SA.Utils.QuotesOnPage.GetQTags()[s];if(qts){var len=qts.length;for(var i=0;i<len;i++)
SA.Utils.QuotesOnPage.SetValueByPut(qts[i],qts[i].getAttribute("put"),d);}}
this.SetValueByPut=function(t,p,d){var v;switch(p){case"per":v=CalPercent(d);break;case"last":v=CalLast(d);break;case"chg":v=CalChg(d);break;default:v=["-",""];break;}
t.innerHTML=v[0];t.className=v[1];}
function CalChg(d){if(d["last"]&&d["close"]){var v=NiceQuoteValue(d["last"]-d["close"]);return["$"+v,GetClass(v)];}
else
return NOT_AVILABLE;}
this.AddQTag=function(tag){var s=tag.getAttribute("s").toUpperCase();if(!qTags[s])qTags[s]=[];qTags[s].push(tag);AddSymbol(s);return s;}
function CalPercent(d){var v;if(d["last"]&&d["close"]){v=NiceQuoteValue(((d["last"]-d["close"])/d["close"])*100);return[v+"%",GetClass(v)]}
else
return NOT_AVILABLE;}
function CalLast(d){var v=d["last"];if(v)return["$"+NiceQuoteValue(v),""];else return NOT_AVILABLE;}
function GetClass(v){if(v<0)return DOWN;if(v>0)return UP;return"";}
function NiceQuoteValue(v){if((v>-1000)&&(v<1000))return v.toFixed(2);return v;}
function AddSymbol(s){if(symbols.indexOf(s)==-1)
symbols.push(s);}
function InitQTags(tags){var len=tags.length;var ns=[];for(var i=0;i<len;i++)ns.push(_this.AddQTag(tags[i]));SymbolData.addSymbols(ns);SymbolData.loadAll();}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.TopNavPopUp=function(link_id,container_id){var btn;var navPop;var visible=false;var self=this;this.Show=function(){navPop.style.display="block";btn.className='top_nav_arrow_up';visible=true;SA.Utils.Expansion.setOnClickOutside(navPop,self.Hide,1);}
this.Hide=function(){navPop.style.display="none";btn.className='top_nav_arrow_down';visible=false;}
this.Click=function(){if(!visible)self.Show();}
this.Init=function(link_id,container_id){if($(link_id)){btn=$(link_id);btn.onclick=self.Click;navPop=$(container_id);}}};})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Ads=new function(){var deltaInit=0;var self=this;this.List=[];this.createDfpAdSingleCall=function(ads_arr){if(/\/shark\//i.test(location)||!ads_arr){return"";}
googletag.cmd.push(function(){var pubService=googletag.pubads();for(var i=0;i<ads_arr.length;i++){setGoogletagValues(ads_arr[i].el_id,ads_arr[i]['ad_params'].evalJSON());}
pubService.enableSingleRequest();googletag.enableServices();});}
function createDfpAdInEl(el,sizeXformat,ad_params){if(/\/shark\//i.test(location)){return"";}else if(window.single_ad_request){googletag.display(el.id);return"";}
googletag.cmd.push(function(){setGoogletagValues(el.id,ad_params,true);});}
function setGoogletagValues(el_id,ad_params,call_display){call_display=call_display||false;if(window.ms_slug)ad_params['ms_slug']=window.ms_slug;if(window.article_dashboards)ad_params['article_dashboards']=window.article_dashboards;if(window.article_sectors_themes)ad_params['article_sectors_themes']=window.article_sectors_themes;if(ad_params.eval_js){window.marina=ad_params;ad_params=eval(ad_params.eval_js+"(ad_params);");}
var slot_id='/6001/'+ad_params.target_id.replace(/\/$/,'');var adslot=googletag.defineSlot(slot_id,getSizeArray(ad_params.sz),el_id);adslot.addService(googletag.pubads());for(key in ad_params){if(key.length&&key!="target_id"&&key!="eval_js"){adslot.setTargeting(key,ad_params[key]);}}
if(call_display){googletag.enableServices();googletag.display(el_id);}}
function getSizeArray(sizeXformat){var sizeParts,sizesArr=[];var allSizes=sizeXformat.split(',');for(var i=0;i<allSizes.length;i++){sizeParts=allSizes[i].split("x");sizesArr.push([parseInt(sizeParts[0]),parseInt(sizeParts[1])]);}
return sizesArr;}
function createIframeAdInEl(el,sizeXformat,src){if(/\/shark\//i.test(location)){return"";}
var sizeParts=sizeXformat.split("x")
var query=[];if(window.ms_slug)query.push("ms_slug="+window.ms_slug);if(window.article_dashboards)query.push("article_dashboards="+window.article_dashboards);if(window.article_sectors_themes)query.push("article_sectors_themes="+window.article_sectors_themes);var iframeFilePath="";if(location.host=="seekingalpha.com"){iframeFilePath="http://seekingalpha.com";}else if(location.host=="staging.seekingalpha.com"){iframeFilePath="http://staging.seekingalpha.com";}
var iframe=document.createElement("iframe");iframe.scrolling="no";iframe.height=sizeParts[1];iframe.width=sizeParts[0];iframe.marginWidth="0";iframe.marginHeight="0";iframe.frameBorder="0";iframe.vspace=0;iframe.hspace=0;iframe.style.border="0px none";iframe.src=iframeFilePath+'/adsframe.html#que='+encodeURIComponent(src)+(query.length?("&par="+encodeURIComponent(query.join("&"))):"");el.appendChild(iframe);}
this.add=function(info){self.List.push(info);}
this.run=function(){if(self.List.length>0)
SA.Utils.saScroll.add("ads_scroller",function(){SA.Utils.Ads.initAdsDelay()});SeekingAlpha.Initializer.AddAfterLoad(function(){SA.Utils.Ads.initAdsDelay();})}
this.run_mobile=function(){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&!adInfo.HadCreated){var el=adInfo.el;if(el){adInfo.HadCreated=true;createIframeAdInEl(el,adInfo.size,adInfo.info);}}}}
this.cleanAd=function(cb){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&adInfo.HadCreated&&!adInfo.OnceTime){var el=adInfo.el;if(el){el.innerHTML="";}}}
self.cleanList();if(cb)cb();}
this.cleanList=function(){self.List=[];}
this.setDelayInit=function(nDelay){deltaInit=nDelay;}
this.initAdsDelay=function(){var size=self.List.length;for(var i=0;i<size;i++){var adInfo=self.List[i];if(typeof(adInfo)!='undefined'&&!adInfo.HadCreated){var el=adInfo.el
if(el){if(ScrollerCloseToElement(el,adInfo.delta||deltaInit)){adInfo.HadCreated=true;typeof(adInfo.info)=="object"?createDfpAdInEl(el,adInfo.size,adInfo.info):createIframeAdInEl(el,adInfo.size,adInfo.info);if(!(/.*\/comments$/.test(location.pathname))){if(!adInfo.NotSticky){var ad=new stickyAd(el.id,{Height:250});ad.fixed_ads_init();}}}}}}}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.joinWithAnd=function(ar,separator){if(!ar)return'';var len=ar.length;if(separator==undefined)separator=', ';if(len==0)return'';else if(len==1)return''+ar;else return ar.slice(0,len-1).join(separator||', ')+' and '+ar[len-1];};scope.unifiedPath=function(){var path=location.pathname;var m=path.match(/^\/(?:(author|user|symbol)\/(?:[^\/]+\/([^\/]+))?|(article|news-article|instablog))/);if(m){if(m[1]){if(m[2])path='/'+m[1]+'/*/'+m[2];else path='/'+m[1];}else if(m[3]){path='/'+m[3];}}
return path;};scope.stripper=function(text){var start=[['<br type="_moz" />',''],[(/&nbsp;/g),' '],[(/&(ndash|#150|#x2013|#8211|mdash|#151|#x2014|#8212);/g),'-'],[(/[]|&(ldquo|#147|#8220|rdquo|#148|#8221);/g),'"'],[(/[]|&(lsquo|#145|#8216|rsquo|#146|#8217);/g),"'"],[(/<\/?span[^>]*>/gi),''],[(/<\/?div[^>]*>/gi),'<br/>']],repeat=[[(/(<(?!br|img)\w+[^>]*>)((?:\s|<br[^>]*>)+)|((?:\s|<br[^>]*>)+)(<\/\w+[^>]*>)/gi),'$2$1$4$3'],[(/<(?!t[dh])(\w+)\b[^>]*>\s*<\/\1\b[^>]*>/gi),'']],finish=[[(/\s*(?:<br[^>]*>\s*)*(<\/?(?:p|t[dh]|li|hr|blockquote)[^>]*>|^|$)\s*(?:<br[^>]*>\s*)*/gi),'$1'],[(/<sup[^>]*>([^<]*[^<0-9][^<]*)<\/sup[^>]*>/gi),'$1'],[(/(?:<br[^>]*>\s*){2,}/gi),'<p>'],[(/(\s)\s+/g),'$1']];var prevText='',i;for(i=0;i<start.length;i++)text=text.replace(start[i][0],start[i][1]);while(prevText!=text){prevText=text;for(i=0;i<repeat.length;i++)text=text.replace(repeat[i][0],repeat[i][1]);}
for(i=0;i<finish.length;i++)text=text.replace(finish[i][0],finish[i][1]);return text;}
scope.ajax=function(url,parameters,onSuccess,onFailure,opt){opt=opt||{};var loader=opt.loader?$(opt.loader):null;opt.parameters=parameters;opt.onSuccess=function(transport){if(loader)loader.style.display='none';var response={errors:'unknown'};try{response=transport.responseText.evalJSON();}catch(e){}
if(response.errors){if(onFailure)onFailure(response);}else{if(onSuccess)onSuccess(response);}};opt.onFailure=function(){if(loader)loader.style.display='none';if(onFailure)onFailure({errors:'unknown'});};if(loader)loader.style.display='block';return new Ajax.Request(url,opt);}
scope.timeStampHandler=new function(){this.addTimeStampMaxLastHour=function(upperHtml,lowerHtml){upperHtml=upperHtml?upperHtml:"";lowerHtml=lowerHtml?lowerHtml:"";var tStamps=$$("[timestamp]");var size=tStamps.length;for(var i=0;i<size;i++){var time=nice_time_ago(parseInt(tStamps[i].getAttribute("timestamp")));if(/Seconds|minute/.test(time))
tStamps[i].innerHTML=upperHtml+time+lowerHtml;}}
this.addTimeStampIntoMin=function(upperHtml,lowerHtml,onComplete){onComplete=onComplete||function(){};upperHtml=upperHtml?upperHtml:"";lowerHtml=lowerHtml?lowerHtml:"";var tStamps=$$("[timestamp]");var size=tStamps.length;for(var i=0;i<size;i++){var time=onlyMin(parseInt(tStamps[i].getAttribute("timestamp")));tStamps[i].innerHTML=upperHtml+time+lowerHtml;}
onComplete();}
function onlyMin(time){var distance_in_minutes=parseInt(((new Date()).getTime()/1000-time)/60);var msg;if(distance_in_minutes==0)
msg="Seconds ago";else if(distance_in_minutes<59)msg="00:"+(distance_in_minutes<10?"0"+distance_in_minutes:distance_in_minutes);else{var hrs=Math.floor(distance_in_minutes/60);var mins=distance_in_minutes%60;msg=(hrs<10?"0"+hrs:hrs)+":"+(mins<10?"0"+mins:mins);}
return msg;}}
scope.CopyFromInputToElement=function(fromInputElement,toElement,theString){if(fromInputElement&&toElement&&!theString){if(fromInputElement.capitalize)toElement.innerHTML=SA.Utils.String.Capitalize(fromInputElement.value);else toElement.innerHTML=fromInputElement.value;}
else toElement.innerHTML=theString;}
scope.LoadCSS=function(path){var headID=document.getElementsByTagName("head")[0];var cssNode=document.createElement('link');cssNode.type='text/css';cssNode.rel='stylesheet';cssNode.href=path;cssNode.media='screen';headID.appendChild(cssNode);}
scope.cutElement=function(element,opt){opt=opt||{};element=$(element);if(!element)return;var parent=element.up(),children=parent.childElements(),len=children.length,width=parseInt(parent.getStyle('width')),elWidth=parseInt(element.getStyle('width'));if(!width||!elWidth||len==0)return;var attrs=['margin-right','margin-left','padding-right','padding-left','width'],attrLen=attrs.length;for(var i=0;i<len;i++){var el=children[i];for(var j=0;j<attrLen;j++)width-=(parseInt(el.getStyle(attrs[j]))||0);}
width+=elWidth;var style={"width":width+'px',"overflow":'hidden',"white-space":"nowrap"};if(!opt.noEllipsis)style["text-overflow"]="ellipsis";if(elWidth>width)element.setStyle(style);}
scope.getNewYorkTime=function(){function moreEQ(ar,ar2){for(var i=0;i<ar.length;i++){if(ar[i]>ar2[i])return true;if(ar[i]<ar2[i])return false;}
return true;}
function between(ar,ar_min,ar_max){return moreEQ(ar,ar_min)&&moreEQ(ar_max,ar);}
var d=new Date();var offset=between([d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours()],[3,10,7],[11,3,5])?-4:-5;d.setTime(d.getTime()+(offset+d.getTimezoneOffset()/60)*3600000);return d;}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.IdleNotifier=function(){var timeoutElement=null;var idleTime=300*1000;var timerTime=new Date();var isActive=true;var isRunning=false;var activeCallback=null;var idleCallback=null;this.start=function(milisec,onActiveCallback,OnIdleCallback){if(isRunning)return;isRunning=true;activeCallback=onActiveCallback||new Function();idleCallback=OnIdleCallback||new Function();idleTime=milisec;for(var i=0,len=this.Events.length;i<len;i++)
Event.observe(window,this.Events[i],this.onInterrupt.bind(this));setTimer(this);}
this.isActive=function(){return isActive;}
this.getIdleTime=function(){return Math.round((new Date()-timerTime)/1000);}
this.onInterrupt=function(){if(!isActive){isActive=true;activeCallback(this.getIdleTime())}
setTimer(this);}
this.onIdle=function(){if(isActive){isActive=false;idleCallback()}}
function setTimer(instance){clearTimeout(timeoutElement);timerTime=new Date();timeoutElement=setTimeout(instance.onIdle.bind(instance),idleTime);}}
scope.IdleNotifier.prototype.Events=['mousemove','click','mouseup','mousedown','keydown','keypress','keyup','submit','change','mouseenter','scroll','resize','dblclick'];})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.SASource=new function(){var autoRefreshedFlag=(/source\=refreshed/i.test(top.location.href)||/_sasource=refreshed/i.test(document.cookie));var sasource=SA.Data.Cookies.get('_sasource');SA.Data.Cookies.del('_sasource');this.isAutoRefreshed=function(){return autoRefreshedFlag;}
this.getSASource=function(){return sasource;}}
scope.PageRefresher=function(url,internal){var source='refreshed';var timeout=null;var idleNotifier=new SA.Utils.IdleNotifier();var isActive=true;var self=this;if(url.match(/[\?&]source=refreshed/)){isSARefreshedFlag=true;source='refreshed';url=url.replace(/[\?&]source=refreshed/,'');}
this.start=function(){onIdleExec=doRefresh;idleNotifier.start(Math.max(2000,internal-2000),this.onActive,this.onIdle);setTimeout(onIdleExec,internal);}
this.Clear=function(){isActive=false;}
this.isActive=function(){return isActive;}
this.setExecFunction=function(func){onIdleExec=(typeof(func)=='function')?func:doRefresh;}
this.isIdle=function(){return!idleNotifier.isActive();}
this.onIdle=function(){}
this.onActive=function(){}
this.Activate=function(){isActive=true;}
function doRefresh(){if(!isActive){setTimeout(onIdleExec,internal);return;}
if(self.isIdle())
SA.Data.Cookies.set('_sasource',source,0.0007);SA.Utils.Connection.Test(function(){top.location.href=url;}.bind(self));}
setTimeout(this.start.bind(this),100);}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.Time=new function(){this.uniqTTL=function(ttl){var now=new Date();var utc=Date.UTC(now.getFullYear(),now.getMonth(),now.getDay(),now.getMinutes(),now.getMinutes(),now.getSeconds());return Math.floor(utc/ttl);}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.String=new function(){this.LongStringByWideBreak=function(elementID,elementClass,elementFatherclass){var element=$(elementID);var elementWidth=element.offsetWidth;var tempDiv=document.createElement("div");tempDiv.innerHTML=element.innerHTML;var divWrapper;divWrapper=$$("."+elementFatherclass);tempDiv.style.display="inline";tempDiv.className=elementClass;divWrapper[0].appendChild(tempDiv);tempDiv.style.visibility="hidden";var string_long_name=new Array();for(i=0;i<tempDiv.innerHTML.length;i++){string_long_name[i]=tempDiv.innerHTML.charAt(i);}
if(tempDiv.offsetWidth>=elementWidth){tempDiv.innerHTML="";var temp;temp=tempDiv.innerHTML;for(i=0,len=string_long_name.length;i<len;i++){temp=temp+string_long_name[i];if(tempDiv.getWidth()>105){temp=temp.substring(0,temp.length-2)+" "+temp.substring(temp.length-2,temp.length)}
tempDiv.innerHTML=temp;}
$(elementID).innerHTML=tempDiv.innerHTML;}}
this.Capitalize=function(string){string=string.replace(/(^|\s|\(| \b|\")([a-z])/g,function(m,p1,p2){return p1+p2.toUpperCase();});var specialWords=['iPhone','iPad','iOS','eBay','mREIT','hhgreg','iCloud','iPod','iTunes','iShare'];var size=specialWords.length;for(var i=0;i<size;i++){var reg=new RegExp("\\W"+specialWords[i],'ig');var match=string.match(reg);if(match){var reg=new RegExp(specialWords[i],'ig');mSplit=match[0].split(reg);string=string.replace(match[0],mSplit[0]+specialWords[i]);}}
return string;}}})();(function(){var scope=SA.UsingNamespace("SA.Utils");scope.popUp=new function(){var popUpWrapper=$("pop_up_wrapper");var popUpTransparicy=$("pop_up_transparicy");this.closePopUpWithOpacity=function(){popUpWrapper.style.display="none";popUpWrapper.innerHTML='';popUpTransparicy.style.display="none";}
this.popUpWithOpacity=function(){if(popUpWrapper==null&&popUpTransparicy==null){popUpTransparicy=document.createElement("div");popUpTransparicy.id=("pop_up_transparicy");document.body.appendChild(popUpTransparicy);popUpWrapper=document.createElement("div");popUpWrapper.id=("pop_up_wrapper");document.body.appendChild(popUpWrapper);popUpWrapper.style.display="none";}
if(popUpWrapper.style.display=="none"){popUpWrapper.style.display="";popUpTransparicy.style.display="";popUpTransparicy.onclick=function(){SA.Utils.popUp.closePopUpWithOpacity();};}else{SA.Utils.popUp.closePopUpWithOpacity();}
return false;}
this.CreatepopUpWithOpacityInner=function(){SA.Utils.popUp.popUpWithOpacity();popUpWrapper.innerHTML='<div id="displaybox_inner"><h1>You have successfully subscribed to real-time alerts!</h1><div>GOOG has been added to your portfolio. If you want to add/edit stocks <a href="/account/portfolio">visit your portfolio page</a></div><div style="padding-top:10px"><div class="emails_be_sent">Emails will be sent to <strong>naomi@seekingalpha.com</strong> <span style="color:#024999">[<a href="/account/account_preferences">change email</a>]</span></div></div></div><div onclick="AlphaBox.Close();" class="close_pop_bordeaux"></div>';}}})();(function(){var scope=SA.UsingNamespace("SA.Promotion");scope.RegPopup=new function(){var popupContainer,prevEmail,events;var closePopup=function(opt){opt=opt||{};popupContainer.hide();popupContainer.innerHTML='';SA.Utils.Expansion.removeOnClickOutside(popupContainer);if(!opt.noCloseEvent&&events.closedPopup)events.closedPopup();popupContainer=null;}
this.close=function(){closePopup();}
this.show=function(container,symbol,dashboardId,dashboardTitle,initEventSource,_events,loginMode){var promoClass=dashboardId?SA.Promotion.Newsletter:SA.Promotion.Quote;events=_events||{};if(!events.alreadySubscribed)events.alreadySubscribed=promoClass.AlreadySubscriberMsg;if(!events.registered)events.registered=promoClass.RegisterMsg;if(!events.forgotPassword)events.forgotPassword=promoClass.ForgotPasswordMsg;if(popupContainer)closePopup({noCloseEvent:true});popupContainer=container=$(container);var title,stocksInput;if(dashboardId)title=['<div class="add_title">To get the <strong>'+dashboardTitle+'</strong><br/>newsletter simply fill in your email:</div>','<input id="promotion_box_email" emailautofill="on" class="promotion_box_email" spellcheck="false" />'];else if(symbol)title=['<div class="add_title">To get email alerts on <strong>'+symbol+'</strong><br/>simply fill in your email:</div>','<input id="promotion_box_email" emailautofill="on" class="promotion_box_email" spellcheck="false" />'];else{title=['<div class="add_title">Which stocks are you watching?</div>','<input id="promotion_box_stocks" class="promotion_box_email" empty="(e.g. GOOG, AAPL, MSFT)" spellcheck="false" />','<div class="m_pop_error" id="promotion_box_stocks_error" style="display:none"></div>','<div class="add_title">Where to send your updates?</div>','<input id="promotion_box_email" emailautofill="on" class="promotion_box_email" empty="your email address" spellcheck="false" />'];stocksInput="promotion_box_stocks";}
var tmp_text=['<div class="m_pop_inner">','<div class="m_pop_arrow"><span></span></div>','<div class="add_to_portfolio_area">',title.join('\n'),'<div class="promotion_box_login">','<div class="green">You\'re already registered with this email.</div>','<div class="pls_enter_pswd">Please enter your password to continue:</div>','<input type="password" id="promotion_box_password" class="promotion_box_password" />','</div>','<div class="m_pop_error" id="get_alerts_error" style="display:none"></div>','<div class="button_and_never_spam">','<div class="we_never_spam">(we never spam)</div>','<div class="cpb_get_alerts_btn" id="get_alerts_btn">'+(dashboardId?'Get Newsletter':'Get Alerts')+'</div>','<div style="float:right;margin:7px 5px 0 0;display:none;" id="get_alerts_loader"><img src="http://static3.cdn-seekingalpha.com/images/loader.gif"></div>','<div class="cleaner"></div>','<div id="get_alerts_fp_btn" class="forgot_password">Forgot password?</div>','<div class="cleaner"></div>','</div>','</div>','<div class="promotion_box_close">X</div>','<div class="cleaner"></div>','</div>'];container.innerHTML=tmp_text.join("");container.style.display='block';container.down(".promotion_box_close").observe('click',closePopup);SA.Utils.Expansion.setOnClickOutside(container,closePopup,1);promoClass.trackEvent('Shown popup');function getStocks(){var stocks=dashboardId||symbol;if(!stocks&&stocksInput){var setStocksErr=function(err,setStocks,event){stocksErr.innerHTML=err;if(setStocks)stocksInput.SetValue(setStocks);stocksInput.ErrorMode();if(event)SA.Promotion.Quote.trackEvent(event);stocksErr.show();return null;}
stocksErr.hide();stocks=SA.Models.StockModel.stringToStocksArray(stocksInput.GetValue());if(stocks[1].length>0)return setStocksErr("Symbol(s) not recognized: "+stocks[1].join(","),stocks[0].join(","),'Reg err: unrecognized stocks');if(stocks[0].length==0)return setStocksErr("Please enter stocks to continue",null,'Reg err: no stocks');stocks=stocks[0].join(",");}
return stocks;}
var regClick=function(){var stocks=getStocks();if(!stocks)return;if(email.Empty()){email_err.innerHTML="Fill your email to continue";email_err.show();email.focus();return;}
var emailValue=prevEmail=email.GetValue();email_err.hide();btn.Lock();promoClass.Register(emailValue,stocks,function(response){btn.UnLock();if(response.message=='already_subscriber'&&events.alreadySubscribed)events.alreadySubscribed(response.slugs,emailValue);else if(events.registered)events.registered(emailValue,stocks);closePopup();},function(response){btn.UnLock();if(response.errors=='already_registered'){btn.SetOnclick(loginClick);forgotPassword=new SA.Utils.Button({element:$('get_alerts_fp_btn'),loaderObj:'get_alerts_loader',onclick:function(){email_err.hide();forgotPassword.Lock();promoClass.ForgotPassword(emailValue,function(response){closePopup();events.forgotPassword(emailValue);},function(response){forgotPassword.UnLock();var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();});}});password.Reset();popupContainer.addClassName("login_mode");email_err.hide();password.focus();}else{var er={'invalid_email':'Invalid Email'}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();}});};var loginClick=function(){var stocks=getStocks();if(!stocks)return;var emailValue=email.GetValue();if(emailValue!=prevEmail){btn.SetOnclick(regClick);regClick();popupContainer.removeClassName("login_mode");return;}
email_err.hide();btn.Lock();promoClass.Login(emailValue,password.GetValue(),function(){btn.UnLock();if(!events.onLoginAddRTA)promoClass.SetAutoPop(dashboardId?{tag_id:dashboardId,title:dashboardTitle}:{symbol:stocks});location.reload();},function(response){btn.UnLock();var er={'invalid_email':'Invalid Email','empty_password':"Password shouldn't be empty",'login_failed':"Wrong password"}[response.errors]||"Unknown error";email_err.innerHTML=er;email_err.show();password.Reset();password.focus();},(events.onLoginAddRTA?{addStocks:stocks,addRTA:true}:null));};if(stocksInput)stocksInput=SA.Utils.Expansion.Input(stocksInput,{autocomplete:{stocks:true}});var btn=new SA.Utils.Button({element:"get_alerts_btn",loaderObj:"get_alerts_loader",onclick:regClick}),email=SA.Utils.Expansion.Input('promotion_box_email',{onEnterKey:btn.click}),email_err=$('get_alerts_error'),stocksErr=$('promotion_box_stocks_error'),password=SA.Utils.Expansion.Input('promotion_box_password',{onEnterKey:btn.click}),forgotPassword;popupContainer.removeClassName("login_mode");if(!stocksInput)email.focus();return;}};})();(function(){var scope=SA.UsingNamespace("SA.Promotion");scope.DefaultAlerts="rta_market_currents,rta_articles"+(typeof(is_pro)!="undefined"&&is_pro?",rta_pro_articles":"");scope.Quote=new function(){var currentSymbol=null,portfolios={},popupContainer,showLocked=false,eventSource,registered_mail;var KEY="proQ"
var DEFAULT_ALERTS=SA.Promotion.DefaultAlerts;var self=this;var events={};var stocksInput;function trackEvent(label,data){data=data||{};var source=data.source||eventSource;delete data.source;if(SA.Pages.Article&&SA.Pages.Article.see_middle_unit()){source+=" middlelena"}
SA.Stats.GA.event('RTA',source,label,data.value);Mone.event('RTA',source,label,{data:(Object.keys(data).length>0?data:null)});}
this.trackEvent=trackEvent;function trackPV(data){data=data||{};var source=data.source||eventSource;delete data.source;if(SA.Pages.Article&&SA.Pages.Article.see_middle_unit()){source+=" middlelena"}
SA.Stats.GA.event('RTA',source,'page views',data.value,true);Mone.event('RTA',source,'page views',{data:(Object.keys(data).length>0?data:null)});}
this.trackPV=trackPV;var setSubscribedCookie=function(){createCookie('hasrta','1',3500);}
this.setSubscribedCookie=function(){setSubscribedCookie();}
this.isEverSubscribed=function(){return cookieExists('hasrta');}
function fixHorizontalPosition(){if(popupContainer.hasClassName('nofix_position'))return;var arrow;popupContainer.style.top='';if(popupContainer.hasClassName('point_left'))arrow=popupContainer.down('.m_pop_arrow span');if(arrow)arrow.style.top='';var height=popupContainer.getHeight(),viewOffset=popupContainer.viewportOffset(),top=popupContainer.positionedOffset().top;var diff=viewOffset.top+height-document.viewport.getHeight();if(diff>0){popupContainer.style.top=(top-diff)+'px';if(arrow){var arrowTop=arrow.positionedOffset().top;arrow.style.top=(arrowTop+diff)+'px';}}}
function displayPopup(){popupContainer.show();fixHorizontalPosition();var loader=$('loader_while_fetch');if(loader)loader.remove();trackEvent('Shown popup');if(events.shownPopup)events.shownPopup();}
function getStocks(){if(!stocksInput)return currentSymbol;var stocksErr=$('promotion_box_stocks_error');var setStocksErr=function(err,setStocks,event){stocksErr.innerHTML=err;if(setStocks)stocksInput.SetValue(setStocks);stocksInput.ErrorMode();if(event)SA.Promotion.Quote.trackEvent(event);stocksErr.show();return'';}
stocksErr.hide();var stocks=SA.Models.StockModel.stringToStocksArray(stocksInput.GetValue());if(stocks[1].length>0)return setStocksErr("Symbol(s) not recognized: "+stocks[1].join(","),stocks[0].join(","),'Reg err: unrecognized stocks');if(stocks[0].length==0)return setStocksErr("Please enter stocks to continue",null,'Reg err: no stocks');return stocks[0].join(",");}
var fillPortfolios=function(pAr){var loader=$('promotion_box_loader');if(loader)loader.remove();var container=$('promotion_box_portfolios');if(!container)return;if(!pAr)pAr=[];var tmp_text=[],chk_selected=false,has_sym=false;for(var i=0;i<pAr.length;i++){portfolios[pAr[i].puri]=new SA.Models.PortfolioModel({portfolioUri:pAr[i].puri});var param='';if(pAr[i].has_sym){param=' disabled="1" checked="1"';has_sym=true;}else{if(!pAr[i].has_sym)param+=' puri="'+pAr[i].puri+'"';if(!chk_selected){param+=' checked="1"';chk_selected=true;}}
tmp_text.push(['<li>','<input type="radio" name="rta_popup_radio" id="port_chk_'+i+'"'+param+'/>','<label for="port_chk_'+i+'">'+dash(pAr[i].title,11)+'</label>','<div class="cleaner"></div>','</li>'].join(''));}
container.innerHTML=tmp_text.join("");if(pAr.length>1){var selPortfolioTitle=$('promotion_box_sel_portfolio_title');if(selPortfolioTitle)selPortfolioTitle.show();container.show();}
tmp_text=[];tmp_text.push('<div style="color:red;display:none;float:left;" id="get_alerts_error"></div>');tmp_text.push('<div class="cleaner"></div>');tmp_text.push('<div class="cpb_get_alerts_btn" id="get_alerts_btn">Get alerts</div>');if(pAr.length>1&&pAr.length<14){tmp_text.push('<div style="color:red;display:none" id="new_portfolio_error"></div>');tmp_text.push('<div class="cleaner"></div>');tmp_text.push('<div class="cpb_get_alerts_line">or <span class="link" id="new_portfolio_btn">create a new portfolio and get alerts</span></div>');}
var footer=$('promotion_box_footer');footer.innerHTML=tmp_text.join("");var autoAdd=!stocksInput&&(pAr.length==1||has_sym);if(!autoAdd)displayPopup();var actionBtn=$('get_alerts_btn'),alertsError=$('get_alerts_error');if(pAr.length>0&&actionBtn){actionBtn=new SA.Utils.Button({element:actionBtn,loaderObj:'get_alerts_loader',onclick:function(){var stocks=getStocks();if(!stocks)return;var ar=container.select('input'),puris=[];alertsError.style.display='none';if(!autoAdd||!has_sym)for(var i=0;i<ar.length;i++){if(ar[i].checked){var puri=ar[i].getAttribute('puri');if(puri)puris.push(puri);}}
if(puris.length>0||has_sym){actionBtn.Lock();SA.Models.PortfolioModel.AddSymbolsWithAlertsToPortfolios(puris.join(','),stocks,DEFAULT_ALERTS,function(response){closePopup();if(!events.subscribed||events.subscribed(response))showSubscribedToAlertsMsg({addedTags:(response.stocks||[])});actionBtn.UnLock();setSubscribedCookie();},function(response){displayPopup();alertsError.innerHTML=response.errors||'Error occured';alertsError.style.display='block';actionBtn.UnLock();},eventSource);trackEvent('Added'+(autoAdd?' (auto)':''),{value:puris.uniq().length});}else{alertsError.innerHTML='* No change made';alertsError.style.display='block';}}});}
var newPortfoioBtn=$('new_portfolio_btn'),newPortfolioError=$('new_portfolio_error');if(pAr.length==0){newPortfoioBtn=actionBtn;newPortfolioError=alertsError;}
if(newPortfoioBtn){newPortfoioBtn=new SA.Utils.Button({element:newPortfoioBtn,onclick:function(){var stocks=getStocks();if(!stocks)return;newPortfolioError.style.display='none';newPortfoioBtn.Lock();new SA.Models.PortfolioModel().createPortfolio("",stocks,function(response){closePopup();response.reason='button';if(!events.createdPortfolio||events.createdPortfolio(response))showPortfolioCreatedMsg();newPortfoioBtn.UnLock();setSubscribedCookie();},function(response){alertsError.innerHTML=response.errors||'Error occured';alertsError.style.display='block';newPortfoioBtn.UnLock();},DEFAULT_ALERTS,eventSource);trackEvent('Create new: button');}});}
if(autoAdd)actionBtn.click();}
var fillErrors=function(errors){var loader=$('promotion_box_loader');if(loader)loader.remove();alert(errors);}
var closePopup=function(opt){opt=opt||{};popupContainer.style.display='none';popupContainer.innerHTML='';SA.Utils.Expansion.removeOnClickOutside(popupContainer);popupContainer=null;var loader=$('loader_while_fetch');if(loader)loader.remove();if(!opt.noCloseEvent&&events.closedPopup)events.closedPopup();}
this.close=function(){closePopup();}
var hasPortfolios=function(){return cookieExists('user_watchlist_slugs');}
var showPortfolioCreatedMsg=function(opt){opt=opt||events||{};sugest_version=ABTest.identity%10;rb=new roadblock("symbol");SA.Utils.Popup.single_suggestion(readCookie('user_email'));}
var showSubscribedToAlertsMsg=function(opt){rb=new roadblock("symbol");SA.Utils.Popup.single_suggestion2();}
var symbolLinks=function(slugs){var ar=slugs||(currentSymbol||'').split(/,\s*/),links=[];for(var i=0;i<ar.length;i++)links.push('<a href="/symbol/'+ar[i].toLowerCase()+'" sasource="promo">'+ar[i].toUpperCase()+'</a>');return SA.Utils.joinWithAnd(links);}
this.show=function(container,symbol,initEventSource,_events){events=_events||{};if(popupContainer)closePopup({noCloseEvent:true});popupContainer=container=$(container);if(symbol)currentSymbol=symbol.replace(/\s+/g,'').replace(/^,+|,+$/g,'').replace(/,+/g,', ').toUpperCase();eventSource=initEventSource||SA.Utils.unifiedPath();if(!SA.Data.User.loggedIn()){SA.Promotion.RegPopup.show(container,currentSymbol,null,null,eventSource,events);fixHorizontalPosition();return;}
if(!hasPortfolios()&&currentSymbol){if(showLocked)return;showLocked=true;new SA.Models.PortfolioModel().createPortfolio("",currentSymbol,function(response){response.reason='no_portfolios';if(!events.createdPortfolio||events.createdPortfolio(response))showPortfolioCreatedMsg();showLocked=false;setSubscribedCookie();},function(response){showLocked=false;if(response&&response.errors)alert(response.errors);},DEFAULT_ALERTS,eventSource);trackEvent('Create new: no portfolios');return;}
var title='';stocksInput=null;if(currentSymbol)title=['<div class="add_title">Add '+currentSymbol+' to your portfolio:</div>',];else{title=['<div class="add_title">Which stocks are you watching?</div>','<input id="promotion_box_stocks" class="promotion_box_email" empty="(e.g. GOOG, AAPL, MSFT)" spellcheck="false" />','<div class="m_pop_error" id="promotion_box_stocks_error" style="display:none"></div>',(hasPortfolios()?'<div class="add_title" id="promotion_box_sel_portfolio_title" style="display:none">Select portfolio:</div>':'')];stocksInput="promotion_box_stocks";}
var tmp_text=['<div class="m_pop_inner logged_in">','<div class="m_pop_arrow"><span></span></div>','<div class="add_to_portfolio_area">',title.join(''),'<div class="loader" id="promotion_box_loader" style="margin: 17px 0 20px 0;"><img src="http://static3.cdn-seekingalpha.com/images/loader.gif" /> Loading...</div>','<ul id="promotion_box_portfolios" style="display:none"></ul>','</div>','<div id="promotion_box_footer"></div>','<div class="promotion_box_close">X</div>','</div>'];container.innerHTML=tmp_text.join("");container.insert({before:'<img id="loader_while_fetch" class="loader_while_fetch" style="margin-left:10px" src="http://static3.cdn-seekingalpha.com/images/loader.gif" />'});container.down(".promotion_box_close").observe('click',closePopup);SA.Utils.Expansion.setOnClickOutside(container,closePopup,1);if(stocksInput)stocksInput=SA.Utils.Expansion.Input(stocksInput,{autocomplete:{stocks:true}});if(stocksInput&&!hasPortfolios())fillPortfolios([]);else SA.Models.PortfolioModel.listPortfolios(fillPortfolios,fillErrors,currentSymbol);}
this.Register=function(email,slugs,success,failure,opt){opt=opt||{}
if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!slugs)return failure({errors:'no_slugs'});var source=(eventSource&&!/^\//.test(eventSource))?'source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):null;var params={'user[email]':email,rta_slugs:slugs,id:'login',activity:'rta','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,''),rta_source:eventSource};if(!opt.noAlerts)params.rta_add_alerts=1;if(opt.password)params.password=opt.password;if(opt.nick)params.nick=opt.nick;if(source)params.force_params=source;return SA.Utils.ajax("/authentication/registration",params,function(response){if(!response.registration){trackEvent('Reg err: '+response.message);failure({errors:response.message});}else{registered_mail=email;trackEvent('Registered'+(opt.noAlerts?' (w/o alerts)':''),{value:slugs.split(',').length,email:email});setSubscribedCookie();success(response);}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.Login=function(email,password,success,failure,opt){opt=opt||{};if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!password)return failure({errors:'empty_password'});var params={'user[email]':email,'user[password]':password,id:'login',activity:'rta','function':'',rta_source:eventSource};if(opt.addStocks)params['rta_slugs']=opt.addStocks;if(opt.addRTA)params['rta_add_alerts']=1;trackEvent('Login try');return SA.Utils.ajax("/authentication/login",params,function(response){if(!response.login){trackEvent('Log err: '+response.message);failure({errors:response.message});}else{if(SA.Pages.Article&&SA.Pages.Article.see_middle_unit()){Mone.event("RTA","article","midelena log in");}
if(response.max_rta_error)alert(response.max_rta_error);success(response);}},function(response){trackEvent('Log err: '+response.errors);failure(response);});}
this.ForgotPassword=function(email,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});return SA.Utils.ajax("/authentication/forgot_password",{'user[email]':email,id:'login',activity:'rta','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,'')},function(response){if(!response.forgot_password){trackEvent('Forgot Password err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Forgot Password err: '+response.errors);failure(response);});}
this.ForgotPasswordMsg=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>We've sent instructions on how to reset your password to your email inbox.</h3>");aHtml.push("<div class='cant_see_note'>(If you can't find it, please check your spam filter.)</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.RegisterMsg=function(email){rb=new roadblock("symbol");sugest_version=ABTest.identity%10;if(sugest_version==3||sugest_version==4){SA.Utils.Popup.single_suggestion3((email||registered_mail));}else{rb.add_success((email||registered_mail));}}
this.AlreadySubscriberMsg=function(slugs){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3 style='padding: 10px 0'>You have successfully added "+symbolLinks(slugs)+" to your real-time alerts.</h3>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.SetEventSource=function(newEventSource){eventSource=newEventSource;}
this.SetAutoPop=function(data){var defData={container:popupContainer?popupContainer.id:'',symbol:currentSymbol,scrollY:document.viewport.getScrollOffsets().top,source:eventSource}
var parent=popupContainer?popupContainer.parentNode:null;if(parent&&parent.style.position=='absolute')defData.parentPos={top:parent.style.top,left:parent.style.left};if(!data)data=defData;else for(var i in defData)if(data[i]==undefined)data[i]=defData[i];SA.Data.Cache.Set(KEY,Object.toJSON(data));}
this.GetAutoPop=function(clean){var json=SA.Data.Cache.Get(KEY);if(!json)return null;try{json=json.evalJSON();}catch(e){json=null;console.error("Error parsing AutoPop data");}
if(clean)self.CleanAutoPop();return json;}
this.CleanAutoPop=function(){SA.Data.Cache.Clean(KEY);}
var autoPopRetry=0;this.CheckAutoPop=function(defContainer){var data=self.GetAutoPop();if(data){var autoPopSymbol=data.symbol,containerId=data.container||defContainer,container=$(containerId),scrollPosY=data.scrollY;if(!container){if(autoPopRetry<10)setTimeout(function(){self.CheckAutoPop(defContainer);},500);else trackEvent('Auto Popup fail: no "'+containerId+'"');autoPopRetry++;return;}
self.CleanAutoPop();eventSource=data.source||SA.Utils.unifiedPath();trackEvent('Auto Popup');if(container){SA.Promotion.Quote.show(container,autoPopSymbol,eventSource,{welcomeBack:true});if(scrollPosY!=null)scrollTo(0,scrollPosY);else container.scrollIntoView();if(data.parentPos){var parent=container.parentNode;if(parent&&parent.style.position=='absolute')parent.setStyle(data.parentPos);}}}}
function logout(){var source=(eventSource&&!/^\//.test(eventSource))?'&source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):'';Authentication.Authenticate("login","footer_login",{Login:"SA.Promotion.Quote.Login",Register:"SA.Promotion.Quote.Register",ForgotPassword:"FooterBar.ForgotPassword"},{Login:"subscribe to email alerts",Close:""},"","","promo=q@"+escape(currentSymbol)+source);trackEvent('Login popup');}}})();(function(){var scope=SA.UsingNamespace("SA.Promotion");scope.Newsletter=new function(){var self=this;var KEY="proNL",eventSource="promotion_newsletter";var registered_mail;var curDashId,curDashTitle,curDashCounts,lock,loader;function trackEvent(label,data){data=data||{};data.source=data.source||eventSource;SA.Promotion.Quote.trackEvent(label,data);}
this.trackEvent=trackEvent;function trackPV(data){data=data||{};data.source=data.source||eventSource;SA.Promotion.Quote.trackPV(data);}
this.trackPV=trackPV;this.Register=function(email,tag_id,success,failure,opt){opt=opt||{}
if(!rxEmail.test(email))return failure({errors:'invalid_email'});var source=(eventSource&&!/^\//.test(eventSource))?'source=pr_'+eventSource.replace(/(\w)\w*\s*/g,"$1").replace(/\W+/g,'_').replace(/^_/,''):null;var params={'user[email]':email,newsletter:tag_id,id:'login',activity:'newsletter','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,''),nl_source:eventSource};if(source)params.force_params=source;return SA.Utils.ajax("/authentication/registration",params,function(response){if(!response.registration){trackEvent('Reg err: '+response.message);failure({errors:response.message});}else{registered_mail=email;trackEvent('Registered'+(opt.noAlerts?' (w/o alerts)':''),{email:email});setSubscribedCookie();success(response);}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.Login=function(email,password,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});if(!password)return failure({errors:'empty_password'});return SA.Utils.ajax("/authentication/login",{'user[email]':email,'user[password]':password,id:'login',activity:'newsletter','function':''},function(response){if(!response.login){trackEvent('Log err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Log err: '+response.errors);failure(response);});}
this.ForgotPassword=function(email,success,failure){if(!rxEmail.test(email))return failure({errors:'invalid_email'});return SA.Utils.ajax("/authentication/forgot_password",{'user[email]':email,id:'login',activity:'newsletter','function':'',referrer:(SA.Data.Cookies.get('session_referrer')||''),url_source:location.href.replace(/\?.*$/,'')},function(response){if(!response.forgot_password){trackEvent('Forgot Password err: '+response.message);failure({errors:response.message});}else success(response);},function(response){trackEvent('Forgot Password err: '+response.errors);failure(response);});}
this.ForgotPasswordMsg=function(){var aHtml=[];aHtml.push("<div id='readlater_register_login' class='customize_pop_bordeaux mail_sent'>");aHtml.push("<h3>We've sent instructions on how to reset your password to your email inbox.</h3>");aHtml.push("<div class='cant_see_note'>(If you can't find it, please check your spam filter.)</div>");aHtml.push("<div class='cleaner'></div>");aHtml.push("<div class='close_pop_bordeaux' onclick='AlphaBox.Close();'></div>");AlphaBox.Loading();AlphaBox.AddHtml(aHtml.join(""));}
this.RegisterMsg=function(email,dashId,title){AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article thankyou">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">Thanks for subscribing for <strong>Seeking Alphas <span>'+(title||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<p class="email_msg_popup">A confirmation email has been sent to <strong>'+(email||registered_mail)+'</strong>.</p>');html.push('<p class="last_p">Please confirm your registration by clicking the link in the email</p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.Subscribe=function(success,failure){return SA.Utils.ajax("/account/ajax_subscribe_newsletter",{tag_id:curDashId,source:eventSource},function(response){setSubscribedCookie();if(response.msg=='already_signed_up'){trackEvent('Already Subscribed');if(!success||success(response)!=false)self.AlreadySubscribedMsg();}else{trackEvent('Subscribed');if(!success||success(response)!=false)self.SubscribedMsg();}},function(response){trackEvent('Reg err: '+response.errors);failure(response);});}
this.GetAutoPop=function(){return SA.Data.Cache.Get(KEY);}
this.AlreadySubscribedMsg=function(overrideTitle){if(!AlphaBox.isOpen)AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article already_subscribed">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">You are already subscribed to <strong>Seeking Alphas <span>'+(overrideTitle||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('<div class="bottom_bg">');html.push('<p class="email_msg_popup">Edit your email settings <a href="/email_preferences" style="color: #024999;">here</a>.</p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.SubscribePopup=function(overrideTitle){AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="black_title"><strong>Seeking Alphas <span>'+(overrideTitle||curDashTitle)+'</span> Newsletter</strong> is sent to <strong>'+curDashCounts+'</strong> subscribers once per day. Do you want to receive it?</div>');html.push('<div class="yes_or_no">');html.push('<div class="yes" onclick="SA.Promotion.Newsletter.onSubscribeYes();"><div class="l_side"></div>Yes</div>');html.push('<div class="no" onclick="AlphaBox.Close()">No, thanks</div>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('<div class="bottom_bg">');html.push('<p class="email_msg_popup do_subscribe">Manage your email subscriptions <a href="/email_preferences" style="color: #024999;">here</a>.</p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.onSubscribeYes=function(){if(lock)return;lock=true;if(loader)loader.show();self.Subscribe(function(){lock=false;if(loader)loader.hide();},function(){lock=false;if(loader)loader.hide();});}
this.SubscribedMsg=function(overrideTitle){if(!AlphaBox.isOpen)AlphaBox.Loading();var html=[];html.push('<div>');html.push('<div class="rta_pop_article">');html.push('<div class="rta_pop_article_close" onclick="AlphaBox.Close()">X</div>');html.push('<div class="rta_pop_article_top">');html.push('<div class="green_title">Thanks for subscribing for <strong>Seeking Alphas <span>'+(overrideTitle||curDashTitle)+'</span> Newsletter</strong></div>');html.push('<p class="email_msg_popup">Emails will be sent to <strong>'+SA.Data.User.email()+'</strong>.</p>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('<div class="bottom_bg">');html.push('<p class="if_not_correct_email">If you would like to change your email address <a href="/account/account_preferences" sasource="newsl_subscr_thank">click here</a></p>');html.push('</div>');html.push('<div class="cleaner"></div>');html.push('</div>');html.push('</div>');AlphaBox.AddHtml(html.join(''));}
this.CheckAutoPop=function(success,failure){var json=SA.Data.Cache.Get(KEY);if(!json)return false;SA.Data.Cache.Clean(KEY);var data=json.evalJSON();if(data){var tag_id=data.tag_id
if(!tag_id)return false;trackEvent('Auto Popup');eventSource=data.source||SA.Utils.unifiedPath();self.setDashboard(tag_id,data.title);self.Subscribe(success,failure);return true;}
return false;}
this.SetAutoPop=function(data){data=data||{};data.source=data.source||eventSource;SA.Data.Cache.Set(KEY,Object.toJSON(data));}
this.SetEventSource=function(newEventSource){eventSource=newEventSource;}
var setSubscribedCookie=function(){createCookie('hasnl','1',3500);}
this.isEverSubscribed=function(){return cookieExists('hasnl');}
this.setDashboard=function(dashId,dashTitle,dashboardCounts){curDashId=dashId;curDashTitle=dashTitle;curDashCounts=dashboardCounts||'';}
this.show=function(container,dashboardId,dashboardTitle,dashboardCounts,initEventSource,opt){opt=opt||{};loader=opt.loader;eventSource=initEventSource||SA.Utils.unifiedPath();self.setDashboard(dashboardId,dashboardTitle,dashboardCounts);if(!SA.Data.User.loggedIn()){SA.Promotion.RegPopup.show(container,null,dashboardId,dashboardTitle,eventSource);}else{self.SubscribePopup();}}};})();(function(){var scope=SA.UsingNamespace("SA.Promotion");scope.AddAlertsSuggestionPopup=function(options){var self=this;var container,loader,btn,symbols,timeoutId,closeBtn,refElement=$(options.element);var id=Math.ceil(Math.random()*1000);var shown=false;options=options||{};this.hide=function(){if(container&&shown)container.fade({duration:0.3,queue:{position:'end',scope:'portfolio_rta_popup'}});shown=false;}
this.addingFail=function(response){self.hide();if(response&&response.errors){alert(response.errors);}}
this.addingSuccess=function(response){self.hide();try{SA.Pages.Account.Portfolios.AddAlertsToTable(response.stocks_ids);}catch(e){}}
this.show=function(newSymbols){if(!container)return;self.stopHideTimeout();symbols=newSymbols;container.appear({duration:0.5,queue:{position:'end',scope:'portfolio_rta_popup'}});loader.hide();shown=true;}
this.startHideTimeout=function(delay){if(timeoutId)clearTimeout(timeoutId);timeoutId=setTimeout(self.hide,delay);}
this.stopHideTimeout=function(){if(timeoutId)clearTimeout(timeoutId);timeoutId=null;}
this.getContainer=function(){return container;}
function init(){container=new Element('div',{"id":"portfolio_rta_popup_"+id,style:'display:none;',"class":"add_alerts_popup"});var html=[];html.push('<div class="close" id="portfolio_rta_close_'+id+'">&nbsp;</div>');html.push('<div class="arr"></div>');html.push('<div class="title">Add email alerts</div>');html.push('<div>Would you like to get real-time email alerts on</div>');html.push('<div>the stocks you just added to your portfolio?</div>');html.push('<div class="getAlerts" id="portfolio_rta_btn_'+id+'">Get alerts<div class="right_cor"></div></div>');html.push('<img class="loader" id="portfolio_rta_loader_'+id+'" src="http://static3.cdn-seekingalpha.com/images/loader.gif" />');container.innerHTML=html.join('\n');var parent=new Element('span',{"class":"add_alerts_popup_container"});refElement.insert({before:parent});parent.insert(container);btn=new SA.Utils.Button({element:'portfolio_rta_btn_'+id,onclick:function(){if(!symbols)return;SA.Models.PortfolioModel.AddSymbolsWithAlertsToPortfolios('',symbols,SA.Promotion.DefaultAlerts,self.addingSuccess,self.addingFail,"pop after adding");SA.Data.User.addRTASymbols(symbols,SA.Promotion.DefaultAlerts);Mone.event("homepage_protfolio_control","portfolio unit","added to rta",{data:{"symbol":symbols}});loader.show();}});closeBtn=new SA.Utils.Button({element:'portfolio_rta_close_'+id,onclick:self.hide});container.observe('mouseout',function(event){var rel=event.relatedTarget||event.toElement;while(rel){if(rel==this)return;rel=rel.parentNode;}
self.startHideTimeout(3000);});container.observe('mouseover',function(){self.stopHideTimeout();});refElement.observe('mouseout',function(event){if(options.outExceptions){var rel=event.relatedTarget||event.toElement;if(rel.match(options.outExceptions)||rel.up(options.outExceptions))return;}
self.startHideTimeout(3000);});refElement.observe('mouseover',function(){self.stopHideTimeout();});loader=$('portfolio_rta_loader_'+id);}
init();};})();(function(){var scope=SA.UsingNamespace("SA.Promotion");scope.Sticky=new function(){var source,element,version,availableABVersions=["e"],container;this.getSource=function(){return source;}
this.getVersion=function(){return version;}
this.init=function(pageSource,opt){opt=opt||{};var versions=opt.versions||availableABVersions;var autopopData=SA.Promotion.Quote.GetAutoPop(false);if((autopopData&&autopopData.container=='promotion_box_rel_nav')||((opt.withRTA||!SA.Data.User.hasRTA())&&!SA.Data.Cookies.get('rta_nav_hide'))){element=$('related_promo_container_rel_nav');if(element){version=versions?new ABTest('nav_alerts',versions).value:null;if(version=='x')return version;container=element.up('.rta_nav');if(container&&version)container.addClassName('ver_'+version);source=pageSource+', '+'rel_nav'+(version?' '+version:'');SA.Promotion.Quote.trackPV({source:source});element.show();if(version)document.body.addClassName("rta_sticky_ver_"+version);}
document.body.addClassName("without_rta");}else version='x';return version;}
this.hide=function(opt){opt=opt||{};if(!opt.dontRemember)SA.Data.Cookies.set('rta_nav_hide',1,3000);if(container)container.slideUp();SA.Promotion.Quote.trackEvent('closed',{source:source});}
this.overrideABVersions=function(vers){availableABVersions=vers;}}})();(function(){var scope=SA.UsingNamespace("SA.Pages.HP");scope.Portfolio=new function(){var table,combo,loader,content,emptyContent,addStocksBtn,addStocksInput,portfolio,mcTitle;var articlesContainer,portfolioUnitContainer;var stocksContainer,stocksContainerDis;var retries=0,retryTimeout;var refreshInterval;var priorityQuotes=[];var self=this;var lastProtfolio=null;var init=false,loggedIn;var availableABVersions=["b"],abversion;var rtaPopup;var is_dashboard=false;this.overrideABVersions=function(versions){availableABVersions=versions;}
this.init=function(){if(init)return;init=true;loggedIn=SA.Data.User.loggedIn();portfolioUnitContainer=$('portfolio_tables');table=$('portfolio_table');combo=$('portfolio_combo');loader=$('portfolio_loader');content=$('portfolio_content');emptyContent=$('portfolio_empty');loader=$('portfolio_loader');articlesContainer=$('portfolio_articles');mcTitle=$('portfolio_mc_title');stocksContainer=$('portfolio_stocks_container');stocksContainerDis=$('portfolio_stocks_container_dis');addStocksBtn=new SA.Utils.Button({element:'portfolio_stocks_btn',onclick:self.addStocks,loaderObj:loader});addStocksInput=SA.Utils.Expansion.Input('portfolio_stocks_input');AutoCompleteSAConfig.Load('portfolio_add_stocks',{Input:addStocksInput,AddAfterInput:true,Authors:false,MultipleInsert:true,AutoInsert:true,AfterSubmit:self.addStocks});abversion=new ABTest("HP promo",availableABVersions).value;portfolioUnitContainer.addClassName("ver_"+abversion);rtaPopup=new SA.Promotion.AddAlertsSuggestionPopup({element:addStocksBtn.GetElement(),outExceptions:'.loader_wrapper'});}
this.initProDashboard=function(){if(init)return;init=true;is_dashboard=true;loggedIn=SA.Data.User.loggedIn();portfolioUnitContainer=$('portfolio_tables');table=$('portfolio_table');combo=$('portfolio_combo');loader=$('portfolio_loader');content=$('portfolio_content');emptyContent=$('portfolio_empty');mcContainer=$('portfolio_mc');loader=$('portfolio_loader');articlesContainer=$('portfolio_articles');mcTitle=$('portfolio_mc_title');stocksContainer=$('portfolio_stocks_container');stocksContainerDis=$('portfolio_stocks_container_dis');addStocksBtn=new SA.Utils.Button({element:'portfolio_stocks_btn',onclick:self.addStocks,loaderObj:loader});addStocksInput=SA.Utils.Expansion.Input('portfolio_stocks_input');AutoCompleteSAConfig.Load('portfolio_add_stocks',{Input:addStocksInput,AddAfterInput:true,Authors:false,MultipleInsert:true,AutoInsert:true,AfterSubmit:self.addStocks});rtaPopup=new SA.Promotion.AddAlertsSuggestionPopup({element:addStocksBtn.GetElement(),outExceptions:'.loader_wrapper'});if(SA.Data.User.hasPortfolio()){self.refresh();self.startAutoRefresh();}else if(SA.Pages.HP.Portfolio.i_am_in_the_flow()){portfolioUnitContainer.hide();}}
this.i_am_in_the_flow=function(){return/\/account\/pro\/success/.test(document.referrer);}
this.subscribeToogle=function(obj,optSource){tag=obj.value;summary="";mode="rta_articles,rta_market_currents";if(is_pro){mode+=",rta_pro_articles";}
eventSource="Home Page";if(optSource){eventSource=optSource}
unlock=null;if(obj.checked){SA.Models.SubscriptionModel.subscribe(tag,mode,eventSource,unlock,unlock);if(is_pro){SA.Pages.HP.Portfolio.addStocktoRtaCookie("rta_pro_articles",tag);}
if(!is_dashboard){SA.Pages.HP.Portfolio.addStocktoRtaCookie("rta_articles",tag);SA.Pages.HP.Portfolio.addStocktoRtaCookie("rta_market_currents",tag);Mone.event("homepage_protfolio_control","portfolio unit","clicked",{data:{"symbol":tag}});}}else{SA.Models.SubscriptionModel.unsubscribe(tag,mode,eventSource,unlock,unlock);if(is_pro){SA.Pages.HP.Portfolio.removeStockfromRtaCookie("rta_pro_articles",tag);}
if(!is_dashboard){try{if(contains(tag,SA.Data.Cookies.get('rta_articles').split(","))){summary="_article";}}catch(e){}
try{if(contains(tag,SA.Data.Cookies.get('rta_market_currents').split(","))){summary+="_mc";}}catch(e){}
SA.Pages.HP.Portfolio.removeStockfromRtaCookie("rta_articles",tag);SA.Pages.HP.Portfolio.removeStockfromRtaCookie("rta_market_currents",tag);Mone.event("homepage_protfolio_control","portfolio unit","unchecked"+summary,{data:{"symbol":tag}});}}
var id=obj.id.sub("pro_check","");obj.style.visibility='hidden';$('pro_loader'+id).show();setTimeout("SA.Pages.HP.Portfolio.clearAnimation('"+id+"')",2000);}
this.clearAnimation=function(id){$("pro_check"+id).style.visibility='visible';$("pro_loader"+id).hide();}
this.startAutoRefresh=function(){if(refreshInterval)clearInterval(refreshInterval);refreshInterval=setInterval(function(){resetRetry();self.refresh({noLoader:true});},60000);}
this.addStocks=function(){if(!portfolio&&typeof(create_portfolio)!="undefined"){stockArea=SA.Utils.Expansion.Input('portfolio_stocks_input');create_portfolio();addStocksInput.Reset();}
if(!portfolio||addStocksInput.Empty())return;if(SA.Data.User.hasPortfolio()&&!loggedIn){var recognized=SA.Pages.HP.Promotion.addStocks(addStocksInput.GetValue());priorityQuotes=recognized.concat(priorityQuotes).uniq();addStocksInput.Reset();self.refresh();scope.Portfolio.track('Portfolio','Add stocks to temp portfolio');return;}
if(!loggedIn)return;resetRetry();var stocks=SA.Models.StockModel.stringToStocksString(addStocksInput.GetValue());var add_source=is_dashboard?"pro dashboar":"home page";Mone.event("Portfolio Unit",add_source,"Ticker Added",{data:{"symbols":stocks}});if(is_dashboard){SA.Pages.HP.Portfolio.addStocktoRtaCookie("rta_pro_articles",stocks)}
if(!stocks)return;var pro_alerts=is_dashboard?"rta_pro_articles,rta_articles,rta_market_currents":null;addStocksBtn.Lock();portfolio.addSymbols(stocks,function(response){addStocksBtn.UnLock();addStocksInput.Reset();priorityQuotes=response.recognized.concat(priorityQuotes).uniq();self.refresh();},function(response){addStocksBtn.UnLock();console.log("Error add: "+response.errors);},pro_alerts);scope.Portfolio.track('Portfolio','Add stocks',{value:stocks.split(',').length});if(SA.Data.User.newRTASymbols(stocks).length>0&&rtaPopup&&!is_dashboard)rtaPopup.show(stocks);}
this.update=function(data){var i,selTitle,slugs=[];if(!data)return;loader.hide();if(data.portfolio_data){combo.length=0;var all=data.portfolio_data.all,sel=data.portfolio_data.selected;if(all.length==0||lastProtfolio!=sel){content.hide();if(emptyContent)emptyContent.show();}
for(var i=0;i<all.length;i++){addOption(combo,new Option(all[i][1],all[i][0],false,all[i][0]==sel));if(all[i][0]==sel)selTitle=all[i][1];}
if(loggedIn&&combo.length<15){addOption(combo,new Option('Create New Portfolio','new'));}
if(combo.length>0)combo.show();var symbols=data.portfolio_data.data,body=table.tBodies[0];while(body.rows.length>0)body.deleteRow(0);var needRefresh=false;for(var i=0;i<symbols.length;i++){var row=body.insertRow(-1),cell;slugs.push(symbols[i].slug.toLowerCase());row.className=i%2==0?'even':'odd';cell=row.insertCell(-1);cell.className='symbol';cell.innerHTML='<a href="/symbol/'+symbols[i].slug.toLowerCase()+'" sasource="hp_pslug" onmouseover="symbolLinkAddAltAndTitle(this)">'+symbols[i].slug+"</a>";cell=row.insertCell(-1);cell.innerHTML='<span class="portfolio_loader_wrapper"><input type="checkbox" id="pro_check'+symbols[i].slug.toLowerCase()+'" class="pro-check" value="'+symbols[i].slug.toLowerCase()+'" onclick="SA.Pages.HP.Portfolio.subscribeToogle(this)"><div id="pro_loader'+symbols[i].slug.toLowerCase()+'" class="two_blue_arrows_loader portfolio_unit" style="display:none;"></span></div>';if(symbols[i].last&&symbols[i].close){cell=row.insertCell(-1);cell.innerHTML=symbols[i].last.toFixed(2);cell=row.insertCell(-1);var chg=symbols[i].last-symbols[i].close;cell.innerHTML=(chg==0?'':(chg>0?'+':''))+chg.toFixed(2);cell.className=(chg==0?'':(chg>0?'up':'down'));cell=row.insertCell(-1);cell.innerHTML=(chg==0?'':(chg>0?'+':''))+(chg/symbols[i].close*100).toFixed(2);cell.className=(chg==0?'':(chg>0?'up':'down'));}else{row.insertCell(-1).innerHTML="N/A";row.insertCell(-1).innerHTML="N/A";row.insertCell(-1).innerHTML="N/A";needRefresh=true;}}
portfolio=new SA.Models.PortfolioModel({portfolioUri:sel,title:selTitle});var seeMoreBottomPortfolio=$('portfolio_see_more');if(symbols.length>0){seeMoreBottomPortfolio.style.borderTop="1px dotted #D4D4D4";}else{seeMoreBottomPortfolio.style.borderTop="none";}
if((symbols.length<50&&!is_dashboard)||(symbols.length<200&&is_dashboard)){stocksContainer.show();stocksContainerDis.hide();}else{stocksContainer.hide();stocksContainerDis.show();}
if(lastProtfolio!=sel){content.appear();lastProtfolio=sel;}
else{content.show();}
if(needRefresh&&retries<3)retryTimeout=setTimeout(function(){retryTimeout=null;retries++;self.refresh({noLoader:true});},(retries<2?1.5:3)*1000);}
if(data.articles_on_portfolio)self.updateArticles(data.articles_on_portfolio,slugs);if(is_dashboard){SA.Pages.HP.Portfolio.updateProDefault();}else{SA.Pages.HP.Portfolio.updateDefault();}}
this.updateDefault=function(){var cnt_articles=0;var cnt_pro_articles=0;var cnt_currents=0;var unchecked=0;var rta_articles=(SA.Data.Cookies.get('rta_articles')&&SA.Data.Cookies.get('rta_articles').split(","))||[];var rta_market_current=(SA.Data.Cookies.get('rta_market_currents')&&SA.Data.Cookies.get('rta_market_currents').split(","))||[];var rta_pro_articles=((is_pro&&SA.Data.Cookies.get('rta_pro_articles')&&SA.Data.Cookies.get('rta_pro_articles').split(",")))||[];$$('.pro-check').each(function(o){if(contains(o.value,rta_pro_articles)||contains(o.value,rta_articles)||contains(o.value,rta_market_current)){o.checked=true;if(contains(o.value,rta_pro_articles)){cnt_pro_articles++;}
if(contains(o.value,rta_articles)){cnt_articles++;}
if(contains(o.value,rta_market_current)){cnt_currents++;}}else{unchecked++;}});Mone.event("homepage_protfolio_control","portfolio unit","unit shown",{data:{"articles":cnt_articles,"pro":cnt_pro_articles,"currents":cnt_currents,"unchecked":unchecked}});}
this.updateProDefault=function(){$$('.pro-check').each(function(o){if(contains(o.value,SA.Data.Cookies.get('rta_pro_articles').split(","))){o.checked=true;}});}
this.addStocktoRtaCookie=function(rta,stock){if(user_cookie){if(user_cookie[rta]==null){user_cookie[rta]="";}
user_cookie[rta]+=","+stock.trim().toLowerCase();}}
this.removeStockfromRtaCookie=function(rta,stock){if(user_cookie&&user_cookie[rta]){user_cookie[rta]=user_cookie[rta].split(",").without(stock.trim().toLowerCase()).join(',');}}
this.formatMCDate=function(timestamp){var weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var date=new Date(timestamp*1000);var day=weekdays[date.getDay()];var hour=date.getHours();var minutes=date.getMinutes();var time_str="";if(hour>12){time_str=(hour-12)+":"+minutes+" PM";}else{time_str=hour+":"+minutes+" AM";}
return"<b>"+day+" "+time_str+"</b>";}
this.formatMCComments=function(item){var url="/currents/post/"+item.id;if(item.comments==0){return"<a class='comments' href='"+url+"' sasource='hp_pmc_comment'>Comment!</a>";}else if(item.comments==1){return"<a class='comments' href='"+url+"' sasource='hp_pmc_comment'>1 Comment</a>";}else{return"<a class='comments' href='"+url+"' sasource='hp_pmc_comment'>"+item.comments+" Comments</a>";}}
this.formatMCTags=function(tags){var url,name,ret_str=[];for(var i=0;i<tags.length;i++){url="/currents/"+tags[i][0];name=(tags[i][1]==null)?this.capitalize(tags[i][0]):tags[i][1];ret_str.push("<a href='"+url+"' sasource='hp_pmc_filters'>"+name+"</a>");}
ret_str=ret_str.join(", ");if(ret_str!="")return" <span class='tags'>["+ret_str+"]</span> ";else return"";}
this.capitalize=function(str){return str.replace(/(^|\s)([a-z])/g,function(m,p1,p2){return p1+p2.toUpperCase();});}
this.updateArticles=function(list,portSlugs){articlesContainer.innerHTML='';if(is_dashboard){list=list.slice(0,10);if(!list.length)articlesContainer.insert("<li>There are not yet any Pro articles on your stocks.</li>");}
for(var i=0;i<list.length;i++){var chosen=[],symbols=list[i].symbols;if(symbols)for(var j=0;j<symbols.length&&chosen.length<2;j++)if(portSlugs.indexOf(symbols[j].slug)!=-1)chosen.push(symbols[j].name);if(chosen.length==0)continue;var li=document.createElement('li');var source=((is_dashboard)?'pro_dash':'hp')+"_particle_"+(i+1);li.innerHTML='<div class="symbol">'+chosen.join(', ')+':</div><a href="'+list[i].uri+'" sasource="'+source+'" title="'+list[i].title+'">'+list[i].title+'</a>';if(is_dashboard){li.innerHTML+='<div class="pro_dash_dateline"><span class="date"> '+getDate(list[i].publish_on)+' <span class="bullet"></span> '+getHour(list[i].publish_on)+' </span> <span class="bullet"></span> '+list[i].by+'</div>';}
articlesContainer.appendChild(li);}}
this.refresh=function(opt){opt=opt||{};if(!opt.noLoader)loader.show();var id=opt.id||'';SA.Utils.ajax('/users/ajax_get_user_details_card',{portfolio:id,priority:priorityQuotes.join(','),is_pro_dashboard:is_dashboard},function(response){self.update(response);},function(response){loader.hide();console.log("Error getting data: "+response.errors);});}
this.select=function(){if(combo.selectedIndex==-1)return;resetRetry();priorityQuotes=[];var id=combo.options[combo.selectedIndex].value;if(!id)return;if(id=='new'){loader.show();new SA.Models.PortfolioModel().createPortfolio("","",function(){self.refresh();addStocksInput.focus();},function(response){console.log("Error create: "+response.errors);});scope.Portfolio.track('Portfolio','Create new');}else{self.refresh({id:id});scope.Portfolio.track('Portfolio','Select');}}
this.track=function(action,label,opt){opt=opt||{};if(SA.Pages.HP.Main){SA.Pages.HP.Main.track(action,label,opt);}else if(is_dashboard){SA.Stats.GA.event('Pro Dashboard Tracking',action,label,opt.value);}}
var resetRetry=function(){if(retryTimeout)clearTimeout(retryTimeout);retryTimeout=null;retries=0;}
function addOption(combo,option){try{combo.add(option,null);}catch(e){combo.add(option);}}
function getDate(timestamp){var a=new Date(timestamp*1000);var months=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var weekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var month=months[a.getMonth()];var date=a.getDate();var day=weekdays[a.getDay()];return day+', '+month+' '+date;}
function getHour(timestamp){var a=new Date(timestamp*1000);var hour=a.getHours();var minutes=a.getMinutes();if(minutes<10)minutes="0"+minutes;var time_str="";if(hour>12){time_str=(hour-12)+":"+minutes+" PM";}else{time_str=hour+":"+minutes+" AM";}
return time_str;}}})();