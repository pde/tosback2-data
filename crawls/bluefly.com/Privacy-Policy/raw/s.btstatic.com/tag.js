if(window.BrightTag==undefined)window.BrightTag={module:function(b,e){return BrightTag[b]||(BrightTag[b]=e)},each:function(b,e){if(b.length===undefined)for(var g in b)b.hasOwnProperty(g)&&e(g,b[g]);else{g=0;for(var i=b.length;g<i;g++)e(b[g],g)}},pushIfDefined:function(b,e,g){if(b&&b.constructor==Array&&e!=null)b.push(g||e)},extend:function(b,e){for(var g in e)if(e.hasOwnProperty(g))b[g]=e[g];return b},trim:function(b){return b.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},eval:function(b,e){try{return eval.call(undefined,
b)}catch(g){bt_handle_exception((e!=null?e:"")+g)}},Escaper:{javascript:function(b){if(b==undefined||b.constructor!=String)return b;return String(b).replace("\\","\\\\").replace("'","\\x27").replace('"',"\\x22").replace("\n","\\n").replace("\r","\\r")}},Random:{integer:function(b){return Math.floor(Math.random()*(b||1E8))}},defaultConfig:function(){return{loadOnly:false,window:window,document:document,host:"s.thebrighttag.com",parentReferrer:top!=self?self.window.location.href:null,docReferrer:document.referrer,
data:{}}}};BrightTag.Blab={};
BrightTag.Blab.Engine=function(b){function e(){m=true;p=o.length;a("engine:off")}function g(){m=false;q=0;(o[p++]||e)()}function i(k){return function(){var n=false,r=b.createElement("script");r.onload=r.onreadystatechange=function(){var s;if(!(s=n)){a:{switch(r.readyState){case undefined:case "loaded":case "complete":s=true;break a}s=false}s=!s}if(!s){n=true;a("block:finish");g()}};r.src=k;a("block:start",k);var t=b.getElementsByTagName("script")[0];t.parentNode.insertBefore(r,t)}}function j(k){return function(){try{a("block:start",
k);if(k.constructor==String)if(b.defaultView)b.defaultView.eval.call(undefined,k);else b.parentWindow?b.parentWindow.execScript(k):a("block:error","Could not evaluate wait block ["+k+"]");else k()}catch(n){a("block:error",n)}finally{a("block:finish");g()}}}function f(k){o.push(k);m&&g();return c}function d(k){o.splice(p+q++,0,k);return c}function a(k){var n=Array.prototype.slice.call(arguments,1);BrightTag.each(l,function(r){(r[k]||h).apply(null,n)})}var c=this,h=function(){},l=[],m=false,o=[],p=
0,q=0;c.run=function(){a("engine:on",c);g()};c.script=function(k){return f(i(k))};c.wait=function(k){return f(j(k))};c.preemptScript=function(k){return d(i(k))};c.preemptWait=function(k){return d(j(k))};c.listen=function(k){l.push(k);(k["engine:listen"]||h).apply(null,[c]);return c}};
BrightTag.Blab.Group=function(){function b(a){j.push(a)}function e(a){a.run()}function g(){var a=j[f++];a?a.listen(d).run():i.doNotQueue()}var i=this,j=[],f=0,d={"engine:off":function(){g()}};i.doNotQueue=function(){b=e};i.push=function(a){b(a);return a};i.run=function(){g()};i.applyListener=function(a){for(var c=f,h=j.length;c<h;c++)j[c].listen(a)}};
BrightTag.Blab.Manager=function(b){function e(d){var a=new i.Engine(b);g.each(f,function(c){a.listen(c)});return(j[d]||(j[d]=new i.Group)).push(a)}var g=BrightTag,i=g.Blab,j={undefined:new i.Group},f=[];j[undefined].doNotQueue();this.addGlobalListener=function(d){f.push(d);g.each(j,function(a){j[a].applyListener(d)})};this.group=function(d){return e(d)};this.listen=function(){return e().listen.apply(null,arguments)};this.script=function(){return e().script.apply(null,arguments)};this.wait=function(){return e().wait.apply(null,
arguments)};this.run=function(d){(j[d]||(j[d]=new i.Group)).run()};this.setOptions=function(){return e()}};
BrightTag.Blab.SwapwriteListener=function(){var b,e=[],g=function(i){b.push(i)};return function(i){function j(c){c.src&&d.preemptScript(c.src);c.innerHTML&&d.preemptWait(c.innerHTML)}function f(c){try{i.body.appendChild(c.cloneNode(true))}catch(h){bt_handle_exception("BrightTag: error appending content to body: "+h)}}var d,a=i.createElement("div");this["block:start"]=function(){var c=i;e.push([b,c.write,c.writeln]);b=[];c.write=c.writeln=g};this["block:finish"]=function(){try{if(b.length!=0){a.innerHTML=
"<br/>"+b.join("");for(var c=a.childNodes||[],h=1,l=c.length;h<l;h++)(c[h].tagName=="SCRIPT"?j:f)(c[h])}}finally{c=i;h=e.pop();b=h[0];c.write=h[1];c.writeln=h[2]}};this["engine:listen"]=function(c){d=c}}}();BrightTag.Blab.GlobalSwapwriteListener=function(b){var e=BrightTag.Blab;this["engine:listen"]=function(g){g.listen(new e.SwapwriteListener(b))}};
BrightTag.module("EventsManager",function(){function b(){}function e(a,c,h){d(a,c,function(){if(!h||h())BrightTag.EventListenerOverride(a,c)})}function g(a){a=a.documentElement.doScroll||function(){throw"No doScroll";};try{a("left")}catch(c){return false}return true}function i(a){var c=a.readyState;return c=="loading"?false:c=="complete"?true:a.addEventListener?c=="interactive":g(a)}function j(a,c,h){var l=this;setTimeout(function(){a()?c.call(l):j(a,c,h)},h)}var f=this,d=f.listen=function(a,c,h){if(a.addEventListener)a.addEventListener(c,
h,false);else a.attachEvent&&a.attachEvent("on"+c,h)};f.domReady=function(a,c){if(i(a))c.call(this);else a.addEventListener?d(a,"DOMContentLoaded",c):j(function(){return i(a)},c,1)};f.enablePageReadyOverrides=function(a,c){f.enablePageReadyOverrides=b;c.readyState=="complete"?BrightTag.EventListenerOverride(a,"load"):e(a,"load");if(c.addEventListener){var h=c.readyState;h=="complete"||h=="interactive"?BrightTag.EventListenerOverride(c,"DOMContentLoaded"):e(c,"DOMContentLoaded")}}});
BrightTag.module("EventListenerOverride",function(b,e){function g(f){var d=this;setTimeout(function(){try{f.call(d)}catch(a){bt_handle_exception("BrightTag error overriding "+e+" event: "+a)}},0)}var i=b.addEventListener?"addEventListener":"attachEvent",j=b[i];b[i]=function(f,d,a){if(typeof d=="function")if(f==e||f=="on"+e)g(d);else try{i=="addEventListener"?j.call(b,f,d,a):j(f,d)}catch(c){bt_handle_exception("BrightTag error proxying "+f+" event: "+c)}}});BrightTag.module("Events",new BrightTag.EventsManager);
BrightTag.module("EventBindingManager",function(b){var e={},g=[],i=BrightTag.jQueryLoader(b,"BrightTag.jQuery");e.Binder=function(d){var a=this,c=[];a.data=function(h,l){c.push({name:h,dbe:l});return a};a.bindData=function(h,l,m){BrightTag.each(c,function(o){try{BrightTag.instance.data(o.name,i.functionWithAccess(["eventObject","eventData"],"return "+o.dbe+";").call(h,l,m))}catch(p){bt_log("Error binding "+o+": "+p)}})};a.handler=function(h){var l=g[d];if(l){var m=Array.prototype.slice.call(arguments,
1);a.bindData(h.target,h,m);l.handler(h,m)}}};var j=function(){var d=this,a=[],c=[];d.execute=function(l){if(l.constructor==Function)a.push(l);else if(l.constructor==String)try{a.push(i.functionWithAccess(["eventObject","eventData"],l))}catch(m){bt_handle_exception("BrightTag could not execute action: "+m)}else bt_log("execute: bad action = "+l);return d};d.fire=function(l){l=new h(l);c.push(l);return l};d.handler=function(l,m){e.executeActions(a,l,m);e.fireTags(c)};var h=function(l){var m=this,o=
[];m.appendData=function(p){o.push(function(q){q.appendData(p)});return m};m.appendJs=function(p){o.push(function(q){q.appendJs(p)});return m};m.postProcess=function(p){BrightTag.each(o,function(q){q(p)})};m.tagId=l;m.execute=d.execute;m.fire=d.fire}},f=/^direct\//i;e.bind=function(d,a,c){var h=new e.Binder(d);i.ensureJQuery(function(){var l=i.getJQuery()(a);l.live&&a.constructor===String&&!f.test(c)?l.live(c,h.handler):l.bind(c.split(f).pop(),h.handler)});return h};e.when=function(d){return g[d]||
(g[d]=new j)};e.executeActions=function(d,a,c){BrightTag.each(d,function(h){try{h.call(a.target,a,c)}catch(l){bt_handle_exception(l)}})};e.fireTags=function(d){if(d.length>0){var a=BrightTag.instance.serverURL();BrightTag.each(d,function(c){a.cf(c.tagId);c.postProcess(a)});BrightTag.Blab.script(a.asString())}};return e});
BrightTag.module("HTTP",{QueryString:function(b){function e(f){if(f&&typeof f=="string"){var d=f.split("&");f={};i.each(d,function(a){a=a.split("=");a={key:decodeURIComponent(a[0]),value:a[1]&&decodeURIComponent(a[1].replace(/\+/g," "))};f[a.key]=a.value})}return f}var g=this,i=BrightTag,j={};i.extend(j,e(b));g.param=function(f){return j[f]||""};g.params=function(){return j};g.appendParam=function(f,d){if(f&&d!=undefined&&d!=="")j[f]=d;return this};g.appendParams=function(f){i.each(f,g.appendParam);
return this};g.alwaysAppendParam=function(f,d){if(f)j[f]=d!=undefined?d:"";return this};g.alwaysAppendParams=function(f){i.each(f,g.alwaysAppendParam);return this};g.appendPartialQueryString=function(f){f&&g.alwaysAppendParams(e(f));return this};g.toString=function(){var f=[];for(var d in j){var a={key:encodeURIComponent(d),value:encodeURIComponent(j[d])};f.push(a.key+"="+a.value)}return f.join("&")}},URL:function(b){var e=this,g,i,j,f=b.indexOf("#");if(f>-1){j=b.substring(f+1);b=b.substring(0,f)}f=
b.indexOf("?");if(f>-1){i=b.substring(f+1);b=b.substring(0,f)}g=b;b=new BrightTag.HTTP.QueryString(i);BrightTag.extend(e,b);e.queryString=b.toString;e.toString=function(){var d=e.queryString();return g+(d.length>0?"?"+d:"")};e.asString=e.toString;e.fragment=function(){return j}}});
BrightTag.module("ServerURL",function(b){var e=this,g=b.host,i=BrightTag,j=b.parentReferrer,f=b.referrer,d="";if(g.length>0)d=(g.match("^[a-z0-9+.-]+://.+")?"":"//")+g+"/tag";i.HTTP.URL.call(this,d);e.appendParams({site:b.site,referrer:f,docReferrer:b.docReferrer,mode:b.mode});f!==j&&e.appendParam("parentReferrer",j);e.appendData=function(a){return e.alwaysAppendParam("_cb_"+("bt_data('"+a+"')"),bt_data(a))};e.appendJs=function(a){return e.alwaysAppendParam("_cb_"+a,i.eval(a,"Invalid inline JavaScript expression: "+
a+", exception = "))};e.cf=function(a){if(a.constructor!=Array)a=[a];var c=e.param("cf");if(c)a=Array(c).concat(a);e.appendParam("cf",a.join());return e};e.addCf=function(a,c){if(!i.eval(c,"Invalid conditional fire expression: "+c+", exception = "))return false;var h=e.param("cf");e.appendParam("cf",h?h+","+a:a);return true}});
BrightTag.module("Page",function(b,e){function g(k){m.write('<script type="text/javascript" src="'+k+'"><\/script>')}function i(k){m.write(k)}function j(k){o.group(!p?"domready":undefined).wait(function(){m.write(k)})}function f(k){d.writeScript=k?g:q;d.appendContent=k?i:j}var d=this,a=BrightTag,c=undefined,h=b.data||{},l=undefined,m=b.document,o=b.blab||a.Blab,p=false;d.referrer=b.referrer;d.parentReferrer=b.parentReferrer;d.docReferrer=b.docReferrer;var q=o.script;f(b.mode==="sync");d.domReady=
function(){p=true;o.addGlobalListener(new o.GlobalSwapwriteListener(m));b.mode==="sync"&&f(false);o.run("domready")};d.parameter=function(k){if(c==undefined)c=new a.HTTP.URL(m.location.href);return c.param(k)};d.meta=function(k){if(!l){l={};a.each(m.getElementsByTagName("meta"),function(n){l[n.getAttribute("name")]=n.getAttribute("content")})}return l[k]||""};d.data=function(k,n){if(n!==undefined)return h[k]=n;n=h[k];return n==undefined?"":n};d.dbe=function(k,n){d.data(k,a.eval(n,"BrightTag: the data binding expression for '"+
k+"' is invalid: "))};d.serverURL=function(){return new a.ServerURL(b)};d.defaultBaseUri=function(){return(m.location.protocol=="https:"?"https:":"http:")+"//s.btstatic.com/"};d.baseUri=function(){return e&&e.src&&e.src.replace(/[^/]+$/,"")||d.defaultBaseUri()};d.primary=function(){d.writeScript(d.serverURL().toString())};d.secondary=function(k){var n=new a.ServerURL(b),r=n.toString();k(n);k=n.toString();k!=r&&d.writeScript(k)}});
BrightTag.module("CookieSyncEngine",function(b){var e={fn:function(a){a()},next:null},g=e,i=b.document,j=function(a){if(typeof a!="function")return false;a={fn:a,next:null};g=g.next=a;return true},f=function(){if(e){var a=e.fn;e=e.next;a(f)}},d=f;BrightTag.Events.listen(b,"load",d);return{sync:d,push:function(a){return j(a)},pushImage:function(a){return j(function(c){var h=new b.Image;h.onerror=h.onload=c;h.src=a})},pushIframe:function(a){return j(function(c){var h=i.createElement("iframe");h.onerror=
h.onload=c;h.width=0;h.height=0;h.style.border=0;h.src=a;i.body.appendChild(h)})}}});function bt_parameter(b){return BrightTag.instance.parameter(b)}function bt_meta(b){return BrightTag.instance.meta(b)}function bt_data(b,e){return BrightTag.instance.data(b,e)}function bt_data_escaped(b,e){return bt_data(b,e)}function bt_log(b){window.console&&console.log&&console.log(b)}var bt_handle_exception=bt_log,_bt_url_prefix,_bt_referrer,_bt_site,_bt_mode;
function btServe(b){if(BrightTag.instance==undefined){var e=BrightTag,g=e.extend({referrer:_bt_referrer,site:_bt_site,mode:_bt_mode},e.defaultConfig());if(_bt_url_prefix!=undefined)g.host=_bt_url_prefix;e.instance=e.Main(e.extend(g,b||{}))}}
BrightTag.module("jQueryLoader",function(b,e){return new (function(g,i){function j(l){h.wait(l)}function f(l){function m(){a=BrightTag.jQuery;j(l)}c="var $ = BrightTag.$; ";BrightTag.jQuery?m():h.script(BrightTag.instance.baseUri()+"BrightTag.jquery-1.5.1.js").wait(m)}var d={},a=g.jQuery,c="",h=BrightTag.Blab.group(i);d.getJQuery=function(){return a};d.functionWithAccess=function(l,m){return new Function(l,c+m)};d.ensureJQuery=function(l){d.ensureJQuery=j;(a?j:f)(l);BrightTag.Blab.run(i)};return d})(b,
e)});
BrightTag.module("Main",function(b){function e(a){(a=(new i.HTTP.URL(a.src)).fragment())&&i.extend(b,(new i.HTTP.QueryString(a)).params())}function g(a){a=i.trim(a.innerHTML);a.length!=0&&i.extend(b,i.eval("(\n"+a+"\n)","BrightTag configuration error: "))}var i=BrightTag,j=function(){for(var a=/\/tag(\.[^.]+|-n)?\.js(#.*)?$/,c=b.document.getElementsByTagName("script"),h=c.length-1;h>-1;h--){var l=c[h];if(a.test(l.src))return l}}();if(j){e(j);g(j)}if(b.site!=undefined){i.Events.enablePageReadyOverrides(b.window,b.document);
try{var f=new i.Page(b,j);i.Events.domReady(b.document,function(){f.domReady()});b.loadOnly||f.primary();return f}catch(d){bt_handle_exception("BrightTag execution error: "+d)}}});(function(b){if(b.instance==undefined){b.extend(b.Blab,new b.Blab.Manager(document));b.$LAB=b.Blab;b.EventBinding=b.EventBindingManager(window);b.CookieSync=b.CookieSyncEngine(window);b.instance=b.Main(b.defaultConfig())}else bt_log("Tried to load tag.js again")})(window.BrightTag);
