var Currency=new function(){this._params={};this._window_url=null;this._game_height=null;this._game_type="flash";this._flash_obj=null;this._overlay=jQuery("<div></div>").attr("class","body-overlay");this._payment_modal=null;this._credits_iframe=null;this.attempts=0;this._old=false;this.max_attempts=10;this._is_webgame=false;this.init=function(){bodyWidth=jQuery(window).width();bodyHeight=jQuery(window).height();this._game_height=jQuery("#gameContainerSizer").css("height");_game_obj=jQuery("#game-container #game-embed");if(_game_obj.length==0){_game_obj=jQuery("#shockwaveGameContainer embed");this._game_type="shockwave"}this._is_webgame=jQuery("#game-container").hasClass("webgame");this._game_obj=_game_obj;if(jQuery("#payment-modal").length>0){jQuery("#payment-modal").remove()}if(!this._is_webgame){if(this._payment_modal==null){this._payment_modal=jQuery("<div></div>").attr("id","payment-modal").css("z-index",999).css("position","absolute").css("top",(bodyHeight-550)/2).css("left",(bodyWidth-970)/2)}if(this._credits_iframe==null){this._credits_iframe=jQuery("<iframe></iframe>").attr("id","credits_iframe").attr("scrolling","no").css("width",970).css("height",550)}}else{if(this._payment_modal==null){this._payment_modal=jQuery("<div></div>").attr("id","payment-modal").css("z-index",999).css("position","relative")}if(this._credits_iframe==null){this._credits_iframe=jQuery("<iframe></iframe>").attr("id","credits_iframe").attr("scrolling","no").css("width",bodyWidth).css("height",bodyHeight)}}};this.showTopup=function(b){this.init();if(typeof(b)=="undefined"){b={}}if(this._is_webgame){b.webmaster="true"}if(b.old==true){this._old=true}b.type="topup";this._params=b;window_url="/currency/en/purchase/?";for(var a in b){window_url+=a+"="+b[a]+"&"}this._window_url=window_url;this._openWindow();if(this._game_type=="flash"){if(this._old==true){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyTopupWindowOpen)!="undefined"){this._game_obj[0].notifyTopupWindowOpen()}}else{if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyTopupWindowOpened)!="undefined"){this._game_obj[0].notifyTopupWindowOpened()}}}};this.purchaseBundle=function(b){this.init();if(typeof(b)=="undefined"){b={}}if(this._is_webgame){b.webmaster="true"}b.type="currency";this._params=b;window_url="/currency/en/purchase/?";for(var a in b){window_url+=a+"="+b[a]+"&"}this._window_url=window_url;this._openWindow();if(this._game_type=="flash"){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyBundleWindowOpened)!="undefined"){this._game_obj[0].notifyBundleWindowOpened()}}};this.purchaseItem=function(a){this.init();if(typeof(a)=="undefined"){a={}}if(this._is_webgame){a.webmaster="true"}a.type="item";this._params=a;if(this._game_type=="flash"){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyItemWindowOpened)!="undefined"){this._game_obj[0].notifyItemWindowOpened()}if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyItemWindowClosed)!="undefined"){this._game_obj[0].notifyItemWindowClosed({success:false,result:this._params})}}};this._openWindow=function(){this._preloadImages();this._hideGame();if(typeof(this._params.game_id)=="undefined"&&typeof(this._params.source_id)=="undefined"){alert("There has been a problem with the purchase window, please reload the page");this._showGame();return false}jQuery("body").prepend(this._overlay);this._credits_iframe.attr("src",this._window_url);this._payment_modal.append(this._credits_iframe);jQuery("body").prepend(this._payment_modal)};this._hideWindow=function(b,a){this._payment_modal.html("");this._payment_modal.remove();this._overlay.remove();if(this._game_type=="flash"){if(this._params.type=="topup"){if(this._old==true){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyTopupWindowClose)!="undefined"){this._game_obj[0].notifyTopupWindowClose({success:b,result:a})}}else{if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyTopupWindowClosed)!="undefined"){this._game_obj[0].notifyTopupWindowClosed({success:b,result:this._params})}}}else{if(this._params.type=="currency"){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyBundleWindowClosed)!="undefined"){this._game_obj[0].notifyBundleWindowClosed({success:b,result:this._params})}}else{if(this._params.type=="item"){if(typeof(this._game_obj[0])!="undefined"&&typeof(this._game_obj[0].notifyItemWindowClosed)!="undefined"){this._game_obj[0].notifyItemWindowClosed({success:b,result:this._params})}}}}}this._showGame()};this._hideGame=function(){if(this._game_type=="shockwave"){this._game_obj.css("visibility","hidden !important")}else{if(navigator.userAgent.indexOf("MSIE")!=-1){this._game_obj.css("left","-999px")}else{this._game_obj.css("visibility","hidden")}}};this._showGame=function(){if(this._game_type=="shockwave"){this._game_obj.css("visibility","visible !important")}else{if(navigator.userAgent.indexOf("MSIE")!=-1){this._game_obj.css("left","0px")}else{this._game_obj.css("visibility","visible")}}};this._preloadImages=function(){this._preloadImage("http://e.miniclip.com/images/credits/backgrounds/"+this._params.game_id+"_new.jpg")._preloadImage("http://e.miniclip.com/images/credits/amount_button_downstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/amount_button_overstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/amount_button_upstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/avatar_overlay.png")._preloadImage("http://e.miniclip.com/images/credits/barbershop_anim.gif")._preloadImage("http://e.miniclip.com/images/credits/best_deal.png")._preloadImage("http://e.miniclip.com/images/credits/close_button_downstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/close_button_overstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/close_button_upstate_1.png")._preloadImage("http://e.miniclip.com/images/credits/continue_button_downstate.png")._preloadImage("http://e.miniclip.com/images/credits/continue_button_overstate.png")._preloadImage("http://e.miniclip.com/images/credits/continue_button_upstate.png")._preloadImage("http://e.miniclip.com/images/credits/stripes.gif")};this._preloadImage=function(a){(new Image()).src=a;return this};this.parseToFloat=function(a){var b=a[0].toString();b=b.replace(/\,/g,"");return parseFloat(b)};this.sizeCurrency=function(){var b=0;jQuery(".credits_amount_price a").each(function(d,c){price=parseToFloat($(this).text().match(/[0-9]+(?:\,?)[0-9]*\.[0-9]{2}/g));if(price>b){b=price}});var a=1;if(b>9999999){a=0.6}else{if(b>999999){a=0.68}else{if(b>99999){a=0.78}else{if(b>9999){a=0.92}else{if(b>999){a=1}else{if(b>99){a=1.1}else{a=1.2}}}}}}jQuery(".credits_amount_price a").attr("style","font-size: "+a+"em")};this.pollForTransactionCompletion=function(a,c,d,b){start_ts=new Date().getTime();this.interval=setInterval(function(){Currency.checkTransactionStatus(a,c,d,start_ts,b)},5000)};this.checkTransactionStatus=function(a,c,e,d,b){if(!e){e=40}if(this.attempts>e){clearInterval(this.interval);new_location=b+"error=1&reason=MAX_RETRIES";window.location=new_location;return false}jQuery.getJSON("/currency/en/status/?transaction_session="+c,function(f){if(!f){}else{switch(f.status){case"COMPLETE":window.location=b+"state=complete&tw="+Math.round(((new Date().getTime()-d)/1000));break;default:this.attempts++;break}}})};this.debugParams=function(){return JSON.stringify(this._params)};this.trackBundleStats=function(a,e,c){if(typeof(a)=="undefined"){if(c){setTimeout(redirectPage(c),500)}}var b=0;if(typeof(Currency)!="undefined"&&typeof(Currency._params)!="undefined"&&typeof(Currency._params.source_id)!="undefined"){b=Currency._params.source_id}else{if(typeof(game_data)!="undefined"&&typeof(game_data.game_id)!="undefined"){b=game_data.game_id}else{b=0}}var d="binary/credits/topup/"+a+"/"+e+"/"+b;if(statTracker!="undefined"){statTracker(d)}else{if(top.statTracker!="undefined"){top.statTracker(d)}else{}}if(c){setTimeout(redirectPage(c),500)}return false}};var credits=new function(){this._params={old:true};this.__init=function(a){this._params.game_id=a};this.ShowTopupWindow=function(){Currency.showTopup(this._params)};this.ShowPurchaseOptions=function(){Currency.showTopup(this._params)};this.HideTopupWindow=function(b,a){Currency._hideWindow(b,a)};this.SetWindowType=function(){};this.GetGameId=function(){return this._params.game_id};this.GetGameWidth=function(){return Currency._game_height};this.GetGameHeight=function(){return Currency._game_height};this.GetWindowType=function(){return 1}};