(function(window,cds,$){var document=window.document,protocol=document.location.protocol,isDebug=cds.isDebug||true,encode64=function(input){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=escape(input);var output="",chr1,chr2,chr3="",enc1,enc2,enc3,enc4="",i=0;do{chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2))enc3=enc4=64;else if(isNaN(chr3))enc4=64;output=output+keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);chr1=chr2=chr3="";enc1=enc2=enc3=enc4=""}while(i<input.length);return output},cdsSocial={_isConfigLoaded:false,_isFacebookSdkLoaded:false,_isGoogleSdkLoaded:false,_isFacebookConnected:false,_appID:"",_nameSpace:"",_debug:"",_urlApi:"",_catalyser:"",_loadUser:false,_fbUser:null,_perms:"",_fbSdkLoadedFunction:[],_loginStatusFunction:[],_likeFunction:[],_loginFunction:[],_messageFunction:[],_userInfosFunction:[],_useParsing:false,_isLogged:false,encode64:encode64,_url:"",SetAutoLoading:function(activate){localStorage&&localStorage.setItem("SocialAutoLoading",activate)},GetAutoLoading:function(){var autoLoading=false;if(localStorage)autoLoading=localStorage.getItem("SocialAutoLoading");return autoLoading==="true"},AddToFBSdkLoadedFunction:function(functionToAdd){this._fbSdkLoadedFunction.push(functionToAdd)},AddToLoginStatus:function(functionToAdd){this._loginStatusFunction.push(functionToAdd)},AddToLikeFunction:function(functionToAdd){this._likeFunction.push(functionToAdd)},AddToLoginFunction:function(functionToAdd){this._loginFunction.push(functionToAdd)},AddToMessageFunction:function(functionToAdd){this._messageFunction.push(functionToAdd)},AddToGetUserInfosFunction:function(functionToAdd){this._userInfosFunction.push(functionToAdd)},_onLogin:function(response){if(!cdsSocial._isLogged){cdsSocial._isLogged=true;cdsSocial._fbUser={id:response.authResponse.userID,name:"",picture:"",token:response.authResponse.accessToken,fulldata:null};cdsSocial._isFacebookConnected=true;$.ajax({type:"POST",url:cdsSocial._url+"RegisterUserConnect.mvc/",data:"",success:cdsSocial._omnitureResponse});for(var i=0;i<cdsSocial._loginFunction.length;i++)cdsSocial._loginFunction[i](response)}},_omnitureResponse:function(response){response=response.substring(response.indexOf(">",0)+1,response.lastIndexOf("<",response.length));eval(response)},_onMessage:function(response){for(var i=0;i<cdsSocial._messageFunction.length;i++)cdsSocial._messageFunction[i](response)},_onLike:function(response){for(var i=0;i<cdsSocial._likeFunction.length;i++)cdsSocial._likeFunction[i](response)},Login:function(){FB.login(function(response){response.authResponse==null&&console.log("User cancelled login or did not fully authorize.")},{scope:cdsSocial._perms})},Logout:function(){FB.logout(function(){cdsSocial.SetAutoLoading(false);window.location.replace(window.location)})},GetUserInfos:function(){if(cdsSocial._isFacebookConnected)FB.api("/me?fields=picture,name",function(response){if(response.picture!==""&&response.name!==""){cdsSocial._fbUser.name=response.name;cdsSocial._fbUser.picture=response.picture;FB.api("/me",function(responseMe){cdsSocial._fbUser.fulldata=responseMe;for(var i=0;i<cdsSocial._userInfosFunction.length;i++)cdsSocial._userInfosFunction[i](response)})}});else console.log("Error CDSocial : FBConnect not initialized")},Load:function(useCatalyser){if(!this._isConfigLoaded){var configDiv=document.getElementById("fb-root");if(configDiv==null){this._appID="200380353339459";this._nameSpace="cdssocial:";this._debug=false;this._urlApi="http://connect.facebook.net/fr_FR/all.js";this._perms=""}else{this._appID=$("#fb-root").attr("data-id");this._nameSpace=$("#fb-root").attr("data-namespace");this._debug=$("#fb-root").attr("data-debug")==="true";this._urlApi=protocol==="https:"?$("#fb-root").attr("data-url").replace("http:",protocol):$("#fb-root").attr("data-url");this._perms=$("#fb-root").attr("data-perms")}if(this._debug)this._url="http://www.r2.cdiscount.com/";else this._url="http://www.cdiscount.com/Ajax/"}var autoLoading=this.GetAutoLoading();if(!autoLoading)if(useCatalyser){if(this._catalyser==="")this._catalyser=".loadSocialScript";var catalyser=$(this._catalyser);catalyser[0]!=null&&$(this._catalyser).mouseover(function(){!cdsSocial._isFacebookSdkLoaded&&cdsSocial._loadAllSdk()})}else!cdsSocial._isFacebookSdkLoaded&&cdsSocial._loadAllSdk();else!cdsSocial._isFacebookSdkLoaded&&cdsSocial._loadAllSdk()},_loadFBSdk:function(){!cdsSocial._isFacebookSdkLoaded&&cds.loadScript({src:cdsSocial._urlApi},function(){if(typeof FB=="undefined")cdsSocial._fBIsNull();else cdsSocial._initApp()})},_loadGoogleSdk:function(){var d=new Date;if(!cdsSocial._isGoogleSdkLoaded)if($("#google-root").length){cds.loadScript({src:"https://apis.google.com/js/plusone.js",text:"{lang: 'fr'}"},function(){isDebug&&cds.log("[RS] https://apis.google.com/js/plusone.js is loaded");$(".FakeGPlusButton").each(function(){$(this).hide()})});cdsSocial._isGoogleSdkLoaded=true}},_loadAllSdk:function(){cdsSocial._loadFBSdk();cdsSocial._loadGoogleSdk()},_fBIsNull:function(){if(typeof FB=="undefined")window.setTimeout(function(){cdsSocial._fBIsNull()},1);else cdsSocial._initApp()},_initApp:function(){if(!cdsSocial._isFacebookSdkLoaded){FB.init({appId:cdsSocial._appID,status:true,cookie:true,xfbml:cdsSocial._useParsing});cdsSocial._isFacebookSdkLoaded=true;for(var i=0;i<cdsSocial._fbSdkLoadedFunction.length;i++)cdsSocial._fbSdkLoadedFunction[i]();$(".FakeLikeButton").each(function(){$(this).hide()});FB.Event.subscribe("auth.login",cdsSocial._onLogin);FB.Event.subscribe("edge.create",cdsSocial._onLike);FB.Event.subscribe("message.send",cdsSocial._onMessage);FB.getLoginStatus(function(response){if(response.status==="connected"){cdsSocial._fbUser={id:response.authResponse.userID,name:"",picture:"",token:response.authResponse.accessToken,fulldata:null};cdsSocial._isFacebookConnected=true;$.ajax({type:"POST",url:cdsSocial._url+"RegisterUserConnect.mvc/",data:"",success:cdsSocial._omnitureResponse});for(var i=0;i<cdsSocial._loginStatusFunction.length;i++)cdsSocial._loginStatusFunction[i](response)}else if(response.status==="not_authorized")console.log("error");else console.log("not connected to facebook")})}}};window["cdsSocial"]=cdsSocial;var cdsWant={_wantedCounterCache:null,_itemClicked:null,_wantedZone:[],_namespace:"",_isDebug:false,_isConnected:false,_url:"",_postingWant:false,_deletingWant:false,Add_WantedZone:function(value){this._wantedZone.push(value)},CreateButton:function(isConnected){if(this._isDebug)this._url="http://www.r2.cdiscount.com/";else this._url="http://www.cdiscount.com/Ajax/";this._isConnected=isConnected;for(var i=0;i<this._wantedZone.length;i++)this._initCounterCache(this._wantedZone[i])},_ajaxify:function(url,successFunction){url=url.replace("{0}",this._url);$.ajax({type:"POST",url:url,data:"",success:successFunction,error:function(response){console.log("error during rendering : "+response)}})},_successCounterCallback:function(response){cdsWant._wantedCounterCache=eval(response);if(cdsWant._isConnected)cdsWant._createButtons();else for(var i=0;i<cdsWant._wantedZone.length;i++)cdsWant._createConnectedWantButtons(cdsWant._wantedZone[i])},_initCounterCache:function(jQueryIds){var IdToSearch=".WantButton",jSonProducts="";if(jQueryIds!=null&&jQueryIds!="")IdToSearch=jQueryIds+" .WantButton";$(IdToSearch).each(function(){if(jSonProducts==="")jSonProducts=$(this).attr("data-productid");else jSonProducts=jSonProducts+","+$(this).attr("data-productid")});this._ajaxify("{0}GetWantCounter.mvc/"+jSonProducts,this._successCounterCallback)},_createButtons:function(){for(var i=0;i<cdsWant._wantedZone.length;i++){cdsWant._createWantButtons(cdsWant._wantedZone[i]);cdsWant._bindButtons(cdsWant._wantedZone[i])}},_createConnectedWantButtons:function(jQueryIds){var currentObject=this,IdToSearch=".WantButton";if(jQueryIds!=null&&jQueryIds!="")IdToSearch=jQueryIds+" .WantButton";$(jQueryIds+" .FakeWantButton").each(function(){$(this).hide()});$(IdToSearch).each(function(){currentObject._setStructure($(this));$(this).children(".main").unbind();$(this).children(".main").bind("click",function(){cdsSocial.Login();currentObject._itemClicked=$(this)})})},_setStructure:function(object){var counter=this._getKeyInCounterCache(object.attr("data-productid"));if(object.html().length===0){if(counter===0)object.append('<div class="main"><div class="icon"></div><div class="label">Je veux !</div><div style="clear:left"></div></div><div id="counterFor'+object.attr("data-productid")+'" class="counter displaynone"><div class="arrow">&nbsp;</div><div class="outer"><div class="label">'+counter+'</div></div></div><div style="clear:left"></div>');else object.append('<div class="main"><div class="icon"></div><div class="label">Je veux !</div><div style="clear:left"></div></div><div id="counterFor'+object.attr("data-productid")+'" class="counter"><div class="arrow">&nbsp;</div><div class="outer"><div class="label">'+counter+'</div></div></div><div style="clear:left"></div>');$('<div id="tipFor'+object.attr("data-productid")+'" class="tip"><span class="arrow">&nbsp;</span><div class="innerDiv"></div></div>').insertAfter(object)}},_createWantButtons:function(jQueryIds){var currentObject=this,IdToSearch=".WantButton";if(jQueryIds!=null&&jQueryIds!="")IdToSearch=jQueryIds+" .WantButton";$(jQueryIds+" .FakeWantButton").each(function(){$(this).hide()});$(IdToSearch).each(function(){if($(this).attr("data-actionid")!=null)$(this).attr("data-actionid")!==""&&$(this).attr("class","WantButtonActivated");else console.log("data-actionid is missing !");currentObject._setStructure($(this))})},_bindButtons:function(jQueryIds){var currentObject=this,IdToSearchWantButton=".WantButton .main",IdToSearchWantButtonActivated=".WantButtonActivated .main";if(jQueryIds!=null&&jQueryIds!="")IdToSearchWantButton=jQueryIds+" .WantButton .main";if(jQueryIds!=null&&jQueryIds!="")IdToSearchWantButtonActivated=jQueryIds+" .WantButtonActivated .main";$(IdToSearchWantButton).unbind();$(IdToSearchWantButtonActivated).unbind();$(IdToSearchWantButton).bind("click",function(){currentObject._postWantedProductOnFacebook($(this),$(this).parent().attr("data-url"),$(this).parent().attr("data-productid"),cdsSocial._nameSpace)});$(IdToSearchWantButtonActivated).bind("click",function(){currentObject._deleteWantedProductOnFacebook($(this),$(this).parent().attr("data-url"),$(this).parent().attr("data-productid"))});$(IdToSearchWantButton).fadeIn("slow");$(IdToSearchWantButtonActivated).fadeIn("slow");if(currentObject._itemClicked!=null){currentObject._itemClicked.click();currentObject._itemClicked=null}},_increaseCounter:function(productId){var counterName="#counterFor"+productId,counter=parseInt($(counterName+" .label").text())+1;if(counter>0){$(counterName+" .label").text(counter);$(counterName).show()}},_decreaseCounter:function(productId){var counterName="#counterFor"+productId,counter=parseInt($(counterName+" .label").text())-1;$(counterName+" .label").text(counter);counter===0&&$(counterName).hide()},_postWantedProductOnFacebook:function(object,urlToPost,productId,namespace){var currentObject=this,tipName="#tipFor"+productId;$("html").unbind("click."+tipName);$(tipName).children(".innerDiv").html('<div class="loadingFB"></div>');$(tipName).show();if(!this._postingWant){this._postingWant=true;FB.api("/me/"+namespace+"want?product="+urlToPost+"&end_time=12/12/2030","post",function(response){object.unbind();var tooltipText="";if(!response||response.error)if(response.error.message.indexOf("Timeline")!=-1)tooltipText='Malheureusement vous ne pouvez pas utiliser le bouton  "Je Veux" car votre profil Facebook n’utilise pas le format Timeline. Nous sommes désolés pour ce désagrément.';else tooltipText=response.error.message+" : "+response.error.type;else{currentObject._increaseCounter(productId);try{cds.sendRequest(currentObject._url+"AddToWishlist.mvc/"+cdsSocial._fbUser.fulldata.id+"/"+response.id+"/"+productId)}catch(error){}tooltipText='Ca y est ! Tes amis savent que tu veux ce produit.<br/>Rends-toi sur ton <a href="http://www.cdiscount.com/shopping-social.html" target="_blank">Shopping social !</a>';try{omnCountSocNetw("Want")}catch(error){}}object.parent().attr("class","WantButtonActivated");object.bind("click",function(){currentObject._deleteWantedProductOnFacebook($(this),urlToPost,productId)});$(tipName).children(".innerDiv").html(tooltipText);$(tipName).show("fast");$(tipName).bind("click",function(){$(this).hide()});currentObject._postingWant=false})}},_deleteWantedProductOnFacebook:function(object,urlToPost,productId){var currentObject=this,tipName="#tipFor"+productId,id=object.parent().attr("data-actionid");try{cds.sendRequest(currentObject._url+"RemoveFromWishlist.mvc/"+cdsSocial._fbUser.fulldata.id+"/"+productId)}catch(error){}object.unbind();currentObject._decreaseCounter(productId);object.parent().attr("data-actionid","");currentObject._deletingWant=false;object.parent().attr("class","WantButton");object.bind("click",function(){currentObject._postWantedProductOnFacebook($(this),urlToPost,productId,cdsSocial._nameSpace)});if(id!=null)if(!this._deletingWant){this._deletingWant=true;FB.api("/"+id,"delete",function(response){(!response||response.error)&&console.log(response.error.message+" : "+response.error.type)})}},_getKeyInCounterCache:function(productid){for(var returnValue=null,i=0;i<this._wantedCounterCache.length;i++)if(this._wantedCounterCache[i].ProductId===productid){return parseInt(this._wantedCounterCache[i].WishCount);break}}};window["cdsWant"]=cdsWant;var cdsShareBasket={_sharedButtonCache:null,_itemClicked:null,_sharedZone:[],_namespace:"",_isDebug:false,_isConnected:false,_url:"",_isImageButton:false,_backgroundUrl:"",Add_SharedZone:function(value){this._sharedZone.push(value)},CreateButton:function(isConnected){this._isConnected=isConnected;if(this._isConnected)for(var i=0;i<this._sharedZone.length;i++){this._createShareButtons(this._sharedZone[i]);this._bindButtons(this._sharedZone[i])}else for(var i=0;i<this._sharedZone.length;i++)this._createConnectedShareButtons(this._sharedZone[i])},_createConnectedShareButtons:function(sharedZone){this._createShareButtons(sharedZone);this._bindAuthentification()},_setStructure:function(object){var arrowPosition="",cssClass="arrow";if(object.attr("data-background")!=null&&object.attr("data-background")!==""){this._isImageButton=true;this._backgroundUrl=object.attr("data-background")}if(object.attr("data-arrowposition")!=null&&object.attr("data-arrowposition")!=="")arrowPosition=object.attr("data-arrowposition");if(object.html().length===0)if(this._isImageButton){var imgServerUrl="http://i4.cdscdn.com/struct/",imgSecuredServerUrl=object.attr("data-securedImageServerUrl");if(imgSecuredServerUrl!=null&&imgSecuredServerUrl.length>0)imgServerUrl=imgSecuredServerUrl;this._backgroundUrl=imgServerUrl+this._backgroundUrl;if(arrowPosition==="right")cssClass="arrowRight";object.append('<div class="mainWithBackground"><img src="'+this._backgroundUrl+'" alt="button background"/></div>');$('<div id="tipForShare" class="tip"><span class="'+cssClass+'">&nbsp;</span><div class="innerDiv"></div></div>').insertAfter(object)}else{object.append('<div class="main"><div class="icon"></div><div class="label">Partager mon panier</div></div><div style="clear:left"></div>');$('<div id="tipForShare" class="tip"><span class="arrow">&nbsp;</span><div class="innerDiv"></div></div>').insertAfter(object)}},_createShareButtons:function(sharedZone){var currentObject=this,IdToSearch=".ShareBasketButton";if(sharedZone!=null&&sharedZone!="")IdToSearch=sharedZone+" .ShareBasketButton";$(IdToSearch).each(function(){currentObject._setStructure($(this))})},_displaySuccessFunction:function(response){var currentObject=this,str='<div id="tooltipContent" data-basketurl="#0" data-productdiscount="#1" data-productname="#2" data-productprice="#3" data-productimageurl="#4" data-clientid="#5" data-orderid="#6"><div style="float:left; width:120px; height:100px;"><img style="margin:5px;width:90px" src="#4" alt="#2" /></div><div style="float:left; width:300px;"><div id="tooltipTitle">{0} a partagé son panier !</div><div id="tooltipText">#7</div></div><div style="clear:left"></div></div><div id="tooltipButtons" style="text-align:right"><button id="savePost">Accepter</button><button id="cancelPost">Annuler</button></div><div id="endPostTooltip"></div>';if(str!=null&&str!==""){str=str.replace("#0",response.BasketShareBaseUrl);str=str.replace("#1",response.ProductDiscount);str=str.replace(new RegExp("#2","g"),response.ProductName);str=str.replace("#3",response.ProductPrice);str=str.replace(new RegExp("#4","g"),response.ProductImage);str=str.replace("#5",response.CdsClientId);str=str.replace("#6",response.OrderId);str=str.replace("#7",response.ShareSummary);str=str.replace("{0}",cdsSocial._fbUser.fulldata.first_name).replace("{0}",cdsSocial._fbUser.fulldata.first_name);$("#tipForShare .innerDiv").html(str);var marginleft=$(".ShareBasketButton").attr("data-marginleft");if(marginleft!=="")$("#tipForShare").attr("style","left:"+marginleft+"px;");else $("#tipForShare").offset({left:$(".ShareBasketButton .main").offset().left,top:$(".ShareBasketButton .main").offset().top+$(".ShareBasketButton").height()});$("#tipForShare").show()}$("#cancelPost").bind("click",function(){!currentObject._isImageButton&&$(".ShareBasketButton .main .iconLoad").attr("class","icon");$("#tipForShare").offset({left:0,top:0});$("#tipForShare").hide();return false});$("#savePost").bind("click",function(){var cmdId=$("#tooltipContent").attr("data-orderId"),clientId=$("#tooltipContent").attr("data-clientId"),productImageUrl=$("#tooltipContent").attr("data-productImageUrl"),productPrice=$("#tooltipContent").attr("data-productPrice"),productName=$("#tooltipContent").attr("data-productName"),productDiscount=$("#tooltipContent").attr("data-productDiscount"),url="{0}AddShareBasket.mvc/"+cmdId+"/"+cdsSocial._fbUser.fulldata.id+"/"+encode64(cdsSocial._fbUser.fulldata.first_name)+"/"+clientId+"/"+encode64(productName)+"/"+productPrice+"/"+productDiscount+"/?productImage="+encode64(productImageUrl),serverUrl=$(".ShareBasketButton").attr("data-serversubmit");url=url.replace("{0}",serverUrl);$.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"cdsShareBasket._addShareSuccessFunction",url:url});return false})},_bindButtons:function(sharedZone){var currentObject=this,IdToSearch=".ShareBasketButton";if(sharedZone!=null&&sharedZone!="")IdToSearch=sharedZone+" .ShareBasketButton";$(IdToSearch).unbind();$(IdToSearch).bind("click",function(){!currentObject._isImageButton&&$(".ShareBasketButton .main .icon").attr("class","iconLoad");var serverUrl=$(this).attr("data-serversubmit"),url="{0}DisplayShareBasket.mvc/"+$(this).attr("data-cmd");url=url.replace("{0}",serverUrl);$.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"cdsShareBasket._displaySuccessFunction",url:url})});if(currentObject._itemClicked!=null){currentObject._itemClicked.click();currentObject._itemClicked=null}},_bindAuthentification:function(sharedZone){var currentObject=this,IdToSearch=".ShareBasketButton";if(sharedZone!=null&&sharedZone!="")IdToSearch=sharedZone+" .ShareBasketButton";$(IdToSearch).bind("click",function(){currentObject._itemClicked=$(this);cdsSocial.Login()})},_sendTracking:function(){var s=s_gi(s_account);s.linkTrackVars="events,eVar54";s.linkTrackEvents="event34";s.eVar54="Partage Panier";s.events="event34";s.tl(this,"o","Partage Reseaux Sociaux")},_addShareSuccessFunction:function(response){var currentObject=this,basketUrl=$("#tooltipContent").attr("data-basketUrl");productPrice=$("#tooltipContent").attr("data-ProductPrice"),productName=$("#tooltipContent").attr("data-productName"),productDiscount=$("#tooltipContent").attr("data-productDiscount"),productImageUrl=$("#tooltipContent").attr("data-productImageUrl"),clientId=$("#tooltipContent").attr("data-clientId"),guid=response.UID;facebookApi="me/"+cdsSocial._nameSpace+"recommend&basket="+basketUrl.replace("[0]",guid)+"&price="+productPrice+"&eco="+productDiscount+"&image="+productImageUrl+"&produit="+productName+"&ref="+guid;FB.api(facebookApi,"post",function(response){if(!response||response.error)if(response.error.message.indexOf("Timeline")!=-1)$("#tipForShare .innerDiv").html("<p class='label'>Cette fonctionnalité n'est disponible que pour les profils Facebook utilisant le format Timeline. Mettez votre profil à jour si vous souhaitez en profiter.</p>");else console.log(response.error.message+" : "+response.error.type);else{$("#tipForShare .innerDiv").html("<p class='label'>Votre panier est partagé. Il est disponible <a target='_blank' href='"+$(".ShareBasketButton").attr("data-pageurl").replace("[0]",guid)+"'>ICI</a></p>");$(".ShareBasketButton").unbind();if(!currentObject._isImageButton){$(".ShareBasketButton").attr("class",$(".ShareBasketButton").attr("class").replace("ShareBasketButton","ShareBasketButtonActivated"));$(".ShareBasketButtonActivated .main .iconLoad").attr("class","icon")}var serverUrl=$(".ShareBasketButton").attr("data-serversubmit");cds.sendRequest(serverUrl+"SaveBasketActionId.mvc/"+cdsSocial._fbUser.fulldata.id+"/"+guid+"/"+response.id);cdsShareBasket._sendTracking()}})}};window["cdsShareBasket"]=cdsShareBasket})(window,cds,jQuery);